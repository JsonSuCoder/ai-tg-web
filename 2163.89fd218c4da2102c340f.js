(self.webpackChunkTelyAI=self.webpackChunkTelyAI||[]).push([[2163],{1671:()=>{},7971:(t,e,a)=>{"use strict";a.a(t,async(t,n)=>{try{a.d(e,{Ah:()=>b,Al:()=>O,ER:()=>M,LW:()=>I,WE:()=>p,_b:()=>T,aT:()=>S,mu:()=>x,tg:()=>h,ur:()=>A});var s=a(25279),i=a(72531),o=a(77787),c=a(81120),r=a(96140),m=a(90709),u=a(74167),d=a(69036),g=a(30020),l=a(13439),f=a(60919),y=t([r,u]);[r,u]=y.then?(await y)():y,g.GlobalWorkerOptions.workerSrc="pdf.worker.min.js";const w=a(70306);async function p(t,e=!1){if(!t.isMentioned||!t.content?.text?.text)return;let a={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,s.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-reply-mention"}],content:JSON.stringify({messageId:t.id,content:t.content.text?.text,isAuto:e,status:"loading"})};await v(a),(0,c.Rx)({message:t.content.text?.text,language:z()}).then(n=>{n.text?(a={...a,content:JSON.stringify({messageId:t.id,content:t.content.text?.text,replys:n.text,isAuto:e,status:"success"})},v(a)):J(a,t,e)}).catch(n=>{console.log("error",n),J(a,t,e)})}async function h(t,e=!1){const a=t.content?.photo;if(!a)return;const n=(0,m.VO)(a,"download");if(!n)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,s.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await v(i),await N({mimeType:"image/jpeg",mediaHash:n,message:t,newMessage:i,isAuto:e})}async function A(t,e=!1){const a=(0,l.mS)(),n=(0,f.Pn$)(a,t),i=n?n?.url:t.content?.text?.text;if(!i||""===i)return;let o={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,s.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await v(o),(0,c.U$)({url:i,text:t.content?.text?.text||"",language:z()}).then(a=>{a?.text?(o={...o,content:JSON.stringify({message:t,summaryInfo:a?.text,isAuto:e,status:"success"})},v(o)):J(o,t,e)}).catch(a=>{console.log("error",a),J(o,t,e)})}async function x(t,e=!1){const a=t.content?.document;if(!a)return;const n=(0,m.VO)(a,"download");if(!n)return;if(M(a.mimeType)&&e)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,s.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};if(await v(i),M(a.mimeType))return void N({mimeType:a.mimeType,mediaHash:n,message:t,newMessage:i,isAuto:e});if(o=a.mimeType,["video/mp4"].indexOf(o)>=0)return void await D({mediaHash:n,mimeType:a?.mimeType,filename:a?.fileName,size:a?.size,newMessage:i,message:t,isAuto:e});var o;await u.hd(n,0);const r=u.Ih(n);if(!r)return;const d=await fetch(r),l=await d.blob(),f=await l.arrayBuffer();let y="";switch(a.mimeType){case"text/plain":y=(new TextDecoder).decode(f);break;case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":y=(await w.extractRawText({arrayBuffer:f})).value;break;case"application/pdf":const a=await g.getDocument({data:f}).promise;let n="";for(let t=1;t<=a.numPages;t++){const e=await a.getPage(t);n+=(await e.getTextContent()).items.map(t=>t.str).join(" ")+"\n"}y=n;break;default:return void await J(i,t,e)}""!==y?(0,c.OJ)({content:y,language:z()}).then(a=>{a?.text?(i={...i,content:JSON.stringify({message:t,summaryInfo:a?.text,isAuto:e,status:"success"})},v(i)):J(i,t,e)}).catch(a=>{console.log("error",a),J(i,t,e)}):await J(i,t,e)}async function T(t,e=!1){const a=t.content?.voice;if(!a)return;const n=(0,m.VO)(a,"download");if(!n)return;const i=Math.floor(4194304);if(t.content.audio?.size&&t.content.audio?.size*(4/3)>i)return void d.Ay.info("File size exceeds limit (4 MB)");let o={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,s.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await v(o),await D({mediaHash:n,mimeType:"audio/ogg",filename:a?.id+".ogg",size:a?.size,newMessage:o,message:t,isAuto:e})}async function I(t,e=!1){const a=t.content?.audio;if(!a)return;const n=(0,m.VO)(a,"download");if(!n)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,s.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await v(i),await D({mediaHash:n,mimeType:a?.mimeType,filename:a?.fileName,size:a?.size,newMessage:i,message:t,isAuto:e})}async function O(t,e=!1){const a=t.content?.video;if(!a)return;const n=(0,m.VO)(a,"download");if(!n)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,s.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await v(i),"video/mp4"===a?.mimeType?await D({mediaHash:n,mimeType:a?.mimeType,filename:a?.fileName,size:a?.size,newMessage:i,message:t,isAuto:e}):await J(i,t,e)}async function v(t){await(o.zs.message?.storeMessage(t)),await i.A.emit(i.E.AddRoomAIMessage,t)}async function D({mediaHash:t,mimeType:e,filename:a,size:n,newMessage:s,message:i,isAuto:o}){try{if(n&&n>4718592)return d.Ay.info("File size exceeds limit (4.5 MB)"),s={...s,content:JSON.stringify({message:i,errorMsg:"File size exceeds limit (4.5 MB)",isAuto:o,status:"error"})},void await v(s);await u.hd(t,0);const r=u.Ih(t);if(!r)return void J(s,i,o);const m=await fetch(r),g=await m.blob(),l=new FormData;l.append("file",g,a||"audio.ogg"),l.append("language",z()),e&&l.append("mimeType",e);const f=await(0,c.DF)(l);f?.text?v(s={...s,content:JSON.stringify({message:i,summaryInfo:f?.text,isAuto:o,status:"success"})}):J(s,i,o)}catch(t){console.log("error",t),J(s,i,o)}}async function N({mimeType:t,mediaHash:e,message:a,newMessage:n,isAuto:s}){await u.hd(e,0);const i=u.Ih(e);if(!i)return void J(n,a,s);const o=await fetch(i),r=await o.blob(),m=new FileReader;m.onloadend=function(){const e=m.result?.toString().split(",")[1]||"";(0,c.IT)({image:`data:${t};base64,`+e,language:z()}).then(t=>{t?.text?v(n={...n,content:JSON.stringify({message:a,summaryInfo:JSON.stringify({text:t?.text}),isAuto:s,status:"success"})}):J(n,a,s)}).catch(t=>{console.log("error",t),J(n,a,s)})},m.readAsDataURL(r)}function S(t){const{photo:e,document:a,webPage:n,voice:s,audio:i,text:o,video:c}=t?.content,r=b(o?.text),m=o?.text&&""!==o.text.trim();return e||a||n&&!m||s||i||r||c}function b(t){return"string"==typeof t&&/^https?:\/\/[\w\-._~:/?#[\]@!$&'()*+,;=%]+$/i.test(t)}function M(t){return t.startsWith("image/")}async function J(t,e,a){t={...t,content:JSON.stringify({message:e,isAuto:a,status:"error"})},await v(t)}function z(){const t=(0,l.mS)(),{autoTranslateLanguage:e="en"}=t.settings.byKey;return new Intl.DisplayNames([e],{type:"language"}).of(e)||"en"}n()}catch(k){n(k)}})},15365:()=>{},25352:()=>{},26959:()=>{},58725:(t,e,a)=>{"use strict";a.a(t,async(t,n)=>{try{a.d(e,{default:()=>r});var s=a(7971),i=t([s]),o=i.then?(await i)():i;s=o[0];class c{static messageListener(t){const{webPage:e,photo:a,video:n,audio:i,voice:o,document:c,text:r}=t.content,m=(0,s.Ah)(r?.text);t.isMentioned?(0,s.WE)(t,!0):e&&!r?.text||m?(0,s.ur)(t,!0):a||(o?(0,s._b)(t,!0):i?(0,s.LW)(t,!0):c?(0,s.mu)(t,!0):n&&(0,s.Al)(t,!0))}}const r=c;n()}catch(t){n(t)}})},60195:()=>{},98196:()=>{}}]);
//# sourceMappingURL=2163.89fd218c4da2102c340f.js.map