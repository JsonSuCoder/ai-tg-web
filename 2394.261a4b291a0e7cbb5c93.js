"use strict";(self.webpackChunkTeleGPT=self.webpackChunkTeleGPT||[]).push([[2394],{285:(e,t,a)=>{a.d(t,{A:()=>d});var n=a(84051),i=a(13439),o=a(90709),s=a(60919),r=a(4961),c=a(59030),l=a(94189);const d=(0,n.ph)((0,i.EK)((e,{userId:t})=>{const a=(0,s.meB)(e),n=t&&(0,s.mBe)(e,t);return{chat:a,contactName:n?(0,o.u0)(n):void 0}})(({isOpen:e,chat:t,userId:a,contactName:o,onClose:s})=>{const{deleteChatMember:d}=(0,i.ko)(),u=(0,c.A)(),p=(0,n.hb)(()=>{d({chatId:t.id,userId:a}),s()},[t,d,s,a]);if(t&&a)return n.Ay.createElement(l.A,{isOpen:e,onClose:s,title:u("GroupRemoved.Remove"),textParts:(0,r.A)(u("PeerInfo.Confirm.RemovePeer",o)),confirmLabel:u("lng_box_remove"),confirmHandler:p,confirmIsDestructive:!0})}))},12859:(e,t,a)=>{a.d(t,{Hc:()=>k,JD:()=>w,cw:()=>b,ow:()=>I,re:()=>T,sN:()=>S});var n=a(66644),i=a(96454),o=a(85982),s=a(14487),r=a(87894),c=a(6e4),l=a(41733),d=a(24021),u=a(90709),p=a(13439),m=a(80840),g=a(32989),A=a(60919),f=a(71331),v=a(42347);const h="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";let V,y,C;function b(){return w(),Promise.all(Object.values(C).map(e=>{const t=e.src;return e.src=h,e.muted=!0,e.volume=1e-4,e.play().then(()=>{e.pause(),e.volume=1,e.currentTime=0,e.muted=!1,(0,n.Uz)(()=>{e.src=t})})}))}function w(){if(C)return;const e=new Audio("./voicechat_join.mp3"),t=new Audio("./voicechat_connecting.mp3");t.loop=!0;const a=new Audio("./voicechat_leave.mp3"),n=new Audio("./voicechat_onallowtalk.mp3"),i=new Audio("./call_busy.mp3"),o=new Audio("./call_connect.mp3"),s=new Audio("./call_end.mp3"),r=new Audio("./call_incoming.mp3");r.loop=!0;const c=new Audio("./call_ringing.mp3");c.loop=!0,C={join:e,allowTalk:n,leave:a,connecting:t,incoming:r,end:s,connect:o,busy:i,ringing:c}}(0,p.aJ)("toggleGroupCallPanel",(e,t,a)=>{const{force:n,tabId:i=(0,s.g0)()}=a||{};return(0,g.w)(e,{isCallPanelVisible:"force"in(a||{})?n:!(0,A.nTw)(e,i).isCallPanelVisible},i)}),(0,p.aJ)("createGroupCall",async(e,t,a)=>{const{chatId:n,tabId:i=(0,s.g0)()}=a,o=(0,A.hds)(e,n);if(!o)return;const r=await(0,d.px)("createGroupCall",{peer:o});r&&(e=(0,p.mS)(),e=(0,m.h9)(e,r.id,{...r,chatId:n}),(0,p.UF)(e),t.requestMasterAndJoinGroupCall({id:r.id,accessHash:r.accessHash,tabId:i}))}),(0,p.aJ)("createGroupCallInviteLink",async(e,t,a)=>{const{tabId:n=(0,s.g0)()}=a||{},i=(0,f.iT)(e);if(!i||!i.chatId)return;const r=(0,A.hds)(e,i.chatId);if(!r)return;const c=Boolean((0,u.Kl)(r));let l=(0,A.AWZ)(e,r.id)?.inviteLink;c&&(l=await(0,d.px)("exportGroupCallInvite",{call:i,canSelfUnmute:!1})),l&&((0,o.eM)(l),t.showNotification({message:{key:"LinkCopied"},tabId:n}))}),(0,p.aJ)("joinVoiceChatByLink",async(e,t,a)=>{const{username:n,inviteHash:i,tabId:o=(0,s.g0)()}=a,r=await(0,v.A$)(e,n);if(!r)return void t.showNotification({message:c.yE("NoUsernameFound"),tabId:o});e=(0,p.mS)();const l=await(0,v.ad)(e,t,r);l?.groupCall&&t.requestMasterAndJoinGroupCall({id:l.groupCall.id,accessHash:l.groupCall.accessHash,inviteHash:i,tabId:o})}),(0,p.aJ)("requestMasterAndJoinGroupCall",(e,t,a)=>{t.requestMasterAndCallAction({action:"joinGroupCall",payload:a,tabId:a.tabId||(0,s.g0)()})}),(0,p.aJ)("requestMasterAndAcceptCall",(e,t,a)=>{t.requestMasterAndCallAction({action:"acceptCall",payload:void 0,tabId:a?.tabId||(0,s.g0)()})}),(0,p.aJ)("joinGroupCall",async(e,t,a)=>{const{chatId:n,id:o,accessHash:c,inviteHash:u,tabId:g=(0,s.g0)()}=a;if(!i.OL)return void t.showNotification({message:"Sorry, your browser doesn't support group calls",tabId:g});if(e.phoneCall)return void t.toggleGroupCallPanel({tabId:g});!function(){const e=new(window.AudioContext||window.webkitAudioContext);V=new Audio,y=e,V.srcObject=E(e),(0,l.A)(V)}(),w(),T(e=(0,p.mS)(),t,!0,g);const{groupCalls:{activeGroupCallId:h}}=e;let C=o?(0,f.Ip)(e,o):(0,f.mD)(e,n);if(C&&C.id===h)t.toggleGroupCallPanel({tabId:g});else if(h)"leaveGroupCall"in t&&t.leaveGroupCall({rejoin:a,tabId:g});else if(C&&h===C.id)t.toggleGroupCallPanel({tabId:g});else{if(C||o&&c||!n)!C&&o&&c&&(C=await async function(e,t){if((0,A.trm)(e))return;const a=await(0,d.px)("getGroupCall",{call:t});if(!a)return;e=(0,p.mS)();const n=(0,f.Ip)(e,t.id);return e=(0,m.h9)(e,t.id,(0,r.cJ)(a.groupCall,["connectionState"]),void 0,n?.isLoaded?void 0:a.groupCall.participantsCount),(0,p.UF)(e),a.groupCall}(e,{id:o,accessHash:c}));else{const a=(0,A.hds)(e,n);if(!a)return;await(0,v.ad)(e,t,a),e=(0,p.mS)(),C=(0,f.mD)(e,n)}C&&(e=(0,p.mS)(),e=(0,m.h9)(e,C.id,{...C,inviteHash:u},void 0,C.participantsCount+1),e={...e,groupCalls:{...e.groupCalls,activeGroupCallId:C.id}},(0,p.UF)(e),t.toggleGroupCallPanel({force:!1,tabId:g}))}}),(0,p.aJ)("playGroupCallSound",(e,t,a)=>{const{sound:n}=a;C?.[n]&&("connecting"!==n&&C.connecting.pause(),"incoming"!==n&&C.incoming.pause(),"ringing"!==n&&C.ringing.pause(),(0,l.A)(C[n]))}),(0,p.aJ)("loadMoreGroupCallParticipants",e=>{const t=(0,f.iT)(e);t&&function(e,t){(0,d.px)("fetchGroupCallParticipants",{call:e,offset:t})}(t,t.nextOffset)}),(0,p.aJ)("requestMasterAndRequestCall",(e,t,a)=>{t.requestMasterAndCallAction({action:"requestCall",payload:a,tabId:a.tabId||(0,s.g0)()})}),(0,p.aJ)("requestCall",(e,t,a)=>{const{userId:n,isVideo:i,tabId:o=(0,s.g0)()}=a;e.phoneCall?t.toggleGroupCallPanel({tabId:o}):(0,A.mBe)(e,n)&&(w(),T(e=(0,p.mS)(),t,i,o),e=(0,p.mS)(),e={...e,phoneCall:{id:"",state:"requesting",participantId:n,isVideo:i,adminId:e.currentUserId}},(0,p.UF)(e),t.toggleGroupCallPanel({force:!1,tabId:o}))});const E=e=>{const t=e.createOscillator(),a=t.connect(e.createMediaStreamDestination());return t.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])};function S(){return V}function k(){return y}function I(){V?.pause(),y=void 0,V=void 0}function T(e,t,a,...[n=(0,s.g0)()]){a?navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{0===e.getVideoTracks().length?t.showNotification({message:c.yE("Call.Camera.Error"),tabId:n}):(e.getTracks().forEach(e=>e.stop()),P(0,t,n))}).catch(()=>{t.showNotification({message:c.yE("Call.Camera.Error"),tabId:n})}):P(0,t,n)}function P(e,t,...[a=(0,s.g0)()]){navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{0===e.getAudioTracks().length?t.showNotification({message:c.yE("RequestAcces.Error.HaveNotAccess.Call"),tabId:a}):e.getTracks().forEach(e=>e.stop())}).catch(()=>{t.showNotification({message:c.yE("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})})}},31791:(e,t,a)=>{a.d(t,{v:()=>n});let n=function(e){return e.FULLSCREEN_CHANGE="fullscreen-change",e.UPDATE_ERROR="update-error",e.UPDATE_AVAILABLE="update-available",e.DEEPLINK="deeplink",e}({})},83320:(e,t,a)=>{a.r(t),a.d(t,{ActiveCallHeader:()=>tt,GroupCall:()=>et,PhoneCall:()=>st,RatePhoneCallModal:()=>ct});var n=a(12859),i=a(96454),o=a(84051),s=a(31481);function r(e){return 0|e}function c(e){return e>>>0}function l(e,t=3){if(!e)return 0;const{length:a}=e;let n=0;for(let t=0;t<a;t++)n+=e[t]*e[t];const i=Math.sqrt(n/a)/255;return Math.min(1,i*t)}function d(e){return{id:e.id,name:e.name,"rtcp-fbs":e.feedbackTypes,clockrate:e.clockrate,parameters:e.parameters,channels:e.channels}}const u=.1,p="getDisplayMedia"in(navigator?.mediaDevices||{}),m=navigator?.mediaDevices?.getSupportedConstraints().echoCancellation,g=navigator?.mediaDevices?.getSupportedConstraints().noiseSuppression,A=(e,t=!1)=>{if(!e||!e.sdp)throw Error("Failed parsing SDP: session description is null");const a=e.sdp.split("\r\nm=").map((e,t)=>0===t?e:`m=${e}`).reduce((e,t)=>{const a=t.match(/^m=(.+?)\s/)?.[1]||"header";return e[e.hasOwnProperty(a)&&"video"===a?"screencast":a]=t.split("\r\n").filter(Boolean),e},{}),n=(e,t)=>t?a[t]?.find(t=>t.startsWith(e))?.substr(e.length):Object.values(a).map(t=>t.find(t=>t.startsWith(e))?.substr(e.length)).filter(Boolean)[0],i=e=>a[e].filter(e=>e.startsWith("a=extmap")).map(e=>{const[,t,a]=e.match(/extmap:(\d+)(?:\/.+)?\s(.+)/);return{id:Number(t),uri:a}}),o=e=>{const t=a[e].filter(e=>e.startsWith("a=rtpmap")).map(e=>{const[,t,a]=e.match(/:(\d+)\s(.+)/)||[],[n,i,o]=a.split("/");return{id:Number(t),name:n,clockrate:Number(i),...o&&{channels:Number(o)}}}),n=a[e].filter(e=>e.startsWith("a=rtcp-fb")).map(e=>{const[,t,a]=e.match(/:(\d+)\s(.+)/)||[],[n,i]=a.split(" ");return{id:Number(t),type:n,subtype:i||""}}),i=a[e].filter(e=>e.startsWith("a=fmtp")).map(e=>{const[,t,a]=e.match(/:(\d+)\s(.+)/)||[],n=a?.split(";").reduce((e,t)=>{const[a,n]=t.split("=");return e[a]=n,e},{});if(n&&!Object.values(n).some(e=>!e))return{id:Number(t),data:n}}).filter(Boolean);return t.map(e=>{const t=i.filter(t=>t.id===e.id).map(e=>e.data).reduce((e,t)=>Object.assign(e,t),{}),a=n.filter(t=>t.id===e.id).map(e=>({type:e.type,subtype:e.subtype}));return{...e,...Object.keys(t).length>0&&{parameters:t},...a.length>0&&{feedbackTypes:a}}})},s=n("a=ssrc:","audio"),c=s&&Number(s.split(" ")[0]),l=n("a=ssrc-group:","video")?.split(" ")||void 0,d=n("a=ssrc-group:","screencast")?.split(" ")||void 0;if(!l)throw Error("Failed parsing SDP: no video ssrc");const[u,p]=n("a=fingerprint:")?.split(" ")||[],m=n("a=setup:");if(!u||!p)throw Error("Failed parsing SDP: no fingerprint");console.log(a);const g=n("a=ice-ufrag:"),A=n("a=ice-pwd:");if(!g||!A)throw Error("Failed parsing SDP: no ICE ufrag or pwd");return{fingerprints:[{fingerprint:p,hash:u,setup:t?m:"active"}],pwd:A,ufrag:g,...c&&{ssrc:r(c)},...l&&{"ssrc-groups":[{semantics:l[0],sources:l.slice(1,l.length).map(Number).map(r)},t&&d&&{semantics:d[0],sources:d.slice(1,d.length).map(Number).map(r)}].filter(Boolean)},...t&&{audioExtmap:i("audio"),videoExtmap:i("video"),screencastExtmap:i("screencast"),audioPayloadTypes:o("audio"),videoPayloadTypes:o("video"),screencastPayloadTypes:o("screencast")}}},f=(e,t=!1,a=!1,n=!1)=>{const i=[],o=e=>{i.push(e)},{sessionId:s,ssrcs:r,audioExtensions:l,videoExtensions:d,audioPayloadTypes:u,videoPayloadTypes:p,transport:{ufrag:m,pwd:g,fingerprints:A,candidates:f}}=e;o("v=0"),o(`o=- ${s} 2 IN IP4 0.0.0.0`),o("s=-"),o("t=0 0"),o("a=ice-options:trickle"),o("a=msid-semantic:WMS *"),o(`a=group:BUNDLE ${r.map(e=>e.mid).join(" ")}${a?"":" "+(n?"3":"2")}`),n||o("a=ice-lite");const v=e=>{if(e.sdpString)o(`a=${e.sdpString}`);else{let t="";t+="a=candidate:",t+=`${e.foundation} ${e.component} ${e.protocol} ${e.priority} ${e.ip} ${e.port} typ ${e.type}`,"rel-addr"in e&&(t+=` raddr ${e["rel-addr"]} rport ${e["rel-port"]}`),t+=` generation ${e.generation}`,o(t)}},h=()=>{o(`a=ice-ufrag:${m}`),o(`a=ice-pwd:${g}`),A.forEach(e=>{o(`a=fingerprint:${e.hash} ${e.fingerprint}`),o(`a=setup:${n?e.setup:"passive"}`)}),f.forEach(v)},V=e=>{const{channels:t,id:a,name:n,clockrate:i,parameters:s}=e;if(o(`a=rtpmap:${a} ${n}/${i}${t?`/${t}`:""}`),s){const e=Object.keys(s).map(e=>`${e}=${s[e]};`).join(" ");o(`a=fmtp:${a} ${e}`)}e["rtcp-fbs"]?.forEach(e=>{o(`a=rtcp-fb:${a} ${e.type}${e.subtype?` ${e.subtype}`:""}`)})},y=e=>{const a=e.isVideo?p:u,i=e.isVideo?"video":"audio";if(o(`m=${i} ${e.isMain?1:0} RTP/SAVPF ${a.map(e=>e.id).join(" ")}`),o("c=IN IP4 0.0.0.0"),o("b=AS:1300"),o(`a=mid:${e.mid}`),o("a=rtcp-mux"),a.forEach(V),o("a=rtcp:1 IN IP4 0.0.0.0"),e.isVideo&&o("a=rtcp-rsize"),(e.isVideo?d:l).forEach(({id:e,uri:t})=>{o(`a=extmap:${e} ${t}`)}),e.isRemoved)o("a=inactive");else{if(h(),n)o("a=sendrecv"),o("a=bundle-only");else{if(t)return void o("a=recvonly");e.isMain?o("a=sendrecv"):(o("a=sendonly"),o("a=bundle-only"))}e.sourceGroups.forEach(t=>{t.semantics&&o(`a=ssrc-group:${t.semantics} ${t.sources.map(c).join(" ")}`),t.sources.forEach(t=>{const a=c(t);o(`a=ssrc:${a} cname:${e.endpoint}`),o(`a=ssrc:${a} msid:${e.endpoint} ${e.endpoint}`),o(`a=ssrc:${a} mslabel:${e.endpoint}`),o(`a=ssrc:${a} label:${e.endpoint}`)})})}};return n?r.filter(y):r.filter(e=>"0"===e.mid||"1"===e.mid).map(y),a||(o("m=application 1 UDP/DTLS/SCTP webrtc-datachannel"),o("c=IN IP4 0.0.0.0"),h(),o("a=ice-options:trickle"),o("a=mid:"+(n?"3":a?"1":"2")),o("a=sctp-port:5000"),o("a=max-message-size:262144")),n||r.filter(e=>"0"!==e.mid&&"1"!==e.mid).map(y),`${i.join("\n")}\n`},v=e=>{const t=e.createOscillator(),a=t.connect(e.createMediaStreamDestination());return t.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])},h=({width:e=640,height:t=480}={})=>{const a=Object.assign(document.createElement("canvas"),{width:e,height:t}),n=a.getContext("2d");if(!n)throw Error("Cannot create canvas ctx");n.fillRect(0,0,e,t);const i=a.captureStream();return new MediaStream([Object.assign(i.getVideoTracks()[0],{enabled:!1})])};var V=a(9705),y=a(41733);let C,b;function w(e){C&&(C.screenshareDataChannel?.close(),C.screenshareConnection?.close(),e||C.onUpdate?.({"@type":"updateGroupCallLeavePresentation"}))}function E(e){return C?.streams?.[e]}function S(e,t){const a=C?.participantFunctions?.[e];a&&a.setVolume?.(t)}function k(e,t){const a=t||C?.myId,n=a&&E(a)?.[e];return!!n&&n.getTracks()[0]?.enabled}function I(e){C?.onUpdate?.({"@type":"updateGroupCallStreams",userId:e,hasAudioStream:k("audio",e),hasVideoStream:k("video",e),hasPresentationStream:k("presentation",e),amplitude:C.speaking?.[e]})}async function T(e,t="user"){if("audio"===e&&C?.audioStream)return C.audioStream;if("presentation"===e)return navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0});const a=await navigator.mediaDevices.getUserMedia({audio:"audio"===e&&{...m&&{echoCancellation:!0},...g&&{noiseSuppression:!0}},video:"video"===e&&{facingMode:t}});if(C&&"audio"===e&&(C.audioStream=a),"video"===e){const e=document.createElement("video");e.srcObject=a;const t=new V.A;e.oncanplay=()=>t.resolve(),await t.promise}return a}async function P(e,t=void 0){if(!(C&&C.myId&&C.connection&&C.streams))return;const a=E(C.myId)?.[e];if(!a)return;const n=a.getTracks()[0];if(!n)return;const i=[...C.connection.getSenders(),...C.screenshareConnection?.getSenders()||[]].find(e=>n.id===e.track?.id);if(i){t=void 0===t?!n.enabled:t;try{if(t&&!n.enabled){const t=await T(e);if(await i.replaceTrack(t.getTracks()[0]),C.streams[C.myId][e]=t,"video"===e)C.facingMode="user";else if("audio"===e){const{audioContext:e}=C;if(!e)return;const a=C.audioSource||e.createMediaStreamSource(t),n=C.audioAnalyser||e.createAnalyser();n.minDecibels=-100,n.maxDecibels=-30,n.smoothingTimeConstant=.05,n.fftSize=1024,a.connect(n),C={...C,audioSource:a,audioAnalyser:n,participantFunctions:{...C.participantFunctions,[C.myId]:{...C.participantFunctions?.[C.myId],getCurrentAmplitude:()=>{const e=new Uint8Array(n.frequencyBinCount);return n.getByteFrequencyData(e),l(e,1.5)}}}}}}else if(!t&&n.enabled){const t="audio"===e?C.silence:C.black;if(!t)return;await i.replaceTrack(t.getTracks()[0]),C.streams[C.myId][e]=t,"video"===e&&(C.facingMode=void 0),"audio"!==e?n.stop():(C.audioSource?.disconnect(),C.audioAnalyser?.disconnect())}I(C.myId),"presentation"!==e||t||w(!0)}catch(e){}}}function N(e){C?.onUpdate?.({"@type":"updateGroupCallConnectionState",connectionState:e})}function M(){C&&(C.myId&&C.streams?.[C.myId]&&Object.values(C.streams[C.myId]||{}).forEach(e=>{e?.getTracks().forEach(e=>{e.stop()})}),C.audioStream?.getTracks().forEach(e=>{e.stop()}),w(!0),C.dataChannel?.close(),C.connection?.close(),N("disconnected"),C.analyserInterval&&clearInterval(C.analyserInterval),C=void 0)}function x(){C&&C.participantFunctions&&Object.keys(C.participantFunctions).forEach(e=>{const{getCurrentAmplitude:t}=C.participantFunctions[Number(e)];if(t){const a=t(),n=C.speaking[e]||0;C.speaking[e]=a,(a>u&&n<=u||a<=u&&n>u)&&I(e)}})}async function G(e){if(!C)return;const{participants:t,conference:a,connection:n,myId:i}=C;if(!(t&&a&&n&&a.ssrcs&&a.transport&&i))return;if(e.find(e=>e.isSelf&&e.source!==C?.conference?.ssrcs?.find(e=>e.isMain&&!e.isVideo)?.sourceGroups[0].sources[0]))return void M();const o=[];if(e.forEach(e=>{if(e.isSelf)return void(e.isMuted&&!e.canSelfUnmute&&(P("audio",!1),P("video",!1),P("presentation",!1)));const{isLeft:t}=e,n=e.isMuted||e.isMutedByMe,i=!e.isVideoJoined||!e.video||t,s=!e.presentation||t;let r=!1,c=!1,l=!1;a.ssrcs.filter(t=>t.userId===e.id).forEach(t=>{t.isVideo||(t.sourceGroups[0].sources[0]===e.source&&(c=!0),t.isRemoved=n),t.isVideo&&(t.isPresentation||(e.video&&t.endpoint===e.video.endpoint&&(r=!0),t.isRemoved=i),t.isPresentation&&(e.presentation&&t.endpoint===e.presentation.endpoint&&(l=!0),t.isRemoved=s))}),n||c||(C.lastMid=C.lastMid+1,a.ssrcs.push({userId:e.id,isMain:!1,endpoint:`audio${e.source}`,isVideo:!1,sourceGroups:[{sources:[e.source]}],mid:C.lastMid.toString()})),i||r||!e.video||(C.lastMid=C.lastMid+1,o.push(e.video.endpoint),a.ssrcs.push({userId:e.id,isMain:!1,endpoint:e.video.endpoint,isVideo:!0,sourceGroups:e.video.sourceGroups,mid:C.lastMid.toString()})),s||l||!e.presentation||(C.lastMid=C.lastMid+1,a.ssrcs.push({isPresentation:!0,userId:e.id,isMain:!1,endpoint:e.presentation.endpoint,isVideo:!0,sourceGroups:e.presentation.sourceGroups,mid:C.lastMid.toString()}))}),C.updatingParticipantsQueue)return void C.updatingParticipantsQueue.push(a);C.updatingParticipantsQueue=[];const s=f(a);await n.setRemoteDescription({type:"offer",sdp:s});try{const e=await n.createAnswer();if(await n.setLocalDescription(e),I(i),C.updatingParticipantsQueue.length>0)for(const e of C.updatingParticipantsQueue){await n.setRemoteDescription({type:"offer",sdp:f(e)});const t=await n.createAnswer();await n.setLocalDescription(t),I(i)}C.updatingParticipantsQueue=void 0}catch(e){console.error(e)}}function B(e){if(!(C&&C.audioElement&&C.audioContext&&C.mediaStream))return;const t=C.conference?.ssrcs?.find(t=>t.endpoint===e.track.id);if(!t||!t.userId)return;const{userId:a,isPresentation:n}=t,i=C.participants?.find(e=>e.id===a),o="video"===e.track.kind?n?"presentation":"video":"audio";e.track.onended=()=>{delete C?.streams?.[a][o],I(a)};const s=e.streams[0];if("audio"===e.track.kind){const{mediaStream:e}=C,t=new window.AudioContext,n=t.createMediaStreamSource(s),o=t.createGain();o.gain.value=(i?.volume||1e4)/1e4;const r=t.createGain();o.gain.value=1;const c=t.createAnalyser();c.minDecibels=-100,c.maxDecibels=-30,c.smoothingTimeConstant=.05,c.fftSize=1024,n.connect(c).connect(r).connect(o).connect(t.destination),e.addTrack(n.mediaStream.getAudioTracks()[0]);const d=new Audio;d.srcObject=s,d.muted=!0,d.remove(),C={...C,participantFunctions:{...C.participantFunctions,[a]:{...C.participantFunctions?.[a],setVolume:e=>{o.gain.value=e>1?2*e:e},toggleMute:e=>{r.gain.value=e?0:1},getCurrentAmplitude:()=>{const e=new Uint8Array(c.frequencyBinCount);return c.getByteFrequencyData(e),l(e,1.5)}}}}}C={...C,streams:{...C.streams,[a]:{...C.streams?.[a],[o]:s}}},I(a)}function R(e,t,a=!1){const n=new RTCPeerConnection,i=a?void 0:function(e){const t=e.createDataChannel("data",{id:0});return t.onopen=()=>{},t.onmessage=e=>{JSON.parse(e.data).colibriClass},t.onerror=e=>{console.log("%conerror","background: green; font-size: 5em"),console.error(e)},t}(n);return e.forEach(e=>e.getTracks().forEach(t=>{n.addTrack(t,e)})),a||(n.oniceconnectionstatechange=()=>{const e=n.iceConnectionState;console.log("iceconnectionstatechange",e),"connected"===e||"completed"===e?N("connected"):"checking"===e||"new"===e?N("connecting"):"disconnected"===n.iceConnectionState&&N("reconnecting")}),n.onconnectionstatechange=()=>{console.log("connectionstatechange",n.connectionState)},n.ontrack=B,n.onnegotiationneeded=async()=>{if(!C)return;console.log("onnegotiationneeded");const{myId:i}=C;if(!i)return;const o=await n.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!a});if(console.log("offer created"),await n.setLocalDescription(o),console.log("local desc set"),!o.sdp)return;const s=A(o),r=a?void 0:{userId:"",sourceGroups:[{sources:[s.ssrc||0]}],isRemoved:a,isMain:!0,isVideo:!1,isPresentation:a,endpoint:a?"1":"0",mid:a?"1":"0"},c=s["ssrc-groups"]&&{isPresentation:a,userId:"",sourceGroups:s["ssrc-groups"],isMain:!0,isVideo:!0,endpoint:a?"0":"1",mid:a?"0":"1"},l=a?C.screenshareConference:C.conference,d=[];a?(c&&d.push(c),r&&d.push(r)):(r&&d.push(r),c&&d.push(c));const u=e.find(e=>"audio"===e.getTracks()[0].kind),p=e.find(e=>"video"===e.getTracks()[0].kind);C={...C,...a?{screenshareConference:{...l,ssrcs:d}}:{conference:{...l,ssrcs:d}},streams:{...C.streams,[i]:{...C.streams?.[i],...u&&{audio:u},...!a&&p?{video:p}:{presentation:p}}}},I(i),t(s)},{connection:n,dataChannel:i}}function L(){b?.onUpdate({...b.mediaState,"@type":"updatePhoneCallMediaState"})}function U(e,t="user"){return"presentation"===e?navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0}):navigator.mediaDevices.getUserMedia({audio:"audio"===e&&{...m&&{echoCancellation:!0},...g&&{noiseSuppression:!0}},video:"video"===e&&{facingMode:t}})}async function D(e,t=void 0){if(!b)return;const a="audio"===e?b.streams.ownAudio:"video"===e?b.streams.ownVideo:b.streams.ownPresentation;if(!a)return;const n=a.getTracks()[0];if(!n)return;const i=b.connection.getSenders().find(e=>n.id===e.track?.id);if(i){t=void 0===t?!n.enabled:t;try{if(t&&!n.enabled){const t=await U(e);t.getTracks()[0].onended=()=>{D(e,!1)},await i.replaceTrack(t.getTracks()[0]),"audio"===e?b.streams.ownAudio=t:"video"===e?(b.streams.ownVideo=t,b.facingMode="user"):b.streams.ownPresentation=t,"video"!==e&&"presentation"!==e||D("video"===e?"presentation":"video",!1)}else if(!t&&n.enabled){n.stop();const t="audio"===e?b.silence:"video"===e?b.blackVideo:b.blackPresentation;if(!t)return;await i.replaceTrack(t.getTracks()[0]),"audio"===e?b.streams.ownAudio=t:"video"===e?b.streams.ownVideo=t:b.streams.ownPresentation=t}L(),_()}catch(e){console.error(e)}}}function F(){b&&(b.streams.ownVideo?.getTracks().forEach(e=>e.stop()),b.streams.ownPresentation?.getTracks().forEach(e=>e.stop()),b.streams.ownAudio?.getTracks().forEach(e=>e.stop()),b.dataChannel.close(),b.connection.close(),b=void 0)}function _(){if(!b)return;const{emitSignalingData:e,streams:t}=b;e({"@type":"MediaState",videoRotation:0,isMuted:!t.ownAudio?.getTracks()[0].enabled,isBatteryLow:!0,videoState:t.ownVideo?.getTracks()[0].enabled?"active":"inactive",screencastState:t.ownPresentation?.getTracks()[0].enabled?"active":"inactive"})}function O(e){if(!b||b.isOutgoing)return e;const{payloadTypes:t}=e,a=t.findIndex(e=>"VP8"===e.name),n=t[a],i=t.findIndex(e=>Number(e.parameters?.apt)===n.id);return e.payloadTypes=[t[a],t[i]],e}function J(e){if(!b)return;const{emitSignalingData:t}=b;e.ssrc&&e["ssrc-groups"]&&e["ssrc-groups"][0]&&e["ssrc-groups"][1]&&t({"@type":"InitialSetup",fingerprints:e.fingerprints,ufrag:e.ufrag,pwd:e.pwd,audio:{ssrc:c(e.ssrc).toString(),ssrcGroups:[],payloadTypes:e.audioPayloadTypes,rtpExtensions:e.audioExtmap},video:O({ssrc:c(e["ssrc-groups"][0].sources[0]).toString(),ssrcGroups:[{semantics:e["ssrc-groups"][0].semantics,ssrcs:e["ssrc-groups"][0].sources.map(c)}],payloadTypes:e.videoPayloadTypes,rtpExtensions:e.videoExtmap}),screencast:O({ssrc:c(e["ssrc-groups"][1].sources[0]).toString(),ssrcGroups:[{semantics:e["ssrc-groups"][1].semantics,ssrcs:e["ssrc-groups"][1].sources.map(c)}],payloadTypes:e.screencastPayloadTypes,rtpExtensions:e.screencastExtmap})})}async function j(e){if(b&&b.connection)switch(e["@type"]){case"MediaState":b.mediaState=e,L(),_();break;case"Candidates":{const{pendingCandidates:t,gotInitialSetup:a}=b;e.candidates.forEach(e=>{t.push(e.sdpString)}),a&&await H();break}case"InitialSetup":{const{connection:t,isOutgoing:a}=b;if(!t)return;const n={transport:{candidates:[],ufrag:e.ufrag,pwd:e.pwd,fingerprints:e.fingerprints,"rtcp-mux":!1,xmlns:""},sessionId:Date.now(),ssrcs:[e.audio&&{isVideo:!1,isMain:!1,userId:"123",endpoint:"0",mid:"0",sourceGroups:[{sources:[e.audio.ssrc]}]},e.video&&{isVideo:!0,isPresentation:!1,isMain:!1,userId:"123",endpoint:"1",mid:"1",sourceGroups:e.video.ssrcGroups.map(e=>({semantics:e.semantics,sources:e.ssrcs}))},e.screencast&&{isVideo:!0,isPresentation:!0,isMain:!1,userId:"123",endpoint:"2",mid:"2",sourceGroups:e.screencast.ssrcGroups.map(e=>({semantics:e.semantics,sources:e.ssrcs}))}],audioPayloadTypes:e.audio.payloadTypes?.map(d)||[],audioExtensions:e.audio.rtpExtensions,videoPayloadTypes:O(e.video).payloadTypes?.map(d)||[],videoExtensions:e.video.rtpExtensions};if(await t.setRemoteDescription({sdp:f(n,a,void 0,!0),type:a?"answer":"offer"}),b.conference=n,!a){const e=await t.createAnswer();await t.setLocalDescription(e),J(A(t.localDescription,!0))}b.gotInitialSetup=!0,await H();break}}}async function H(){if(!b)return;const{pendingCandidates:e,connection:t}=b;e.length&&(await Promise.all(e.map(e=>async function(e,t){try{await e.addIceCandidate({candidate:t,sdpMLineIndex:0})}catch(e){console.error(e)}}(t,e))),b.pendingCandidates=[])}async function $(e,t){const a=await e.createOffer(t);await e.setLocalDescription(a),J(A(e.localDescription,!0))}var z=a(14487),K=a(24021),q=a(13439),W=a(80840),Z=a(32989),Q=a(60919),Y=a(71331),X=a(42347);(0,q.aJ)("leaveGroupCall",async(e,t,a)=>{const{isFromLibrary:i,shouldDiscard:o,shouldRemove:s,rejoin:r,isPageUnload:c,tabId:l=(0,z.g0)()}=a||{},d=(0,Y.iT)(e);d&&(e=(0,W.R6)(e,{connectionState:"disconnected"},d.participantsCount-1),e={...e,groupCalls:{...e.groupCalls,activeGroupCallId:void 0}},(0,q.UF)(e),await(0,K.px)("leaveGroupCall",{call:d,isPageUnload:c}),await(0,K.px)("abortRequestGroup","call"),o&&await(0,K.px)("discardGroupCall",{call:d}),e=(0,q.mS)(),s&&(e=(0,W.um)(e,d.id)),(0,n.ow)(),(0,q.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:l}),i||M(),t.afterHangUp(),r&&t.requestMasterAndJoinGroupCall({...r,tabId:l}))}),(0,q.aJ)("toggleGroupCallVideo",async e=>{const t=(0,Y.iT)(e),a=(0,Q.mBe)(e,e.currentUserId);a&&t&&(await P("video"),await(0,K.px)("editGroupCallParticipant",{call:t,videoStopped:!k("video"),participant:a}))}),(0,q.aJ)("requestToSpeak",(e,t,a)=>{const{value:n}=a||{value:!0},i=(0,Y.iT)(e),o=(0,Q.mBe)(e,e.currentUserId);o&&i&&(0,K.px)("editGroupCallParticipant",{call:i,raiseHand:n,participant:o})}),(0,q.aJ)("setGroupCallParticipantVolume",(e,t,a)=>{const{participantId:n,volume:i}=a,o=(0,Y.iT)(e),r=(0,Q.mBe)(e,n);r&&o&&(S(n,Math.floor(i/s.CH0)/100),(0,K.px)("editGroupCallParticipant",{call:o,volume:Number(i),participant:r}))}),(0,q.aJ)("toggleGroupCallMute",async(e,t,a)=>{const{participantId:n,value:i}=a||{},o=(0,Y.iT)(e),s=(0,Q.mBe)(e,n||e.currentUserId);if(!s||!o)return;const r=void 0===i?k("audio",s.id):i;n?S(n,r?0:1):await P("audio"),await(0,K.px)("editGroupCallParticipant",{call:o,muted:r,participant:s})}),(0,q.aJ)("toggleGroupCallPresentation",async(e,t,a)=>{const n=(0,Y.iT)(e),i=(0,Q.mBe)(e,e.currentUserId);if(i&&n){if(void 0!==a?.value?a?.value:!k("presentation")){const e=await async function(){if(C)try{const e=await T("presentation");if(!e)return;return e.getTracks()[0].onended=()=>{C&&C.myId&&(delete C.streams?.[C.myId].presentation,I(C.myId),w())},await new Promise(t=>{const{connection:a,dataChannel:n}=R([e],t,!0);C={...C,screenshareConnection:a,screenshareDataChannel:n}})}catch(e){return}}();if(!e)return;await(0,K.px)("joinGroupCallPresentation",{call:n,params:e})}else await P("presentation",!1),await(0,K.px)("leaveGroupCallPresentation",{call:n});await(0,K.px)("editGroupCallParticipant",{call:n,presentationPaused:!k("presentation"),participant:i})}}),(0,q.aJ)("connectToActiveGroupCall",async(e,t,a)=>{const{tabId:i=(0,z.g0)()}=a||{},o=(0,Y.iT)(e);if(!o)return;if("discarded"===o.connectionState)return void t.showNotification({message:"This voice chat is not active",tabId:i});const s=(0,n.sN)(),r=(0,n.Hc)();if(!s||!r)return;const{currentUserId:c}=e;if(!c)return;const l=await function(e,t,a,n){if(C)throw Error("Already in call");N("connecting");const i=new MediaStream;return a.srcObject=i,(0,y.A)(a),C={onUpdate:n,participants:[],myId:e,speaking:{},silence:v(t),black:h({width:640,height:480}),analyserInterval:setInterval(x,1e3),audioElement:a,audioContext:t,mediaStream:i,lastMid:3},T("audio"),new Promise(e=>{C={...C,...R([C.silence,C.black],e)}})}(c,r,s,t.apiUpdate),d=await(0,K.px)("joinGroupCall",{call:o,params:l,inviteHash:o.inviteHash});if(e=(0,q.mS)(),!d)return t.showNotification({message:"Failed to join voice chat",tabId:i}),void t.leaveGroupCall({tabId:i});if(t.loadMoreGroupCallParticipants(),o.chatId){e=(0,q.mS)();const a=(0,Q.hds)(e,o.chatId);if(!a)return;await(0,X.ad)(e,t,a)}}),(0,q.aJ)("connectToActivePhoneCall",async(e,t)=>{const{phoneCall:a}=e;if(!a)return;const n=(0,Y.uu)(e);if(!n)return;const i=await(0,K.px)("getDhConfig");if(!i)return;await(0,K.px)("createPhoneCallState",[!0]);const o=await(0,K.px)("requestPhoneCall",[i]);await(0,K.px)("requestCall",{user:n,gAHash:o,isVideo:a.isVideo})||"hangUp"in t&&t.hangUp({tabId:(0,z.g0)()})}),(0,q.aJ)("acceptCall",async e=>{const{phoneCall:t}=e;if(!t)return;const a=await(0,K.px)("getDhConfig");if(!a)return;await(0,K.px)("createPhoneCallState",[!1]);const n=await(0,K.px)("acceptPhoneCall",[a]);await(0,K.px)("acceptCall",{call:t,gB:n})}),(0,q.aJ)("sendSignalingData",(e,t,a)=>{const{phoneCall:n}=e;if(!n)return;const i=JSON.stringify(a);(async()=>{const e=await(0,K.px)("encodePhoneCallData",[i]);e&&(0,K.px)("sendSignalingData",{data:e,call:n})})()}),(0,q.aJ)("closeCallRatingModal",(e,t,a)=>{const{tabId:n=(0,z.g0)()}=a||{};return(0,Z.w)(e,{ratingPhoneCall:void 0},n)}),(0,q.aJ)("setCallRating",(e,t,a)=>{const{rating:n,comment:i,tabId:o=(0,z.g0)()}=a,{ratingPhoneCall:s}=(0,Q.nTw)(e,o);if(s)return(0,K.px)("setCallRating",{call:s,rating:n,comment:i}),(0,Z.w)(e,{ratingPhoneCall:void 0},o)}),(0,q.aJ)("hangUp",(e,t,a)=>{const{isPageUnload:n,tabId:i=(0,z.g0)()}=a||{},{phoneCall:o}=e;if(o){if("discarded"===o.state)return(0,K.px)("destroyPhoneCallState"),F(),e={...e,phoneCall:void 0},(0,q.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:i}),void t.afterHangUp();if((0,K.px)("destroyPhoneCallState"),F(),(0,K.px)("discardCall",{call:o,isPageUnload:n}),"requesting"===o.state)return e={...e,phoneCall:void 0},(0,q.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:i}),void t.afterHangUp();setTimeout(()=>{e=(0,q.mS)(),e={...e,phoneCall:void 0},(0,q.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:i}),t.afterHangUp()},500)}});var ee=a(87894),te=a(6e4);const ae=new Uint16Array([55357,56841,55357,56845,55357,56859,55357,56877,55357,56881,55357,56865,55357,56846,55357,56884,55357,56885,55357,56840,55357,56876,55357,56839,55357,56847,55357,56430,55357,56439,55357,56450,55357,56438,55357,56424,55357,56425,55357,56436,55357,56437,55357,56891,55357,56893,55357,56896,55357,56442,55357,56904,55357,56905,55357,56906,55357,56448,55357,56445,55357,56489,55357,56613,55357,56485,55357,56484,55357,56386,55357,56384,55357,56387,55357,56389,55357,56388,55357,56397,55357,56398,55357,56396,55357,56394,9996,9995,55357,56400,55357,56390,55357,56391,55357,56393,55357,56392,55357,56911,55357,56399,55357,56490,55357,57014,55356,57283,55357,56451,55357,56427,55357,56426,55357,56428,55357,56429,55357,56453,55356,57257,55357,56401,55357,56402,55357,56415,55357,56414,55357,56416,55357,56405,55357,56407,55357,56406,55357,56409,55357,56412,55357,56403,55356,57216,55357,56452,55357,56475,55357,56473,55357,56476,55357,56474,55357,56461,55357,56462,55357,56374,55357,56378,55357,56369,55357,56365,55357,56377,55357,56368,55357,56376,55357,56367,55357,56360,55357,56379,55357,56375,55357,56366,55357,56343,55357,56372,55357,56337,55357,56344,55357,56380,55357,56359,55357,56357,55357,56340,55357,56333,55357,56354,55357,56347,55357,56349,55357,56348,55357,56350,55357,56332,55357,56345,55357,56346,55357,56351,55357,56364,55357,56331,55357,56336,55357,56330,55357,56363,55356,57152,55356,57145,55356,57147,55356,57153,55356,57150,55356,57156,55356,57141,55356,57140,55356,57139,55356,57118,55356,57114,55356,57113,55356,57102,55356,57099,9889,9748,10052,9924,55356,57088,55356,57096,55356,57098,55356,57235,55356,57222,55356,57219,55357,56443,55356,57221,55356,57220,55356,57217,55356,57224,55357,56622,55356,57253,55357,56567,55357,56511,55357,56507,9742,55357,56545,55357,56570,55357,56571,55357,56585,55357,56596,9203,9200,8986,55357,56594,55357,56593,55357,56590,55357,56481,55357,56614,55357,56588,55357,56587,55357,57023,55357,57021,55357,56615,55357,56616,55357,57002,55357,57004,55357,56483,55357,56619,55357,56618,55357,56458,55357,56457,55357,56496,55357,56501,55357,56499,9993,55357,56555,55357,56550,55357,56517,55357,56513,9986,55357,56524,55357,56526,10002,9999,55357,56528,55357,56538,55357,56620,55357,56621,55356,57256,55356,57260,55356,57252,55356,57255,55356,57269,55356,57273,55356,57275,55356,57274,55356,57272,55357,56446,55356,57262,55356,56527,55356,57266,55356,57263,55356,57288,55356,57280,9917,9918,55356,57278,55356,57265,55356,57289,55356,57267,55356,57281,55356,57287,55356,57286,55356,57290,55356,57284,9749,55356,57212,55356,57210,55356,57207,55356,57204,55356,57173,55356,57172,55356,57183,55356,57175,55356,57201,55356,57178,55356,57180,55356,57185,55356,57203,55356,57182,55356,57193,55356,57190,55356,57218,55356,57200,55356,57194,55356,57195,55356,57197,55356,57199,55356,57166,55356,57167,55356,57162,55356,57163,55356,57170,55356,57159,55356,57161,55356,57171,55356,57169,55356,57164,55356,57168,55356,57165,55356,57158,55356,57157,55356,57149,55356,57313,55356,57317,55356,57318,9962,55356,57328,9978,55356,57325,55357,56827,55357,56829,55356,57248,55356,57249,9970,55356,57250,55357,56994,55357,56996,9875,55357,56960,9992,55357,56961,55357,56962,55357,56971,55357,56974,55357,56972,55357,56985,55357,56983,55357,56981,55357,56987,55357,57e3,55357,56980,55357,56978,55357,56977,55357,57010,55357,56992,55357,56988,55357,56998,9888,55357,56999,9981,55356,57264,55357,56831,55356,57258,55356,57261,55356,56815,55356,56821,55356,56816,55356,56823,55356,56809,55356,56810,55356,56808,55356,56819,55356,56826,55356,56824,55356,56811,55356,56823,55356,56810,55356,56824,55356,56814,55356,56825,55356,56823,55356,56826,55356,56812,55356,56807,49,8419,50,8419,51,8419,52,8419,53,8419,54,8419,55,8419,56,8419,57,8419,48,8419,55357,56607,10071,10067,9829,9830,55357,56495,55357,56599,55357,56625,55357,56628,55357,56629,55357,56630,55357,56631]),ne=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,87,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,256,258,259,260,261,262,264,266,268,270,272,274,276,278,280,282,284,286,288,290,292,294,295,297,299,301,303,305,306,307,308,310,312,314,316,318,320,322,324,326,328,330,332,334,336,338,340,342,344,346,348,350,351,353,355,357,359,360,362,364,365,366,368,370,372,374,376,378,380,382,384,386,388,390,392,394,396,398,400,402,404,406,407,408,410,412,414,416,418,420,422,424,426,427,429,431,433,435,437,439,441,443,445,447,449,451,453,455,457,459,461,463,465,467,469,471,473,475,477,479,481,483,485,487,489,491,493,495,497,499,501,503,505,507,508,510,511,513,515,517,519,521,522,524,526,528,529,531,532,534,536,538,540,542,544,546,548,550,552,554,556,558,560,562,564,566,567,569,570,572,574,576,578,582,586,590,594,598,602,606,610,614,618,620,622,624,626,628,630,632,634,636,638,640,641,642,643,644,646,648,650,652,654,656,658];(0,q.aJ)("apiUpdate",(e,t,a)=>{const{activeGroupCallId:n}=e.groupCalls;switch(a["@type"]){case"updateGroupCallLeavePresentation":t.toggleGroupCallPresentation({value:!1});break;case"updateGroupCallStreams":if(!a.userId||!n)break;if(!(0,Y.n5)(e,n,a.userId))break;return(0,W.c5)(e,n,a.userId,(0,ee.cJ)(a,["@type","userId"]));case"updateGroupCallConnectionState":if(!n)break;if("disconnected"===a.connectionState){"leaveGroupCall"in t&&t.leaveGroupCall({isFromLibrary:!0,tabId:(0,z.g0)()});break}return(0,W.h9)(e,n,{connectionState:a.connectionState,isSpeakerDisabled:a.isSpeakerDisabled});case"updateGroupCallParticipants":{const{groupCallId:e,participants:t}=a;n===e&&G(t);break}case"updateGroupCallConnection":{if(a.data.stream){t.showNotification({message:"Big live streams are not yet supported",tabId:(0,z.g0)()}),"leaveGroupCall"in t&&t.leaveGroupCall({tabId:(0,z.g0)()});break}!async function(e,t){if(!C)return;const a=t?C.screenshareConference:C.conference,n=t?C.screenshareConnection:C.connection;if(!a||!n||!a.ssrcs)return;const i=Date.now(),o={...a,transport:e.transport,sessionId:i,audioExtensions:e.audio?.["rtp-hdrexts"],audioPayloadTypes:e.audio?.["payload-types"],videoExtensions:e.video?.["rtp-hdrexts"],videoPayloadTypes:e.video?.["payload-types"]};C={...C,...t?{screenshareConference:o}:{conference:o}};try{await n.setRemoteDescription({type:"answer",sdp:f(o,!0,t)})}catch(e){console.error(e)}}(a.data,a.presentation);const n=(0,Y.iT)(e);n?.participants&&Object.keys(n.participants).length>0&&G(Object.values(n.participants));break}case"updatePhoneCallMediaState":return{...e,phoneCall:{...e.phoneCall,...(0,ee.cJ)(a,["@type"])}};case"updatePhoneCall":{if(!i.OL)return;const{phoneCall:n,currentUserId:s}=e,r={...n,...a.call},c=n?.adminId===s;if(e={...e,phoneCall:r},(0,q.UF)(e),e=(0,q.mS)(),n&&n.id&&r.id!==n.id)return void("discarded"!==r.state&&(0,K.px)("discardCall",{call:r,isBusy:!0}));const{accessHash:l,state:d,connections:u,gB:p}=r;if(("active"===d||"accepted"===d)&&(o=r.protocol,!o?.libraryVersions.some(e=>"4.0.0"===e||"4.0.1"===e))){const a=(0,Y.uu)(e);return"hangUp"in t&&t.hangUp({tabId:(0,z.g0)()}),void t.showNotification({message:te.yE("VoipPeerIncompatible",a?.firstName),tabId:(0,z.g0)()})}if("discarded"===d){if(!n)return;return(0,Z.w)(e,{...r.needRating&&{ratingPhoneCall:r},isCallPanelVisible:void 0},(0,z.g0)())}return"accepted"===d&&l&&p?(async()=>{const{gA:t,keyFingerprint:a,emojis:n}=await(0,K.px)("confirmPhoneCall",[p,ae,ne]),i={...(e=(0,q.mS)()).phoneCall,emojis:n};e={...e,phoneCall:i},(0,q.UF)(e),(0,K.px)("confirmCall",{call:r,gA:t,keyFingerprint:a})})():"active"===d&&u&&"active"!==n?.state&&(c||((0,K.px)("receivedCall",{call:r}),(async()=>{const{emojis:t}=await(0,K.px)("confirmPhoneCall",[r.gAOrB,ae,ne]),a={...(e=(0,q.mS)()).phoneCall,emojis:t};e={...e,phoneCall:a},(0,q.UF)(e)})()),async function(e,t,a,n,i,o){const s=new RTCPeerConnection({iceServers:e.map(e=>({urls:[e.isTurn&&`turn:${e.ip}:${e.port}`,e.isStun&&`stun:${e.ip}:${e.port}`].filter(Boolean),username:e.username,credentialType:"password",credential:e.password})),iceTransportPolicy:i?"all":"relay",bundlePolicy:"max-bundle",iceCandidatePoolSize:10});s.onicecandidate=e=>{e.candidate&&t({"@type":"Candidates",candidates:[{sdpString:e.candidate.candidate}]})},s.onconnectionstatechange=()=>{o({"@type":"updatePhoneCallConnectionState",connectionState:s.connectionState})},s.ontrack=e=>{if(!b)return;const t=e.streams[0];"audio"===e.track.kind?(b.audio.srcObject=t,b.audio.play().catch(),b.streams.audio=t):"1"===e.transceiver.mid?b.streams.video=t:b.streams.presentation=t,L()},s.oniceconnectionstatechange=async e=>{switch(s.iceConnectionState){case"disconnected":case"failed":a&&await $(s,{offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:!0})}};const r=v(new AudioContext),c=h({width:640,height:480}),l=h({width:640,height:480});s.addTrack(r.getTracks()[0],r),s.addTrack(c.getTracks()[0],c),s.addTrack(l.getTracks()[0],l);const d=s.createDataChannel("data",{id:0,negotiated:!0});d.onmessage=e=>{j(JSON.parse(e.data))};const u=new Audio;b={audio:u,connection:s,emitSignalingData:t,isOutgoing:a,pendingCandidates:[],onUpdate:o,streams:{ownVideo:c,ownAudio:r,ownPresentation:l},mediaState:{isBatteryLow:!1,screencastState:"inactive",videoState:"inactive",videoRotation:0,isMuted:!0},blackVideo:c,blackPresentation:l,silence:r,dataChannel:d};try{D("audio",!0)}catch(e){console.error(e)}a&&await $(s,{offerToReceiveAudio:!0,offerToReceiveVideo:!0})}(u,t.sendSignalingData,c,Boolean(r?.isVideo),Boolean(r.isP2pAllowed),t.apiUpdate)),e}case"updatePhoneCallConnectionState":{const{connectionState:n}=a;return e.phoneCall?"closed"===n||"disconnected"===n||"failed"===n?void("hangUp"in t&&t.hangUp({tabId:(0,z.g0)()})):{...e,phoneCall:{...e.phoneCall,isConnected:"connected"===n}}:e}case"updatePhoneCallSignalingData":{const{phoneCall:t}=e;if(!t)break;(0,K.px)("decodePhoneCallData",[a.data])?.then(j);break}}var o});var ie=a(87357),oe=a(43874),se=a(37661),re=a(5912),ce=a(17712),le=a(59030),de=a(90423),ue=a(73767),pe=a(93545),me=a(54746),ge=a(64493),Ae=a(19806),fe=a(12933),ve=a(22337),he=a(96374),Ve=a(46222),ye=a(4961);function Ce(e){return Math.floor((e.volume||s.iRY)/s.CH0).toString()}var be=a(10722),we=a(21849),Ee=a(34431),Se=a(22720),ke=a(58443),Ie=a(672),Te=a(4438),Pe=a(285),Ne=a(71429),Me=a(24433);function xe(){return xe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},xe.apply(null,arguments)}const Ge=[0,17],Be=[17,34],Re=(0,o.ph)((0,q.EK)(e=>({isAdmin:(0,Y.qI)(e)}))(({participant:e,onCloseAnimationEnd:t,onClose:a,isDropdownOpen:n,isAdmin:i,menuRef:r,...c})=>{const{toggleGroupCallMute:l,setGroupCallParticipantVolume:d,toggleGroupCallPanel:u,openChat:p,requestToSpeak:m}=(0,q.ko)(),g=(0,le.A)(),[A,f,v]=(0,se.A)(),h=e?.id,{isMutedByMe:V,isMuted:y,isSelf:C,canSelfUnmute:b}=e||{},w=Boolean(e?.raiseHandRating),E=!b&&y,[S,k]=(0,o.J0)(V?0:(e?.volume||s.iRY)/s.CH0),[I,T]=(0,o.J0)(!1),P=0===S,N=P?Ge:Be;(0,o.vJ)(()=>{n||T(!1)},[n]);const M=(0,ce.A)(e=>{k(e),T(0===e!==P)});(0,o.vJ)(()=>{k(V?0:(e?.volume||s.iRY)/s.CH0)},[h]);const x=function(e,t,a=[]){return(0,Ie.A)(e=>{e()},a,e,t)}(500),G=(0,ce.A)(e=>{e.stopPropagation(),f(),a()}),B=(0,ce.A)(e=>{e.stopPropagation(),m({value:!1}),a()}),R=(0,ce.A)(t=>{t.stopPropagation(),a(),i?E&&M((e?.volume??s.iRY)/s.CH0):M(V?s.iRY/s.CH0:0),l({participantId:h,value:i?!E:!V})}),L=(0,ce.A)(e=>{e.stopPropagation(),u(),p({id:h}),a()});return o.Ay.createElement("div",null,o.Ay.createElement(Ne.A,xe({isOpen:n,ref:r,withPortal:!0,onClose:a,onCloseAnimationEnd:t,className:"participant-menu with-menu-transitions"},c),!C&&!E&&o.Ay.createElement("div",{className:"group"},o.Ay.createElement("div",{className:(0,ie.A)("volume-control",S<50&&"low",S>=50&&S<100&&"medium",S>=100&&S<150&&"normal",S>=150&&"high")},o.Ay.createElement("input",{type:"range",min:"0",max:"200",value:S,onChange:e=>{const t=Number(e.target.value);M(t),x(()=>{0===t?l({participantId:h,value:!0}):d({participantId:h,volume:Math.floor(t*s.CH0)})})}}),o.Ay.createElement("div",{className:"info"},o.Ay.createElement(Te.A,{tgsUrl:ke.w.Speaker,play:!!I&&N.toString(),playSegment:N,size:24}),o.Ay.createElement("span",null,S,"%")))),o.Ay.createElement("div",{className:"group"},w&&C&&o.Ay.createElement(Me.A,{icon:"stop-raising-hand",onClick:B},g("VoipGroupCancelRaiseHand")),!C&&o.Ay.createElement(Me.A,{icon:"user",onClick:L},g("VoipGroupOpenProfile")),!C&&o.Ay.createElement(Me.A,{icon:y&&i&&E?"allow-speak":"microphone-alt",onClick:R},g(i?E?"VoipGroupAllowToSpeak":"VoipMute":V?"VoipGroupUnmuteForMe":"VoipGroupMuteForMe")),!C&&i&&o.Ay.createElement(Me.A,{icon:"delete-user",destructive:!0,onClick:G},g("VoipGroupUserRemove")))),!C&&i&&o.Ay.createElement(Pe.A,{isOpen:A,userId:h,onClose:v}))})),Le=(0,o.ph)(({participant:e,noColor:t,className:a})=>{const{isMuted:n,isMutedByMe:i}=e,s=(e.amplitude||0)>u,r=Boolean(e.raiseHandRating),c=(0,ue.A)(r),l=!Boolean(e?.canSelfUnmute)&&n,d=(0,ue.A)(n),p=(0,o.Kr)(()=>n&&!d?[43,64]:!n&&d?[22,42]:r&&!c?[65,84]:!l&&c?[0,21]:n?[22,23]:[43,44],[n,l,r]),m=(0,o.Kr)(()=>t?"#ffffff":r?"#4da6e0":l||i?"#ff706f":s?"#57bc6c":"#aaaaaa",[t,r,l,i,s]);return o.Ay.createElement(Te.A,{tgsUrl:ke.w.VoiceOutlined,play:p.toString(),playSegment:p,size:28,color:m,className:a,forceAlways:!0,nonInteractive:!0})}),Ue={root:"Wk7JwPx3",subtitle:"ShcCNemD",subtitleText:"UZLgp2cx",icon:"vRc6jhKf",subtitleBlue:"yA7bxEWw",subtitleRed:"DnuZwImI",subtitleGreen:"BkgYQGFq",avatar:"ouHUJ9ff"},De=(0,o.ph)((0,q.EK)((e,{participant:t})=>({peer:(0,Q.mBe)(e,t.id)||(0,Q.hds)(e,t.id)}))(({participant:e,peer:t})=>{const a=(0,o.li)(),n=(0,o.li)(),i=(0,le.A)(),{isSelf:r,isMutedByMe:c,isMuted:l,hasVideoStream:d,hasPresentationStream:p}=e,m=(e.amplitude||0)>u,g=Boolean(e.raiseHandRating),{isContextMenuOpen:A,contextMenuAnchor:f,handleContextMenu:v,handleBeforeContextMenu:h,handleContextMenuClose:V,handleContextMenuHide:y}=(0,be.A)(a,r),C=(0,o.hb)(()=>a.current,[]),b=(0,o.hb)(()=>a.current.closest(".custom-scroll, .no-scrollbar"),[]),w=(0,o.hb)(()=>n.current,[]),E=(0,o.hb)(()=>({withPortal:!0}),[]),S=Boolean(!l&&m&&e.volume&&e.volume!==s.iRY),[k,I]=(0,o.Kr)(()=>c?[i("VoipGroupMutedForMe"),Ue.subtitleRed]:g?[i("WantsToSpeak"),Ue.subtitleBlue]:S?[i("SpeakingWithVolume",Ce(e)).replace("%%","%"),Ue.subtitleGreen]:!l&&m?[i("Speaking"),Ue.subtitleGreen]:r?[i("ThisIsYou"),Ue.subtitleBlue]:e.about?[e.about,""]:[i("Listening"),Ue.subtitleBlue],[c,g,S,l,m,r,e,i]);if(t)return o.Ay.createElement(Se.A,{leftElement:o.Ay.createElement(we.A,{peer:t,className:Ue.avatar}),rightElement:o.Ay.createElement(Le,{participant:e,className:Ue.icon}),className:Ue.root,onClick:v,onMouseDown:h,onContextMenu:v,multiline:!0,ripple:!0,ref:a},o.Ay.createElement(Ee.A,{peer:t,withEmojiStatus:!0,className:Ue.title}),o.Ay.createElement("span",{className:(0,ie.A)(Ue.subtitle,"subtitle",I)},p&&o.Ay.createElement(me.A,{name:"share-screen"}),d&&o.Ay.createElement(me.A,{name:"video"}),S&&o.Ay.createElement(me.A,{name:"speaker"}),o.Ay.createElement("span",{className:Ue.subtitleText},(0,ye.A)(k))),o.Ay.createElement(Re,{participant:e,isDropdownOpen:A,anchor:f,getTriggerElement:C,getRootElement:b,getMenuElement:w,getLayout:E,onClose:V,onCloseAnimationEnd:y,menuRef:n}))}));function Fe(e,t){return(0,ee.zV)(!e.isMuted,!t.isMuted)||(0,ee.zV)(e.presentation,t.presentation)||(0,ee.zV)(e.video,t.video)||(0,ee.zV)(e.raiseHandRating,t.raiseHandRating)}const _e=(0,o.ph)((0,q.EK)(e=>{const{participantsCount:t,participants:a}=(0,Y.iT)(e)||{};return{participants:a,participantsCount:t||0}})(({panelOffset:e,participants:t,participantsCount:a,isLandscape:n})=>{const{loadMoreGroupCallParticipants:i}=(0,q.ko)(),s=(0,o.Kr)(()=>Object.values(t||{}).sort(Fe).map(e=>e.id),[t]),r=(0,ce.A)(()=>{i()}),[c,l]=(0,he.A)(r,s,s.length>=a);return o.Ay.createElement(Ve.A,{items:c,onLoadMore:l,style:`transform: translateY(${e}px);`,className:(0,ie.A)("npTa6CmI",!n&&"v7oB2HTv")},t&&c?.map(e=>t[e]&&o.Ay.createElement(De,{key:e,teactOrderKey:s.indexOf(e),participant:t[e]})))}));var Oe=a(32610),Je=a(66644),je=a(19822),He=a(37836),$e=a(32625),ze=a(55158);const Ke="eUXuK9Oz",qe="O2bTiH2E",We=(0,o.ph)((0,q.EK)((e,{participant:t})=>({user:t.isUser?(0,Q.mBe)(e,t.id):void 0,chat:t.isUser?void 0:(0,Q.hds)(e,t.id)}))(({layout:e,pinnedVideo:t,setPinned:a,canPin:n,className:r,participant:c,user:l,chat:d})=>{const p=(0,le.A)(),m=(0,o.li)(),g=(0,o.li)(),A=(0,o.li)(),{x:f,y:v,width:h,height:V,noAnimate:y,isRemoved:C,type:b}=e,{isSelf:w,isMutedByMe:S,isMuted:k}=c,I=t?.id===c.id&&t?.type===b,T=(c.amplitude||0)>u,P=Boolean(c.raiseHandRating),N="video"===b&&c.isSelf,M=(0,o.Kr)(()=>w?p("ThisIsYou"):S?p("VoipGroupMutedForMe"):P?p("WantsToSpeak"):k||!T?p("Listening"):c.volume&&c.volume!==s.iRY?p("SpeakingWithVolume",Ce(c)).replace("%%","%"):p("Speaking"),[w,S,P,k,T,c,p]),x=(0,o.li)();C||(x.current=e);const{x:G,y:B,width:R,height:L}=x.current||{},[U,D,F,_]=C?[G,B,R,L]:[f,v,h,V],[O,J]=(0,o.J0)(!y),j=E(l?.id||d.id),H="video"===b?j?.video:j?.presentation,$=(0,o.li)(H);H?.active&&H?.getVideoTracks()[0].enabled&&($.current=H);const z=$.current,K=(0,ce.A)(()=>{const e=g.current;e&&(e.srcObject=null)});(0,o.vJ)(()=>(z?.addEventListener("inactive",K),()=>{z?.removeEventListener("inactive",K)}),[K,z]),(0,o.vJ)(()=>{J(!1)},[]);const[q,W]=(0,o.J0)(!0),Z=(0,ce.A)(()=>{W(!1)});(0,$e.A)(()=>{if(!z?.active)return;const e=g.current,t=A.current;(0,Je.RK)(()=>{t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height)})},1e3),(0,o.vJ)(()=>{const e=g.current,t=m.current;if(!e||!t||!z)return;const a=t.getContext("2d",{alpha:!1});if(!a)return;let n=!0;return(0,Je.RK)(()=>{n&&(t.width=16,t.height=16,a.filter="blur(2px)",(0,je.i0)(()=>!!n&&!!z.active&&(a.drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,t.width,t.height),i.QH||(0,Oe.A)(a,0,0,t.width,t.height,2,2),!0),He.IJ))}),()=>{n=!1}},[z]);const Q=(0,o.li)(),Y=(0,o.li)(),{isContextMenuOpen:X,contextMenuAnchor:ee,handleContextMenu:te,handleContextMenuClose:ae,handleContextMenuHide:ne}=(0,be.A)(Q,w),oe=(0,o.hb)(()=>Q.current,[]),se=(0,o.hb)(()=>Q.current.closest(".custom-scroll, .no-scrollbar"),[]),re=(0,o.hb)(()=>Y.current,[]),de=(0,o.hb)(()=>({withPortal:!0}),[]),ue=(0,o.hb)(()=>{a(I?void 0:{id:l?.id||d.id,type:b})},[d,I,a,b,l?.id]);return o.Ay.createElement("div",{className:(0,ie.A)("DKuzmnN7",(O||C)&&"T_wodAHA",y&&"yPCkJzpi",r,I&&"B4WZhF9P"),style:`--x: ${U}px; --y: ${D}px; --width: ${F}px; --height: ${_}px;`,ref:Q,onContextMenu:te,onDoubleClick:n?ue:void 0},o.Ay.createElement("div",{className:(0,ie.A)("eBq1NoLo",T&&"h4NcT6OS")},q&&o.Ay.createElement(ze.A,{className:(0,ie.A)(Ke,"XedVWQii")}),z&&o.Ay.createElement("video",{className:(0,ie.A)(Ke,N&&qe),muted:!0,autoPlay:!0,playsInline:!0,srcObject:z,ref:g,onCanPlay:Z}),o.Ay.createElement("canvas",{className:(0,ie.A)("eTpvBU_b eUXuK9Oz",N&&qe),ref:A}),o.Ay.createElement("div",{className:"R5ULTrF9"},o.Ay.createElement("canvas",{className:(0,ie.A)("cjUWuViy",N&&qe),ref:m})),n&&o.Ay.createElement(ge.A,{round:!0,size:"smaller",ripple:!0,color:"translucent",className:"lPdblo0y",ariaLabel:p(I?"lng_group_call_context_unpin_camera":"lng_group_call_context_pin_camera"),onClick:ue},o.Ay.createElement(me.A,{name:I?"unpin":"pin"})),o.Ay.createElement("div",{className:"T1deCDSn"},o.Ay.createElement("div",{className:"LzFFayK3"},o.Ay.createElement(Ee.A,{peer:l||d,className:"RBwMAuKp"}),o.Ay.createElement("div",{className:"z1ZZTsjC"},M)),o.Ay.createElement(Le,{participant:c,className:"j1aDzn1H",noColor:!0}))),o.Ay.createElement(Re,{participant:c,isDropdownOpen:X,anchor:ee,getTriggerElement:oe,getRootElement:se,getMenuElement:re,getLayout:de,onClose:ae,onCloseAnimationEnd:ne,menuRef:Y}))})),Ze=()=>{navigator.vibrate?.(50)};var Qe=a(57474);const Ye=(0,o.ph)((0,q.EK)(e=>{const t=(0,Y.iT)(e),{connectionState:a}=t||{},n=t&&(0,Y.n5)(e,t.id,e.currentUserId),{raiseHandRating:i,hasAudioStream:o,canSelfUnmute:s,isMuted:r}=n||{};return{connectionState:a||"discarded",hasRequestedToSpeak:Boolean(i),noAudioStream:!o,canSelfUnmute:s,isMuted:r}})(({className:e,noAudioStream:t,canSelfUnmute:a,isMuted:n,connectionState:i})=>{const{toggleGroupCallMute:s,requestToSpeak:r,playGroupCallSound:c}=(0,q.ko)(),l=(0,le.A)(),d=(0,o.li)("up"),[u,p]=(0,o.J0)(!1),m="connected"!==i,g=!a&&n,A=(0,ue.A)(g);(0,o.vJ)(()=>{A&&!g&&c({sound:"allowTalk"})},[c,A,g]);const f=(0,o.Kr)(()=>{if(u){const e=Math.floor(100*Math.random());return e<32?[0,120]:e<64?[120,240]:e<97?[240,420]:[420,540]}return!A&&g?t?[99,135]:[136,172]:A&&!g?[0,36]:g?[0,0]:t?[69,99]:[36,69]},[A,u,t,g]),v=u?"HandFilled":"VoiceMini",h=(0,o.hb)(()=>{Ze(),s()},[s]),V=(0,o.hb)(()=>{if(g){if(u)return;return Ze(),r(),p(!0),void setTimeout(()=>{p(!1)},3e3)}d.current="down",t&&setTimeout(()=>{"down"===d.current&&(d.current="hold",h())},200)},[u,t,r,g,h]),y=(0,o.hb)(()=>{g||(h(),d.current="up")},[g,h]);return o.Ay.createElement(ge.A,{round:!0,size:"default",className:(0,ie.A)("lKdhQ5pw",!m&&t&&"bjKqp3SI",!m&&g&&"Ynow5UuE",e),onMouseDown:V,onMouseUp:y,ariaLabel:l(n?"VoipUnmute":"VoipMute"),disabled:m},o.Ay.createElement(Te.A,{tgsUrl:ke.w[v],size:36,play:f.toString(),playSegment:f,className:"Ea1XnQaX",forceAlways:!0}),o.Ay.createElement(Qe.A,{className:(0,ie.A)("tyQNJC6B",m&&"LowChABq"),color:"white"}))})),Xe={root:"OsO5GKfn",panelWrapper:"cUVoePr_",panel:"Thuz79M3",panelScrollTrigger:"zoK6Y6IS",panelHeader:"DMBtCL9Z",scrolled:"GdEH1Agb",fullscreen:"JJx0QI2w",landscape:"wamCuzMB",headerButton:"gmyieSid",firstButton:"hVnn6KBp",lastButton:"iy78A5rG",panelHeaderText:"TwEEA77i",title:"pNZ9skLf",bigger:"NumT3v5i",subtitle:"gmfUKabx",participants:"iTeC_RxH",participantVideos:"PZmKIdTl",addParticipantButton:"clmu2oBt",videos:"ATwoMlAV",mainVideoContainer:"hqFon3dV",videosHeader:"KPHc659W",appFullscreen:"cl2sfoBF",videosHeaderLastButton:"_t50HVNJ",videosContent:"oEEQZilE",actions:"uGzi9s97",actionButton:"foXbVcnN",destructive:"YIR9Z9CZ",canRequestToSpeak:"ZoiZQu_O",muted:"wpvv1V6m",portrait:"R6HQcMwx",noVideoParticipants:"aepCFyJQ",noSidebar:"XjgP21E6"},et=(0,o.ph)((0,q.EK)((e,{groupCallId:t})=>{const{connectionState:a,title:n,participants:i,participantsCount:o,chatId:s}=(0,Y.Ip)(e,t)||{},r=s?(0,Q.hds)(e,s):void 0;return{connectionState:a,title:n||r?.title,participantsCount:o,meParticipant:(0,Y.n5)(e,t,e.currentUserId),isCallPanelVisible:Boolean((0,Q.nTw)(e).isCallPanelVisible),isAdmin:(0,Y.qI)(e),participants:i,canInvite:(0,Y.O7)(e)}})(({groupCallId:e,isCallPanelVisible:t,connectionState:a,participantsCount:n,title:i,meParticipant:s,isAdmin:r,participants:c,canInvite:l})=>{const{toggleGroupCallVideo:d,toggleGroupCallPresentation:u,leaveGroupCall:m,toggleGroupCallPanel:g,connectToActiveGroupCall:A,playGroupCallSound:f,createGroupCallInviteLink:v}=(0,q.ko)(),h=(0,le.A)(),V=(0,o.li)(),y=(0,o.li)(),C=(0,o.li)(),b=(0,o.li)(),w=(0,o.li)(),[E,S]=(0,o.J0)(!1),k=!t&&!E,{observe:I}=(0,re.BL)({rootRef:w,throttleMs:200,isDisabled:!k}),T=!(0,re.Vz)(b,k?I:void 0),{isMobile:P,isLandscape:N}=(0,oe.Ay)(),[M,x,G]=(0,se.A)(),[B,R,L]=(0,se.A)(!0),U=Boolean(M&&N),D=(0,de.zk)(),F=(0,o.Kr)(()=>Object.values(c).find(({presentation:e})=>e),[c]),_=(0,o.Kr)(()=>Object.values(c).filter(({video:e,presentation:t})=>e||t).flatMap(({id:e,video:t,presentation:a})=>(0,ee.oE)([t?{id:e,type:"video"}:void 0,a?{id:e,type:"screen"}:void 0])),[c]),O=_.length>0,J=i||h("VoipGroupVoiceChat"),j=h("Participants",n,"i"),[H,$,z]=(0,se.A)(),[K,W]=(0,o.J0)(!1),[Z,Q]=(0,o.J0)(!1),Y=s?.hasVideoStream,X=s?.hasPresentationStream,te=s?.hasAudioStream,ae="connected"!==a,ne=s?.canSelfUnmute,he=!ne&&!te;(0,o.vJ)(()=>{"connected"===a?f({sound:"join"}):"reconnecting"===a&&f({sound:"connecting"})},[a]);const Ve=(0,ce.A)(()=>{z(),W(!1)}),ye=(0,ce.A)(()=>{V.current&&!P&&(M?G():x())}),Ce=(0,ce.A)(()=>{B?L():R()}),be=(0,ce.A)(()=>{g()}),we=(0,ce.A)(()=>{v()}),Ee=(0,ce.A)(()=>{d()});(0,o.vJ)(()=>{A()},[A,e]);const Se=(0,ce.A)(()=>{!r||H?(f({sound:"leave"}),S(!0),z()):$()}),ke=(0,ce.A)(()=>{E&&m({shouldDiscard:Z})}),Ie=(0,ce.A)(()=>{u()}),Te=_.length>1&&!P,Pe=U&&O,[Ne,Me]=(0,o.J0)(void 0),{videoLayout:xe,panelOffset:Ge}=function({primaryContainerRef:e,secondaryContainerRef:t,videoParticipants:a,isLandscapeLayout:n,pinnedVideo:i}){const[s,r]=(0,o.J0)([]),[c,l]=(0,o.J0)(0),d=a.length,u=(0,ue.A)(d),p=(0,ue.A)(a),m=(0,o.Kr)(()=>p?.filter(({id:e,type:t})=>!a.some(a=>a.id===e&&a.type===t)),[p,a]),g=(0,ce.A)(()=>{const o=e.current,s=t.current;if(!s)return;const c=void 0!==u&&u>d?u-d:0,{x:p,y:g,width:A}=s.getBoundingClientRect(),f=[];if(void 0!==i||!o||!n){const e=!0;let t,s=!1,u=0,v=a;if(i&&o&&n&&(u=v.findIndex(({id:e,type:t})=>e===i.id&&t===i.type),-1!==u)){const{x:e,y:a,width:n,height:r}=o.getBoundingClientRect(),{id:c,type:l}=i;t={x:e,y:a,width:n,height:r,participantId:c,type:l,orderKey:u},s=!0,v=v.filter(({id:e,type:t})=>e!==c||t!==i.type)}const h=s?d-1:d,V=h%2==1,y=2,C=Math.ceil(h/y),b=(A-10*(y-1))/y,w=Math.max(0,V?240+(C-1)*b+8*(C-1):C*b+8*(C-1));for(let t=0;t<h;t++){const a=V&&0===t,n=a?A:b,i=a?240:b,o=V&&0!==t?t+1:t,s=(e?0:p)+o%y*(n+10),r=(e?0:g)+(V&&0!==t?248+(Math.floor(o/y)-1)*(i+8):Math.floor(o/y)*(i+8));f.push({x:s,y:r,width:n,height:i,shouldRemount:!e,isRemounted:e,noAnimate:!0,participantId:v[t].id,type:v[t].type,orderKey:t>=u?t+1:t})}if(t&&f.splice(u,0,t),m)for(let t=0;t<c;t++)f.push({x:0,y:0,width:0,height:0,isRemounted:e,isRemoved:!0,participantId:m[t].id,type:m[t].type,orderKey:t+d});return l(w),void r(f)}const{x:v,y:h,width:V,height:y}=o.getBoundingClientRect(),C=function(e){return e>=25?5:e>=13?4:e>=7?3:e>=3?2:1}(d),b=Math.ceil(d/C),w=b*C>d,E=(V-10*(C-1))/C,S=(y-8*(b-1))/b,k=E*(d%C);for(let e=0;e<d;e++){const t=Math.floor(e/C),n=v+e%C*(E+10)+(w&&t===b-1?(V-k)/2:0),i=h+Math.floor(e/C)*(S+8);f.push({x:n,y:i,width:E,height:S,participantId:a[e].id,type:a[e].type,orderKey:e})}if(m)for(let e=0;e<c;e++)f.push({x:0,y:0,width:0,height:0,isRemoved:!0,participantId:m[e].id,type:m[e].type,orderKey:e+d});l(0),r(f)});return(0,o.vJ)(g,[g,a,n,i]),(0,pe.A)(e,g,!e.current),(0,pe.A)(t,g,!t.current),{videoLayout:s,panelOffset:c}}({primaryContainerRef:y,secondaryContainerRef:C,videoParticipants:_,isLandscapeLayout:U,pinnedVideo:Ne}),Be=(0,ce.A)(e=>{Me(e),e&&!M&&x()}),Re=(0,ce.A)(()=>{F&&Me({id:F.id,type:"screen"})});return(0,o.vJ)(Re,[Re,Boolean(F)]),(0,o.vJ)(()=>{Ne&&(_.some(e=>e.type===Ne.type&&e.id===Ne.id)||Me(void 0))},[Ne,xe,_]),o.Ay.createElement(ve.A,{isOpen:k,onClose:g,className:(0,ie.A)(Xe.root,(M||P)&&Xe.fullscreen,D&&Xe.appFullscreen,U&&Xe.landscape,!O&&Xe.noVideoParticipants,!U&&Xe.portrait,!B&&Pe&&Xe.noSidebar),dialogRef:V,onCloseAnimationEnd:ke},Pe&&o.Ay.createElement("div",{className:Xe.videos},o.Ay.createElement("div",{className:Xe.videosHeader},!P&&o.Ay.createElement(ge.A,{round:!0,size:"smaller",color:"translucent",onClick:ye,className:(0,ie.A)(Xe.headerButton,Xe.firstButton),ariaLabel:h(M?"AccExitFullscreen":"AccSwitchToFullscreen")},o.Ay.createElement(me.A,{name:M?"smallscreen":"fullscreen"})),o.Ay.createElement("h3",{className:(0,ie.A)(Xe.title,Xe.bigger)},i||h("VoipGroupVoiceChat")),Pe&&!B&&o.Ay.createElement(ge.A,{round:!0,size:"smaller",color:"translucent",className:(0,ie.A)(Xe.headerButton,Xe.videosHeaderLastButton),onClick:Ce,ariaLabel:h("AccDescrExpandPanel")},o.Ay.createElement(me.A,{name:"sidebar"}))),o.Ay.createElement("div",{className:Xe.videosContent,ref:y})),o.Ay.createElement("div",{className:Xe.panelWrapper,ref:w},o.Ay.createElement("div",{className:(0,ie.A)(Xe.panel,"custom-scroll")},o.Ay.createElement("div",{className:Xe.panelScrollTrigger,ref:b}),o.Ay.createElement("div",{className:(0,ie.A)(Xe.panelHeader,T&&Xe.scrolled)},!Pe&&!P&&o.Ay.createElement(ge.A,{round:!0,size:"smaller",color:"translucent",ripple:!P,className:(0,ie.A)(Xe.firstButton,Xe.headerButton),onClick:ye,ariaLabel:h("AccSwitchToFullscreen")},o.Ay.createElement(me.A,{name:"fullscreen"})),P&&o.Ay.createElement(ge.A,{round:!0,size:"smaller",color:"translucent",onClick:be,className:(0,ie.A)(Xe.headerButton,Xe.firstButton),ariaLabel:h("Close")},o.Ay.createElement(me.A,{name:"close"})),Pe&&o.Ay.createElement(ge.A,{round:!0,size:"smaller",ripple:!P,className:(0,ie.A)(Xe.firstButton,Xe.headerButton),color:"translucent",onClick:Ce,ariaLabel:h("AccDescrCollapsePanel")},o.Ay.createElement(me.A,{name:"sidebar"})),o.Ay.createElement("div",{className:Xe.panelHeaderText},o.Ay.createElement("h3",{className:(0,ie.A)(Xe.title,Pe&&Xe.bigger)},Pe?j:J),!Pe&&o.Ay.createElement("span",{className:Xe.subtitle},j)),!Pe&&l&&o.Ay.createElement(ge.A,{round:!0,size:"smaller",ripple:!P,className:(0,ie.A)(Xe.lastButton,Xe.headerButton),color:"translucent",onClick:we,ariaLabel:h("VoipGroupInviteMember")},o.Ay.createElement(me.A,{name:"add-user"}))),o.Ay.createElement("div",{className:Xe.participants},o.Ay.createElement("div",{className:Xe.participantVideos,ref:C,style:`height: ${Ge}px;`},xe.map(e=>{const t=c[e.participantId];return e.isRemounted&&t?o.Ay.createElement(We,{teactOrderKey:e.orderKey,key:`${e.participantId}_${e.type}`,layout:e,canPin:Te,setPinned:Be,pinnedVideo:Ne,participant:t}):o.Ay.createElement("div",{teactOrderKey:e.orderKey,key:`${e.participantId}_${e.type}`})})),o.Ay.createElement(_e,{panelOffset:Ge,isLandscape:Pe}))),o.Ay.createElement(fe.A,{key:"add-participant",isShown:Pe&&l,onClick:we,className:Xe.addParticipantButton,ariaLabel:h("VoipGroupInviteMember")},o.Ay.createElement(me.A,{name:"add-user-filled"}))),o.Ay.createElement("div",{className:Xe.mainVideoContainer},xe.map(e=>{const t=c[e.participantId];return e.isRemounted||!t?o.Ay.createElement("div",{teactOrderKey:e.orderKey,key:`${e.participantId}_${e.type}`}):o.Ay.createElement(We,{teactOrderKey:e.orderKey,key:`${e.participantId}_${e.type}`,layout:e,canPin:Te,setPinned:Be,pinnedVideo:Ne,participant:t,className:Xe.video})})),o.Ay.createElement("div",{className:Xe.actions},o.Ay.createElement(ge.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Xe.actionButton,!te&&Xe.muted,he&&Xe.canRequestToSpeak),onClick:Ee,ariaLabel:h(Y?"VoipStopVideo":"VoipStartVideo"),disabled:ae},o.Ay.createElement(me.A,{name:Y?"video":"video-stop"})),o.Ay.createElement(ge.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Xe.actionButton,!te&&Xe.muted,he&&Xe.canRequestToSpeak),onClick:Ie,ariaLabel:h(X?"lng_group_call_screen_share_stop":"lng_group_call_tooltip_screen"),disabled:ae||!p},o.Ay.createElement(me.A,{name:X?"share-screen":"share-screen-stop"})),o.Ay.createElement(Ye,{className:Xe.actionButton}),o.Ay.createElement(ge.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Xe.actionButton,!te&&Xe.muted,he&&Xe.canRequestToSpeak),ariaLabel:h("lng_group_call_settings"),disabled:!0},o.Ay.createElement(me.A,{name:"settings-filled"})),o.Ay.createElement(ge.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Xe.actionButton,Xe.destructive),onClick:Se,ariaLabel:h("lng_group_call_leave")},o.Ay.createElement(me.A,{name:"close"}))),o.Ay.createElement(ve.A,{isOpen:H,onClose:Ve,className:"error",title:h(K?"VoipGroupEndAlertTitle":"VoipGroupLeaveAlertTitle")},o.Ay.createElement("p",null,h(K?"VoipGroupEndAlertText":"VoipGroupLeaveAlertText")),!K&&o.Ay.createElement(Ae.A,{className:"dialog-checkbox",label:h("VoipGroupEndChat"),checked:Z,onCheck:Q}),o.Ay.createElement("div",{className:"dialog-buttons"},o.Ay.createElement(ge.A,{isText:!0,className:"confirm-dialog-button",onClick:Se},h(K?"VoipGroupEnd":"VoipGroupLeave")),o.Ay.createElement(ge.A,{isText:!0,className:"confirm-dialog-button",onClick:Ve},h("Cancel")))))})),tt=(0,o.ph)((0,q.EK)(e=>{const t=(0,Q.nTw)(e);return{groupCall:t.isMasterTab?(0,Y.iT)(e):void 0,isCallPanelVisible:t.isCallPanelVisible,phoneCallUser:t.isMasterTab?(0,Y.uu)(e):void 0}})(({groupCall:e,phoneCallUser:t,isCallPanelVisible:a})=>{const{toggleGroupCallPanel:n}=(0,q.ko)(),i=(0,le.A)();if((0,o.vJ)(()=>{document.body.classList.toggle("has-call-header",Boolean(a));const e=window.electron?.setWindowButtonsPosition||window.electron?.setTrafficLightPosition;return e?.(a?"lowered":"standard"),()=>{document.body.classList.toggle("has-call-header",!1),e?.("standard")}},[a]),e||t)return o.Ay.createElement("div",{className:(0,ie.A)("ActiveCallHeader",a&&"open"),onClick:function(){n()}},o.Ay.createElement("span",{className:"title"},t?.firstName||e?.title||i("VoipGroupVoiceChat")))}));var at=a(17663),nt=a(30857);const it=(0,o.ph)(({onClick:e,label:t,customIcon:a,icon:n,iconClassName:i,className:s,isDisabled:r,isActive:c})=>o.Ay.createElement("div",{className:"lBO3RZUM"},o.Ay.createElement(ge.A,{round:!0,className:(0,ie.A)(s,"ch2sqAKW",c&&"OQxlsRp7"),onClick:e,disabled:r},a||o.Ay.createElement(me.A,{name:n,className:i})),o.Ay.createElement("div",{className:"aHguvLcL"},t))),ot={root:"GNYRVAUg",blurred:"RBmbMiou","single-column":"O7cZE08z",singleColumn:"O7cZE08z",header:"GI6dY5aJ","close-button":"ULiJZuaP",closeButton:"ULiJZuaP","emojis-backdrop":"RFBKZpjx",emojisBackdrop:"RFBKZpjx",open:"zi1NlOXX",emojis:"DFco1VIN","emoji-tooltip":"MRIShZ3V",emojiTooltip:"MRIShZ3V","user-info":"eaUe2A0c",userInfo:"eaUe2A0c",buttons:"qIeflO02",leave:"hclywYYk",accept:"ln_ZBUHy","accept-icon":"cVRd3twS",acceptIcon:"cVRd3twS","main-video":"bGlBFSJq",mainVideo:"bGlBFSJq","second-video":"TOFu1n5x",secondVideo:"TOFu1n5x",visible:"LOnSFN9w",fullscreen:"Omg5T1o6"},st=(0,o.ph)((0,q.EK)(e=>{const{phoneCall:t,currentUserId:a}=e,{isCallPanelVisible:n,isMasterTab:i}=(0,Q.nTw)(e),o=(0,Y.uu)(e);return{isCallPanelVisible:Boolean(n),user:o,isOutgoing:t?.adminId===a,phoneCall:i?t:void 0}})(({user:e,isOutgoing:t,phoneCall:a,isCallPanelVisible:n})=>{const s=(0,le.A)(),{hangUp:r,requestMasterAndAcceptCall:c,playGroupCallSound:l,toggleGroupCallPanel:d,connectToActivePhoneCall:u}=(0,q.ko)(),m=(0,o.li)(),[g,A,f]=(0,se.A)(),{isMobile:v}=(0,oe.Ay)(),h=(0,o.hb)(()=>{g?f():A()},[f,g,A]),V=(0,o.hb)(()=>{m.current&&(g?document.exitFullscreen().then(f):m.current.requestFullscreen().then(A))},[f,g,A]);(0,o.vJ)(()=>{if(!i.SC)return;const e=m.current;return e?(e.addEventListener("fullscreenchange",h),()=>{e.removeEventListener("fullscreenchange",h)}):void 0},[h]);const y=(0,o.hb)(()=>{d(),g&&f()},[f,g,d]),C="discarded"===a?.state,w="busy"===a?.reason,E="requested"===a?.state&&!t,S=("requested"===a?.state||"waiting"===a?.state)&&t,k="active"===a?.state,I=a?.isConnected,[T,P,N]=(0,se.A)(),M=(0,o.hb)(()=>{P(),r()},[r,P]);(0,o.vJ)(()=>{T?l({sound:"end"}):E?l({sound:"incoming"}):w?l({sound:"busy"}):C?l({sound:"end"}):S?l({sound:"ringing"}):I&&l({sound:"connect"})},[w,C,E,S,I,l,T]),(0,o.vJ)(()=>{a?.id?N():u()},[u,a?.id,N]);const x=(0,nt.A)();(0,$e.A)(x,I?1e3:void 0);const G=(0,o.Kr)(()=>{const e=a?.state;return T?s("lng_call_status_hanging"):w?"busy":"requesting"===e?s("lng_call_status_requesting"):"requested"===e?s(t?"lng_call_status_ringing":"lng_call_status_incoming"):"waiting"===e?s("lng_call_status_waiting"):"active"===e&&I?void 0:s("lng_call_status_exchanging")},[w,I,T,t,s,a?.state]),B="active"===a?.videoState,R="active"===a?.screencastState,F=b?.streams,_=F?.ownAudio?.getTracks()[0].enabled,O=F?.ownPresentation?.getTracks()[0].enabled,J=F?.ownVideo?.getTracks()[0].enabled,[j,H,$]=(0,se.A)(),[z,K,W]=(0,se.A)(),Z=(0,o.hb)(()=>{O&&H(),J&&K(),setTimeout(async()=>{await D("presentation"),$(),W()},250)},[O,J,H,K,$,W]),Q=(0,o.hb)(()=>{J&&K(),O&&H(),setTimeout(async()=>{await D("video"),$(),W()},250)},[O,J,H,K,$,W]),Y=(0,o.hb)(()=>{D("audio")},[]),[X,ee,te]=(0,se.A)(),[ae,ne,re]=(0,se.A)(),ce=(0,o.hb)(()=>{ne(),async function(){if(!b||!b.facingMode)return;const e=b.streams.ownVideo;if(!e)return;const t=e.getTracks()[0];if(!t)return;const a=b.connection.getSenders().find(e=>t.id===e.track?.id);if(a){b.facingMode="environment"===b.facingMode?"user":"environment";try{const e=await U("video",b.facingMode);await a.replaceTrack(e.getTracks()[0]),b.streams.ownVideo=e,L()}catch(e){}}}(),setTimeout(re,250)},[ne,re]),de=a?.startDate&&Number(new Date)/1e3-a.startDate;return(0,o.vJ)(()=>{"discarded"===a?.state&&setTimeout(r,250)},[r,a?.reason,a?.state]),o.Ay.createElement(ve.A,{isOpen:a&&"discarded"!==a?.state&&!n,onClose:y,className:(0,ie.A)(ot.root,v&&ot.singleColumn),dialogRef:m},o.Ay.createElement(we.A,{peer:e,size:"jumbo",className:B||R?ot.blurred:""}),"active"===a?.screencastState&&F?.presentation&&o.Ay.createElement("video",{className:ot.mainVideo,muted:!0,autoPlay:!0,playsInline:!0,srcObject:F.presentation}),"active"===a?.videoState&&F?.video&&o.Ay.createElement("video",{className:ot.mainVideo,muted:!0,autoPlay:!0,playsInline:!0,srcObject:F.video}),o.Ay.createElement("video",{className:(0,ie.A)(ot.secondVideo,!j&&O&&ot.visible,g&&ot.fullscreen),muted:!0,autoPlay:!0,playsInline:!0,srcObject:F?.ownPresentation}),o.Ay.createElement("video",{className:(0,ie.A)(ot.secondVideo,!z&&J&&ot.visible,g&&ot.fullscreen),muted:!0,autoPlay:!0,playsInline:!0,srcObject:F?.ownVideo}),o.Ay.createElement("div",{className:ot.header},i.SC&&o.Ay.createElement(ge.A,{round:!0,size:"smaller",color:"translucent",onClick:V,ariaLabel:s(g?"AccExitFullscreen":"AccSwitchToFullscreen")},o.Ay.createElement(me.A,{name:g?"smallscreen":"fullscreen"})),o.Ay.createElement(ge.A,{round:!0,size:"smaller",color:"translucent",onClick:y,className:ot.closeButton},o.Ay.createElement(me.A,{name:"close"}))),o.Ay.createElement("div",{className:(0,ie.A)(ot.emojisBackdrop,X&&ot.open),onClick:X?te:ee},o.Ay.createElement("div",{className:(0,ie.A)(ot.emojis,X&&ot.open)},a?.isConnected&&a?.emojis&&(0,ye.A)(a.emojis,["emoji"])),o.Ay.createElement("div",{className:(0,ie.A)(ot.emojiTooltip,X&&ot.open)},s("CallEmojiKeyTooltip",e?.firstName).replace("%%","%"))),o.Ay.createElement("div",{className:ot.userInfo},o.Ay.createElement("h1",null,e?.firstName),o.Ay.createElement("span",{className:ot.status},G||(0,at.QO)(de||0))),o.Ay.createElement("div",{className:ot.buttons},o.Ay.createElement(it,{onClick:Y,icon:"microphone",isDisabled:!k,isActive:_,label:s(_?"lng_call_mute_audio":"lng_call_unmute_audio")}),o.Ay.createElement(it,{onClick:Q,icon:"video",isDisabled:!k,isActive:J,label:s(J?"lng_call_stop_video":"lng_call_start_video")}),J&&(i.Ni||i.pz)&&o.Ay.createElement(it,{onClick:ce,customIcon:o.Ay.createElement(Te.A,{tgsUrl:ke.w.CameraFlip,playSegment:ae?[0,10]:[0,1],size:32}),isDisabled:!k,label:s("VoipFlip")}),p&&o.Ay.createElement(it,{onClick:Z,icon:"share-screen",isDisabled:!k,isActive:O,label:s("lng_call_screencast")}),E&&o.Ay.createElement(it,{onClick:c,icon:"phone-discard",isDisabled:C,label:s("lng_call_accept"),className:ot.accept,iconClassName:ot.acceptIcon}),o.Ay.createElement(it,{onClick:M,icon:"phone-discard",isDisabled:C,label:s(E?"lng_call_decline":"lng_call_end_call"),className:ot.leave})))}));var rt=a(40664);const ct=(0,o.ph)(({isOpen:e})=>{const{closeCallRatingModal:t,setCallRating:a}=(0,q.ko)(),n=(0,o.li)(),i=(0,le.A)(),[s,r]=(0,o.J0)(),c=(0,o.hb)(()=>{s?a({rating:s+1,comment:n.current?.value||""}):t()},[t,s,a]),l=(0,o.hb)(()=>{t()},[t]);return o.Ay.createElement(ve.A,{title:i("lng_call_rate_label"),className:"narrow",onClose:t,isOpen:e},o.Ay.createElement("div",{className:"P7EfDKJN"},new Array(5).fill(void 0).map((e,t)=>{const a=void 0!==s&&s>=t;return o.Ay.createElement(me.A,{name:a?"favorite-filled":"favorite",className:(0,ie.A)(a&&"_XX6q8YW","t8LJLFSN"),onClick:(n=t,()=>r(s===n?void 0:n))});var n})),o.Ay.createElement(rt.A,{ref:n,placeholder:i("lng_call_rate_comment"),className:(0,ie.A)("EvL0WaKD",4!==s&&void 0!==s&&"v5hn1XvT")}),o.Ay.createElement("div",{className:"dialog-buttons mt-2"},o.Ay.createElement(ge.A,{className:"confirm-dialog-button",isText:!0,onClick:c},i("Send")),o.Ay.createElement(ge.A,{className:"confirm-dialog-button",isText:!0,onClick:l},i("Cancel"))))});(i.Yw||i.pz)&&document.addEventListener("click",n.cw,{once:!0})},90423:(e,t,a)=>{a.d(t,{Ay:()=>r,j9:()=>d,zk:()=>c});var n=a(84051),i=a(31791),o=a(96454);const s=l();function r(e,t,a){const[i,r]=(0,n.J0)(Boolean(s&&document[s]));return(0,n.Nf)(()=>{const n=e.current,i=()=>{const e=Boolean(s&&document[s]);r(e),e?a?.(!1):t?.(!1),n instanceof HTMLVideoElement&&(n.controls=e)},o=()=>{r(!0),a&&a(!0)},c=()=>{r(!1),t&&t(!1)};return document.addEventListener("fullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),n&&(n.addEventListener("webkitbeginfullscreen",o,!1),n.addEventListener("webkitendfullscreen",c,!1)),()=>{document.removeEventListener("fullscreenchange",i,!1),document.removeEventListener("webkitfullscreenchange",i,!1),document.removeEventListener("mozfullscreenchange",i,!1),n&&(n.removeEventListener("webkitbeginfullscreen",o,!1),n.removeEventListener("webkitendfullscreen",c,!1))}},[]),s||o.pz?[i,()=>{var t;e.current&&(s||o.pz)&&!i&&((t=e.current).requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.webkitEnterFullscreen?t.webkitEnterFullscreen():t.mozRequestFullScreen&&t.mozRequestFullScreen(),r(!0))},()=>{e.current&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),r(!1))}]:[!1]}const c=()=>{const[e,t]=(0,n.J0)(!1);return(0,n.vJ)(()=>{const e=()=>{t(d())},a=window.electron?.on(i.v.FULLSCREEN_CHANGE,t);return window.electron?.isFullscreen().then(t),document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),()=>{a?.(),document.removeEventListener("fullscreenchange",e,!1),document.removeEventListener("webkitfullscreenchange",e,!1),document.removeEventListener("mozfullscreenchange",e,!1)}},[]),e};function l(){return void 0!==document.fullscreenElement?"fullscreenElement":void 0!==document.mozFullScreenElement?"mozFullScreenElement":void 0!==document.webkitFullscreenElement?"webkitFullscreenElement":""}function d(){const e=l();return Boolean(e&&document[e])}}}]);
//# sourceMappingURL=2394.261a4b291a0e7cbb5c93.js.map