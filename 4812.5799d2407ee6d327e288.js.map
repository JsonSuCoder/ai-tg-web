{"version":3,"file":"4812.5799d2407ee6d327e288.js","mappings":"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,EAAOy7B,aAAaE,KAClClF,uBACApG,aACAI,gBAAgB7G,EAAAA,EAAAA,KAAe5pB,GAAQywB,eACvCmL,wBAAyBzI,GAAcyI,wBACvCvE,UACAE,mBACAT,uBACAE,iBACAE,oBACAO,oBACApU,oBACAwQ,+BACA6C,mBACAmF,kCAAmC1G,EAAS0G,kCAC5CjE,gBACAI,2BACA8D,yBAA0B3I,GAAc2I,yBACxCC,gBAAiB5I,GAAc4I,gBAC/B7D,mBACAE,qBACD,GAlLer4B,EAv/DwBi8B,EAC1CpxB,OACA2tB,gBACA0D,gBACAzF,oBACAiC,yBACAyD,UACAtJ,WACAzP,iBACAjiB,SACA+gB,WACA0Q,UACA2C,qBACAlS,kBACAgH,QACAlqB,QACAozB,gBACA6C,gBACAZ,2BACAzJ,wBACA0J,yBACAxC,iBACAhI,kBACA2N,aACAgC,iBACA/B,sBACAE,sBACAiC,wBACAe,4BACA5R,gBACA2B,0BACAuN,aACAhF,wBACA8E,0BACAiD,oBACAnD,uBACAK,oBACAG,uBACAC,mBACAxN,iBACAqI,eACAwG,gBACAlB,wBACAlG,yBACAC,4BACAM,qBACAC,iBACA2F,gBACAE,cACAE,sBACAE,eACAtF,cACAC,cACAN,YACAmB,gBACAZ,kBACAE,uBACAqF,iBACA7X,cACAgY,sBACAlK,sBACA3N,SACA8S,YACA9B,+BACAwI,4BACAC,mBACAC,WACA58B,aACA24B,sBACAC,gBACA2C,iBACAE,yBACAtY,0BACAmT,qBACAsF,eACAD,uBACAG,sBACAC,gBACAhF,uBACAhG,kBACAJ,aACAuL,2BACAvY,qBACAgU,UACAE,mBACAT,uBACAE,iBACAE,oBACAO,oBACAf,mBACA6F,cACAC,WACAC,UACAC,aACAb,qCACAjE,gBACAI,2BACA+D,mBACA7D,mBACAE,yBAEA,MAAM,YACJuE,GAAW,WACXC,GAAU,WACVC,GAAU,cACVC,GAAa,eACbC,GAAc,qBACdC,GAAoB,WACpBC,GAAU,eACVC,GAAc,oBACdC,GAAmB,WACnBC,GAAU,uBACVC,GAAsB,cACtBC,GAAa,qBACbC,GAAoB,iBA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","sources":["webpack://telegram-t/./src/components/common/MessageOutgoingStatus.tsx","webpack://telegram-t/./src/components/right/DeleteMemberModal.tsx","webpack://telegram-t/./src/hooks/useHotkeys.ts","webpack://telegram-t/./src/util/parseHotkey.ts","webpack://telegram-t/./src/components/story/StoryRibbon.module.scss?8966","webpack://telegram-t/./src/components/middle/composer/hooks/useCustomEmojiTooltip.ts","webpack://telegram-t/./src/components/chatAssistant/component/button.tsx","webpack://telegram-t/./src/util/PostMessageConnector.ts","webpack://telegram-t/./src/components/chatAssistant/component/textarea.tsx","webpack://telegram-t/./src/components/chatAssistant/globalSummary/summary-utils.ts","webpack://telegram-t/./src/components/chatAssistant/room-storage/index.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-translate/input-language.module.scss?791a","webpack://telegram-t/./src/components/chatAssistant/component/input-translate/input-language-modal.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-translate/input-translate-tip.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-translate/input-translate.tsx","webpack://telegram-t/./src/components/middle/composer/helpers/applyIosAutoCapitalizationFix.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useChatCommandTooltip.ts","webpack://telegram-t/./src/lib/cleanDocsHtml.ts","webpack://telegram-t/./src/components/middle/composer/helpers/cleanHtml.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useClipboardPaste.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useDraft.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useEditing.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useInlineBotTooltip.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useStickerTooltip.ts","webpack://telegram-t/./src/util/voiceRecording.ts","webpack://telegram-t/./src/components/chatAssistant/utils/grammarly.ts","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/Skeleton/SkeletonScreen.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/tabs/FormalTab.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/tabs/FriendlyTab.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/tabs/ImproveTab.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/tabs/RephraseTab.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/tabs/ShortenTab.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/GrammarToolWrapper.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/GrammarTool.tsx","webpack://telegram-t/./src/components/middle/composer/AttachmentModal.async.tsx","webpack://telegram-t/./src/components/middle/composer/AttachMenu.tsx","webpack://telegram-t/./src/components/middle/composer/BotCommandMenu.async.tsx","webpack://telegram-t/./src/components/middle/composer/BotKeyboardMenu.tsx","webpack://telegram-t/./src/components/middle/composer/BotMenuButton.tsx","webpack://telegram-t/./src/components/middle/composer/ChatCommandTooltip.async.tsx","webpack://telegram-t/./src/components/middle/composer/ComposerEmbeddedMessage.tsx","webpack://telegram-t/./src/components/middle/composer/DropArea.async.tsx","webpack://telegram-t/./src/components/middle/composer/InlineBotTooltip.async.tsx","webpack://telegram-t/./src/components/middle/composer/MentionTooltip.async.tsx","webpack://telegram-t/./src/components/middle/composer/PollModal.async.tsx","webpack://telegram-t/./src/components/middle/composer/SendAsMenu.async.tsx","webpack://telegram-t/./src/components/middle/composer/StickerTooltip.async.tsx","webpack://telegram-t/./src/components/middle/composer/WebPagePreview.tsx","webpack://telegram-t/./src/components/common/Composer.tsx","webpack://telegram-t/./src/components/middle/composer/hooks/useAttachmentModal.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useVoiceRecording.ts","webpack://telegram-t/./src/util/deleteLastCharacterOutsideSelection.ts","webpack://telegram-t/./src/components/chatAssistant/messages/ai-search-sugesstion-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/global-intoduce-message.module.scss?5de3","webpack://telegram-t/./src/components/chatAssistant/messages/global-introduce-message.tsx","webpack://telegram-t/./src/components/chatAssistant/hook/useSpeechPlayer.ts","webpack://telegram-t/./src/components/chatAssistant/messages/global-summary-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/google-event-create-messages.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/google-event-detail-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/google-login-auth-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/group-search-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/introduce-portrait-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/introduce-smartreply-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/introduce-summary-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/introduce-translation-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/room-actions-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/room-ai-des-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/room-summary-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/urgent-check-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/user-search-message.tsx","webpack://telegram-t/./src/components/chatAssistant/markdown.tsx","webpack://telegram-t/./src/components/chatAssistant/code-block.tsx","webpack://telegram-t/./src/components/chatAssistant/message-reasoning.tsx","webpack://telegram-t/./src/components/chatAssistant/preview-attachment.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/room-ai-media-message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages/room-ai-reply-mention-message.tsx","webpack://telegram-t/./src/components/chatAssistant/message.tsx","webpack://telegram-t/./src/components/chatAssistant/messages.tsx","webpack://telegram-t/./src/components/chatAssistant/hook/use-messages.tsx","webpack://telegram-t/./src/components/chatAssistant/hook/use-scroll-to-bottom.tsx","webpack://telegram-t/./src/components/middle/composer/hooks/useMentionTooltip.ts","webpack://telegram-t/./src/components/left/main/hooks/useOrderDiff.ts","webpack://telegram-t/./src/components/middle/message/hooks/useOverlayPosition.ts","webpack://telegram-t/./src/components/middle/composer/helpers/selection.ts","webpack://telegram-t/./src/hooks/useForumPanelRender.ts","webpack://telegram-t/./src/components/middle/message/WebPageUniqueGift.module.scss?8703","webpack://telegram-t/./src/components/middle/message/WebPageUniqueGift.tsx","webpack://telegram-t/./src/components/middle/message/WebPage.tsx","webpack://telegram-t/./src/components/middle/message/helpers/webpageType.ts","webpack://telegram-t/./src/components/main/visualEffects/SnapEffectContainer.module.scss?fa7b","webpack://telegram-t/./src/components/main/visualEffects/SnapEffectContainer.tsx","webpack://telegram-t/./src/components/middle/message/helpers/getSingularPaidMedia.ts","webpack://telegram-t/./src/components/middle/message/helpers/calculateAlbumLayout.ts","webpack://telegram-t/./src/util/languageDetection.ts","webpack://telegram-t/./src/components/middle/message/hooks/useDetectChatLanguage.ts","webpack://telegram-t/./src/components/middle/message/hooks/useOuterHandlers.ts","webpack://telegram-t/./src/components/common/embedded/EmbeddedStory.tsx","webpack://telegram-t/./src/components/common/TopicChip.tsx","webpack://telegram-t/./src/components/common/TopicChip.module.scss?5208","webpack://telegram-t/./src/components/middle/message/hocs/withSelectControl.tsx","webpack://telegram-t/./src/components/middle/message/Album.tsx","webpack://telegram-t/./src/components/common/hooks/useAnimatedEmoji.ts","webpack://telegram-t/./src/components/middle/message/AnimatedCustomEmoji.tsx","webpack://telegram-t/./src/components/middle/message/AnimatedEmoji.tsx","webpack://telegram-t/./src/components/middle/message/CommentButton.tsx","webpack://telegram-t/./src/components/middle/message/Contact.module.scss?fec1","webpack://telegram-t/./src/components/middle/message/Contact.tsx","webpack://telegram-t/./src/components/middle/message/ContextMenuContainer.async.tsx","webpack://telegram-t/./src/components/middle/message/FactCheck.module.scss?3842","webpack://telegram-t/./src/components/middle/message/FactCheck.tsx","webpack://telegram-t/./src/components/middle/message/Game.tsx","webpack://telegram-t/./src/components/middle/message/Giveaway.module.scss?9b0c","webpack://telegram-t/./src/components/middle/message/Giveaway.tsx","webpack://telegram-t/./src/components/middle/message/InlineButtons.tsx","webpack://telegram-t/./src/components/middle/message/Invoice.tsx","webpack://telegram-t/./src/components/middle/message/InvoiceMediaPreview.module.scss?19f6","webpack://telegram-t/./src/components/middle/message/InvoiceMediaPreview.tsx","webpack://telegram-t/./src/components/middle/message/Location.tsx","webpack://telegram-t/./src/components/middle/message/MessageMeta.tsx","webpack://telegram-t/./src/components/middle/message/MessagePhoneCall.module.scss?15a3","webpack://telegram-t/./src/components/middle/message/MessagePhoneCall.tsx","webpack://telegram-t/./src/components/middle/message/PaidMediaOverlay.module.scss?e3d6","webpack://telegram-t/./src/components/middle/message/PaidMediaOverlay.tsx","webpack://telegram-t/./src/components/middle/message/PollOption.tsx","webpack://telegram-t/./src/components/middle/message/Poll.tsx","webpack://telegram-t/./src/components/middle/message/Sticker.module.scss?30d0","webpack://telegram-t/./src/components/middle/message/Sticker.tsx","webpack://telegram-t/./src/components/middle/message/Story.tsx","webpack://telegram-t/./src/components/middle/message/StoryMention.tsx","webpack://telegram-t/./src/components/middle/message/Message.tsx","webpack://telegram-t/./src/components/middle/message/hooks/useInnerHandlers.ts","webpack://telegram-t/./src/hooks/useTextLanguage.ts","webpack://telegram-t/./src/components/middle/message/helpers/buildContentClassName.ts","webpack://telegram-t/./src/components/story/StoryToggler.module.scss?58fa","webpack://telegram-t/./src/components/common/PrivateChatInfo.tsx","webpack://telegram-t/./src/components/middle/composer/helpers/prepareForRegExp.ts","webpack://telegram-t/./src/components/middle/composer/hooks/usePaidMessageConfirmation.ts","webpack://telegram-t/./src/hooks/useEnsureStory.ts","webpack://telegram-t/./src/components/chatAssistant/utils/util.ts","webpack://telegram-t/./src/hooks/polling/usePeerStoriesPolling.ts","webpack://telegram-t/./src/hooks/usePrevDuringAnimation.ts","webpack://telegram-t/./src/components/left/main/ChatBadge.tsx","webpack://telegram-t/./src/components/common/helpers/formatUsername.ts","webpack://telegram-t/./src/components/left/main/hooks/useLeftHeaderButtonRtlForumTransition.ts","webpack://telegram-t/./src/components/middle/message/Video.tsx","webpack://telegram-t/./src/components/middle/composer/hooks/useEmojiTooltip.ts","webpack://telegram-t/./src/components/middle/composer/CustomEmojiTooltip.async.tsx","webpack://telegram-t/./src/components/middle/composer/SymbolMenu.async.tsx","webpack://telegram-t/./src/components/middle/composer/SymbolMenuButton.tsx","webpack://telegram-t/./src/components/chatAssistant/component/Icon.tsx","webpack://telegram-t/./src/components/chatAssistant/hook/useOldLang.ts","webpack://telegram-t/./src/components/chatAssistant/hook/useEffectOnce.ts","webpack://telegram-t/./src/types/electron.ts","webpack://telegram-t/./src/hooks/reducers/useFoldersReducer.ts","webpack://telegram-t/./src/components/left/main/ChatCallStatus.module.scss?f06e","webpack://telegram-t/./src/components/left/main/ChatCallStatus.tsx","webpack://telegram-t/./src/components/left/main/Chat.tsx","webpack://telegram-t/./src/components/story/helpers/ribbonAnimation.ts","webpack://telegram-t/./src/components/middle/message/helpers/mediaDimensions.ts","webpack://telegram-t/./src/util/focusEditableElement.ts","webpack://telegram-t/./src/hooks/useMouseInside.ts","webpack://telegram-t/./src/components/common/WebLink.tsx","webpack://telegram-t/./src/util/memoized.ts","webpack://telegram-t/./src/components/common/TopicIcon.tsx","webpack://telegram-t/./src/hooks/useLongPress.ts","webpack://telegram-t/./src/util/selection.ts","webpack://telegram-t/./src/components/story/StoryToggler.tsx","webpack://telegram-t/./src/lib/injectComponent.tsx","webpack://telegram-t/./src/components/middle/message/helpers/getCustomAppendixBg.ts","webpack://telegram-t/./src/util/launchMediaWorkers.ts","webpack://telegram-t/./src/hooks/useGetSelectionRange.ts","webpack://telegram-t/./src/components/middle/composer/DropTarget.tsx","webpack://telegram-t/./src/components/middle/composer/DropArea.tsx","webpack://telegram-t/./src/hooks/useReducer.ts","webpack://telegram-t/./src/components/common/NothingFound.tsx","webpack://telegram-t/./src/components/chatAssistant/globalSummary/DrawerContext.tsx","webpack://telegram-t/./src/components/common/Document.tsx","webpack://telegram-t/./src/util/dates/workHours.ts","webpack://telegram-t/./src/components/common/profile/BusinessHours.module.scss?06fd","webpack://telegram-t/./src/components/common/profile/BusinessHours.tsx","webpack://telegram-t/./src/components/common/profile/UserBirthday.module.scss?dc99","webpack://telegram-t/./src/components/common/profile/UserBirthday.tsx","webpack://telegram-t/./src/components/common/profile/ChatExtra.module.scss?9412","webpack://telegram-t/./src/components/common/profile/ChatExtra.tsx","webpack://telegram-t/./src/components/middle/composer/helpers/getFilesFromDataTransferItems.ts","webpack://telegram-t/./src/components/story/helpers/videoFormats.ts","webpack://telegram-t/./src/components/common/LinkField.module.scss?fa18","webpack://telegram-t/./src/components/common/LinkField.tsx","webpack://telegram-t/./src/hooks/useChatContextActions.ts","webpack://telegram-t/./src/util/map.ts","webpack://telegram-t/./src/components/chatAssistant/hook/useForceUpdate.ts","webpack://telegram-t/./src/components/common/PaymentMessageConfirmDialog.module.scss?1d52","webpack://telegram-t/./src/components/common/PaymentMessageConfirmDialog.tsx","webpack://telegram-t/./src/components/middle/HeaderMenuContainer.async.tsx","webpack://telegram-t/./src/components/middle/HeaderActions.tsx","webpack://telegram-t/./src/components/middle/hooks/useHeaderPane.tsx","webpack://telegram-t/./src/components/middle/message/MessageAppendix.tsx","webpack://telegram-t/./src/components/middle/composer/EmojiTooltip.async.tsx","webpack://telegram-t/./src/util/mediaSession.ts","webpack://telegram-t/./src/components/common/GroupChatInfo.tsx","webpack://telegram-t/./src/components/middle/message/Photo.tsx","webpack://telegram-t/./src/util/systemFilesDialog.ts","webpack://telegram-t/./src/components/common/File.tsx","webpack://telegram-t/./src/components/common/ChatForumLastMessage.module.scss?cb0b","webpack://telegram-t/./src/components/common/ChatForumLastMessage.tsx","webpack://telegram-t/./src/components/left/main/hooks/useChatListEntry.tsx","webpack://telegram-t/./src/util/audioPlayer.ts","webpack://telegram-t/./src/components/common/DeleteChatModal.tsx","webpack://telegram-t/./src/components/middle/composer/AttachBotIcon.module.scss?7e9f","webpack://telegram-t/./src/components/middle/composer/AttachBotIcon.tsx","webpack://telegram-t/./src/components/middle/composer/AttachBotItem.tsx","webpack://telegram-t/./src/hooks/schedulers/useIntervalForceUpdate.ts","webpack://telegram-t/./src/components/middle/composer/helpers/buildAttachment.ts","webpack://telegram-t/./src/util/audio.ts","webpack://telegram-t/./src/components/common/helpers/boostInfo.ts","webpack://telegram-t/./src/components/left/search/helpers/getSenderName.ts","webpack://telegram-t/./src/lib/utils.ts","webpack://telegram-t/./src/components/story/mediaArea/MediaArea.module.scss?fe60","webpack://telegram-t/./src/components/story/mediaArea/MediaAreaSuggestedReaction.tsx","webpack://telegram-t/./src/components/story/mediaArea/MediaAreaWeather.tsx","webpack://telegram-t/./src/util/formatTemperature.ts","webpack://telegram-t/./src/components/story/mediaArea/MediaAreaOverlay.tsx","webpack://telegram-t/./src/hooks/window/useBeforeUnload.ts","webpack://telegram-t/./src/util/AbsoluteVideo.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useInputCustomEmojis.ts","webpack://telegram-t/./src/components/middle/composer/TextFormatter.async.tsx","webpack://telegram-t/./src/components/chatAssistant/utils/grammar.ts","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/useGrammarChecker.ts","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/InputErrorTooltip.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/InputGrammar.tsx","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/InputGrammarWrapper.tsx","webpack://telegram-t/./src/components/middle/composer/MessageInput.tsx","webpack://telegram-t/./src/hooks/useOffscreenCanvasBlur.ts","webpack://telegram-t/./src/components/middle/message/hooks/useBlurredMediaThumbRef.ts","webpack://telegram-t/./src/components/calls/group/GroupCallTopPane.tsx","webpack://telegram-t/./src/hooks/useAsyncResolvers.ts","webpack://telegram-t/./src/components/middle/message/hooks/useMessageTranslation.ts","webpack://telegram-t/./src/global/selectors/limits.ts","webpack://telegram-t/./src/components/common/helpers/waveform.ts","webpack://telegram-t/./src/components/common/Audio.tsx","webpack://telegram-t/./src/util/waveform.ts","webpack://telegram-t/./src/components/chatAssistant/hook/useSyncEffect.ts","webpack://telegram-t/./src/components/chatAssistant/hook/usePreviousDeprecated.ts","webpack://telegram-t/./src/components/chatAssistant/hook/data/useSelectorSignal.ts","webpack://telegram-t/./src/components/chatAssistant/hook/useMedia.ts","webpack://telegram-t/./src/components/chatAssistant/hook/data/useSelector.ts","webpack://telegram-t/./src/components/chatAssistant/hook/useDerivedState.ts","webpack://telegram-t/./src/components/chatAssistant/hook/useStateRef.ts","webpack://telegram-t/./src/components/chatAssistant/hook/useSignalEffect.ts","webpack://telegram-t/./src/hooks/useStreaming.ts","webpack://telegram-t/./src/util/cycleRestrict.ts","webpack://telegram-t/./src/components/chatAssistant/globalSummary/chat-serana.tsx","webpack://telegram-t/./src/components/chatAssistant/hook/useGlobalSummaryBadge.tsx","webpack://telegram-t/./src/components/left/main/Archive.module.scss?6d2a","webpack://telegram-t/./src/components/left/main/Archive.tsx","webpack://telegram-t/./src/components/left/main/EmptyFolder.module.scss?0952","webpack://telegram-t/./src/components/left/main/EmptyFolder.tsx","webpack://telegram-t/./src/components/left/main/FrozenAccountNotification.tsx","webpack://telegram-t/./src/components/left/main/FrozenAccountNotification.module.scss?c59a","webpack://telegram-t/./src/components/left/main/UnconfirmedSession.module.scss?bd2b","webpack://telegram-t/./src/components/left/main/UnconfirmedSession.tsx","webpack://telegram-t/./src/components/left/main/ChatList.tsx","webpack://telegram-t/./src/hooks/scroll/useTopOverscroll.tsx","webpack://telegram-t/./src/hooks/useMediaWithLoadProgress.ts","webpack://telegram-t/./src/components/common/ProfilePhoto.tsx","webpack://telegram-t/./src/components/common/ProfileInfo.module.scss?701a","webpack://telegram-t/./src/components/common/ProfileInfo.tsx","webpack://telegram-t/./src/components/common/hooks/usePhotosPreload.ts","webpack://telegram-t/./src/components/middle/message/BaseStory.module.scss?d118","webpack://telegram-t/./src/components/middle/message/BaseStory.tsx","webpack://telegram-t/./src/components/chatAssistant/icons.tsx","webpack://telegram-t/./src/global/selectors/calls.ts","webpack://telegram-t/./src/components/right/statistics/StatisticsOverview.module.scss?5334","webpack://telegram-t/./src/components/right/statistics/StatisticsOverview.tsx","webpack://telegram-t/./src/hooks/useSendMessageAction.ts","webpack://telegram-t/./src/components/chatAssistant/component/input-grammar/tabs/HighlightedText.tsx","webpack://telegram-t/./src/components/middle/message/MessageEffect.module.scss?d23f","webpack://telegram-t/./src/components/middle/message/MessageEffect.tsx","webpack://telegram-t/./src/components/story/StoryRibbonButton.tsx","webpack://telegram-t/./src/components/story/StoryRibbon.tsx","webpack://telegram-t/./src/components/chatAssistant/component/ChatAvatar.tsx","webpack://telegram-t/./src/hooks/useInputFocusOnOpen.ts","webpack://telegram-t/./src/hooks/useMarkScrolled/useMarkScrolled.ts","webpack://telegram-t/./src/components/left/main/hooks/useChatAnimationType.ts","webpack://telegram-t/./src/components/common/TypingStatus.tsx","webpack://telegram-t/./src/components/common/DotAnimation.tsx","webpack://telegram-t/./src/components/chatAssistant/component/Avatar.tsx","webpack://telegram-t/./src/components/chatAssistant/hook/useFastClick.ts","webpack://telegram-t/./src/components/common/Media.tsx","webpack://telegram-t/./src/components/common/LastMessageMeta.tsx","webpack://telegram-t/./src/components/middle/composer/CustomSendMenu.async.tsx","webpack://telegram-t/./src/hooks/media/useUnsupportedMedia.ts","webpack://telegram-t/./src/components/middle/message/RoundVideo.tsx","webpack://telegram-t/./src/components/middle/composer/helpers/renderKeyboardButtonText.tsx","webpack://telegram-t/./src/hooks/useAudioPlayer.ts","webpack://telegram-t/./src/components/middle/message/SponsoredContextMenu.tsx","webpack://telegram-t/./src/components/middle/message/SponsoredContextMenuContainer.tsx","webpack://telegram-t/./src/components/left/main/EmptyForum.module.scss?0a02","webpack://telegram-t/./src/components/left/main/EmptyForum.tsx","webpack://telegram-t/./src/components/left/main/Topic.module.scss?d97e","webpack://telegram-t/./src/components/left/main/Topic.tsx","webpack://telegram-t/./src/components/left/main/hooks/useTopicContextActions.ts","webpack://telegram-t/./src/components/left/main/ForumPanel.tsx","webpack://telegram-t/./src/components/left/main/ForumPanel.module.scss?d1a9","webpack://telegram-t/./src/hooks/window/useFullscreen.ts","webpack://telegram-t/./src/components/common/embedded/EmbeddedMessage.tsx","webpack://telegram-t/./src/components/story/hooks/useStoryPreloader.ts","webpack://telegram-t/./src/components/right/hooks/useAsyncRendering.ts","webpack://telegram-t/./src/util/download.ts","webpack://telegram-t/./src/util/progressiveLoader.ts","webpack://telegram-t/./src/components/left/MuteChatModal.async.tsx","webpack://telegram-t/./src/components/left/ChatFolderModal.async.tsx","webpack://telegram-t/./src/components/chatAssistant/ErrorBoundary.tsx"],"sourcesContent":["import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport type { ApiMessageOutgoingStatus } from '../../api/types';\n\nimport Transition from '../ui/Transition';\nimport Icon from './icons/Icon';\n\nimport './MessageOutgoingStatus.scss';\n\ntype OwnProps = {\n  status: ApiMessageOutgoingStatus;\n};\n\nenum Keys {\n  failed, pending, succeeded, read,\n}\n\nconst MessageOutgoingStatus: FC<OwnProps> = ({ status }) => {\n  return (\n    <div className=\"MessageOutgoingStatus\">\n      <Transition name=\"reveal\" activeKey={Keys[status]}>\n        {status === 'failed' ? (\n          <div className=\"MessageOutgoingStatus--failed\">\n            <Icon name=\"message-failed\" />\n          </div>\n        ) : <Icon name={`message-${status}`} />}\n      </Transition>\n    </div>\n  );\n};\n\nexport default memo(MessageOutgoingStatus);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useCallback } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiChat } from '../../api/types';\n\nimport { getUserFirstOrLastName } from '../../global/helpers';\nimport { selectCurrentChat, selectUser } from '../../global/selectors';\nimport renderText from '../common/helpers/renderText';\n\nimport useOldLang from '../../hooks/useOldLang';\n\nimport ConfirmDialog from '../ui/ConfirmDialog';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  userId?: string;\n  onClose: () => void;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  contactName?: string;\n};\n\nconst DeleteMemberModal: FC<OwnProps & StateProps> = ({\n  isOpen,\n  chat,\n  userId,\n  contactName,\n  onClose,\n}) => {\n  const { deleteChatMember } = getActions();\n\n  const lang = useOldLang();\n\n  const handleDeleteChatMember = useCallback(() => {\n    deleteChatMember({ chatId: chat!.id, userId: userId! });\n    onClose();\n  }, [chat, deleteChatMember, onClose, userId]);\n\n  if (!chat || !userId) {\n    return undefined;\n  }\n\n  return (\n    <ConfirmDialog\n      isOpen={isOpen}\n      onClose={onClose}\n      title={lang('GroupRemoved.Remove')}\n      textParts={renderText(lang('PeerInfo.Confirm.RemovePeer', contactName))}\n      confirmLabel={lang('lng_box_remove')}\n      confirmHandler={handleDeleteChatMember}\n      confirmIsDestructive\n    />\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { userId }): StateProps => {\n    const chat = selectCurrentChat(global);\n    const user = userId && selectUser(global, userId);\n    const contactName = user ? getUserFirstOrLastName(user) : undefined;\n\n    return {\n      chat,\n      contactName,\n    };\n  },\n)(DeleteMemberModal));\n","import { useEffect } from '../lib/teact/teact';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport { getHotkeyMatcher } from '../util/parseHotkey';\n\nconst IGNORE_TAGS = new Set(['INPUT', 'TEXTAREA', 'SELECT']);\n\nconst handlers = createCallbackManager();\ndocument.documentElement.addEventListener('keydown', handlers.runCallbacks);\n\nexport function useHotkeys(hotkeys?: Record<string, (e: KeyboardEvent) => void>) {\n  useEffect(() => {\n    if (!hotkeys) {\n      return undefined;\n    }\n\n    const entries = Object.entries(hotkeys);\n\n    function handleKeyDown(e: KeyboardEvent) {\n      if (!shouldFireEvent(e)) {\n        return;\n      }\n\n      entries.forEach(([hotkey, handler]) => {\n        if (getHotkeyMatcher(hotkey)(e)) {\n          handler(e);\n        }\n      });\n    }\n\n    return handlers.addCallback(handleKeyDown);\n  }, [hotkeys]);\n}\n\nfunction shouldFireEvent(e: KeyboardEvent) {\n  if (e.target instanceof HTMLElement) {\n    return !IGNORE_TAGS.has(e.target.tagName);\n  }\n\n  return true;\n}\n","// Original source from Mantine\n// https://github.com/mantinedev/mantine/blob/master/src/mantine-hooks/src/use-hotkeys/parse-hotkey.ts\n\nexport type KeyboardModifiers = {\n  alt: boolean;\n  ctrl: boolean;\n  meta: boolean;\n  mod: boolean;\n  shift: boolean;\n};\n\nexport type Hotkey = KeyboardModifiers & {\n  key?: string;\n};\n\ntype CheckHotkeyMatch = (event: KeyboardEvent) => boolean;\n\nexport function parseHotkey(hotkey: string): Hotkey {\n  const keys = hotkey\n    .toLowerCase()\n    .split('+')\n    .map((part) => part.trim());\n\n  const modifiers: KeyboardModifiers = {\n    alt: keys.includes('alt'),\n    ctrl: keys.includes('ctrl'),\n    meta: keys.includes('meta'),\n    mod: keys.includes('mod'),\n    shift: keys.includes('shift'),\n  };\n\n  const reservedKeys = ['alt', 'ctrl', 'meta', 'shift', 'mod'];\n\n  const freeKey = keys.find((key) => !reservedKeys.includes(key));\n\n  return {\n    ...modifiers,\n    key: freeKey,\n  };\n}\n\nfunction isExactHotkey(hotkey: Hotkey, event: KeyboardEvent): boolean {\n  const {\n    alt, ctrl, meta, mod, shift, key,\n  } = hotkey;\n  const {\n    altKey, ctrlKey, metaKey, shiftKey, key: pressedKey,\n  } = event;\n\n  if (alt !== altKey) {\n    return false;\n  }\n\n  if (mod) {\n    if (!ctrlKey && !metaKey) {\n      return false;\n    }\n  } else {\n    if (ctrl !== ctrlKey) {\n      return false;\n    }\n    if (meta !== metaKey) {\n      return false;\n    }\n  }\n  if (shift !== shiftKey) {\n    return false;\n  }\n\n  return Boolean(key\n    && (pressedKey.toLowerCase() === key.toLowerCase()\n      || event.code.replace('Key', '').toLowerCase() === key.toLowerCase()));\n}\n\nexport function getHotkeyMatcher(hotkey: string): CheckHotkeyMatch {\n  return (event) => isExactHotkey(parseHotkey(hotkey), event);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"CdTfL4f7\",\"fadeIn\":\"MyeHARy0\",\"closing\":\"EZbKn_M3\",\"peer\":\"kW0xpExG\",\"name\":\"BDZrSTO_\",\"name_hasUnreadStory\":\"OoUm5AUZ\",\"nameHasUnreadStory\":\"OoUm5AUZ\",\"hidden\":\"lnVtxMZI\",\"contextMenu\":\"N1sagA0s\"};","import type { RefObject } from 'react';\nimport { useEffect } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiSticker } from '../../../../api/types';\nimport type { Signal } from '../../../../util/signals';\n\nimport { EMOJI_IMG_REGEX } from '../../../../config';\nimport { requestNextMutation } from '../../../../lib/fasterdom/fasterdom';\nimport twemojiRegex from '../../../../lib/twemojiRegex';\nimport { IS_EMOJI_SUPPORTED } from '../../../../util/browser/windowEnvironment';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport { getHtmlBeforeSelection } from '../../../../util/selection';\nimport { buildCustomEmojiHtml } from '../helpers/customEmoji';\n\nimport { useThrottledResolver } from '../../../../hooks/useAsyncResolvers';\nimport useDerivedSignal from '../../../../hooks/useDerivedSignal';\nimport useDerivedState from '../../../../hooks/useDerivedState';\nimport useFlag from '../../../../hooks/useFlag';\nimport useLastCallback from '../../../../hooks/useLastCallback';\n\nconst THROTTLE = 300;\nconst RE_ENDS_ON_EMOJI = new RegExp(`(${twemojiRegex.source})$`, 'g');\nconst RE_ENDS_ON_EMOJI_IMG = new RegExp(`${EMOJI_IMG_REGEX.source}$`, 'g');\n\nexport default function useCustomEmojiTooltip(\n  isEnabled: boolean,\n  getHtml: Signal<string>,\n  setHtml: (html: string) => void,\n  getSelectionRange: Signal<Range | undefined>,\n  inputRef: RefObject<HTMLDivElement>,\n  customEmojis?: ApiSticker[],\n) {\n  const { loadCustomEmojiForEmoji, clearCustomEmojiForEmoji } = getActions();\n\n  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = useFlag(false);\n\n  const extractLastEmojiThrottled = useThrottledResolver(() => {\n    const html = getHtml();\n    if (!isEnabled || !html || !getSelectionRange()?.collapsed) return undefined;\n\n    const hasEmoji = html.match(IS_EMOJI_SUPPORTED ? twemojiRegex : EMOJI_IMG_REGEX);\n    if (!hasEmoji) return undefined;\n\n    const htmlBeforeSelection = getHtmlBeforeSelection(inputRef.current!);\n\n    return htmlBeforeSelection.match(IS_EMOJI_SUPPORTED ? RE_ENDS_ON_EMOJI : RE_ENDS_ON_EMOJI_IMG)?.[0];\n  }, [getHtml, getSelectionRange, inputRef, isEnabled], THROTTLE);\n\n  const getLastEmoji = useDerivedSignal(\n    extractLastEmojiThrottled, [extractLastEmojiThrottled, getHtml, getSelectionRange], true,\n  );\n\n  const isActive = useDerivedState(() => Boolean(getLastEmoji()), [getLastEmoji]);\n  const hasCustomEmojis = Boolean(customEmojis?.length);\n\n  useEffect(() => {\n    if (!isEnabled || !isActive) return;\n\n    const lastEmoji = getLastEmoji();\n    if (lastEmoji) {\n      if (!hasCustomEmojis) {\n        loadCustomEmojiForEmoji({\n          emoji: IS_EMOJI_SUPPORTED ? lastEmoji : lastEmoji.match(/.+alt=\"(.+)\"/)?.[1]!,\n        });\n      }\n    } else {\n      clearCustomEmojiForEmoji();\n    }\n  }, [isEnabled, isActive, getLastEmoji, hasCustomEmojis, clearCustomEmojiForEmoji, loadCustomEmojiForEmoji]);\n\n  const insertCustomEmoji = useLastCallback((emoji: ApiSticker) => {\n    const lastEmoji = getLastEmoji();\n    if (!isEnabled || !lastEmoji) return;\n\n    const inputEl = inputRef.current!;\n    const htmlBeforeSelection = getHtmlBeforeSelection(inputEl);\n    const regexText = IS_EMOJI_SUPPORTED\n      ? lastEmoji\n      // Escape regexp special chars\n      : lastEmoji.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n    const regex = new RegExp(`(${regexText})\\\\1*$`, '');\n    const matched = htmlBeforeSelection.match(regex)![0];\n    const count = matched.length / lastEmoji.length;\n    const newHtml = htmlBeforeSelection.replace(regex, buildCustomEmojiHtml(emoji).repeat(count));\n    const htmlAfterSelection = inputEl.innerHTML.substring(htmlBeforeSelection.length);\n\n    setHtml(`${newHtml}${htmlAfterSelection}`);\n\n    requestNextMutation(() => {\n      focusEditableElement(inputEl, true, true);\n    });\n  });\n\n  useEffect(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);\n\n  return {\n    isCustomEmojiTooltipOpen: Boolean(isActive && hasCustomEmojis && !isManuallyClosed),\n    closeCustomEmojiTooltip: markManuallyClosed,\n    insertCustomEmoji,\n  };\n}\n","/* eslint-disable react/jsx-props-no-spreading */\n/* eslint-disable max-len */\nimport * as React from 'react';\nimport { Slot } from '@radix-ui/react-slot';\nimport { cva, type VariantProps } from 'class-variance-authority';\n\nimport { cn } from '../utils/util';\n\nconst buttonVariants = cva(\n  'inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0',\n  {\n    variants: {\n      variant: {\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\n        destructive:\n          'bg-destructive text-destructive-foreground hover:bg-destructive/90',\n        outline:\n          'border border-input bg-background hover:bg-accent hover:text-accent-foreground',\n        secondary:\n          'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n        ghost: 'hover:bg-accent hover:text-accent-foreground',\n        link: 'text-primary underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-10 px-4 py-2',\n        sm: 'h-9 rounded-md px-3',\n        lg: 'h-11 rounded-md px-8',\n        icon: 'h-10 w-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n  VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({\n    className, variant, size, asChild = false, ...props\n  }, ref) => {\n    const Comp = asChild ? Slot : 'button';\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    );\n  },\n);\nButton.displayName = 'Button';\n\nexport { Button, buttonVariants };\n","import generateUniqueId from './generateUniqueId';\nimport { throttleWithTickEnd } from './schedulers';\n\nexport interface CancellableCallback {\n  (\n    ...args: any[]\n  ): void;\n\n  isCanceled?: boolean;\n}\n\ntype InitPayload = {\n  type: 'init';\n  messageId?: string;\n  args: any;\n};\n\ntype CallMethodPayload = {\n  type: 'callMethod';\n  messageId?: string;\n  name: string;\n  args: any;\n  withCallback?: boolean;\n};\n\ntype CancelProgressPayload = {\n  type: 'cancelProgress';\n  messageId: string;\n};\n\nexport type OriginPayload =\n  InitPayload\n  | CallMethodPayload\n  | CancelProgressPayload;\n\nexport type OriginMessageData = {\n  channel?: string;\n  payloads: OriginPayload[];\n};\n\nexport interface OriginMessageEvent {\n  data: OriginMessageData;\n}\n\nexport type ApiUpdate =\n  { type: string }\n  & any;\n\nexport type WorkerPayload =\n  {\n    channel?: string;\n    type: 'update';\n    update: ApiUpdate;\n  }\n  |\n  {\n    channel?: string;\n    type: 'methodResponse';\n    messageId: string;\n    response?: any;\n    error?: { message: string };\n  }\n  |\n  {\n    channel?: string;\n    type: 'methodCallback';\n    messageId: string;\n    callbackArgs: any[];\n  }\n  |\n  {\n    channel?: string;\n    type: 'unhandledError';\n    error?: { message: string };\n  };\n\nexport type WorkerMessageData = {\n  channel?: string;\n  payloads: WorkerPayload[];\n};\n\nexport interface WorkerMessageEvent {\n  data: WorkerMessageData;\n}\n\ninterface RequestState {\n  messageId: string;\n  resolve: Function;\n  reject: Function;\n  callback: AnyToVoidFunction;\n}\n\ntype InputRequestTypes = Record<string, AnyFunction>;\n\ntype Values<T> = T[keyof T];\nexport type RequestTypes<T extends InputRequestTypes> = Values<{\n  [Name in keyof (T)]: {\n    name: Name & string;\n    args: Parameters<T[Name]>;\n    transferables?: Transferable[];\n  }\n}>;\n\nclass ConnectorClass<T extends InputRequestTypes> {\n  private requestStates = new Map<string, RequestState>();\n\n  private requestStatesByCallback = new Map<AnyToVoidFunction, RequestState>();\n\n  private pendingPayloads: OriginPayload[] = [];\n\n  private pendingTransferables: Transferable[] = [];\n\n  constructor(\n    public target: Worker,\n    private onUpdate?: (update: ApiUpdate) => void,\n    private channel?: string,\n  ) {\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  public destroy() {\n  }\n\n  init(...args: any[]) {\n    this.postMessageOnTickEnd({\n      type: 'init',\n      args,\n    });\n  }\n\n  request(messageData: RequestTypes<T>) {\n    const { requestStates, requestStatesByCallback } = this;\n    const { transferables, ...restMessageData } = messageData;\n\n    const messageId = generateUniqueId();\n    const payload: CallMethodPayload = {\n      type: 'callMethod',\n      messageId,\n      ...restMessageData,\n    };\n\n    const requestState = { messageId } as RequestState;\n\n    // Re-wrap type because of `postMessage`\n    const promise: Promise<any> = new Promise((resolve, reject) => {\n      Object.assign(requestState, { resolve, reject });\n    });\n\n    if (typeof payload.args[payload.args.length - 1] === 'function') {\n      payload.withCallback = true;\n\n      const callback = payload.args.pop() as AnyToVoidFunction;\n      requestState.callback = callback;\n      requestStatesByCallback.set(callback, requestState);\n    }\n\n    requestStates.set(messageId, requestState);\n    promise\n      .catch(() => undefined)\n      .finally(() => {\n        requestStates.delete(messageId);\n\n        if (requestState.callback) {\n          requestStatesByCallback.delete(requestState.callback);\n        }\n      });\n\n    this.postMessageOnTickEnd(payload, transferables);\n\n    return promise;\n  }\n\n  cancelCallback(progressCallback: CancellableCallback) {\n    progressCallback.isCanceled = true;\n\n    const { messageId } = this.requestStatesByCallback.get(progressCallback) || {};\n    if (!messageId) {\n      return;\n    }\n\n    this.postMessageOnTickEnd({\n      type: 'cancelProgress',\n      messageId,\n    });\n  }\n\n  onMessage(data: WorkerMessageData) {\n    const { requestStates, channel } = this;\n    if (data.channel !== channel) {\n      return;\n    }\n\n    data.payloads.forEach((payload) => {\n      if (payload.type === 'update' && this.onUpdate) {\n        this.onUpdate(payload.update);\n      }\n      if (payload.type === 'methodResponse') {\n        const requestState = requestStates.get(payload.messageId);\n        if (requestState) {\n          if (payload.error) {\n            requestState.reject(payload.error);\n          } else {\n            requestState.resolve(payload.response);\n          }\n        }\n      } else if (payload.type === 'methodCallback') {\n        const requestState = requestStates.get(payload.messageId);\n        requestState?.callback?.(...payload.callbackArgs);\n      } else if (payload.type === 'unhandledError') {\n        throw new Error(payload.error?.message);\n      }\n    });\n  }\n\n  private postMessageOnTickEnd(payload: OriginPayload, transferables?: Transferable[]) {\n    this.pendingPayloads.push(payload);\n\n    if (transferables) {\n      this.pendingTransferables.push(...transferables);\n    }\n\n    this.postMessagesOnTickEnd();\n  }\n\n  private postMessagesOnTickEnd = throttleWithTickEnd(() => {\n    const { channel } = this;\n    const payloads = this.pendingPayloads;\n    const transferables = this.pendingTransferables;\n\n    this.pendingPayloads = [];\n    this.pendingTransferables = [];\n\n    this.target.postMessage({ channel, payloads }, transferables);\n  });\n}\n\nexport function createConnector<T extends InputRequestTypes>(\n  worker: Worker,\n  onUpdate?: (update: ApiUpdate) => void,\n  channel?: string,\n) {\n  const connector = new ConnectorClass<T>(worker, onUpdate, channel);\n\n  function handleMessage({ data }: WorkerMessageEvent) {\n    connector.onMessage(data);\n  }\n\n  worker.addEventListener('message', handleMessage);\n\n  connector.destroy = () => {\n    worker.removeEventListener('message', handleMessage);\n  };\n\n  return connector;\n}\n\nexport type Connector<T extends InputRequestTypes = InputRequestTypes> = ReturnType<typeof createConnector<T>>;\n","/* eslint-disable react/jsx-props-no-spreading */\n/* eslint-disable max-len */\nimport * as React from 'react';\n\nimport { cn } from '../utils/util';\n\nconst Textarea = React.forwardRef<\nHTMLTextAreaElement,\nReact.ComponentProps<'textarea'>\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        'flex min-h-[45px] w-full border-box rounded-md border border-input bg-white px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm dark:bg-black dark:placeholder:text-[#888888]',\n        className,\n      )}\n      ref={ref}\n      {...props}\n    />\n  );\n});\nTextarea.displayName = 'Textarea';\n\nexport { Textarea };\n","import { v4 as uuidv4 } from 'uuid';\n\nimport type { SummaryStoreMessage } from '../store/summary-store';\n\nexport const createIntroduceReplyMessage = ():SummaryStoreMessage => {\n  return {\n    timestamp: new Date().getTime(),\n    content: '',\n    id: uuidv4(),\n    createdAt: new Date(),\n    role: 'assistant',\n    annotations: [{\n      type: 'global-smartreply-introduce',\n    }],\n  };\n};\nexport const createIntroduceSummaryMessage = ():SummaryStoreMessage => {\n  return {\n    timestamp: new Date().getTime(),\n    content: '',\n    id: uuidv4(),\n    createdAt: new Date(),\n    role: 'assistant',\n    annotations: [{\n      type: 'global-summary-introduce',\n    }],\n  };\n};\nexport const createIntroduceTranslationMessage = ():SummaryStoreMessage => {\n  return {\n    timestamp: new Date().getTime(),\n    content: '',\n    id: uuidv4(),\n    createdAt: new Date(),\n    role: 'assistant',\n    annotations: [{\n      type: 'global-translation-introduce',\n    }],\n  };\n};\nexport const createIntroducePortraitMessage = ():SummaryStoreMessage => {\n  return {\n    timestamp: new Date().getTime(),\n    content: '',\n    id: uuidv4(),\n    createdAt: new Date(),\n    role: 'assistant',\n    annotations: [{\n      type: 'global-portrait-introduce',\n    }],\n  };\n};\n\nexport const createGlobalIntroduceMessage = ():SummaryStoreMessage => {\n  return {\n    timestamp: new Date().getTime(),\n    content: '',\n    id: uuidv4(),\n    createdAt: new Date(),\n    role: 'assistant',\n    annotations: [{\n      type: 'global-introduce',\n    }],\n  };\n};\n","import { getGlobal } from '../../../global';\n\nimport eventEmitter, { Actions } from '../lib/EventEmitter';\nimport { selectChat } from '../../../global/selectors';\n\nclass RoomStorage {\n  static get global() {\n    return getGlobal();\n  }\n\n  public static getRoomLastFocusTime(chatId: string) {\n    const roomAIData = localStorage.getItem('room-ai-data');\n    return roomAIData ? JSON.parse(roomAIData)[chatId]?.lastFocusTime || 0 : 0;\n  }\n\n  public static getRoomLastSummaryId(chatId: string) {\n    const roomAIData = localStorage.getItem('room-ai-data');\n    return roomAIData ? JSON.parse(roomAIData)[chatId]?.lastSummaryId || 0 : 0;\n  }\n\n  public static getRoomUnreadCount(chatId: string) {\n    const chat = selectChat(this.global, chatId);\n    return chat ? chat.unreadCount || 0 : 0;\n  }\n\n  public static getRoomAIUnreadCount(chatId: string) {\n    const roomAIData = localStorage.getItem('room-ai-data');\n    return roomAIData ? JSON.parse(roomAIData)?.[chatId]?.unreadCount || 0 : 0;\n  }\n\n  public static getRoomTranslateLanguage(chatId: string) {\n    const roomAIData = localStorage.getItem('room-ai-data');\n    return roomAIData ? JSON.parse(roomAIData)?.[chatId]?.translateLanguage || '' : '';\n  }\n\n  public static updateRoomTranslateLanguage(chatId: string, language: string | undefined) {\n    const roomAIData = localStorage.getItem('room-ai-data');\n    const data = roomAIData ? JSON.parse(roomAIData) : {};\n    data[chatId] = {\n      ...data[chatId],\n      translateLanguage: language,\n    };\n    localStorage.setItem('room-ai-data', JSON.stringify(data));\n  }\n\n  public static updateRoomAIData(chatId: string, type:string, value:any) {\n    const roomAIData = localStorage.getItem('room-ai-data');\n    const parsedData = roomAIData ? JSON.parse(roomAIData) : {};\n    const currentData = parsedData[chatId] || {};\n    currentData[type] = value;\n    parsedData[chatId] = currentData;\n    localStorage.setItem('room-ai-data', JSON.stringify(parsedData));\n    if (type === 'unreadCount') {\n      eventEmitter.emit(Actions.UpdateRoomAIUnreadCount, { chatId, count: value });\n    }\n  }\n\n  public static increaseUnreadCount(chatId: string) {\n    const count = this.getRoomAIUnreadCount(chatId) + 1;\n    this.updateRoomAIData(chatId, 'unreadCount', count);\n    eventEmitter.emit(Actions.UpdateRoomAIUnreadCount, { chatId, count });\n  }\n}\n\nexport default RoomStorage;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"LFiEK79A\",\"list-item\":\"_VgXA3ZV\",\"listItem\":\"_VgXA3ZV\",\"title\":\"RITxpjRP\",\"subtitle\":\"TsAsFkJP\",\"languages\":\"WPdg2YHh\"};","import type { FC } from '../../../../lib/teact/teact';\nimport React, {\n  useEffect, useMemo, useState,\n} from '../../../../lib/teact/teact';\n\nimport { SUPPORTED_TRANSLATION_LANGUAGES } from '../../../../config';\nimport buildClassName from '../../../../util/buildClassName';\nimport renderText from '../../../common/helpers/renderText';\n\nimport useLastCallback from '../../../../hooks/useLastCallback';\nimport useOldLang from '../../../../hooks/useOldLang';\n\nimport InputText from '../../../ui/InputText';\nimport ListItem from '../../../ui/ListItem';\nimport Modal from '../../../ui/Modal';\n\nimport styles from './input-language.module.scss';\n\ntype LanguageItem = {\n  langCode: string;\n  translatedName: string;\n  originalName: string;\n};\n\nexport type OwnProps = {\n  isOpen?: boolean;\n  translateLanguage: string | undefined;\n  closeInputLanguageModal: () => void;\n  updateTranslateLanguage: (langCode: string | undefined) => void;\n};\n\nconst InputLanguageModal: FC<OwnProps> = ({\n  isOpen,\n  translateLanguage,\n  closeInputLanguageModal,\n  updateTranslateLanguage,\n}) => {\n  const [search, setSearch] = useState('');\n  const lang = useOldLang();\n  const handleSelect = useLastCallback((langCode: string) => {\n    if (langCode === translateLanguage) {\n      updateTranslateLanguage(undefined);\n    } else {\n      updateTranslateLanguage(langCode);\n    }\n\n    closeInputLanguageModal();\n  });\n\n  const handleSearch = useLastCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setSearch(e.target.value);\n  });\n\n  const translateLanguages = useMemo(() => SUPPORTED_TRANSLATION_LANGUAGES.map((langCode: string) => {\n    const translatedNames = new Intl.DisplayNames([translateLanguage || 'en'], { type: 'language' });\n    const translatedName = translatedNames.of(langCode)!;\n\n    const originalNames = new Intl.DisplayNames([langCode], { type: 'language' });\n    const originalName = originalNames.of(langCode)!;\n\n    return {\n      langCode,\n      translatedName,\n      originalName,\n    } satisfies LanguageItem;\n  }), [translateLanguage]);\n\n  useEffect(() => {\n    if (!isOpen) setSearch('');\n  }, [isOpen]);\n\n  const filteredDisplayedLanguages = useMemo(() => {\n    if (!search.trim()) {\n      return translateLanguages;\n    }\n\n    return translateLanguages.filter(({ langCode, translatedName, originalName }) => (\n      translatedName.toLowerCase().includes(search.toLowerCase())\n      || originalName.toLowerCase().includes(search.toLowerCase())\n      || langCode.toLowerCase().includes(search.toLowerCase())\n    ));\n  }, [translateLanguages, search]);\n\n  return (\n    <Modal\n      className={styles.root}\n      isSlim\n      isOpen={isOpen}\n      hasCloseButton\n      title={lang('Language')}\n      onClose={closeInputLanguageModal}\n    >\n      <InputText\n        key=\"search\"\n        value={search}\n        onChange={handleSearch}\n        placeholder={lang('Search')}\n        teactExperimentControlled\n      />\n      <div className={buildClassName(styles.languages, 'custom-scroll')}>\n        {filteredDisplayedLanguages.map(({ langCode, originalName, translatedName }) => (\n          <ListItem\n            key={langCode}\n            className={buildClassName(styles.listItem, 'no-icon')}\n            secondaryIcon={translateLanguage === langCode ? 'check' : undefined}\n            disabled={translateLanguage === langCode}\n            multiline\n            narrow\n            allowDisabledClick\n            // eslint-disable-next-line react/jsx-no-bind\n            onClick={() => handleSelect(langCode)}\n          >\n            <span className={buildClassName('title', styles.title)}>\n              {renderText(originalName, ['highlight'], { highlight: search })}\n            </span>\n            <span className={buildClassName('subtitle', styles.subtitle)}>\n              {renderText(translatedName, ['highlight'], { highlight: search })}\n            </span>\n          </ListItem>\n        ))}\n      </div>\n    </Modal>\n  );\n};\n\nexport default InputLanguageModal;\n","import React from '../../../../lib/teact/teact';\n\nimport './input-translate-tip.scss';\n\nconst InputTranslateTip = () => {\n  return (\n    <div className=\"input-translate-tip\">\n      <span>Enter your native language, and it will auto-translate to the set language upon sending.</span>\n      <div className=\"input-translate-tip-arrow\" />\n    </div>\n  );\n};\n\nexport default InputTranslateTip;\n","import React, { useCallback, useEffect, useState } from '../../../../lib/teact/teact';\n\nimport RoomStorage from '../../room-storage';\nimport InputLanguageModal from './input-language-modal';\nimport InputTranslateTip from './input-translate-tip';\n\nimport useFlag from '../../../../hooks/useFlag';\n\nimport './input-translate.scss';\n\nimport aiTranslatePath from '../../assets/ai-translate.png';\n\nconst InputTranslate = (props:{ chatId:string }) => {\n  const { chatId } = props;\n  const [inputLanguageModalOpen, openInputLanguageModal, closeInputLanguageModal] = useFlag();\n  const [translateLanguage, setTranslateLanguage] = useState<string | undefined>(undefined);\n  const [tooltipOpen, openTooltip, closeTooltip] = useFlag();\n  useEffect(() => {\n    setTranslateLanguage(RoomStorage.getRoomTranslateLanguage(chatId));\n  }, [chatId]);\n  const updateTranslateLanguage = useCallback((langCode: string | undefined) => {\n    RoomStorage.updateRoomTranslateLanguage(chatId, langCode);\n    setTranslateLanguage(langCode);\n    if (!translateLanguage && langCode) {\n      openTooltip();\n      setTimeout(() => {\n        closeTooltip();\n      }, 5000);\n    }\n  }, [chatId, translateLanguage]);\n  return (\n    <div className=\"input-ai-actions\">\n      <button className=\"Button input-ai-actions-button\" onClick={openInputLanguageModal}>\n        {\n          translateLanguage\n            ? (\n              <span className=\"text-[var(--color-text-secondary)] text-[14px] font-bold\">\n                {translateLanguage.toUpperCase()}\n              </span>\n            )\n            : (\n              <img src={aiTranslatePath} alt=\"Chat AI Logo\" />\n            )\n        }\n      </button>\n      {tooltipOpen && (\n        <InputTranslateTip />\n      )}\n      <InputLanguageModal\n        translateLanguage={translateLanguage}\n        isOpen={inputLanguageModalOpen}\n        closeInputLanguageModal={closeInputLanguageModal}\n        updateTranslateLanguage={updateTranslateLanguage}\n      />\n    </div>\n  );\n};\n\nexport default InputTranslate;\n","import { IS_IOS } from '../../../../util/browser/windowEnvironment';\n\nlet resetInput: HTMLInputElement;\n\nif (IS_IOS) {\n  resetInput = document.createElement('input');\n  resetInput.classList.add('for-ios-autocapitalization-fix');\n  document.body.appendChild(resetInput);\n}\n\n// https://stackoverflow.com/a/55652503\nexport default function applyIosAutoCapitalizationFix(inputEl: HTMLElement) {\n  resetInput.focus();\n  inputEl.focus();\n}\n","import { useEffect, useState } from '../../../../lib/teact/teact';\n\nimport type { ApiBotCommand, ApiQuickReply } from '../../../../api/types';\nimport type { Signal } from '../../../../util/signals';\n\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\n\nimport { useThrottledResolver } from '../../../../hooks/useAsyncResolvers';\nimport useDerivedSignal from '../../../../hooks/useDerivedSignal';\nimport useFlag from '../../../../hooks/useFlag';\n\nconst RE_COMMAND = /^\\/([\\w@]{1,32})?$/i;\n\nconst THROTTLE = 300;\n\nexport default function useChatCommandTooltip(\n  isEnabled: boolean,\n  getHtml: Signal<string>,\n  botCommands?: ApiBotCommand[] | false,\n  chatBotCommands?: ApiBotCommand[],\n  quickReplies?: Record<number, ApiQuickReply>,\n) {\n  const [filteredBotCommands, setFilteredBotCommands] = useState<ApiBotCommand[] | undefined>();\n  const [filteredQuickReplies, setFilteredQuickReplies] = useState<ApiQuickReply[] | undefined>();\n  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = useFlag(false);\n\n  const detectCommandThrottled = useThrottledResolver(() => {\n    const html = getHtml();\n    return isEnabled && html.startsWith('/') ? prepareForRegExp(html).match(RE_COMMAND)?.[0].trim() : undefined;\n  }, [getHtml, isEnabled], THROTTLE);\n\n  const getCommand = useDerivedSignal(\n    detectCommandThrottled, [detectCommandThrottled, getHtml], true,\n  );\n\n  useEffect(() => {\n    const command = getCommand();\n    const commands = botCommands || chatBotCommands;\n    if (!command || (!commands && !quickReplies)) {\n      setFilteredBotCommands(undefined);\n      setFilteredQuickReplies(undefined);\n      return;\n    }\n\n    const filter = command.substring(1);\n    const nextFilteredBotCommands = commands?.filter((c) => !filter || c.command.startsWith(filter));\n\n    setFilteredBotCommands(\n      nextFilteredBotCommands?.length ? nextFilteredBotCommands : undefined,\n    );\n\n    const newFilteredQuickReplies = Object.values(quickReplies || {}).filter((quickReply) => (\n      !filter || quickReply.shortcut.startsWith(filter)\n    ));\n\n    setFilteredQuickReplies(\n      newFilteredQuickReplies?.length ? newFilteredQuickReplies : undefined,\n    );\n  }, [getCommand, botCommands, chatBotCommands, quickReplies]);\n\n  useEffect(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);\n\n  return {\n    isOpen: Boolean((filteredBotCommands?.length || filteredQuickReplies?.length) && !isManuallyClosed),\n    close: markManuallyClosed,\n    filteredBotCommands,\n    filteredQuickReplies,\n  };\n}\n","// Utility for cleaning html code from Google Docs.\n// Original source from DocsSoap:\n// https://www.npmjs.com/package/docs-soap\n\nconst GDOCS_ELEMENT_ID_REGEXP = /id=\"docs-internal-guid/i;\n\nconst GDOCS_STYLES = {\n  BOLD: '700',\n  ITALIC: 'italic',\n  UNDERLINE: 'underline',\n  STRIKETHROUGH: 'line-through',\n  SUPERSCRIPT: 'super',\n  SUBSCRIPT: 'sub',\n};\n\nconst ELEMENTS = {\n  ANCHOR: 'a',\n  BOLD: 'strong',\n  ITALIC: 'em',\n  UNDERLINE: 'u',\n  BLOCKQUOTE: 'blockquote',\n  STRIKETHROUGH: 'del',\n  SUPERSCRIPT: 'sup',\n  SUBSCRIPT: 'sub',\n};\n\nconst headers = [\n  'H1',\n  'H2',\n  'H3',\n  'H4',\n  'H5',\n  'H6',\n];\n\nfunction parseHtml(html: string): HTMLElement {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(html, 'text/html');\n\n  return doc.body;\n}\n\nfunction wrapNodeAnchor(node: Node, href: string): HTMLAnchorElement {\n  const anchor = document.createElement(ELEMENTS.ANCHOR) as HTMLAnchorElement;\n  anchor.href = href;\n  anchor.appendChild(node.cloneNode(true));\n\n  return anchor;\n}\n\nfunction wrapNodeInline(node: Node, style: string): Node {\n  const el = document.createElement(style);\n  el.appendChild(node.cloneNode(true));\n\n  return el;\n}\n\nfunction wrapNode(inner: HTMLElement, result: Node): Node {\n  let newNode = result.cloneNode(true);\n  if (!inner) {\n    return newNode;\n  }\n  if (inner.style && inner.style.fontWeight === GDOCS_STYLES.BOLD) {\n    newNode = wrapNodeInline(newNode, ELEMENTS.BOLD);\n  }\n  if (inner.style && inner.style.fontStyle === GDOCS_STYLES.ITALIC) {\n    newNode = wrapNodeInline(newNode, ELEMENTS.ITALIC);\n  }\n  if (inner.style && inner.style.textDecoration === GDOCS_STYLES.UNDERLINE) {\n    newNode = wrapNodeInline(newNode, ELEMENTS.UNDERLINE);\n  }\n  if (inner.style && inner.style.textDecoration === GDOCS_STYLES.STRIKETHROUGH) {\n    newNode = wrapNodeInline(newNode, ELEMENTS.STRIKETHROUGH);\n  }\n  if (inner.style && inner.style.verticalAlign === GDOCS_STYLES.SUPERSCRIPT) {\n    newNode = wrapNodeInline(newNode, ELEMENTS.SUPERSCRIPT);\n  }\n  if (inner.style && inner.style.verticalAlign === GDOCS_STYLES.SUBSCRIPT) {\n    newNode = wrapNodeInline(newNode, ELEMENTS.SUBSCRIPT);\n  }\n\n  return newNode;\n}\n\nfunction applyBlockStyles(dirty: Node): Node {\n  const node = dirty.cloneNode(true);\n  let newNode = document.createTextNode(node.textContent || '') as Node;\n  let styledNode = document.createTextNode('') as Node;\n  if ('style' in node.childNodes[0] && Boolean(node.childNodes[0].style)) {\n    styledNode = node.childNodes[0];\n  }\n  if (node.childNodes[0] && node.childNodes[0].nodeName === 'A') {\n    newNode = wrapNodeAnchor(newNode.cloneNode(true), (node.childNodes[0] as HTMLAnchorElement).href);\n    styledNode = node.childNodes[0].childNodes[0];\n  }\n  newNode = wrapNode(styledNode as HTMLElement, newNode);\n  return newNode;\n}\n\nfunction applyInlineStyles(dirty: Node): Node {\n  const node = dirty.cloneNode(true);\n  let newNode = document.createTextNode(node.textContent || '') as Node;\n  let styledNode = node;\n  if (node.nodeName === 'A') {\n    newNode = wrapNodeAnchor(newNode, (node as HTMLAnchorElement).href);\n    if ('style' in node.childNodes[0] && Boolean(node.childNodes[0].style)) {\n      styledNode = node.childNodes[0];\n    }\n  }\n  newNode = wrapNode(styledNode as HTMLElement, newNode);\n  return newNode;\n}\n\nfunction getCleanNode(node: Node): Node[] {\n  if (node.childNodes && (node.childNodes.length <= 1 || node.nodeName === 'OL' || node.nodeName === 'UL')) {\n    let newWrapper: Node | undefined;\n    let newNode = document.createTextNode(node.textContent || '') as Node;\n    if (node.nodeName === 'UL' || node.nodeName === 'OL' || node.nodeName === 'LI') {\n      newWrapper = document.createElement(node.nodeName);\n      newNode = document.createDocumentFragment();\n      const items = [];\n      for (let i = 0; i < node.childNodes.length; i++) {\n        items.push(...getCleanNode(node.childNodes[i]));\n      }\n      items.map((i: Node): Node => newNode.appendChild(i));\n    } else if (headers.indexOf(node.nodeName) !== -1) {\n      newWrapper = document.createElement(node.nodeName);\n      newNode = applyInlineStyles(node.childNodes[0]);\n    } else if (node.nodeName === 'P') {\n      newWrapper = document.createElement('p');\n      newNode = applyBlockStyles(node);\n    } else if (node.nodeName === 'BR') {\n      newNode = node;\n    } else {\n      newWrapper = document.createElement('span');\n      newNode = applyInlineStyles(node);\n    }\n    if (newWrapper) {\n      newWrapper.appendChild(newNode);\n      return [newWrapper];\n    }\n\n    return [node.cloneNode(true)];\n  }\n\n  if (node.childNodes) {\n    const nodes = [];\n    for (let i = 0; i < node.childNodes.length; i++) {\n      nodes.push(...getCleanNode(node.childNodes[i]));\n    }\n    return nodes;\n  }\n\n  return [node];\n}\n\nfunction filterNode(node: Node): boolean {\n  return node.nodeType !== 8; // Node.COMMENT_NODE = 8\n}\n\nfunction getCleanDocument(dirty: HTMLElement): HTMLElement {\n  const body = document.createElement('body');\n  const nodes = dirty.childNodes;\n  const filteredNodes = Array.from(nodes).filter(filterNode);\n  const cleanNodes = [];\n\n  for (const node of filteredNodes) {\n    cleanNodes.push(...getCleanNode(node));\n  }\n\n  for (let i = 0; i < cleanNodes.length; i++) {\n    body.appendChild(cleanNodes[i].cloneNode(true));\n  }\n\n  return body;\n}\n\nexport default function cleanDocsHtml(clipboardContent: string): string {\n  if (!clipboardContent.match(GDOCS_ELEMENT_ID_REGEXP)) {\n    return parseHtml(clipboardContent.replace(/(\\r\\n|\\n|\\r)/, '')).innerHTML;\n  }\n\n  return getCleanDocument(parseHtml(clipboardContent.replace(/(\\r\\n|\\n|\\r)/, ''))).innerHTML;\n}\n","import { ApiMessageEntityTypes } from '../../../../api/types';\n\nimport { DEBUG } from '../../../../config';\nimport cleanDocsHtml from '../../../../lib/cleanDocsHtml';\nimport { ENTITY_CLASS_BY_NODE_NAME } from '../../../../util/parseHtmlAsFormattedText';\n\nconst STYLE_TAG_REGEX = /<style>(.*?)<\\/style>/gs;\n\nexport function preparePastedHtml(html: string) {\n  let fragment = document.createElement('div');\n  try {\n    html = cleanDocsHtml(html);\n  } catch (err) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n    }\n  }\n  fragment.innerHTML = html.replace(/\\u00a0/g, ' ').replace(STYLE_TAG_REGEX, ''); // Strip &nbsp and styles\n\n  const textContents = fragment.querySelectorAll<HTMLDivElement>('.text-content');\n  if (textContents.length) {\n    fragment = textContents[textContents.length - 1]; // Replace with the last copied message\n  }\n\n  Array.from(fragment.getElementsByTagName('*')).forEach((node) => {\n    if (!(node instanceof HTMLElement)) {\n      node.remove();\n      return;\n    }\n    node.removeAttribute('style');\n\n    // Fix newlines\n    if (node.tagName === 'BR') node.replaceWith('\\n');\n    if (node.tagName === 'P') node.appendChild(document.createTextNode('\\n'));\n    if (node.tagName === 'IMG' && !node.dataset.entityType) node.replaceWith(node.getAttribute('alt') || '');\n    // We do not intercept copy logic, so we remove some nodes here\n    if (node.dataset.ignoreOnPaste) node.remove();\n\n    if (ENTITY_CLASS_BY_NODE_NAME[node.tagName]) {\n      node.setAttribute('data-entity-type', ENTITY_CLASS_BY_NODE_NAME[node.tagName]);\n    }\n    // Strip non-entity tags\n    if (!node.dataset.entityType && node.textContent === node.innerText) node.replaceWith(node.textContent);\n    // Append entity parameters for parsing\n    if (node.dataset.alt) node.setAttribute('alt', node.dataset.alt);\n    switch (node.dataset.entityType) {\n      case ApiMessageEntityTypes.MentionName:\n        node.replaceWith(node.textContent || '');\n        break;\n      case ApiMessageEntityTypes.CustomEmoji:\n        node.textContent = node.dataset.alt || '';\n        break;\n    }\n  });\n\n  return fragment.innerHTML.trimEnd();\n}\n\nexport function escapeHtml(html: string) {\n  const fragment = document.createElement('div');\n  const text = document.createTextNode(html);\n  fragment.appendChild(text);\n  return fragment.innerHTML;\n}\n","import type { StateHookSetter } from '../../../../lib/teact/teact';\nimport { useEffect } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiAttachment, ApiFormattedText, ApiMessage } from '../../../../api/types';\n\nimport {\n  EDITABLE_INPUT_ID, EDITABLE_INPUT_MODAL_ID, EDITABLE_STORY_INPUT_ID,\n} from '../../../../config';\nimport { canReplaceMessageMedia, isUploadingFileSticker } from '../../../../global/helpers';\nimport { containsCustomEmoji, stripCustomEmoji } from '../../../../global/helpers/symbols';\nimport parseHtmlAsFormattedText from '../../../../util/parseHtmlAsFormattedText';\nimport buildAttachment from '../helpers/buildAttachment';\nimport { preparePastedHtml } from '../helpers/cleanHtml';\nimport getFilesFromDataTransferItems from '../helpers/getFilesFromDataTransferItems';\n\nimport useOldLang from '../../../../hooks/useOldLang';\n\nconst TYPE_HTML = 'text/html';\nconst DOCUMENT_TYPE_WORD = 'urn:schemas-microsoft-com:office:word';\nconst NAMESPACE_PREFIX_WORD = 'xmlns:w';\n\nconst VALID_TARGET_IDS = new Set([EDITABLE_INPUT_ID, EDITABLE_INPUT_MODAL_ID, EDITABLE_STORY_INPUT_ID]);\nconst CLOSEST_CONTENT_EDITABLE_SELECTOR = 'div[contenteditable]';\n\nconst useClipboardPaste = (\n  isActive: boolean,\n  insertTextAndUpdateCursor: (text: ApiFormattedText, inputId?: string) => void,\n  setAttachments: StateHookSetter<ApiAttachment[]>,\n  setNextText: StateHookSetter<ApiFormattedText | undefined>,\n  editedMessage: ApiMessage | undefined,\n  shouldStripCustomEmoji?: boolean,\n  onCustomEmojiStripped?: VoidFunction,\n) => {\n  const { showNotification } = getActions();\n  const lang = useOldLang();\n\n  useEffect(() => {\n    if (!isActive) {\n      return undefined;\n    }\n\n    async function handlePaste(e: ClipboardEvent) {\n      if (!e.clipboardData) {\n        return;\n      }\n\n      const input = (e.target as HTMLElement)?.closest(CLOSEST_CONTENT_EDITABLE_SELECTOR);\n      if (!input || !VALID_TARGET_IDS.has(input.id)) {\n        return;\n      }\n\n      e.preventDefault();\n\n      // Some extensions can trigger paste into their panels without focus\n      if (document.activeElement !== input) {\n        return;\n      }\n\n      const pastedText = e.clipboardData.getData('text');\n      const html = e.clipboardData.getData('text/html');\n\n      let pastedFormattedText = html ? parseHtmlAsFormattedText(\n        preparePastedHtml(html), undefined, true,\n      ) : undefined;\n\n      if (pastedFormattedText && containsCustomEmoji(pastedFormattedText) && shouldStripCustomEmoji) {\n        pastedFormattedText = stripCustomEmoji(pastedFormattedText);\n        onCustomEmojiStripped?.();\n      }\n\n      const { items } = e.clipboardData;\n      let files: File[] | undefined = [];\n\n      if (items.length > 0) {\n        files = await getFilesFromDataTransferItems(items);\n        if (editedMessage) {\n          files = files?.slice(0, 1);\n        }\n      }\n\n      if (!files?.length && !pastedText) {\n        return;\n      }\n\n      const textToPaste = pastedFormattedText?.entities?.length ? pastedFormattedText : { text: pastedText };\n\n      let isWordDocument = false;\n      try {\n        const parser = new DOMParser();\n        const parsedDocument = parser.parseFromString(html, TYPE_HTML);\n        isWordDocument = parsedDocument.documentElement\n          .getAttribute(NAMESPACE_PREFIX_WORD) === DOCUMENT_TYPE_WORD;\n      } catch (err: any) {\n        // Ignore\n      }\n\n      const hasText = textToPaste && textToPaste.text;\n      let shouldSetAttachments = files?.length && !isWordDocument;\n\n      const newAttachments = files ? await Promise.all(files.map((file) => buildAttachment(file.name, file))) : [];\n      const canReplace = (editedMessage && newAttachments?.length\n        && canReplaceMessageMedia(editedMessage, newAttachments[0])) || Boolean(hasText);\n      const isUploadingDocumentSticker = isUploadingFileSticker(newAttachments[0]);\n      const isInAlbum = editedMessage && editedMessage?.groupedId;\n\n      if (editedMessage && isUploadingDocumentSticker) {\n        showNotification({ message: lang(isInAlbum ? 'lng_edit_media_album_error' : 'lng_edit_media_invalid_file') });\n        return;\n      }\n\n      if (isInAlbum) {\n        shouldSetAttachments = canReplace;\n        if (!shouldSetAttachments) {\n          showNotification({ message: lang('lng_edit_media_album_error') });\n          return;\n        }\n      }\n\n      if (shouldSetAttachments) {\n        setAttachments(editedMessage ? newAttachments : (attachments) => attachments.concat(newAttachments));\n      }\n\n      if (hasText) {\n        if (shouldSetAttachments) {\n          setNextText(textToPaste);\n        } else {\n          insertTextAndUpdateCursor(textToPaste, input?.id);\n        }\n      }\n    }\n\n    document.addEventListener('paste', handlePaste, false);\n\n    return () => {\n      document.removeEventListener('paste', handlePaste, false);\n    };\n  }, [\n    insertTextAndUpdateCursor, editedMessage, setAttachments, isActive, shouldStripCustomEmoji,\n    onCustomEmojiStripped, setNextText, lang,\n  ]);\n};\n\nexport default useClipboardPaste;\n","import { useEffect, useLayoutEffect, useRef } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiDraft, ApiMessage } from '../../../../api/types';\nimport type { ThreadId } from '../../../../types';\nimport type { Signal } from '../../../../util/signals';\nimport { ApiMessageEntityTypes } from '../../../../api/types';\n\nimport { DRAFT_DEBOUNCE } from '../../../../config';\nimport {\n  requestMeasure,\n} from '../../../../lib/fasterdom/fasterdom';\nimport parseHtmlAsFormattedText from '../../../../util/parseHtmlAsFormattedText';\nimport { getTextWithEntitiesAsHtml } from '../../../common/helpers/renderTextWithEntities';\n\nimport useLastCallback from '../../../../hooks/useLastCallback';\nimport useLayoutEffectWithPrevDeps from '../../../../hooks/useLayoutEffectWithPrevDeps';\nimport useRunDebounced from '../../../../hooks/useRunDebounced';\nimport { useStateRef } from '../../../../hooks/useStateRef';\nimport useBackgroundMode from '../../../../hooks/window/useBackgroundMode';\nimport useBeforeUnload from '../../../../hooks/window/useBeforeUnload';\n\nlet isFrozen = false;\n\nfunction freeze() {\n  isFrozen = true;\n\n  requestMeasure(() => {\n    isFrozen = false;\n  });\n}\n\nconst useDraft = ({\n  draft,\n  chatId,\n  threadId,\n  getHtml,\n  setHtml,\n  editedMessage,\n  isDisabled,\n} : {\n  draft?: ApiDraft;\n  chatId: string;\n  threadId: ThreadId;\n  getHtml: Signal<string>;\n  setHtml: (html: string) => void;\n  editedMessage?: ApiMessage;\n  isDisabled?: boolean;\n}) => {\n  const { saveDraft, clearDraft, loadCustomEmojis } = getActions();\n\n  const isTouchedRef = useRef(false);\n\n  useEffect(() => {\n    const html = getHtml();\n    const isLocalDraft = draft?.isLocal !== undefined;\n    if (getTextWithEntitiesAsHtml(draft?.text) === html && !isLocalDraft) {\n      isTouchedRef.current = false;\n    } else {\n      isTouchedRef.current = true;\n    }\n  }, [draft, getHtml]);\n  useEffect(() => {\n    isTouchedRef.current = false;\n  }, [chatId, threadId]);\n\n  const isEditing = Boolean(editedMessage);\n\n  const updateDraft = useLastCallback((prevState: { chatId?: string; threadId?: ThreadId } = {}) => {\n    if (isDisabled || isEditing || !isTouchedRef.current) return;\n\n    const html = getHtml();\n\n    if (html) {\n      requestMeasure(() => {\n        saveDraft({\n          chatId: prevState.chatId ?? chatId,\n          threadId: prevState.threadId ?? threadId,\n          text: parseHtmlAsFormattedText(html),\n        });\n      });\n    } else {\n      clearDraft({\n        chatId: prevState.chatId ?? chatId,\n        threadId: prevState.threadId ?? threadId,\n        shouldKeepReply: true,\n      });\n    }\n  });\n\n  const runDebouncedForSaveDraft = useRunDebounced(DRAFT_DEBOUNCE, true, undefined, [chatId, threadId]);\n\n  // Restore draft on chat change\n  useLayoutEffectWithPrevDeps(([prevChatId, prevThreadId, prevDraft]) => {\n    if (isDisabled) {\n      return;\n    }\n    const isTouched = isTouchedRef.current;\n\n    if (chatId === prevChatId && threadId === prevThreadId) {\n      if (isTouched && !draft) return; // Prevent reset from other client if we have local edits\n      if (!draft && prevDraft) {\n        setHtml('');\n      }\n\n      if (isTouched) return;\n    }\n\n    if (editedMessage || !draft) {\n      return;\n    }\n\n    setHtml(getTextWithEntitiesAsHtml(draft.text));\n\n    const customEmojiIds = draft.text?.entities\n      ?.map((entity) => entity.type === ApiMessageEntityTypes.CustomEmoji && entity.documentId)\n      .filter(Boolean) || [];\n    if (customEmojiIds.length) loadCustomEmojis({ ids: customEmojiIds });\n  }, [chatId, threadId, draft, getHtml, setHtml, editedMessage, isDisabled]);\n\n  // Save draft on chat change. Should be layout effect to read correct html on cleanup\n  useLayoutEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    return () => {\n      if (!isEditing) {\n        updateDraft({ chatId, threadId });\n      }\n\n      freeze();\n    };\n  }, [chatId, threadId, isEditing, updateDraft, isDisabled]);\n\n  const chatIdRef = useStateRef(chatId);\n  const threadIdRef = useStateRef(threadId);\n  useEffect(() => {\n    if (isDisabled || isFrozen) {\n      return;\n    }\n\n    if (!getHtml()) {\n      updateDraft();\n\n      return;\n    }\n\n    const scopedhatId = chatIdRef.current;\n    const scopedThreadId = threadIdRef.current;\n\n    runDebouncedForSaveDraft(() => {\n      if (chatIdRef.current === scopedhatId && threadIdRef.current === scopedThreadId) {\n        updateDraft();\n      }\n    });\n  }, [chatIdRef, getHtml, isDisabled, runDebouncedForSaveDraft, threadIdRef, updateDraft]);\n\n  useBackgroundMode(updateDraft);\n  useBeforeUnload(updateDraft);\n};\n\nexport default useDraft;\n","import { useEffect, useState } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiDraft, ApiFormattedText, ApiMessage } from '../../../../api/types';\nimport type { MessageListType, ThreadId } from '../../../../types';\nimport type { Signal } from '../../../../util/signals';\nimport { ApiMessageEntityTypes } from '../../../../api/types';\n\nimport { EDITABLE_INPUT_CSS_SELECTOR } from '../../../../config';\nimport { requestMeasure, requestNextMutation } from '../../../../lib/fasterdom/fasterdom';\nimport { hasMessageMedia } from '../../../../global/helpers';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport parseHtmlAsFormattedText from '../../../../util/parseHtmlAsFormattedText';\nimport { getTextWithEntitiesAsHtml } from '../../../common/helpers/renderTextWithEntities';\n\nimport { useDebouncedResolver } from '../../../../hooks/useAsyncResolvers';\nimport useDerivedSignal from '../../../../hooks/useDerivedSignal';\nimport useEffectWithPrevDeps from '../../../../hooks/useEffectWithPrevDeps';\nimport useLastCallback from '../../../../hooks/useLastCallback';\nimport useBackgroundMode from '../../../../hooks/window/useBackgroundMode';\nimport useBeforeUnload from '../../../../hooks/window/useBeforeUnload';\n\nconst URL_ENTITIES = new Set<string>([ApiMessageEntityTypes.TextUrl, ApiMessageEntityTypes.Url]);\nconst DEBOUNCE_MS = 300;\n\nconst useEditing = (\n  getHtml: Signal<string>,\n  setHtml: (html: string) => void,\n  editedMessage: ApiMessage | undefined,\n  resetComposer: (shouldPreserveInput?: boolean) => void,\n  chatId: string,\n  threadId: ThreadId,\n  type: MessageListType,\n  draft?: ApiDraft,\n  editingDraft?: ApiFormattedText,\n): [VoidFunction, VoidFunction, boolean] => {\n  const {\n    editMessage, setEditingDraft, toggleMessageWebPage, openDeleteMessageModal,\n  } = getActions();\n  const [shouldForceShowEditing, setShouldForceShowEditing] = useState(false);\n\n  const replyingToId = draft?.replyInfo?.replyToMsgId;\n\n  useEffectWithPrevDeps(([prevEditedMessage, prevReplyingToId]) => {\n    if (!editedMessage) {\n      return;\n    }\n\n    if (replyingToId && prevReplyingToId !== replyingToId) {\n      setHtml('');\n      setShouldForceShowEditing(false);\n      return;\n    }\n\n    if (prevEditedMessage?.id === editedMessage.id && replyingToId === prevReplyingToId) {\n      return;\n    }\n\n    const text = !prevEditedMessage && editingDraft?.text.length ? editingDraft : editedMessage.content.text;\n    const html = getTextWithEntitiesAsHtml(text);\n\n    setHtml(html);\n    setShouldForceShowEditing(true);\n\n    requestNextMutation(() => {\n      const messageInput = document.querySelector<HTMLDivElement>(EDITABLE_INPUT_CSS_SELECTOR);\n      if (messageInput) {\n        focusEditableElement(messageInput, true);\n      }\n    });\n  }, [editedMessage, replyingToId, editingDraft, setHtml]);\n\n  useEffect(() => {\n    if (!editedMessage) {\n      return;\n    }\n\n    const shouldSetNoWebPage = !('webPage' in editedMessage.content)\n      && editedMessage.content.text?.entities?.some((entity) => URL_ENTITIES.has(entity.type));\n\n    toggleMessageWebPage({\n      chatId,\n      threadId,\n      noWebPage: shouldSetNoWebPage,\n    });\n  }, [chatId, threadId, editedMessage]);\n\n  useEffect(() => {\n    if (!editedMessage) return undefined;\n    return () => {\n      const edited = parseHtmlAsFormattedText(getHtml());\n      const update = edited.text.length ? edited : undefined;\n\n      setEditingDraft({\n        chatId, threadId, type, text: update,\n      });\n    };\n  }, [chatId, editedMessage, getHtml, setEditingDraft, threadId, type]);\n\n  const detectLinkDebounced = useDebouncedResolver(() => {\n    if (!editedMessage) return false;\n\n    const edited = parseHtmlAsFormattedText(getHtml());\n    return !('webPage' in editedMessage.content)\n      && editedMessage.content.text?.entities?.some((entity) => URL_ENTITIES.has(entity.type))\n      && !(edited.entities?.some((entity) => URL_ENTITIES.has(entity.type)));\n  }, [editedMessage, getHtml], DEBOUNCE_MS, true);\n\n  const getShouldResetNoWebPageDebounced = useDerivedSignal(detectLinkDebounced, [detectLinkDebounced, getHtml], true);\n\n  useEffectWithPrevDeps(([prevEditedMessage]) => {\n    if (!editedMessage || prevEditedMessage?.id !== editedMessage.id) {\n      return;\n    }\n\n    if (getShouldResetNoWebPageDebounced()) {\n      toggleMessageWebPage({\n        chatId,\n        threadId,\n        noWebPage: false,\n      });\n    }\n  }, [editedMessage, chatId, getHtml, threadId, getShouldResetNoWebPageDebounced]);\n\n  const restoreNewDraftAfterEditing = useLastCallback(() => {\n    if (!draft) return;\n\n    // Run one frame after editing draft reset\n    requestMeasure(() => {\n      setHtml(getTextWithEntitiesAsHtml(draft.text));\n\n      // Wait one more frame until new HTML is rendered\n      requestNextMutation(() => {\n        const messageInput = document.querySelector<HTMLDivElement>(EDITABLE_INPUT_CSS_SELECTOR);\n        if (messageInput) {\n          focusEditableElement(messageInput, true);\n        }\n      });\n    });\n  });\n\n  const handleEditCancel = useLastCallback(() => {\n    resetComposer();\n    restoreNewDraftAfterEditing();\n  });\n\n  const handleEditComplete = useLastCallback(() => {\n    const { text, entities } = parseHtmlAsFormattedText(getHtml());\n\n    if (!editedMessage) {\n      return;\n    }\n\n    if (!text && !hasMessageMedia(editedMessage)) {\n      openDeleteMessageModal({\n        chatId,\n        messageIds: [editedMessage.id],\n        isSchedule: type === 'scheduled',\n      });\n      return;\n    }\n\n    editMessage({\n      messageList: { chatId, threadId, type },\n      text,\n      entities,\n    });\n\n    resetComposer();\n    restoreNewDraftAfterEditing();\n  });\n\n  const handleBlur = useLastCallback(() => {\n    if (!editedMessage) return;\n    const edited = parseHtmlAsFormattedText(getHtml());\n    const update = edited.text.length ? edited : undefined;\n\n    setEditingDraft({\n      chatId, threadId, type, text: update,\n    });\n  });\n\n  useBackgroundMode(handleBlur);\n  useBeforeUnload(handleBlur);\n\n  return [handleEditComplete, handleEditCancel, shouldForceShowEditing];\n};\n\nexport default useEditing;\n","import { useEffect } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { InlineBotSettings } from '../../../../types';\nimport type { Signal } from '../../../../util/signals';\n\nimport memoized from '../../../../util/memoized';\n\nimport { useThrottledResolver } from '../../../../hooks/useAsyncResolvers';\nimport useDerivedState from '../../../../hooks/useDerivedState';\nimport useFlag from '../../../../hooks/useFlag';\nimport useLastCallback from '../../../../hooks/useLastCallback';\nimport useSyncEffect from '../../../../hooks/useSyncEffect';\n\nconst THROTTLE = 300;\nconst INLINE_BOT_QUERY_REGEXP = /^@([a-z0-9_]{1,32})[\\u00A0\\u0020]+(.*)/is;\nconst HAS_NEW_LINE = /^@([a-z0-9_]{1,32})[\\u00A0\\u0020]+\\n{2,}/i;\nconst MEMO_NO_RESULT = {\n  username: '',\n  query: '',\n  canShowHelp: false,\n  usernameLowered: '',\n};\n\nconst tempEl = document.createElement('div');\n\nexport default function useInlineBotTooltip(\n  isEnabled: boolean,\n  chatId: string,\n  getHtml: Signal<string>,\n  inlineBots?: Record<string, false | InlineBotSettings>,\n) {\n  const { queryInlineBot, resetInlineBot, resetAllInlineBots } = getActions();\n\n  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = useFlag(false);\n\n  const extractBotQueryThrottled = useThrottledResolver(() => {\n    const html = getHtml();\n    return isEnabled && html.startsWith('@') ? parseBotQuery(html) : MEMO_NO_RESULT;\n  }, [getHtml, isEnabled], THROTTLE);\n  const {\n    username, query, canShowHelp, usernameLowered,\n  } = useDerivedState(extractBotQueryThrottled, [extractBotQueryThrottled, getHtml], true);\n\n  useSyncEffect(([prevUsername]) => {\n    if (prevUsername) {\n      resetInlineBot({ username: prevUsername });\n    }\n  }, [username, resetInlineBot]);\n\n  useEffect(() => {\n    if (!usernameLowered) return;\n\n    queryInlineBot({\n      chatId, username: usernameLowered, query,\n    });\n  }, [chatId, query, queryInlineBot, usernameLowered]);\n\n  useEffect(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);\n\n  const {\n    id: botId,\n    switchPm,\n    switchWebview,\n    offset,\n    results,\n    isGallery,\n    help,\n  } = (usernameLowered && inlineBots?.[usernameLowered]) || {};\n\n  const isOpen = Boolean((results?.length || switchPm) && !isManuallyClosed);\n\n  useEffect(() => {\n    if (!isOpen && !username) {\n      resetAllInlineBots();\n    }\n  }, [isOpen, resetAllInlineBots, username]);\n\n  const loadMore = useLastCallback(() => {\n    if (!usernameLowered) return;\n\n    queryInlineBot({\n      chatId, username: usernameLowered, query, offset,\n    });\n  });\n\n  return {\n    isOpen,\n    botId,\n    isGallery,\n    switchPm,\n    switchWebview,\n    results,\n    closeTooltip: markManuallyClosed,\n    help: canShowHelp && help ? `@${username} ${help}` : undefined,\n    loadMore,\n  };\n}\n\nconst buildQueryStateMemo = memoized((username: string, query: string, canShowHelp: boolean) => ({\n  username,\n  query,\n  canShowHelp,\n  usernameLowered: username.toLowerCase(),\n}));\n\nfunction parseBotQuery(html: string) {\n  if (!html.startsWith('@')) {\n    return MEMO_NO_RESULT;\n  }\n\n  const text = getPlainText(html);\n  const result = text.match(INLINE_BOT_QUERY_REGEXP);\n  if (!result) {\n    return MEMO_NO_RESULT;\n  }\n\n  return buildQueryStateMemo(result[1], result[2], result[2] === '' && !text.match(HAS_NEW_LINE));\n}\n\nfunction getPlainText(html: string) {\n  tempEl.innerHTML = html.replace(/<br>/g, '\\n');\n\n  tempEl.querySelectorAll<HTMLElement>('[alt]').forEach((el) => {\n    if (!el.innerText) {\n      el.innerText = el.getAttribute('alt')!;\n    }\n  });\n\n  return tempEl.innerText;\n}\n","import { useEffect } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiSticker } from '../../../../api/types';\nimport type { Signal } from '../../../../util/signals';\n\nimport { EMOJI_IMG_REGEX } from '../../../../config';\nimport twemojiRegex from '../../../../lib/twemojiRegex';\nimport { IS_EMOJI_SUPPORTED } from '../../../../util/browser/windowEnvironment';\nimport parseEmojiOnlyString from '../../../../util/emoji/parseEmojiOnlyString';\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\n\nimport useDerivedSignal from '../../../../hooks/useDerivedSignal';\nimport useDerivedState from '../../../../hooks/useDerivedState';\nimport useFlag from '../../../../hooks/useFlag';\n\nconst MAX_LENGTH = 8;\nconst STARTS_ENDS_ON_EMOJI_IMG_REGEX = new RegExp(`^${EMOJI_IMG_REGEX.source}$`, 'g');\n\nexport default function useStickerTooltip(\n  isEnabled: boolean,\n  getHtml: Signal<string>,\n  stickers?: ApiSticker[],\n) {\n  const { loadStickersForEmoji, clearStickersForEmoji } = getActions();\n\n  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = useFlag(false);\n\n  const getSingleEmoji = useDerivedSignal(() => {\n    const html = getHtml();\n    if (!isEnabled || !html || (IS_EMOJI_SUPPORTED && html.length > MAX_LENGTH)) return undefined;\n\n    const hasEmoji = html.match(IS_EMOJI_SUPPORTED ? twemojiRegex : EMOJI_IMG_REGEX);\n    if (!hasEmoji) return undefined;\n\n    const cleanHtml = prepareForRegExp(html);\n    const isSingleEmoji = cleanHtml && (\n      (IS_EMOJI_SUPPORTED && parseEmojiOnlyString(cleanHtml) === 1)\n      || (!IS_EMOJI_SUPPORTED && Boolean(html.match(STARTS_ENDS_ON_EMOJI_IMG_REGEX)))\n    );\n\n    return isSingleEmoji\n      ? (IS_EMOJI_SUPPORTED ? cleanHtml : cleanHtml.match(/alt=\"(.+)\"/)?.[1]!)\n      : undefined;\n  }, [getHtml, isEnabled]);\n\n  const isActive = useDerivedState(() => Boolean(getSingleEmoji()), [getSingleEmoji]);\n  const hasStickers = Boolean(stickers?.length);\n\n  useEffect(() => {\n    if (!isEnabled || !isActive) return;\n\n    const singleEmoji = getSingleEmoji();\n    if (singleEmoji) {\n      if (!hasStickers) {\n        loadStickersForEmoji({ emoji: singleEmoji });\n      }\n    } else {\n      clearStickersForEmoji();\n    }\n  }, [isEnabled, isActive, getSingleEmoji, hasStickers, loadStickersForEmoji, clearStickersForEmoji]);\n\n  useEffect(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);\n\n  return {\n    isStickerTooltipOpen: Boolean(isActive && hasStickers && !isManuallyClosed),\n    closeStickerTooltip: markManuallyClosed,\n  };\n}\n","import type { IOpusRecorder } from 'opus-recorder';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\n\nexport type Result = { blob: Blob; duration: number; waveform: number[] };\n\nconst encoderPath = new URL('opus-recorder/dist/encoderWorker.min', import.meta.url).href;\nconst MIN_RECORDING_TIME = 1000;\nconst POLYFILL_OPTIONS = { encoderPath, reuseWorker: true };\nconst BLOB_PARAMS = { type: 'audio/ogg' };\nconst FFT_SIZE = 64;\nconst MIN_VOLUME = 0.1;\n\nlet opusRecorderPromise: Promise<{ default: IOpusRecorder }>;\nlet OpusRecorder: IOpusRecorder;\nlet mediaRecorder: IOpusRecorder;\n\nexport async function init() {\n  if (!opusRecorderPromise) {\n    opusRecorderPromise = import('opus-recorder');\n    OpusRecorder = (await opusRecorderPromise).default;\n    mediaRecorder = new OpusRecorder(POLYFILL_OPTIONS);\n  }\n\n  return opusRecorderPromise;\n}\n\nexport async function start(analyzerCallback: Function) {\n  await startMediaRecorder();\n\n  const startedAt = Date.now();\n  let pausedAt: number;\n  const chunks: Uint8Array[] = [];\n  const waveform: number[] = [];\n\n  mediaRecorder.ondataavailable = (typedArray) => {\n    chunks.push(typedArray);\n  };\n\n  const releaseAnalyzer = subscribeToAnalyzer(mediaRecorder, (volume: number) => {\n    waveform.push(volume * 255);\n    analyzerCallback(volume);\n  });\n\n  return {\n    stop: () => new Promise<Result>((resolve, reject) => {\n      mediaRecorder.onstop = () => {\n        resolve({\n          blob: new Blob(chunks, BLOB_PARAMS),\n          duration: Math.round(((pausedAt || Date.now()) - startedAt) / 1000),\n          waveform,\n        });\n      };\n      mediaRecorder.onerror = reject;\n\n      const delayStop = Math.max(0, startedAt + MIN_RECORDING_TIME - Date.now());\n      setTimeout(() => {\n        mediaRecorder.stop();\n        releaseAnalyzer();\n      }, delayStop);\n    }),\n    pause: () => {\n      const delayStop = Math.max(0, startedAt + MIN_RECORDING_TIME - Date.now());\n      setTimeout(() => {\n        mediaRecorder.pause();\n        pausedAt = Date.now();\n        releaseAnalyzer();\n      }, delayStop);\n    },\n  };\n}\n\nasync function startMediaRecorder() {\n  await init();\n  await mediaRecorder.start();\n}\n\nfunction subscribeToAnalyzer(recorder: IOpusRecorder, cb: Function) {\n  const source = recorder.sourceNode;\n  const analyser = source.context.createAnalyser();\n  analyser.fftSize = FFT_SIZE;\n  source.connect(analyser);\n\n  const dataLength = analyser.frequencyBinCount;\n  const dataArray = new Uint8Array(dataLength);\n  let isDestroyed = false;\n\n  function tick() {\n    if (isDestroyed) {\n      return;\n    }\n\n    analyser.getByteFrequencyData(dataArray);\n\n    const sum = dataArray.reduce((acc, current) => acc + current, 0);\n    const mean = (sum / dataLength);\n    const volume = mean / 255;\n\n    cb(volume < MIN_VOLUME ? 0 : volume);\n\n    requestMeasure(tick);\n  }\n\n  tick();\n\n  return () => {\n    isDestroyed = true;\n  };\n}\n","export type GrammarlyCheckItem = {\n  type?: string;\n  description?: string;\n  offset: number;\n  length: number;\n  originalText?: string;\n  remove_segment: boolean;\n  suggestions:string[];\n};\ntype GrammarlyCheckResponse = {\n  code:number;\n  data:{\n    errors:GrammarlyCheckItem[];\n  };\n};\nexport const grammarlyCheck = (text:string):Promise<GrammarlyCheckResponse> => {\n  return new Promise((resolve, reject) => {\n    fetch('https://telegpt-three.vercel.app/grammarly-check', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        text,\n      }),\n    }).then((response) => response.json())\n      .then((data) => resolve(data as GrammarlyCheckResponse))\n      .catch((err) => {\n        reject(err);\n      });\n  });\n};\nexport const grammarlyShorten = (text:string):Promise<GrammarlyCheckResponse> => {\n  return new Promise((resolve, reject) => {\n    fetch('https://telegpt-three.vercel.app/grammarly-shorten', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        text,\n      }),\n    }).then((response) => response.json())\n      .then((data) => resolve(data as GrammarlyCheckResponse))\n      .catch((err) => {\n        reject(err);\n      });\n  });\n};\nexport const grammarlyFormal = (text:string):Promise<GrammarlyCheckResponse> => {\n  return new Promise((resolve, reject) => {\n    fetch('https://telegpt-three.vercel.app/grammarly-formal', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        text,\n      }),\n    }).then((response) => response.json())\n      .then((data) => resolve(data as GrammarlyCheckResponse))\n      .catch((err) => {\n        reject(err);\n      });\n  });\n};\nexport const grammarlyFriendly = (text:string):Promise<GrammarlyCheckResponse> => {\n  return new Promise((resolve, reject) => {\n    fetch('https://telegpt-three.vercel.app/grammarly-friendly', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        text,\n      }),\n    }).then((response) => response.json())\n      .then((data) => resolve(data as GrammarlyCheckResponse))\n      .catch((err) => {\n        reject(err);\n      });\n  });\n};\nexport const grammarlyRephrase = (text:string):Promise<GrammarlyCheckResponse> => {\n  return new Promise((resolve, reject) => {\n    fetch('https://telegpt-three.vercel.app/grammarly-rephrase', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        text,\n      }),\n    }).then((response) => response.json())\n      .then((data) => resolve(data as GrammarlyCheckResponse))\n      .catch((err) => {\n        reject(err);\n      });\n  });\n};\n\nexport function getCorrectedText(text: string, errors: GrammarlyCheckItem[]): string {\n  if (!errors.length) return text;\n\n  // \n  const sorted = [...errors].sort((a, b) => b.offset - a.offset);\n\n  for (const { offset, length, suggestions } of sorted) {\n    const suggestion = suggestions[0] || '';\n    text = text.slice(0, offset) + suggestion + text.slice(offset + length);\n  }\n\n  return text;\n}\n","import React from 'react';\n\nimport './SkeletonScreen.scss';\n\nconst SkeletonScreen = () => {\n  return (\n    <div className=\"skeleton-wrapper\">\n      <div className=\"skeleton-text skeleton-line\" />\n      <div className=\"skeleton-text skeleton-line\" />\n      <div className=\"skeleton-text skeleton-line\" />\n    </div>\n  );\n};\n\nexport default SkeletonScreen;\n","/* eslint-disable react-hooks-static-deps/exhaustive-deps */\n/* eslint-disable max-len */\nimport React, { useCallback, useEffect } from 'react';\nimport { Button } from 'antd';\n\nimport type { GrammarlyCheckItem } from '../../../utils/grammarly';\nimport type { GrammarTabProps } from '../GrammarTool';\n\nimport { getCorrectedText, grammarlyFormal } from '../../../utils/grammarly';\n\nimport SkeletonScreen from '../Skeleton/SkeletonScreen';\nimport HighlightedText from './HighlightedText';\n\nconst FormalTab = (props:GrammarTabProps) => {\n  const { text, setHtml, onClose } = props;\n  const [loading, setLoading] = React.useState(true);\n  const [grammarlyResult, setGrammarlyResult] = React.useState<GrammarlyCheckItem[]>([]);\n  function handleImprove() {\n    grammarlyFormal(text).then((result) => {\n      if (result.data.errors) {\n        setGrammarlyResult(result.data.errors);\n        setLoading(false);\n      } else {\n        throw new Error('No errors found in the text');\n      }\n    }).catch((err) => {\n      // eslint-disable-next-line no-console\n      console.error('Error checking grammar:', err);\n      setLoading(false);\n      setGrammarlyResult([]);\n    });\n  }\n\n  useEffect(() => {\n    handleImprove();\n  }, []);\n\n  const handleAccept = useCallback(() => {\n    if (grammarlyResult) {\n      const newText = getCorrectedText(text, grammarlyResult);\n      setHtml(newText);\n      onClose();\n    }\n  }, [grammarlyResult]);\n  return (\n    <div>\n      <h2 className=\"grammar-tool-tab-content-title\">Use professional wording</h2>\n      {loading ? (<SkeletonScreen />) : (\n        <>\n          <HighlightedText text={text} errors={grammarlyResult} />\n          <Button color=\"default\" variant=\"outlined\" onClick={handleAccept}>\n            Accept\n          </Button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default FormalTab;\n","/* eslint-disable react-hooks-static-deps/exhaustive-deps */\n/* eslint-disable max-len */\nimport React, { useCallback, useEffect } from 'react';\nimport { Button } from 'antd';\n\nimport type { GrammarlyCheckItem } from '../../../utils/grammarly';\nimport type { GrammarTabProps } from '../GrammarTool';\n\nimport { getCorrectedText, grammarlyFriendly } from '../../../utils/grammarly';\n\nimport SkeletonScreen from '../Skeleton/SkeletonScreen';\nimport HighlightedText from './HighlightedText';\n\nconst FriendlyTab = (props:GrammarTabProps) => {\n  const { text, setHtml, onClose } = props;\n  const [loading, setLoading] = React.useState(true);\n  const [grammarlyResult, setGrammarlyResult] = React.useState<GrammarlyCheckItem[]>([]);\n  function handleImprove() {\n    grammarlyFriendly(text).then((result) => {\n      if (result.data.errors) {\n        setGrammarlyResult(result.data.errors);\n        setLoading(false);\n      } else {\n        throw new Error('No errors found in the text');\n      }\n    }).catch((err) => {\n      // eslint-disable-next-line no-console\n      console.error('Error checking grammar:', err);\n      setLoading(false);\n      setGrammarlyResult([]);\n    });\n  }\n\n  useEffect(() => {\n    handleImprove();\n  }, []);\n\n  const handleAccept = useCallback(() => {\n    if (grammarlyResult) {\n      const newText = getCorrectedText(text, grammarlyResult);\n      setHtml(newText);\n      onClose();\n    }\n  }, [grammarlyResult]);\n  return (\n    <div>\n      <h2 className=\"grammar-tool-tab-content-title\">Use more personal language</h2>\n      {loading ? (<SkeletonScreen />) : (\n        <>\n          <HighlightedText text={text} errors={grammarlyResult} />\n          <Button color=\"default\" variant=\"outlined\" onClick={handleAccept}>\n            Accept\n          </Button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default FriendlyTab;\n","/* eslint-disable react-hooks-static-deps/exhaustive-deps */\n/* eslint-disable max-len */\nimport React, { useCallback, useEffect } from 'react';\nimport { Button } from 'antd';\n\nimport type { GrammarlyCheckItem } from '../../../utils/grammarly';\nimport type { GrammarTabProps } from '../GrammarTool';\n\nimport { getCorrectedText, grammarlyCheck } from '../../../utils/grammarly';\n\nimport SkeletonScreen from '../Skeleton/SkeletonScreen';\nimport HighlightedText from './HighlightedText';\n\nconst ImproveTab = (props:GrammarTabProps) => {\n  const { text, setHtml, onClose } = props;\n  const [loading, setLoading] = React.useState(true);\n  const [grammarlyResult, setGrammarlyResult] = React.useState<GrammarlyCheckItem[]>([]);\n  function handleImprove() {\n    grammarlyCheck(text).then((result) => {\n      if (result.data.errors) {\n        setGrammarlyResult(result.data.errors);\n        setLoading(false);\n      } else {\n        throw new Error('No errors found in the text');\n      }\n    }).catch((err) => {\n      // eslint-disable-next-line no-console\n      console.error('Error checking grammar:', err);\n      setLoading(false);\n      setGrammarlyResult([]);\n    });\n  }\n\n  useEffect(() => {\n    handleImprove();\n  }, []);\n\n  const handleAccept = useCallback(() => {\n    if (grammarlyResult) {\n      const newText = getCorrectedText(text, grammarlyResult);\n      setHtml(newText);\n      onClose();\n    }\n  }, [grammarlyResult]);\n  return (\n    <div>\n      <h2 className=\"grammar-tool-tab-content-title\">Fix grammar errors</h2>\n      {loading ? (<SkeletonScreen />) : (\n        <>\n          <HighlightedText text={text} errors={grammarlyResult} />\n          <Button color=\"default\" variant=\"outlined\" onClick={handleAccept}>\n            Accept\n          </Button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default ImproveTab;\n","/* eslint-disable react-hooks-static-deps/exhaustive-deps */\n/* eslint-disable max-len */\nimport React, { useCallback, useEffect } from 'react';\nimport { Button } from 'antd';\n\nimport type { GrammarlyCheckItem } from '../../../utils/grammarly';\nimport type { GrammarTabProps } from '../GrammarTool';\n\nimport { getCorrectedText, grammarlyRephrase } from '../../../utils/grammarly';\n\nimport SkeletonScreen from '../Skeleton/SkeletonScreen';\nimport HighlightedText from './HighlightedText';\n\nconst RephraseTab = (props:GrammarTabProps) => {\n  const { text, setHtml, onClose } = props;\n  const [loading, setLoading] = React.useState(true);\n  const [grammarlyResult, setGrammarlyResult] = React.useState<GrammarlyCheckItem[]>([]);\n  function handleImprove() {\n    grammarlyRephrase(text).then((result) => {\n      if (result.data.errors) {\n        setGrammarlyResult(result.data.errors);\n        setLoading(false);\n      } else {\n        throw new Error('No errors found in the text');\n      }\n    }).catch((err) => {\n      // eslint-disable-next-line no-console\n      console.error('Error checking grammar:', err);\n      setLoading(false);\n      setGrammarlyResult([]);\n    });\n  }\n\n  useEffect(() => {\n    handleImprove();\n  }, []);\n\n  const handleAccept = useCallback(() => {\n    if (grammarlyResult) {\n      const newText = getCorrectedText(text, grammarlyResult);\n      setHtml(newText);\n      onClose();\n    }\n  }, [grammarlyResult]);\n  return (\n    <div>\n      <h2 className=\"grammar-tool-tab-content-title\">Enhance clarity and fluency</h2>\n      {loading ? (<SkeletonScreen />) : (\n        <>\n          <HighlightedText text={text} errors={grammarlyResult} />\n          <Button color=\"default\" variant=\"outlined\" onClick={handleAccept}>\n            Accept\n          </Button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default RephraseTab;\n","/* eslint-disable react-hooks-static-deps/exhaustive-deps */\n/* eslint-disable max-len */\nimport React, { useCallback, useEffect } from 'react';\nimport { Button } from 'antd';\n\nimport type { GrammarlyCheckItem } from '../../../utils/grammarly';\nimport type { GrammarTabProps } from '../GrammarTool';\n\nimport { getCorrectedText, grammarlyShorten } from '../../../utils/grammarly';\n\nimport SkeletonScreen from '../Skeleton/SkeletonScreen';\nimport HighlightedText from './HighlightedText';\n\nconst ShortenTab = (props:GrammarTabProps) => {\n  const { text, setHtml, onClose } = props;\n  const [loading, setLoading] = React.useState(true);\n  const [grammarlyResult, setGrammarlyResult] = React.useState<GrammarlyCheckItem[]>([]);\n  function handleImprove() {\n    grammarlyShorten(text).then((result) => {\n      if (result.data.errors) {\n        setGrammarlyResult(result.data.errors);\n        setLoading(false);\n      } else {\n        throw new Error('No errors found in the text');\n      }\n    }).catch((err) => {\n      // eslint-disable-next-line no-console\n      console.error('Error checking grammar:', err);\n      setLoading(false);\n      setGrammarlyResult([]);\n    });\n  }\n\n  useEffect(() => {\n    handleImprove();\n  }, []);\n\n  const handleAccept = useCallback(() => {\n    if (grammarlyResult) {\n      const newText = getCorrectedText(text, grammarlyResult);\n      setHtml(newText);\n      onClose();\n    }\n  }, [grammarlyResult]);\n  return (\n    <div>\n      <h2 className=\"grammar-tool-tab-content-title\">Condense wordy sections</h2>\n      {loading ? (<SkeletonScreen />) : (\n        <>\n          <HighlightedText text={text} errors={grammarlyResult} />\n          <Button color=\"default\" variant=\"outlined\" onClick={handleAccept}>\n            Accept\n          </Button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default ShortenTab;\n","/* eslint-disable max-len */\n/* eslint-disable teactn/no-unused-prop-types */\n/* eslint-disable react/no-unused-prop-types */\n/* eslint-disable @typescript-eslint/no-use-before-define */\n/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable no-null/no-null */\nimport React, {\n  useEffect, useRef,\n} from '../../../../lib/teact/teact';\n\nimport type { Signal } from '../../../../util/signals';\n\nimport { injectComponent } from '../../../../lib/injectComponent';\nimport captureEscKeyListener from '../../../../util/captureEscKeyListener';\nimport parseHtmlAsFormattedText from '../../../../util/parseHtmlAsFormattedText';\n\nimport useFlag from '../../../../hooks/useFlag';\nimport useVirtualBackdrop from '../../../../hooks/useVirtualBackdrop';\n\nimport GrammarTool from './GrammarTool';\n\nimport './GrammarToolWrapper.scss';\n\nimport GrammerInput from '../../assets/grammar-input.png';\n\ninterface GrammarToolWrapperProps {\n  getHtml: Signal<string>;\n  setHtml: (newValue: string) => void;\n}\n\nconst injectMessageAI = injectComponent(GrammarTool);\nconst GrammarToolWrapper = (props:GrammarToolWrapperProps) => {\n  const [isGrammarToolOpen, openGrammarTool, closeGrammarTool] = useFlag();\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const { getHtml, setHtml } = props;\n  useEffect(() => {\n    let injected: { unmount: () => void } | undefined;\n    if (containerRef.current && isGrammarToolOpen) {\n      injected = injectMessageAI(containerRef.current, { getHtml, setHtml, onClose: closeGrammarTool });\n    }\n    return () => {\n      injected?.unmount();\n    };\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, [isGrammarToolOpen, closeGrammarTool]);\n\n  useEffect(\n    () => (isGrammarToolOpen ? captureEscKeyListener(closeGrammarTool) : undefined),\n    [isGrammarToolOpen, closeGrammarTool],\n  );\n\n  useVirtualBackdrop(\n    isGrammarToolOpen,\n    containerRef,\n    closeGrammarTool,\n    undefined,\n    undefined,\n  );\n  const handleToggleMenu = () => {\n    if (isGrammarToolOpen) {\n      closeGrammarTool();\n    } else {\n      const { text } = parseHtmlAsFormattedText(getHtml());\n      if (text.trim() === '') return;\n      openGrammarTool();\n    }\n  };\n  return (\n    <div className=\"input-ai-actions flex-shrink-0 mr-[8px]\">\n      <button className=\"Button input-ai-actions-button\" onClick={handleToggleMenu}>\n        <img src={GrammerInput} alt=\"Chat AI Logo\" />\n      </button>\n      {isGrammarToolOpen && (\n        <div\n          className=\"grammar-tool-wrapper open\"\n          ref={containerRef}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default GrammarToolWrapper;\n","/* eslint-disable react/jsx-props-no-spreading */\n/* eslint-disable max-len */\nimport React from 'react';\nimport { Tabs, type TabsProps } from 'antd';\n\nimport type { Signal } from '../../../../util/signals';\n\nimport parseHtmlAsFormattedText from '../../../../util/parseHtmlAsFormattedText';\n\nimport FormalTab from './tabs/FormalTab';\nimport FriendlyTab from './tabs/FriendlyTab';\nimport ImproveTab from './tabs/ImproveTab';\nimport RephraseTab from './tabs/RephraseTab';\nimport ShortenTab from './tabs/ShortenTab';\n\nexport interface GrammarTabProps {\n  text: string;\n  setHtml: (newValue: string) => void;\n  onClose: () => void;\n}\nexport interface GrammarToolProps {\n  getHtml: Signal<string>;\n  setHtml: (newValue: string) => void;\n  onClose: () => void;\n}\nconst GrammarTool = (props:GrammarToolProps) => {\n  const { getHtml, setHtml, onClose } = props;\n  const { text } = parseHtmlAsFormattedText(getHtml());\n  const items: TabsProps['items'] = [\n    {\n      key: '1',\n      label: 'Improve',\n      children: <ImproveTab text={text} setHtml={setHtml} onClose={onClose} />,\n    },\n    {\n      key: '2',\n      label: 'Rephrase',\n      children: <RephraseTab text={text} setHtml={setHtml} onClose={onClose} />,\n    },\n    {\n      key: '3',\n      label: 'Shorten',\n      children: <ShortenTab text={text} setHtml={setHtml} onClose={onClose} />,\n    },\n    {\n      key: '4',\n      label: 'Friendly',\n      children: <FriendlyTab text={text} setHtml={setHtml} onClose={onClose} />,\n    },\n    {\n      key: '5',\n      label: 'Formal',\n      children: <FormalTab text={text} setHtml={setHtml} onClose={onClose} />,\n    },\n  ];\n  return (\n    <Tabs className=\"grammar-tool-tabs\" defaultActiveKey=\"1\" items={items} tabPosition=\"bottom\" />\n  );\n};\nexport default GrammarTool;\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './AttachmentModal';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst AttachmentModalAsync: FC<OwnProps> = (props) => {\n  const { attachments } = props;\n  const AttachmentModal = useModuleLoader(Bundles.Extra, 'AttachmentModal', !attachments.length);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return AttachmentModal ? <AttachmentModal {...props} /> : undefined;\n};\n\nexport default AttachmentModalAsync;\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useEffect,\n  useMemo,\n} from '../../../lib/teact/teact';\n\nimport type { ApiAttachMenuPeerType, ApiMessage } from '../../../api/types';\nimport type { GlobalState } from '../../../global/types';\nimport type { MessageListType, ThemeKey, ThreadId } from '../../../types';\n\nimport {\n  CONTENT_TYPES_WITH_PREVIEW, DEBUG_LOG_FILENAME, SUPPORTED_AUDIO_CONTENT_TYPES,\n  SUPPORTED_PHOTO_CONTENT_TYPES,\n  SUPPORTED_VIDEO_CONTENT_TYPES,\n} from '../../../config';\nimport {\n  getMessageAudio, getMessageDocument,\n  getMessagePhoto,\n  getMessageVideo, getMessageVoice,\n  getMessageWebPagePhoto,\n  getMessageWebPageVideo,\n} from '../../../global/helpers';\nimport { IS_TOUCH_ENV } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { getDebugLogs } from '../../../util/debugConsole';\nimport { validateFiles } from '../../../util/files';\nimport { openSystemFilesDialog } from '../../../util/systemFilesDialog';\n\nimport useFlag from '../../../hooks/useFlag';\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMouseInside from '../../../hooks/useMouseInside';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Icon from '../../common/icons/Icon';\nimport Menu from '../../ui/Menu';\nimport MenuItem from '../../ui/MenuItem';\nimport ResponsiveHoverButton from '../../ui/ResponsiveHoverButton';\nimport AttachBotItem from './AttachBotItem';\n\nimport './AttachMenu.scss';\n\nexport type OwnProps = {\n  chatId: string;\n  threadId?: ThreadId;\n  isButtonVisible: boolean;\n  canAttachMedia: boolean;\n  canAttachPolls: boolean;\n  canSendPhotos: boolean;\n  canSendVideos: boolean;\n  canSendDocuments: boolean;\n  canSendAudios: boolean;\n  isScheduled?: boolean;\n  attachBots?: GlobalState['attachMenu']['bots'];\n  peerType?: ApiAttachMenuPeerType;\n  shouldCollectDebugLogs?: boolean;\n  theme: ThemeKey;\n  onFileSelect: (files: File[], shouldSuggestCompression?: boolean) => void;\n  onPollCreate: NoneToVoidFunction;\n  onMenuOpen: NoneToVoidFunction;\n  onMenuClose: NoneToVoidFunction;\n  canEditMedia?: boolean;\n  editingMessage?: ApiMessage;\n  messageListType?: MessageListType;\n  paidMessagesStars?: number;\n};\n\nconst AttachMenu: FC<OwnProps> = ({\n  chatId,\n  threadId,\n  isButtonVisible,\n  canAttachMedia,\n  canAttachPolls,\n  canSendPhotos,\n  canSendVideos,\n  canSendDocuments,\n  canSendAudios,\n  attachBots,\n  peerType,\n  isScheduled,\n  theme,\n  shouldCollectDebugLogs,\n  onFileSelect,\n  onMenuOpen,\n  onMenuClose,\n  onPollCreate,\n  canEditMedia,\n  editingMessage,\n  messageListType,\n  paidMessagesStars,\n}) => {\n  const [isAttachMenuOpen, openAttachMenu, closeAttachMenu] = useFlag();\n  const [handleMouseEnter, handleMouseLeave, markMouseInside] = useMouseInside(isAttachMenuOpen, closeAttachMenu);\n\n  const canSendVideoAndPhoto = canSendPhotos && canSendVideos;\n  const canSendVideoOrPhoto = canSendPhotos || canSendVideos;\n\n  const [isAttachmentBotMenuOpen, markAttachmentBotMenuOpen, unmarkAttachmentBotMenuOpen] = useFlag();\n  const isMenuOpen = isAttachMenuOpen || isAttachmentBotMenuOpen;\n\n  const isPhotoOrVideo = editingMessage && editingMessage?.groupedId\n    && Boolean(getMessagePhoto(editingMessage) || getMessageWebPagePhoto(editingMessage)\n      || Boolean(getMessageVideo(editingMessage) || getMessageWebPageVideo(editingMessage)));\n  const isFile = editingMessage && editingMessage?.groupedId && Boolean(getMessageAudio(editingMessage)\n    || getMessageVoice(editingMessage) || getMessageDocument(editingMessage));\n\n  useEffect(() => {\n    if (isAttachMenuOpen) {\n      markMouseInside();\n    }\n  }, [isAttachMenuOpen, markMouseInside]);\n\n  useEffect(() => {\n    if (isMenuOpen) {\n      onMenuOpen();\n    } else {\n      onMenuClose();\n    }\n  }, [isMenuOpen, onMenuClose, onMenuOpen]);\n\n  const handleToggleAttachMenu = useLastCallback(() => {\n    if (isAttachMenuOpen) {\n      closeAttachMenu();\n    } else {\n      openAttachMenu();\n    }\n  });\n\n  const handleFileSelect = useLastCallback((e: Event, shouldSuggestCompression?: boolean) => {\n    const { files } = e.target as HTMLInputElement;\n    const validatedFiles = validateFiles(files);\n\n    if (validatedFiles?.length) {\n      onFileSelect(validatedFiles, shouldSuggestCompression);\n    }\n  });\n\n  const handleQuickSelect = useLastCallback(() => {\n    openSystemFilesDialog(\n      Array.from(canSendVideoAndPhoto ? CONTENT_TYPES_WITH_PREVIEW : (\n        canSendPhotos ? SUPPORTED_PHOTO_CONTENT_TYPES : SUPPORTED_VIDEO_CONTENT_TYPES\n      )).join(','),\n      (e) => handleFileSelect(e, true),\n    );\n  });\n\n  const handleDocumentSelect = useLastCallback(() => {\n    openSystemFilesDialog(!canSendDocuments && canSendAudios\n      ? Array.from(SUPPORTED_AUDIO_CONTENT_TYPES).join(',') : (\n        '*'\n      ), (e) => handleFileSelect(e, false));\n  });\n\n  const handleSendLogs = useLastCallback(() => {\n    const file = new File([getDebugLogs()], DEBUG_LOG_FILENAME, { type: 'text/plain' });\n    onFileSelect([file]);\n  });\n\n  const bots = useMemo(() => {\n    return attachBots\n      ? Object.values(attachBots).filter((bot) => {\n        if (!peerType || !bot.isForAttachMenu) return false;\n        if (peerType === 'bots' && bot.id === chatId\n          && bot.attachMenuPeerTypes && bot.attachMenuPeerTypes.includes('self')) {\n          return true;\n        }\n        return bot.attachMenuPeerTypes!.includes(peerType);\n      })\n      : undefined;\n  }, [attachBots, chatId, peerType]);\n\n  const oldLang = useOldLang();\n  const lang = useLang();\n\n  if (!isButtonVisible) {\n    return undefined;\n  }\n\n  return (\n    <div className=\"AttachMenu\">\n      {\n        editingMessage && canEditMedia ? (\n          <ResponsiveHoverButton\n            id=\"replace-menu-button\"\n            className={buildClassName('AttachMenu--button composer-action-button', isAttachMenuOpen && 'activated')}\n            round\n            color=\"translucent\"\n            onActivate={handleToggleAttachMenu}\n            ariaLabel=\"Replace an attachment\"\n            ariaControls=\"replace-menu-controls\"\n            hasPopup\n          >\n            <Icon name=\"replace\" />\n          </ResponsiveHoverButton>\n        ) : (\n          <ResponsiveHoverButton\n            id=\"attach-menu-button\"\n            disabled={Boolean(editingMessage)}\n            className={buildClassName('AttachMenu--button composer-action-button', isAttachMenuOpen && 'activated')}\n            round\n            color=\"translucent\"\n            onActivate={handleToggleAttachMenu}\n            ariaLabel=\"Add an attachment\"\n            ariaControls=\"attach-menu-controls\"\n            hasPopup\n          >\n            <Icon name=\"attach\" />\n          </ResponsiveHoverButton>\n        )\n      }\n      <Menu\n        id=\"attach-menu-controls\"\n        isOpen={isMenuOpen}\n        autoClose\n        positionX=\"right\"\n        positionY=\"bottom\"\n        onClose={closeAttachMenu}\n        className=\"AttachMenu--menu fluid\"\n        onCloseAnimationEnd={closeAttachMenu}\n        onMouseEnter={!IS_TOUCH_ENV ? handleMouseEnter : undefined}\n        onMouseLeave={!IS_TOUCH_ENV ? handleMouseLeave : undefined}\n        noCloseOnBackdrop={!IS_TOUCH_ENV}\n        ariaLabelledBy=\"attach-menu-button\"\n      >\n        {/*\n       ** Using ternary operator here causes some attributes from first clause\n       ** transferring to the fragment content in the second clause\n       */}\n        {!canAttachMedia && (\n          <MenuItem className=\"media-disabled\" disabled>\n            {lang(messageListType === 'scheduled' && paidMessagesStars\n              ? 'DescriptionScheduledPaidMediaNotAllowed'\n              : 'DescriptionRestrictedMedia')}\n          </MenuItem>\n        )}\n        {canAttachMedia && (\n          <>\n            {canSendVideoOrPhoto && !isFile && (\n              <MenuItem icon=\"photo\" onClick={handleQuickSelect}>\n                {oldLang(canSendVideoAndPhoto ? 'AttachmentMenu.PhotoOrVideo'\n                  : (canSendPhotos ? 'InputAttach.Popover.Photo' : 'InputAttach.Popover.Video'))}\n              </MenuItem>\n            )}\n            {((canSendDocuments || canSendAudios) && !isPhotoOrVideo)\n              && (\n                <MenuItem icon=\"document\" onClick={handleDocumentSelect}>\n                  {oldLang(!canSendDocuments && canSendAudios ? 'InputAttach.Popover.Music' : 'AttachDocument')}\n                </MenuItem>\n              )}\n            {canSendDocuments && shouldCollectDebugLogs && (\n              <MenuItem icon=\"bug\" onClick={handleSendLogs}>\n                {oldLang('DebugSendLogs')}\n              </MenuItem>\n            )}\n          </>\n        )}\n        {canAttachPolls && !editingMessage && (\n          <MenuItem icon=\"poll\" onClick={onPollCreate}>{oldLang('Poll')}</MenuItem>\n        )}\n\n        {!editingMessage && !canEditMedia && !isScheduled && bots?.map((bot) => (\n          <AttachBotItem\n            bot={bot}\n            chatId={chatId}\n            threadId={threadId}\n            theme={theme}\n            onMenuOpened={markAttachmentBotMenuOpen}\n            onMenuClosed={unmarkAttachmentBotMenuOpen}\n          />\n        ))}\n      </Menu>\n    </div>\n  );\n};\n\nexport default memo(AttachMenu);","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './BotCommandMenu';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst BotCommandMenuAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const BotCommandMenu = useModuleLoader(Bundles.Extra, 'BotCommandMenu', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return BotCommandMenu ? <BotCommandMenu {...props} /> : undefined;\n};\n\nexport default BotCommandMenuAsync;\n","import type { FC, TeactNode } from '../../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { ApiMessage } from '../../../api/types';\n\nimport { selectChatMessage, selectCurrentMessageList } from '../../../global/selectors';\nimport { IS_TOUCH_ENV } from '../../../util/browser/windowEnvironment';\nimport renderKeyboardButtonText from './helpers/renderKeyboardButtonText';\n\nimport useMouseInside from '../../../hooks/useMouseInside';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Button from '../../ui/Button';\nimport Menu from '../../ui/Menu';\n\nimport './BotKeyboardMenu.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  messageId: number;\n  onClose: NoneToVoidFunction;\n};\n\ntype StateProps = {\n  message?: ApiMessage;\n};\n\nconst BotKeyboardMenu: FC<OwnProps & StateProps> = ({\n  isOpen, message, onClose,\n}) => {\n  const { clickBotInlineButton } = getActions();\n\n  const lang = useOldLang();\n\n  const [handleMouseEnter, handleMouseLeave] = useMouseInside(isOpen, onClose);\n  const { isKeyboardSingleUse } = message || {};\n\n  const buttonTexts = useMemo(() => {\n    const texts: TeactNode[][] = [];\n    message?.keyboardButtons!.forEach((row) => {\n      texts.push(row.map((button) => renderKeyboardButtonText(lang, button)));\n    });\n\n    return texts;\n  }, [lang, message?.keyboardButtons]);\n\n  if (!message || !message.keyboardButtons) {\n    return undefined;\n  }\n\n  return (\n    <Menu\n      isOpen={isOpen}\n      autoClose={isKeyboardSingleUse}\n      positionX=\"right\"\n      positionY=\"bottom\"\n      onClose={onClose}\n      className=\"BotKeyboardMenu\"\n      onCloseAnimationEnd={onClose}\n      onMouseEnter={!IS_TOUCH_ENV ? handleMouseEnter : undefined}\n      onMouseLeave={!IS_TOUCH_ENV ? handleMouseLeave : undefined}\n      noCompact\n    >\n      <div className=\"content custom-scroll\">\n        {message.keyboardButtons.map((row, i) => (\n          <div className=\"row\">\n            {row.map((button, j) => (\n              <Button\n                ripple\n                disabled={button.type === 'unsupported'}\n                // eslint-disable-next-line react/jsx-no-bind\n                onClick={() => clickBotInlineButton({ chatId: message.chatId, messageId: message.id, button })}\n              >\n                {buttonTexts?.[i][j]}\n              </Button>\n            ))}\n          </div>\n        ))}\n      </div>\n    </Menu>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { messageId }): StateProps => {\n    const { chatId } = selectCurrentMessageList(global) || {};\n    if (!chatId) {\n      return {};\n    }\n\n    return { message: selectChatMessage(global, chatId, messageId) };\n  },\n)(BotKeyboardMenu));\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useEffect, useRef } from '../../../lib/teact/teact';\n\nimport buildClassName from '../../../util/buildClassName';\nimport renderText from '../../common/helpers/renderText';\n\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\n\ntype OwnProps = {\n  isOpen?: boolean;\n  onClick: VoidFunction;\n  text: string;\n  isDisabled?: boolean;\n};\n\nconst BotMenuButton: FC<OwnProps> = ({\n  isOpen,\n  onClick,\n  text,\n  isDisabled,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const textRef = useRef<HTMLSpanElement>(null);\n\n  useEffect(() => {\n    const textEl = textRef.current;\n    if (!textEl) return;\n\n    const width = textEl.scrollWidth + 1; // Make width slightly bigger prevent ellipsis in some cases\n\n    const composerEl = textEl.closest('.Composer') as HTMLElement;\n    composerEl.style.setProperty('--bot-menu-text-width', `${width}px`);\n  }, [isOpen, text]);\n\n  useEffect(() => {\n    const textEl = textRef.current;\n    if (!textEl) return undefined;\n\n    const composerEl = textEl.closest('.Composer') as HTMLElement;\n\n    return () => {\n      composerEl.style.removeProperty('--bot-menu-text-width');\n    };\n  }, []);\n\n  return (\n    <Button\n      className={buildClassName('composer-action-button bot-menu', isOpen && 'open')}\n      round\n      color=\"translucent\"\n      disabled={isDisabled}\n      onClick={onClick}\n      ariaLabel=\"Open bot command keyboard\"\n    >\n      <Icon name=\"webapp\" className={buildClassName('bot-menu-icon', isOpen && 'open')} />\n      <span ref={textRef} className=\"bot-menu-text\">{renderText(text)}</span>\n    </Button>\n  );\n};\n\nexport default memo(BotMenuButton);\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './ChatCommandTooltip';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst ChatCommandTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const ChatCommandTooltip = useModuleLoader(Bundles.Extra, 'ChatCommandTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return ChatCommandTooltip ? <ChatCommandTooltip {...props} /> : undefined;\n};\n\nexport default ChatCommandTooltipAsync;\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useEffect, useMemo, useRef,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type {\n  ApiChat, ApiInputMessageReplyInfo, ApiMessage, ApiPeer,\n} from '../../../api/types';\nimport type { MessageListType, ThreadId } from '../../../types/index';\n\nimport { isChatChannel, stripCustomEmoji } from '../../../global/helpers';\nimport {\n  selectCanAnimateInterface,\n  selectChat,\n  selectChatMessage,\n  selectDraft,\n  selectEditingId,\n  selectEditingMessage,\n  selectEditingScheduledId,\n  selectForwardedSender,\n  selectIsChatWithSelf,\n  selectIsCurrentUserPremium,\n  selectPeer,\n  selectSender,\n  selectTabState,\n} from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport { getPeerColorClass } from '../../common/helpers/peerColor';\n\nimport useContextMenuHandlers from '../../../hooks/useContextMenuHandlers';\nimport useCurrentOrPrev from '../../../hooks/useCurrentOrPrev';\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useShowTransitionDeprecated from '../../../hooks/useShowTransitionDeprecated';\n\nimport { ClosableEmbeddedMessage } from '../../common/embedded/EmbeddedMessage';\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\nimport Menu from '../../ui/Menu';\nimport MenuItem from '../../ui/MenuItem';\nimport MenuSeparator from '../../ui/MenuSeparator';\n\nimport './ComposerEmbeddedMessage.scss';\n\ntype StateProps = {\n  replyInfo?: ApiInputMessageReplyInfo;\n  editingId?: number;\n  message?: ApiMessage;\n  sender?: ApiPeer;\n  shouldAnimate?: boolean;\n  forwardedMessagesCount?: number;\n  noAuthors?: boolean;\n  noCaptions?: boolean;\n  forwardsHaveCaptions?: boolean;\n  isCurrentUserPremium?: boolean;\n  isContextMenuDisabled?: boolean;\n  isReplyToDiscussion?: boolean;\n  isInChangingRecipientMode?: boolean;\n  shouldPreventComposerAnimation?: boolean;\n  senderChat?: ApiChat;\n  isSenderChannel?: boolean;\n  currentUserId?: string;\n};\n\ntype OwnProps = {\n  onClear?: () => void;\n  shouldForceShowEditing?: boolean;\n  chatId: string;\n  threadId: ThreadId;\n  messageListType: MessageListType;\n};\n\nconst CLOSE_DURATION = 350;\n\nconst ComposerEmbeddedMessage: FC<OwnProps & StateProps> = ({\n  replyInfo,\n  editingId,\n  message,\n  sender,\n  shouldAnimate,\n  forwardedMessagesCount,\n  noAuthors,\n  noCaptions,\n  forwardsHaveCaptions,\n  shouldForceShowEditing,\n  isCurrentUserPremium,\n  isContextMenuDisabled,\n  isReplyToDiscussion,\n  onClear,\n  isInChangingRecipientMode,\n  shouldPreventComposerAnimation,\n  senderChat,\n  chatId,\n  currentUserId,\n  isSenderChannel,\n}) => {\n  const {\n    resetDraftReplyInfo,\n    updateDraftReplyInfo,\n    setEditingId,\n    focusMessage,\n    changeRecipient,\n    openChatOrTopicWithReplyInDraft,\n    setForwardNoAuthors,\n    setForwardNoCaptions,\n    exitForwardMode,\n    setShouldPreventComposerAnimation,\n  } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const oldLang = useOldLang();\n  const lang = useLang();\n\n  const isReplyToTopicStart = message?.content.action?.type === 'topicCreate';\n  const isShowingReply = replyInfo && !shouldForceShowEditing;\n  const isReplyWithQuote = Boolean(replyInfo?.quoteText);\n\n  const isForwarding = Boolean(forwardedMessagesCount);\n\n  const isShown = (() => {\n    if (isInChangingRecipientMode) return false;\n    if (message && (replyInfo || editingId)) return true;\n    if (sender && isForwarding) return true;\n    return false;\n  })();\n\n  const {\n    shouldRender, transitionClassNames,\n  } = useShowTransitionDeprecated(\n    isShown && !isReplyToTopicStart && !isReplyToDiscussion,\n    undefined,\n    !shouldAnimate,\n    undefined,\n    !shouldAnimate,\n    CLOSE_DURATION,\n    !shouldAnimate,\n  );\n  useEffect(() => {\n    if (shouldPreventComposerAnimation) {\n      setShouldPreventComposerAnimation({ shouldPreventComposerAnimation: false });\n    }\n  });\n\n  const clearEmbedded = useLastCallback(() => {\n    if (editingId) {\n      setEditingId({ messageId: undefined });\n    } else if (forwardedMessagesCount) {\n      exitForwardMode();\n    } else if (replyInfo && !shouldForceShowEditing) {\n      resetDraftReplyInfo();\n    }\n    onClear?.();\n  });\n\n  useEffect(() => (isShown ? captureEscKeyListener(clearEmbedded) : undefined), [isShown, clearEmbedded]);\n\n  const {\n    isContextMenuOpen, contextMenuAnchor, handleContextMenu,\n    handleContextMenuClose, handleContextMenuHide,\n  } = useContextMenuHandlers(ref);\n\n  const focusMessageFromDraft = () => {\n    focusMessage({ chatId: message!.chatId, messageId: message!.id, noForumTopicPanel: true });\n  };\n  const handleMessageClick = useLastCallback((e: React.MouseEvent): void => {\n    handleContextMenu(e);\n  });\n\n  const handleClearClick = useLastCallback((e: React.MouseEvent<HTMLButtonElement, MouseEvent>): void => {\n    e.stopPropagation();\n    clearEmbedded();\n    handleContextMenuHide();\n  });\n  const buildAutoCloseMenuItemHandler = (action: NoneToVoidFunction) => {\n    return () => {\n      handleContextMenuClose();\n      action();\n    };\n  };\n  const handleForwardToAnotherChatClick = useLastCallback(buildAutoCloseMenuItemHandler(changeRecipient));\n  const handleShowMessageClick = useLastCallback(buildAutoCloseMenuItemHandler(focusMessageFromDraft));\n  const handleRemoveQuoteClick = useLastCallback(buildAutoCloseMenuItemHandler(\n    () => updateDraftReplyInfo({ quoteText: undefined }),\n  ));\n  const handleChangeReplyRecipientClick = useLastCallback(buildAutoCloseMenuItemHandler(changeRecipient));\n  const handleReplyInSenderChat = useLastCallback(() => {\n    handleContextMenuClose();\n    if (!sender) return;\n    openChatOrTopicWithReplyInDraft({ chatId: sender.id });\n  });\n  const handleDoNotReplyClick = useLastCallback(buildAutoCloseMenuItemHandler(clearEmbedded));\n\n  const getTriggerElement = useLastCallback(() => ref.current);\n  const getRootElement = useLastCallback(() => ref.current!);\n  const getMenuElement = useLastCallback(() => ref.current!.querySelector('.forward-context-menu .bubble'));\n\n  useEffect(() => {\n    if (!shouldRender) {\n      handleContextMenuClose();\n      handleContextMenuHide();\n    }\n  }, [handleContextMenuClose, handleContextMenuHide, shouldRender]);\n\n  const className = buildClassName('ComposerEmbeddedMessage', transitionClassNames);\n  const renderingSender = useCurrentOrPrev(sender, true);\n  const innerClassName = buildClassName(\n    'ComposerEmbeddedMessage_inner',\n    getPeerColorClass(renderingSender),\n  );\n\n  const leftIcon = useMemo(() => {\n    if (editingId) {\n      return 'edit';\n    }\n    if (isForwarding) {\n      return 'forward';\n    }\n    if (isShowingReply) {\n      return 'reply';\n    }\n\n    return undefined;\n  }, [editingId, isForwarding, isShowingReply]);\n\n  const customText = forwardedMessagesCount && forwardedMessagesCount > 1\n    ? oldLang('ForwardedMessageCount', forwardedMessagesCount)\n    : undefined;\n\n  const strippedMessage = useMemo(() => {\n    if (!message || !isForwarding || !message.content.text || !noAuthors || isCurrentUserPremium) return message;\n\n    const strippedText = stripCustomEmoji(message.content.text);\n    return {\n      ...message,\n      content: {\n        ...message.content,\n        text: strippedText,\n      },\n    };\n  }, [isCurrentUserPremium, isForwarding, message, noAuthors]);\n\n  const renderingLeftIcon = useCurrentOrPrev(leftIcon, true);\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const canReplyInSenderChat = sender && !isSenderChannel && chatId !== sender.id && sender.id !== currentUserId;\n\n  return (\n    <div className={className} ref={ref} onContextMenu={handleContextMenu}>\n      <div className={innerClassName}>\n        <div className=\"embedded-left-icon\" onClick={handleContextMenu}>\n          {renderingLeftIcon && <Icon name={renderingLeftIcon} />}\n          {Boolean(replyInfo?.quoteText) && (\n            <Icon name=\"quote\" className=\"quote-reply\" />\n          )}\n        </div>\n        <ClosableEmbeddedMessage\n          isOpen={isShown}\n          className=\"inside-input\"\n          replyInfo={replyInfo}\n          isInComposer\n          message={strippedMessage}\n          sender={!noAuthors ? sender : undefined}\n          customText={customText}\n          title={(editingId && !isShowingReply) ? oldLang('EditMessage')\n            : noAuthors ? oldLang('HiddenSendersNameDescription') : undefined}\n          onClick={handleMessageClick}\n          senderChat={senderChat}\n        />\n        <Button\n          className=\"embedded-cancel\"\n          round\n          faded\n          color=\"translucent\"\n          ariaLabel={oldLang('Cancel')}\n          onClick={handleClearClick}\n        >\n          <Icon name=\"close\" />\n        </Button>\n        {(isShowingReply || isForwarding) && !isContextMenuDisabled && (\n          <Menu\n            isOpen={isContextMenuOpen}\n            anchor={contextMenuAnchor}\n            getTriggerElement={getTriggerElement}\n            getRootElement={getRootElement}\n            getMenuElement={getMenuElement}\n            className=\"forward-context-menu\"\n            onClose={handleContextMenuClose}\n            onCloseAnimationEnd={handleContextMenuHide}\n          >\n            {isForwarding && (\n              <>\n                <MenuItem\n                  icon={!noAuthors ? 'message-succeeded' : undefined}\n                  customIcon={noAuthors ? <Icon name=\"placeholder\" /> : undefined}\n                  // eslint-disable-next-line react/jsx-no-bind\n                  onClick={() => setForwardNoAuthors({\n                    noAuthors: false,\n                  })}\n                >\n                  {oldLang(forwardedMessagesCount > 1 ? 'ShowSenderNames' : 'ShowSendersName')}\n                </MenuItem>\n                <MenuItem\n                  icon={noAuthors ? 'message-succeeded' : undefined}\n                  customIcon={!noAuthors ? <Icon name=\"placeholder\" /> : undefined}\n                  // eslint-disable-next-line react/jsx-no-bind\n                  onClick={() => setForwardNoAuthors({\n                    noAuthors: true,\n                  })}\n                >\n                  {oldLang(forwardedMessagesCount > 1 ? 'HideSenderNames' : 'HideSendersName')}\n                </MenuItem>\n                {forwardsHaveCaptions && (\n                  <>\n                    <MenuSeparator />\n                    <MenuItem\n                      icon={!noCaptions ? 'message-succeeded' : undefined}\n                      customIcon={noCaptions ? <Icon name=\"placeholder\" /> : undefined}\n                      // eslint-disable-next-line react/jsx-no-bind\n                      onClick={() => setForwardNoCaptions({\n                        noCaptions: false,\n                      })}\n                    >\n                      {oldLang(forwardedMessagesCount > 1 ? 'Conversation.ForwardOptions.ShowCaption' : 'ShowCaption')}\n                    </MenuItem>\n                    <MenuItem\n                      icon={noCaptions ? 'message-succeeded' : undefined}\n                      customIcon={!noCaptions ? <Icon name=\"placeholder\" /> : undefined}\n                      // eslint-disable-next-line react/jsx-no-bind\n                      onClick={() => setForwardNoCaptions({\n                        noCaptions: true,\n                      })}\n                    >\n                      {oldLang(forwardedMessagesCount > 1 ? 'Conversation.ForwardOptions.HideCaption' : 'HideCaption')}\n                    </MenuItem>\n                  </>\n                )}\n                <MenuSeparator />\n                <MenuItem icon=\"replace\" onClick={handleForwardToAnotherChatClick}>\n                  {oldLang('ForwardAnotherChat')}\n                </MenuItem>\n              </>\n            )}\n            {isShowingReply && (\n              <>\n                <MenuItem\n                  icon=\"show-message\"\n                  onClick={handleShowMessageClick}\n                >\n                  {oldLang('Message.Context.Goto')}\n                </MenuItem>\n                {isReplyWithQuote && (\n                  <MenuItem\n                    icon=\"remove-quote\"\n                    onClick={handleRemoveQuoteClick}\n                  >\n                    {oldLang('RemoveQuote')}\n                  </MenuItem>\n                )}\n                {canReplyInSenderChat && (\n                  <MenuItem icon=\"user\" onClick={handleReplyInSenderChat}>\n                    {lang('ReplyInPrivateMessage')}\n                  </MenuItem>\n                )}\n                <MenuItem icon=\"replace\" onClick={handleChangeReplyRecipientClick}>\n                  {oldLang('ReplyToAnotherChat')}\n                </MenuItem>\n                <MenuItem icon=\"delete\" onClick={handleDoNotReplyClick}>\n                  {oldLang('DoNotReply')}\n                </MenuItem>\n              </>\n            )}\n          </Menu>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, {\n    shouldForceShowEditing, chatId, threadId, messageListType,\n  }): StateProps => {\n    const {\n      forwardMessages: {\n        fromChatId, toChatId, messageIds: forwardMessageIds, noAuthors, noCaptions,\n      },\n      isShareMessageModalShown: isModalShown,\n      shouldPreventComposerAnimation,\n    } = selectTabState(global);\n\n    const editingId = messageListType === 'scheduled'\n      ? selectEditingScheduledId(global, chatId)\n      : selectEditingId(global, chatId, threadId);\n    const shouldAnimate = selectCanAnimateInterface(global) && !shouldPreventComposerAnimation;\n    const isForwarding = toChatId === chatId;\n    const forwardedMessages = forwardMessageIds?.map((id) => selectChatMessage(global, fromChatId!, id)!);\n\n    const draft = selectDraft(global, chatId, threadId);\n    const replyInfo = draft?.replyInfo;\n    const replyToPeerId = replyInfo?.replyToPeerId;\n    const senderChat = replyToPeerId ? selectChat(global, replyToPeerId) : undefined;\n\n    let message: ApiMessage | undefined;\n    if (editingId) {\n      message = selectEditingMessage(global, chatId, threadId, messageListType);\n    } else if (isForwarding && forwardMessageIds!.length === 1) {\n      message = forwardedMessages?.[0];\n    } else if (replyInfo && !shouldForceShowEditing) {\n      message = selectChatMessage(global, replyInfo.replyToPeerId || chatId, replyInfo.replyToMsgId);\n    }\n\n    let sender: ApiPeer | undefined;\n\n    if (editingId && message) {\n      sender = selectSender(global, message);\n    } else if (isForwarding) {\n      if (message) {\n        sender = selectForwardedSender(global, message);\n        if (!sender) {\n          sender = selectSender(global, message);\n        }\n      }\n      if (!sender) {\n        sender = selectPeer(global, fromChatId!);\n      }\n    } else if (replyInfo && message && !shouldForceShowEditing) {\n      const { forwardInfo } = message;\n      const isChatWithSelf = selectIsChatWithSelf(global, chatId);\n      if (forwardInfo && (forwardInfo.isChannelPost || isChatWithSelf)) {\n        sender = selectForwardedSender(global, message);\n      }\n\n      if (!sender && (!forwardInfo?.hiddenUserName || Boolean(replyInfo.quoteText))) {\n        sender = selectSender(global, message);\n      }\n    }\n\n    const chat = sender && selectChat(global, sender.id);\n    const isSenderChannel = chat && isChatChannel(chat);\n\n    const forwardsHaveCaptions = forwardedMessages?.some((forward) => (\n      forward?.content.text && Object.keys(forward.content).length > 1\n    ));\n\n    const isContextMenuDisabled = isForwarding && forwardMessageIds!.length === 1\n      && Boolean(message?.content.storyData);\n\n    const isReplyToDiscussion = replyInfo?.replyToMsgId === threadId && !replyInfo.replyToPeerId;\n\n    return {\n      replyInfo,\n      editingId,\n      message,\n      sender,\n      shouldAnimate,\n      forwardedMessagesCount: isForwarding ? forwardMessageIds!.length : undefined,\n      noAuthors,\n      noCaptions,\n      forwardsHaveCaptions,\n      isCurrentUserPremium: selectIsCurrentUserPremium(global),\n      isContextMenuDisabled,\n      isReplyToDiscussion,\n      isInChangingRecipientMode: isModalShown,\n      shouldPreventComposerAnimation,\n      senderChat,\n      currentUserId: global.currentUserId,\n      isSenderChannel,\n    };\n  },\n)(ComposerEmbeddedMessage));\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './DropArea';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst DropAreaAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const DropArea = useModuleLoader(Bundles.Extra, 'DropArea', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return DropArea ? <DropArea {...props} /> : undefined;\n};\n\nexport default DropAreaAsync;\nexport { DropAreaState } from './DropArea';\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './InlineBotTooltip';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst InlineBotTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const InlineBotTooltip = useModuleLoader(Bundles.Extra, 'InlineBotTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return InlineBotTooltip ? <InlineBotTooltip {...props} /> : undefined;\n};\n\nexport default InlineBotTooltipAsync;\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './MentionTooltip';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst MentionTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const MentionTooltip = useModuleLoader(Bundles.Extra, 'MentionTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return MentionTooltip ? <MentionTooltip {...props} /> : undefined;\n};\n\nexport default MentionTooltipAsync;\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './PollModal';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst PollModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const PollModal = useModuleLoader(Bundles.Extra, 'PollModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return PollModal ? <PollModal {...props} /> : undefined;\n};\n\nexport default PollModalAsync;\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './SendAsMenu';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst SendAsMenuAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const SendAsMenu = useModuleLoader(Bundles.Extra, 'SendAsMenu', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return SendAsMenu ? <SendAsMenu {...props} /> : undefined;\n};\n\nexport default SendAsMenuAsync;\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './StickerTooltip';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst StickerTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const StickerTooltip = useModuleLoader(Bundles.Extra, 'StickerTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return StickerTooltip ? <StickerTooltip {...props} /> : undefined;\n};\n\nexport default StickerTooltipAsync;\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useEffect, useRef } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type {\n  ApiFormattedText, ApiMessage, ApiMessageEntityTextUrl, ApiWebPage,\n} from '../../../api/types';\nimport type { GlobalState } from '../../../global/types';\nimport type { ThemeKey, ThreadId, WebPageMediaSize } from '../../../types';\nimport type { Signal } from '../../../util/signals';\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport { RE_LINK_TEMPLATE } from '../../../config';\nimport { selectNoWebPage, selectTabState, selectTheme } from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport parseHtmlAsFormattedText from '../../../util/parseHtmlAsFormattedText';\n\nimport { useDebouncedResolver } from '../../../hooks/useAsyncResolvers';\nimport useContextMenuHandlers from '../../../hooks/useContextMenuHandlers';\nimport useCurrentOrPrev from '../../../hooks/useCurrentOrPrev';\nimport useDerivedSignal from '../../../hooks/useDerivedSignal';\nimport useDerivedState from '../../../hooks/useDerivedState';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useShowTransitionDeprecated from '../../../hooks/useShowTransitionDeprecated';\nimport useSyncEffect from '../../../hooks/useSyncEffect';\n\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\nimport Menu from '../../ui/Menu';\nimport MenuItem from '../../ui/MenuItem';\nimport WebPage from '../message/WebPage';\n\nimport './WebPagePreview.scss';\n\ntype OwnProps = {\n  chatId: string;\n  threadId: ThreadId;\n  getHtml: Signal<string>;\n  isEditing: boolean;\n  isDisabled?: boolean;\n};\n\ntype StateProps = {\n  webPagePreview?: ApiWebPage;\n  noWebPage?: boolean;\n  theme: ThemeKey;\n  attachmentSettings: GlobalState['attachmentSettings'];\n};\n\nconst DEBOUNCE_MS = 300;\nconst RE_LINK = new RegExp(RE_LINK_TEMPLATE, 'i');\n\nconst WebPagePreview: FC<OwnProps & StateProps> = ({\n  chatId,\n  threadId,\n  getHtml,\n  isDisabled,\n  webPagePreview,\n  noWebPage,\n  theme,\n  attachmentSettings,\n  isEditing,\n}) => {\n  const {\n    loadWebPagePreview,\n    clearWebPagePreview,\n    toggleMessageWebPage,\n    updateAttachmentSettings,\n  } = getActions();\n\n  const lang = useOldLang();\n\n  const formattedTextWithLinkRef = useRef<ApiFormattedText>();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const isInvertedMedia = attachmentSettings.isInvertedMedia;\n  const isSmallerMedia = attachmentSettings.webPageMediaSize === 'small';\n\n  const detectLinkDebounced = useDebouncedResolver(() => {\n    const formattedText = parseHtmlAsFormattedText(getHtml());\n    const linkEntity = formattedText.entities?.find((entity): entity is ApiMessageEntityTextUrl => (\n      entity.type === ApiMessageEntityTypes.TextUrl\n    ));\n\n    formattedTextWithLinkRef.current = formattedText;\n\n    return linkEntity?.url || formattedText.text.match(RE_LINK)?.[0];\n  }, [getHtml], DEBOUNCE_MS, true);\n\n  const getLink = useDerivedSignal(detectLinkDebounced, [detectLinkDebounced, getHtml], true);\n\n  useEffect(() => {\n    const link = getLink();\n    const formattedText = formattedTextWithLinkRef.current;\n\n    if (link) {\n      loadWebPagePreview({ text: formattedText! });\n    } else {\n      clearWebPagePreview();\n      toggleMessageWebPage({ chatId, threadId });\n    }\n  }, [getLink, chatId, threadId]);\n\n  useSyncEffect(() => {\n    clearWebPagePreview();\n    toggleMessageWebPage({ chatId, threadId });\n  }, [chatId, clearWebPagePreview, threadId, toggleMessageWebPage]);\n\n  const isShown = useDerivedState(() => {\n    return Boolean(webPagePreview && getHtml() && !noWebPage && !isDisabled);\n  }, [isDisabled, getHtml, noWebPage, webPagePreview]);\n  const { shouldRender, transitionClassNames } = useShowTransitionDeprecated(isShown);\n\n  const hasMediaSizeOptions = webPagePreview?.hasLargeMedia;\n\n  const renderingWebPage = useCurrentOrPrev(webPagePreview, true);\n\n  const handleClearWebpagePreview = useLastCallback(() => {\n    toggleMessageWebPage({ chatId, threadId, noWebPage: true });\n  });\n\n  const {\n    isContextMenuOpen, contextMenuAnchor, handleContextMenu,\n    handleContextMenuClose, handleContextMenuHide,\n  } = useContextMenuHandlers(ref, isEditing, true);\n\n  const getTriggerElement = useLastCallback(() => ref.current);\n  const getRootElement = useLastCallback(() => ref.current!);\n  const getMenuElement = useLastCallback(\n    () => ref.current!.querySelector('.web-page-preview-context-menu .bubble'),\n  );\n\n  const handlePreviewClick = useLastCallback((e: React.MouseEvent): void => {\n    handleContextMenu(e);\n  });\n\n  useEffect(() => {\n    if (!shouldRender || !renderingWebPage) {\n      handleContextMenuClose();\n      handleContextMenuHide();\n    }\n  }, [handleContextMenuClose, handleContextMenuHide, shouldRender, renderingWebPage]);\n\n  function updateIsInvertedMedia(value?: true) {\n    updateAttachmentSettings({ isInvertedMedia: value });\n  }\n\n  function updateIsLargerMedia(value?: WebPageMediaSize) {\n    updateAttachmentSettings({ webPageMediaSize: value });\n  }\n\n  if (!shouldRender || !renderingWebPage) {\n    return undefined;\n  }\n\n  // TODO Refactor so `WebPage` can be used without message\n  const { photo, ...webPageWithoutPhoto } = renderingWebPage;\n  const messageStub = {\n    content: {\n      webPage: webPageWithoutPhoto,\n    },\n  } as ApiMessage;\n\n  function renderContextMenu() {\n    return (\n      <Menu\n        isOpen={isContextMenuOpen}\n        anchor={contextMenuAnchor}\n        getTriggerElement={getTriggerElement}\n        getRootElement={getRootElement}\n        getMenuElement={getMenuElement}\n        className=\"web-page-preview-context-menu\"\n        onClose={handleContextMenuClose}\n        onCloseAnimationEnd={handleContextMenuHide}\n        autoClose\n      >\n        <>\n          {\n            isInvertedMedia ? (\n              // eslint-disable-next-line react/jsx-no-bind\n              <MenuItem icon=\"move-caption-up\" onClick={() => updateIsInvertedMedia(undefined)}>\n                {lang('PreviewSender.MoveTextUp')}\n              </MenuItem>\n            ) : (\n            // eslint-disable-next-line react/jsx-no-bind\n              <MenuItem icon=\"move-caption-down\" onClick={() => updateIsInvertedMedia(true)}>\n                {lang(('PreviewSender.MoveTextDown'))}\n              </MenuItem>\n            )\n          }\n          {hasMediaSizeOptions && (\n            isSmallerMedia ? (\n            // eslint-disable-next-line react/jsx-no-bind\n              <MenuItem icon=\"expand\" onClick={() => updateIsLargerMedia('large')}>\n                {lang('ChatInput.EditLink.LargerMedia')}\n              </MenuItem>\n            ) : (\n            // eslint-disable-next-line react/jsx-no-bind\n              <MenuItem icon=\"collapse\" onClick={() => updateIsLargerMedia('small')}>\n                {lang(('ChatInput.EditLink.SmallerMedia'))}\n              </MenuItem>\n            )\n          )}\n          <MenuItem\n            icon=\"delete\"\n            // eslint-disable-next-line react/jsx-no-bind\n            onClick={handleClearWebpagePreview}\n          >\n            {lang('ChatInput.EditLink.RemovePreview')}\n          </MenuItem>\n        </>\n      </Menu>\n    );\n  }\n\n  return (\n    <div className={buildClassName('WebPagePreview', transitionClassNames)} ref={ref}>\n      <div className=\"WebPagePreview_inner\">\n        <div className=\"WebPagePreview-left-icon\" onClick={handlePreviewClick}>\n          <Icon name=\"link\" />\n        </div>\n        <WebPage\n          message={messageStub}\n          inPreview\n          theme={theme}\n          onContainerClick={handlePreviewClick}\n          isEditing={isEditing}\n        />\n        <Button\n          className=\"WebPagePreview-clear\"\n          round\n          faded\n          color=\"translucent\"\n          ariaLabel=\"Clear Webpage Preview\"\n          onClick={handleClearWebpagePreview}\n        >\n          <Icon name=\"close\" />\n        </Button>\n        {!isEditing && renderContextMenu()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId, threadId }): StateProps => {\n    const noWebPage = selectNoWebPage(global, chatId, threadId);\n    const {\n      attachmentSettings,\n    } = global;\n    return {\n      theme: selectTheme(global),\n      webPagePreview: selectTabState(global).webPagePreview,\n      noWebPage,\n      attachmentSettings,\n    };\n  },\n)(WebPagePreview));\n","import type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, {\n  memo, useEffect, useMemo, useRef, useSignal, useState,\n} from '../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../global';\n\nimport type {\n  ApiAttachment,\n  ApiAttachMenuPeerType,\n  ApiAvailableEffect,\n  ApiAvailableReaction,\n  ApiBotCommand,\n  ApiBotInlineMediaResult,\n  ApiBotInlineResult,\n  ApiBotMenuButton,\n  ApiChat,\n  ApiChatFullInfo,\n  ApiDisallowedGifts,\n  ApiDraft,\n  ApiFormattedText,\n  ApiMessage,\n  ApiMessageEntity,\n  ApiNewPoll,\n  ApiQuickReply,\n  ApiReaction,\n  ApiStealthMode,\n  ApiSticker,\n  ApiTopic,\n  ApiUser,\n  ApiVideo,\n  ApiWebPage,\n} from '../../api/types';\nimport type {\n  GlobalState, TabState,\n} from '../../global/types';\nimport type {\n  IAnchorPosition,\n  InlineBotSettings,\n  MessageList,\n  MessageListType,\n  ThemeKey,\n  ThreadId,\n} from '../../types';\nimport { MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  BASE_EMOJI_KEYWORD_LANG,\n  DEFAULT_MAX_MESSAGE_LENGTH,\n  EDITABLE_INPUT_MODAL_ID,\n  HEART_REACTION,\n  MAX_UPLOAD_FILEPART_SIZE,\n  ONE_TIME_MEDIA_TTL_SECONDS,\n  SCHEDULED_WHEN_ONLINE,\n  SEND_MESSAGE_ACTION_INTERVAL,\n  SERVICE_NOTIFICATIONS_USER_ID,\n} from '../../config';\nimport { requestMeasure, requestNextMutation } from '../../lib/fasterdom/fasterdom';\nimport {\n  canEditMedia,\n  getAllowedAttachmentOptions,\n  getReactionKey,\n  getStoryKey,\n  isChatAdmin,\n  isChatChannel,\n  isChatSuperGroup,\n  isSameReaction,\n  isSystemBot,\n  isUserId,\n} from '../../global/helpers';\nimport { getChatNotifySettings } from '../../global/helpers/notifications';\nimport { getPeerTitle } from '../../global/helpers/peers';\nimport {\n  selectBot,\n  selectCanPlayAnimatedEmojis,\n  selectCanScheduleUntilOnline,\n  selectChat,\n  selectChatFullInfo,\n  selectChatMessage,\n  selectChatType,\n  selectCurrentMessageList,\n  selectDraft,\n  selectEditingDraft,\n  selectEditingMessage,\n  selectEditingScheduledDraft,\n  selectIsChatWithSelf,\n  selectIsCurrentUserFrozen,\n  selectIsCurrentUserPremium,\n  selectIsInSelectMode,\n  selectIsPremiumPurchaseBlocked,\n  selectIsReactionPickerOpen,\n  selectIsRightColumnShown,\n  selectNewestMessageWithBotKeyboardButtons,\n  selectNotifyDefaults,\n  selectNotifyException,\n  selectNoWebPage,\n  selectPeerPaidMessagesStars,\n  selectPeerStory,\n  selectPerformanceSettingsValue,\n  selectRequestedDraft,\n  selectRequestedDraftFiles,\n  selectTabState,\n  selectTheme,\n  selectTopicFromMessage,\n  selectUser,\n  selectUserFullInfo,\n} from '../../global/selectors';\nimport { selectCurrentLimit } from '../../global/selectors/limits';\nimport { selectSharedSettings } from '../../global/selectors/sharedState';\nimport { IS_IOS, IS_VOICE_RECORDING_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport buildClassName from '../../util/buildClassName';\nimport { formatMediaDuration, formatVoiceRecordDuration } from '../../util/dates/dateFormat';\nimport { processDeepLink } from '../../util/deeplink';\nimport { tryParseDeepLink } from '../../util/deepLinkParser';\nimport deleteLastCharacterOutsideSelection from '../../util/deleteLastCharacterOutsideSelection';\nimport { processMessageInputForCustomEmoji } from '../../util/emoji/customEmojiManager';\nimport focusEditableElement from '../../util/focusEditableElement';\nimport { formatStarsAsIcon } from '../../util/localization/format';\nimport { MEMO_EMPTY_ARRAY } from '../../util/memo';\nimport parseHtmlAsFormattedText from '../../util/parseHtmlAsFormattedText';\nimport { insertHtmlInSelection } from '../../util/selection';\nimport { getServerTime } from '../../util/serverTime';\nimport windowSize from '../../util/windowSize';\nimport { callApi } from '../../api/gramjs';\nimport InputTranslate from '../chatAssistant/component/input-translate/input-translate';\nimport RoomStorage from '../chatAssistant/room-storage';\nimport applyIosAutoCapitalizationFix from '../middle/composer/helpers/applyIosAutoCapitalizationFix';\nimport buildAttachment, { prepareAttachmentsToSend } from '../middle/composer/helpers/buildAttachment';\nimport { buildCustomEmojiHtml } from '../middle/composer/helpers/customEmoji';\nimport { isSelectionInsideInput } from '../middle/composer/helpers/selection';\nimport { getPeerColorClass } from './helpers/peerColor';\nimport renderText from './helpers/renderText';\nimport { getTextWithEntitiesAsHtml } from './helpers/renderTextWithEntities';\n\nimport useInterval from '../../hooks/schedulers/useInterval';\nimport useTimeout from '../../hooks/schedulers/useTimeout';\nimport useContextMenuHandlers from '../../hooks/useContextMenuHandlers';\nimport useDerivedState from '../../hooks/useDerivedState';\nimport useEffectWithPrevDeps from '../../hooks/useEffectWithPrevDeps';\nimport useFlag from '../../hooks/useFlag';\nimport useGetSelectionRange from '../../hooks/useGetSelectionRange';\nimport useLang from '../../hooks/useLang';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\nimport usePreviousDeprecated from '../../hooks/usePreviousDeprecated';\nimport useSchedule from '../../hooks/useSchedule';\nimport useSendMessageAction from '../../hooks/useSendMessageAction';\nimport useShowTransitionDeprecated from '../../hooks/useShowTransitionDeprecated';\nimport { useStateRef } from '../../hooks/useStateRef';\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useAttachmentModal from '../middle/composer/hooks/useAttachmentModal';\nimport useChatCommandTooltip from '../middle/composer/hooks/useChatCommandTooltip';\nimport useClipboardPaste from '../middle/composer/hooks/useClipboardPaste';\nimport useCustomEmojiTooltip from '../middle/composer/hooks/useCustomEmojiTooltip';\nimport useDraft from '../middle/composer/hooks/useDraft';\nimport useEditing from '../middle/composer/hooks/useEditing';\nimport useEmojiTooltip from '../middle/composer/hooks/useEmojiTooltip';\nimport useInlineBotTooltip from '../middle/composer/hooks/useInlineBotTooltip';\nimport useMentionTooltip from '../middle/composer/hooks/useMentionTooltip';\nimport usePaidMessageConfirmation from '../middle/composer/hooks/usePaidMessageConfirmation';\nimport useStickerTooltip from '../middle/composer/hooks/useStickerTooltip';\nimport useVoiceRecording from '../middle/composer/hooks/useVoiceRecording';\n\nimport GrammarToolWrapper from '../chatAssistant/component/input-grammar/GrammarToolWrapper';\nimport eventEmitter from '../chatAssistant/lib/EventEmitter';\nimport AttachmentModal from '../middle/composer/AttachmentModal.async';\nimport AttachMenu from '../middle/composer/AttachMenu';\nimport BotCommandMenu from '../middle/composer/BotCommandMenu.async';\nimport BotKeyboardMenu from '../middle/composer/BotKeyboardMenu';\nimport BotMenuButton from '../middle/composer/BotMenuButton';\nimport ChatCommandTooltip from '../middle/composer/ChatCommandTooltip.async';\nimport ComposerEmbeddedMessage from '../middle/composer/ComposerEmbeddedMessage';\nimport CustomEmojiTooltip from '../middle/composer/CustomEmojiTooltip.async';\nimport CustomSendMenu from '../middle/composer/CustomSendMenu.async';\nimport DropArea, { DropAreaState } from '../middle/composer/DropArea.async';\nimport EmojiTooltip from '../middle/composer/EmojiTooltip.async';\nimport InlineBotTooltip from '../middle/composer/InlineBotTooltip.async';\nimport MentionTooltip from '../middle/composer/MentionTooltip.async';\nimport MessageInput from '../middle/composer/MessageInput';\nimport PollModal from '../middle/composer/PollModal.async';\nimport SendAsMenu from '../middle/composer/SendAsMenu.async';\nimport StickerTooltip from '../middle/composer/StickerTooltip.async';\nimport SymbolMenuButton from '../middle/composer/SymbolMenuButton';\nimport WebPagePreview from '../middle/composer/WebPagePreview';\nimport MessageEffect from '../middle/message/MessageEffect';\nimport ReactionSelector from '../middle/message/reactions/ReactionSelector';\nimport Button from '../ui/Button';\nimport ResponsiveHoverButton from '../ui/ResponsiveHoverButton';\nimport Spinner from '../ui/Spinner';\nimport Transition from '../ui/Transition';\nimport AnimatedCounter from './AnimatedCounter';\nimport Avatar from './Avatar';\nimport Icon from './icons/Icon';\nimport PaymentMessageConfirmDialog from './PaymentMessageConfirmDialog';\nimport ReactionAnimatedEmoji from './reactions/ReactionAnimatedEmoji';\n\nimport './Composer.scss';\n\ntype ComposerType = 'messageList' | 'story';\n\ntype OwnProps = {\n  type: ComposerType;\n  chatId: string;\n  threadId: ThreadId;\n  storyId?: number;\n  messageListType: MessageListType;\n  dropAreaState?: string;\n  isReady: boolean;\n  isMobile?: boolean;\n  inputId: string;\n  editableInputCssSelector: string;\n  editableInputId: string;\n  className?: string;\n  inputPlaceholder?: TeactNode | string;\n  onDropHide?: NoneToVoidFunction;\n  onForward?: NoneToVoidFunction;\n  onFocus?: NoneToVoidFunction;\n  onBlur?: NoneToVoidFunction;\n};\n\ntype StateProps =\n  {\n    isOnActiveTab: boolean;\n    editingMessage?: ApiMessage;\n    chat?: ApiChat;\n    chatFullInfo?: ApiChatFullInfo;\n    draft?: ApiDraft;\n    replyToTopic?: ApiTopic;\n    currentMessageList?: MessageList;\n    isChatWithBot?: boolean;\n    isChatWithSelf?: boolean;\n    isChannel?: boolean;\n    isForCurrentMessageList: boolean;\n    isRightColumnShown?: boolean;\n    isSelectModeActive?: boolean;\n    isReactionPickerOpen?: boolean;\n    shouldDisplayGiftsButton?: boolean;\n    isForwarding?: boolean;\n    forwardedMessagesCount?: number;\n    pollModal: TabState['pollModal'];\n    botKeyboardMessageId?: number;\n    botKeyboardPlaceholder?: string;\n    withScheduledButton?: boolean;\n    isInScheduledList?: boolean;\n    canScheduleUntilOnline?: boolean;\n    stickersForEmoji?: ApiSticker[];\n    customEmojiForEmoji?: ApiSticker[];\n    currentUserId?: string;\n    currentUser?: ApiUser;\n    recentEmojis: string[];\n    contentToBeScheduled?: TabState['contentToBeScheduled'];\n    shouldSuggestStickers?: boolean;\n    shouldSuggestCustomEmoji?: boolean;\n    baseEmojiKeywords?: Record<string, string[]>;\n    emojiKeywords?: Record<string, string[]>;\n    topInlineBotIds?: string[];\n    isInlineBotLoading: boolean;\n    inlineBots?: Record<string, false | InlineBotSettings>;\n    botCommands?: ApiBotCommand[] | false;\n    botMenuButton?: ApiBotMenuButton;\n    sendAsUser?: ApiUser;\n    sendAsChat?: ApiChat;\n    sendAsId?: string;\n    editingDraft?: ApiFormattedText;\n    requestedDraft?: ApiFormattedText;\n    requestedDraftFiles?: File[];\n    attachBots: GlobalState['attachMenu']['bots'];\n    attachMenuPeerType?: ApiAttachMenuPeerType;\n    theme: ThemeKey;\n    fileSizeLimit: number;\n    captionLimit: number;\n    isCurrentUserPremium?: boolean;\n    canSendVoiceByPrivacy?: boolean;\n    attachmentSettings: GlobalState['attachmentSettings'];\n    slowMode?: ApiChatFullInfo['slowMode'];\n    shouldUpdateStickerSetOrder?: boolean;\n    availableReactions?: ApiAvailableReaction[];\n    topReactions?: ApiReaction[];\n    canPlayAnimatedEmojis?: boolean;\n    canBuyPremium?: boolean;\n    shouldCollectDebugLogs?: boolean;\n    sentStoryReaction?: ApiReaction;\n    stealthMode?: ApiStealthMode;\n    canSendOneTimeMedia?: boolean;\n    quickReplyMessages?: Record<number, ApiMessage>;\n    quickReplies?: Record<number, ApiQuickReply>;\n    canSendQuickReplies?: boolean;\n    webPagePreview?: ApiWebPage;\n    noWebPage?: boolean;\n    isContactRequirePremium?: boolean;\n    paidMessagesStars?: number;\n    effect?: ApiAvailableEffect;\n    effectReactions?: ApiReaction[];\n    areEffectsSupported?: boolean;\n    canPlayEffect?: boolean;\n    shouldPlayEffect?: boolean;\n    maxMessageLength: number;\n    shouldPaidMessageAutoApprove?: boolean;\n    isSilentPosting?: boolean;\n    isPaymentMessageConfirmDialogOpen: boolean;\n    starsBalance: number;\n    isStarsBalanceModalOpen: boolean;\n    disallowedGifts?: ApiDisallowedGifts;\n    isAccountFrozen?: boolean;\n    isAppConfigLoaded?: boolean;\n  };\n\nenum MainButtonState {\n  Send = 'send',\n  Record = 'record',\n  Edit = 'edit',\n  Schedule = 'schedule',\n  Forward = 'forward',\n  SendOneTime = 'sendOneTime',\n}\n\ntype ScheduledMessageArgs = TabState['contentToBeScheduled'] | {\n  id: string; queryId: string; isSilent?: boolean;\n};\n\nconst VOICE_RECORDING_FILENAME = 'wonderful-voice-message.ogg';\n// When voice recording is active, composer placeholder will hide to prevent overlapping\nconst SCREEN_WIDTH_TO_HIDE_PLACEHOLDER = 600; // px\n\nconst MOBILE_KEYBOARD_HIDE_DELAY_MS = 100;\nconst SELECT_MODE_TRANSITION_MS = 200;\nconst SENDING_ANIMATION_DURATION = 350;\nconst MOUNT_ANIMATION_DURATION = 430;\n\nconst Composer: FC<OwnProps & StateProps> = ({\n  type,\n  isOnActiveTab,\n  dropAreaState,\n  isInScheduledList,\n  canScheduleUntilOnline,\n  isReady,\n  isMobile,\n  editingMessage,\n  chatId,\n  threadId,\n  storyId,\n  currentMessageList,\n  messageListType,\n  draft,\n  chat,\n  chatFullInfo,\n  replyToTopic,\n  isForCurrentMessageList,\n  isCurrentUserPremium,\n  canSendVoiceByPrivacy,\n  isChatWithBot,\n  isChatWithSelf,\n  isChannel,\n  fileSizeLimit,\n  isRightColumnShown,\n  isSelectModeActive,\n  isReactionPickerOpen,\n  shouldDisplayGiftsButton,\n  isForwarding,\n  forwardedMessagesCount,\n  pollModal,\n  botKeyboardMessageId,\n  botKeyboardPlaceholder,\n  inputPlaceholder,\n  withScheduledButton,\n  stickersForEmoji,\n  customEmojiForEmoji,\n  topInlineBotIds,\n  currentUserId,\n  currentUser,\n  captionLimit,\n  contentToBeScheduled,\n  shouldSuggestStickers,\n  shouldSuggestCustomEmoji,\n  baseEmojiKeywords,\n  emojiKeywords,\n  recentEmojis,\n  inlineBots,\n  isInlineBotLoading,\n  botCommands,\n  sendAsUser,\n  sendAsChat,\n  sendAsId,\n  editingDraft,\n  requestedDraft,\n  requestedDraftFiles,\n  botMenuButton,\n  attachBots,\n  attachMenuPeerType,\n  attachmentSettings,\n  theme,\n  slowMode,\n  shouldUpdateStickerSetOrder,\n  editableInputCssSelector,\n  editableInputId,\n  inputId,\n  className,\n  availableReactions,\n  topReactions,\n  canBuyPremium,\n  canPlayAnimatedEmojis,\n  shouldCollectDebugLogs,\n  sentStoryReaction,\n  stealthMode,\n  canSendOneTimeMedia,\n  quickReplyMessages,\n  quickReplies,\n  canSendQuickReplies,\n  webPagePreview,\n  noWebPage,\n  isContactRequirePremium,\n  paidMessagesStars,\n  effect,\n  effectReactions,\n  areEffectsSupported,\n  canPlayEffect,\n  shouldPlayEffect,\n  maxMessageLength,\n  isSilentPosting,\n  onDropHide,\n  onFocus,\n  onBlur,\n  onForward,\n  isPaymentMessageConfirmDialogOpen,\n  starsBalance,\n  isStarsBalanceModalOpen,\n  disallowedGifts,\n  isAccountFrozen,\n  isAppConfigLoaded,\n}) => {\n  const {\n    sendMessage,\n    clearDraft,\n    showDialog,\n    openPollModal,\n    closePollModal,\n    loadScheduledHistory,\n    openThread,\n    addRecentEmoji,\n    sendInlineBotResult,\n    loadSendAs,\n    resetOpenChatWithDraft,\n    callAttachBot,\n    addRecentCustomEmoji,\n    showNotification,\n    showAllowedMessageTypesNotification,\n    openStoryReactionPicker,\n    openGiftModal,\n    closeReactionPicker,\n    sendStoryReaction,\n    editMessage,\n    updateAttachmentSettings,\n    saveEffectInDraft,\n    setReactionEffect,\n    hideEffectInComposer,\n    updateChatSilentPosting,\n  } = getActions();\n\n  const oldLang = useOldLang();\n  const lang = useLang();\n\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const counterRef = useRef<HTMLSpanElement>(null);\n\n  // eslint-disable-next-line no-null/no-null\n  const storyReactionRef = useRef<HTMLButtonElement>(null);\n\n  const [getHtml, setHtml] = useSignal('');\n  const [isMounted, setIsMounted] = useState(false);\n  const getSelectionRange = useGetSelectionRange(editableInputCssSelector);\n  const lastMessageSendTimeSeconds = useRef<number>();\n  const prevDropAreaState = usePreviousDeprecated(dropAreaState);\n  const { width: windowWidth } = windowSize.get();\n\n  const isInMessageList = type === 'messageList';\n  const isInStoryViewer = type === 'story';\n  const sendAsPeerIds = isInMessageList ? chat?.sendAsPeerIds : undefined;\n  const canShowSendAs = sendAsPeerIds\n    && (sendAsPeerIds.length > 1 || !sendAsPeerIds.some((peer) => peer.id === currentUserId!));\n  // Prevent Symbol Menu from closing when calendar is open\n  const [isSymbolMenuForced, forceShowSymbolMenu, cancelForceShowSymbolMenu] = useFlag();\n  const sendMessageAction = useSendMessageAction(chatId, threadId);\n  const [isInputHasFocus, markInputHasFocus, unmarkInputHasFocus] = useFlag();\n  const [isAttachMenuOpen, onAttachMenuOpen, onAttachMenuClose] = useFlag();\n  const [isInlineAILoading, setIsInlineAILoading] = useState(false);\n\n  const canMediaBeReplaced = editingMessage && canEditMedia(editingMessage);\n\n  const { emojiSet, members: groupChatMembers, botCommands: chatBotCommands } = chatFullInfo || {};\n  const chatEmojiSetId = emojiSet?.id;\n\n  const isSentStoryReactionHeart = sentStoryReaction && isSameReaction(sentStoryReaction, HEART_REACTION);\n\n  useEffect(processMessageInputForCustomEmoji, [getHtml]);\n\n  const customEmojiNotificationNumber = useRef(0);\n\n  const [requestCalendar, calendar] = useSchedule(\n    isInMessageList && canScheduleUntilOnline,\n    cancelForceShowSymbolMenu,\n  );\n\n  useTimeout(() => {\n    setIsMounted(true);\n  }, MOUNT_ANIMATION_DURATION);\n\n  useEffect(() => {\n    if (isInMessageList) return;\n\n    closeReactionPicker();\n  }, [isInMessageList, storyId]);\n\n  useEffect(() => {\n    lastMessageSendTimeSeconds.current = undefined;\n  }, [chatId]);\n\n  useEffect(() => {\n    if (isAppConfigLoaded && chatId && isReady && !isInStoryViewer) {\n      loadScheduledHistory({ chatId });\n    }\n  }, [isReady, chatId, threadId, isInStoryViewer, isAppConfigLoaded]);\n\n  useEffect(() => {\n    const isChannelWithProfiles = isChannel && chat?.areProfilesShown;\n    if (chatId && chat && !sendAsPeerIds && isReady && (isChatSuperGroup(chat) || isChannelWithProfiles)) {\n      loadSendAs({ chatId });\n    }\n  }, [chat, chatId, isChannel, isReady, loadSendAs, sendAsPeerIds]);\n\n  const shouldAnimateSendAsButtonRef = useRef(false);\n  useSyncEffect(([prevChatId, prevSendAsPeerIds]) => {\n    // We only animate send-as button if `sendAsPeerIds` was missing when opening the chat\n    shouldAnimateSendAsButtonRef.current = Boolean(chatId === prevChatId && sendAsPeerIds && !prevSendAsPeerIds);\n  }, [chatId, sendAsPeerIds]);\n\n  const [attachments, setAttachments] = useState<ApiAttachment[]>([]);\n  const hasAttachments = Boolean(attachments.length);\n  const [nextText, setNextText] = useState<ApiFormattedText | undefined>(undefined);\n\n  const {\n    canSendStickers, canSendGifs, canAttachMedia, canAttachPolls, canAttachEmbedLinks,\n    canSendVoices, canSendPlainText, canSendAudios, canSendVideos, canSendPhotos, canSendDocuments,\n  } = useMemo(\n    () => getAllowedAttachmentOptions(chat,\n      chatFullInfo,\n      isChatWithBot,\n      isInStoryViewer,\n      paidMessagesStars,\n      isInScheduledList),\n    [chat, chatFullInfo, isChatWithBot, isInStoryViewer, paidMessagesStars, isInScheduledList],\n  );\n\n  const isNeedPremium = isContactRequirePremium && isInStoryViewer;\n  const isSendTextBlocked = isNeedPremium || !canSendPlainText;\n\n  const messagesCount = useDerivedState(() => {\n    if (hasAttachments) return attachments.length;\n    const messagesInInput = (getHtml() || hasAttachments) ? 1 : 0;\n    if (!isForwarding || !forwardedMessagesCount) return messagesInInput || 1;\n    return forwardedMessagesCount + messagesInInput;\n  }, [getHtml, hasAttachments, attachments, isForwarding, forwardedMessagesCount]);\n  const starsForAllMessages = paidMessagesStars ? messagesCount * paidMessagesStars : 0;\n\n  const {\n    closeConfirmDialog: closeConfirmModalPayForMessage,\n    dialogHandler: paymentMessageConfirmDialogHandler,\n    shouldAutoApprove: shouldPaidMessageAutoApprove,\n    setAutoApprove: setShouldPaidMessageAutoApprove,\n    handleWithConfirmation: handleActionWithPaymentConfirmation,\n  } = usePaidMessageConfirmation(starsForAllMessages, isStarsBalanceModalOpen, starsBalance);\n\n  const hasWebPagePreview = !hasAttachments && canAttachEmbedLinks && !noWebPage && Boolean(webPagePreview);\n  const isComposerBlocked = isSendTextBlocked && !editingMessage;\n\n  useEffect(() => {\n    if (!hasWebPagePreview) {\n      updateAttachmentSettings({ isInvertedMedia: undefined });\n    }\n  }, [hasWebPagePreview]);\n\n  const insertHtmlAndUpdateCursor = useLastCallback((newHtml: string, inInputId: string = editableInputId) => {\n    if (inInputId === editableInputId && isComposerBlocked) return;\n    const selection = window.getSelection()!;\n    let messageInput: HTMLDivElement;\n    if (inInputId === editableInputId) {\n      messageInput = document.querySelector<HTMLDivElement>(editableInputCssSelector)!;\n    } else {\n      messageInput = document.getElementById(inInputId) as HTMLDivElement;\n    }\n\n    if (selection.rangeCount) {\n      const selectionRange = selection.getRangeAt(0);\n      if (isSelectionInsideInput(selectionRange, inInputId)) {\n        insertHtmlInSelection(newHtml);\n        messageInput.dispatchEvent(new Event('input', { bubbles: true }));\n        return;\n      }\n    }\n\n    setHtml(`${getHtml()}${newHtml}`);\n\n    // If selection is outside of input, set cursor at the end of input\n    requestNextMutation(() => {\n      focusEditableElement(messageInput);\n    });\n  });\n\n  const insertTextAndUpdateCursor = useLastCallback((\n    text: string, inInputId: string = editableInputId,\n  ) => {\n    const newHtml = renderText(text, ['escape_html', 'emoji_html', 'br_html'])\n      .join('')\n      .replace(/\\u200b+/g, '\\u200b');\n    insertHtmlAndUpdateCursor(newHtml, inInputId);\n  });\n\n  const insertFormattedTextAndUpdateCursor = useLastCallback((\n    text: ApiFormattedText, inInputId: string = editableInputId,\n  ) => {\n    const newHtml = getTextWithEntitiesAsHtml(text);\n    insertHtmlAndUpdateCursor(newHtml, inInputId);\n  });\n\n  const insertCustomEmojiAndUpdateCursor = useLastCallback((emoji: ApiSticker, inInputId: string = editableInputId) => {\n    insertHtmlAndUpdateCursor(buildCustomEmojiHtml(emoji), inInputId);\n  });\n\n  const insertNextText = useLastCallback(() => {\n    if (!nextText) return;\n    insertFormattedTextAndUpdateCursor(nextText, editableInputId);\n    setNextText(undefined);\n  });\n\n  const {\n    shouldSuggestCompression,\n    shouldForceCompression,\n    shouldForceAsFile,\n    handleAppendFiles,\n    handleFileSelect,\n    onCaptionUpdate,\n    handleClearAttachments,\n    handleSetAttachments,\n  } = useAttachmentModal({\n    attachments,\n    setHtml,\n    setAttachments,\n    fileSizeLimit,\n    chatId,\n    canSendAudios,\n    canSendVideos,\n    canSendPhotos,\n    canSendDocuments,\n    insertNextText,\n    editedMessage: editingMessage,\n  });\n\n  const [isBotKeyboardOpen, openBotKeyboard, closeBotKeyboard] = useFlag();\n  const [isBotCommandMenuOpen, openBotCommandMenu, closeBotCommandMenu] = useFlag();\n  const [isSymbolMenuOpen, openSymbolMenu, closeSymbolMenu] = useFlag();\n  const [isSendAsMenuOpen, openSendAsMenu, closeSendAsMenu] = useFlag();\n  const [isHoverDisabled, disableHover, enableHover] = useFlag();\n\n  const {\n    startRecordingVoice,\n    stopRecordingVoice,\n    pauseRecordingVoice,\n    activeVoiceRecording,\n    currentRecordTime,\n    recordButtonRef: mainButtonRef,\n    startRecordTimeRef,\n    isViewOnceEnabled,\n    setIsViewOnceEnabled,\n    toogleViewOnceEnabled,\n  } = useVoiceRecording();\n\n  const shouldSendRecordingStatus = isForCurrentMessageList && !isInStoryViewer;\n  useInterval(() => {\n    sendMessageAction({ type: 'recordAudio' });\n  }, shouldSendRecordingStatus ? activeVoiceRecording && SEND_MESSAGE_ACTION_INTERVAL : undefined);\n\n  useEffect(() => {\n    if (!isForCurrentMessageList || isInStoryViewer) return;\n    if (!activeVoiceRecording) {\n      sendMessageAction({ type: 'cancel' });\n    }\n  }, [activeVoiceRecording, isForCurrentMessageList, isInStoryViewer, sendMessageAction]);\n\n  const isEditingRef = useStateRef(Boolean(editingMessage));\n\n  const updateInlineAILoading = useLastCallback((value:boolean) => {\n    setIsInlineAILoading(value);\n  });\n  const updataAIResponse = useLastCallback((text:string) => {\n    setIsInlineAILoading(false);\n    setHtml(text);\n  });\n\n  useEffect(() => {\n    if (!isForCurrentMessageList || isInStoryViewer) return;\n    if (getHtml() && !isEditingRef.current) {\n      sendMessageAction({ type: 'typing' });\n    }\n  }, [getHtml, isEditingRef, isForCurrentMessageList, isInStoryViewer, sendMessageAction]);\n\n  useEffect(() => {\n    eventEmitter.on('update-input-text', updataAIResponse);\n    eventEmitter.on('update-input-spiner', updateInlineAILoading);\n    return () => {\n      eventEmitter.off('update-input-text', updataAIResponse);\n      eventEmitter.off('update-input-spiner', updateInlineAILoading);\n    };\n  }, []);\n\n  const isAdmin = chat && isChatAdmin(chat);\n\n  const {\n    isEmojiTooltipOpen,\n    closeEmojiTooltip,\n    filteredEmojis,\n    filteredCustomEmojis,\n    insertEmoji,\n  } = useEmojiTooltip(\n    Boolean(isReady && isOnActiveTab && (isInStoryViewer || isForCurrentMessageList)\n      && shouldSuggestStickers && !hasAttachments),\n    getHtml,\n    setHtml,\n    undefined,\n    recentEmojis,\n    baseEmojiKeywords,\n    emojiKeywords,\n  );\n\n  const {\n    isCustomEmojiTooltipOpen,\n    closeCustomEmojiTooltip,\n    insertCustomEmoji,\n  } = useCustomEmojiTooltip(\n    Boolean(isReady && isOnActiveTab && (isInStoryViewer || isForCurrentMessageList)\n      && shouldSuggestCustomEmoji && !hasAttachments),\n    getHtml,\n    setHtml,\n    getSelectionRange,\n    inputRef,\n    customEmojiForEmoji,\n  );\n\n  const {\n    isStickerTooltipOpen,\n    closeStickerTooltip,\n  } = useStickerTooltip(\n    Boolean(isReady\n      && isOnActiveTab\n      && (isInStoryViewer || isForCurrentMessageList)\n      && shouldSuggestStickers\n      && canSendStickers\n      && !hasAttachments),\n    getHtml,\n    stickersForEmoji,\n  );\n\n  const {\n    isMentionTooltipOpen,\n    closeMentionTooltip,\n    insertMention,\n    mentionFilteredUsers,\n  } = useMentionTooltip(\n    Boolean(isInMessageList && isReady && isForCurrentMessageList && !hasAttachments),\n    getHtml,\n    setHtml,\n    getSelectionRange,\n    inputRef,\n    groupChatMembers,\n    topInlineBotIds,\n    currentUserId,\n  );\n\n  const {\n    isOpen: isInlineBotTooltipOpen,\n    botId: inlineBotId,\n    isGallery: isInlineBotTooltipGallery,\n    switchPm: inlineBotSwitchPm,\n    switchWebview: inlineBotSwitchWebview,\n    results: inlineBotResults,\n    closeTooltip: closeInlineBotTooltip,\n    help: inlineBotHelp,\n    loadMore: loadMoreForInlineBot,\n  } = useInlineBotTooltip(\n    Boolean(isInMessageList && isReady && isForCurrentMessageList && !hasAttachments),\n    chatId,\n    getHtml,\n    inlineBots,\n  );\n\n  const hasQuickReplies = Boolean(quickReplies && Object.keys(quickReplies).length);\n\n  const {\n    isOpen: isChatCommandTooltipOpen,\n    close: closeChatCommandTooltip,\n    filteredBotCommands: botTooltipCommands,\n    filteredQuickReplies: quickReplyCommands,\n  } = useChatCommandTooltip(\n    Boolean(isInMessageList\n      && isReady\n      && isForCurrentMessageList\n      && ((botCommands && botCommands?.length) || chatBotCommands?.length || (hasQuickReplies && canSendQuickReplies))),\n    getHtml,\n    botCommands,\n    chatBotCommands,\n    canSendQuickReplies ? quickReplies : undefined,\n  );\n\n  useDraft({\n    draft,\n    chatId,\n    threadId,\n    getHtml,\n    setHtml,\n    editedMessage: editingMessage,\n    isDisabled: isInStoryViewer || Boolean(requestedDraft),\n  });\n\n  const resetComposer = useLastCallback((shouldPreserveInput = false) => {\n    if (!shouldPreserveInput) {\n      setHtml('');\n    }\n\n    setAttachments(MEMO_EMPTY_ARRAY);\n    setNextText(undefined);\n\n    closeEmojiTooltip();\n    closeCustomEmojiTooltip();\n    closeStickerTooltip();\n    closeMentionTooltip();\n\n    if (isMobile) {\n      // @optimization\n      setTimeout(() => closeSymbolMenu(), SENDING_ANIMATION_DURATION);\n    } else {\n      closeSymbolMenu();\n    }\n  });\n\n  const [handleEditComplete, handleEditCancel, shouldForceShowEditing] = useEditing(\n    getHtml,\n    setHtml,\n    editingMessage,\n    resetComposer,\n    chatId,\n    threadId,\n    messageListType,\n    draft,\n    editingDraft,\n  );\n\n  // Handle chat change (should be placed after `useDraft` and `useEditing`)\n  const resetComposerRef = useStateRef(resetComposer);\n  const stopRecordingVoiceRef = useStateRef(stopRecordingVoice);\n  useEffect(() => {\n    return () => {\n      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n      stopRecordingVoiceRef.current();\n      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n      resetComposerRef.current();\n    };\n  }, [chatId, threadId, resetComposerRef, stopRecordingVoiceRef]);\n\n  const areAllGiftsDisallowed = useMemo(() => {\n    if (!disallowedGifts) {\n      return undefined;\n    }\n    return Object.values(disallowedGifts).every(Boolean);\n  }, [disallowedGifts]);\n\n  const shouldShowGiftButton = Boolean(!isChatWithSelf && shouldDisplayGiftsButton && !areAllGiftsDisallowed);\n\n  const showCustomEmojiPremiumNotification = useLastCallback(() => {\n    const notificationNumber = customEmojiNotificationNumber.current;\n    if (!notificationNumber) {\n      showNotification({\n        message: oldLang('UnlockPremiumEmojiHint'),\n        action: {\n          action: 'openPremiumModal',\n          payload: { initialSection: 'animated_emoji' },\n        },\n        actionText: oldLang('PremiumMore'),\n      });\n    } else {\n      showNotification({\n        message: oldLang('UnlockPremiumEmojiHint2'),\n        action: {\n          action: 'openChat',\n          payload: { id: currentUserId, shouldReplaceHistory: true },\n        },\n        actionText: oldLang('Open'),\n      });\n    }\n    customEmojiNotificationNumber.current = Number(!notificationNumber);\n  });\n\n  const mainButtonState = useDerivedState(() => {\n    if (!isInputHasFocus && onForward && !(getHtml() && !hasAttachments)) {\n      return MainButtonState.Forward;\n    }\n\n    if (editingMessage && shouldForceShowEditing) {\n      return MainButtonState.Edit;\n    }\n\n    if (IS_VOICE_RECORDING_SUPPORTED && !activeVoiceRecording && !isForwarding && !(getHtml() && !hasAttachments)) {\n      return MainButtonState.Record;\n    }\n\n    if (isInScheduledList) {\n      return MainButtonState.Schedule;\n    }\n\n    return MainButtonState.Send;\n  }, [\n    activeVoiceRecording, editingMessage, getHtml, hasAttachments, isForwarding, isInputHasFocus, onForward,\n    shouldForceShowEditing, isInScheduledList,\n  ]);\n  const canShowCustomSendMenu = !isInScheduledList;\n\n  const {\n    isContextMenuOpen: isCustomSendMenuOpen,\n    handleContextMenu,\n    handleContextMenuClose,\n    handleContextMenuHide,\n  } = useContextMenuHandlers(mainButtonRef, !(mainButtonState === MainButtonState.Send && canShowCustomSendMenu));\n\n  const {\n    contextMenuAnchor: storyReactionPickerAnchor,\n    handleContextMenu: handleStoryPickerContextMenu,\n    handleBeforeContextMenu: handleBeforeStoryPickerContextMenu,\n    handleContextMenuHide: handleStoryPickerContextMenuHide,\n  } = useContextMenuHandlers(storyReactionRef, !isInStoryViewer);\n\n  useEffect(() => {\n    if (isReactionPickerOpen) return;\n\n    if (storyReactionPickerAnchor) {\n      openStoryReactionPicker({\n        peerId: chatId,\n        storyId: storyId!,\n        position: storyReactionPickerAnchor,\n      });\n      handleStoryPickerContextMenuHide();\n    }\n  }, [chatId, handleStoryPickerContextMenuHide, isReactionPickerOpen, storyId, storyReactionPickerAnchor]);\n\n  useClipboardPaste(\n    isForCurrentMessageList || isInStoryViewer,\n    insertFormattedTextAndUpdateCursor,\n    handleSetAttachments,\n    setNextText,\n    editingMessage,\n    !isCurrentUserPremium && !isChatWithSelf,\n    showCustomEmojiPremiumNotification,\n  );\n\n  const handleEmbeddedClear = useLastCallback(() => {\n    if (editingMessage) {\n      handleEditCancel();\n    }\n  });\n\n  const validateTextLength = useLastCallback((text: string, isAttachmentModal?: boolean) => {\n    const maxLength = isAttachmentModal ? captionLimit : maxMessageLength;\n    if (text?.length > maxLength) {\n      const extraLength = text.length - maxLength;\n      showDialog({\n        data: {\n          message: 'MESSAGE_TOO_LONG_PLEASE_REMOVE_CHARACTERS',\n          textParams: {\n            '{EXTRA_CHARS_COUNT}': extraLength.toString(),\n            '{PLURAL_S}': extraLength > 1 ? 's' : '',\n          },\n          hasErrorKey: true,\n        },\n      });\n\n      return false;\n    }\n    return true;\n  });\n\n  const checkSlowMode = useLastCallback(() => {\n    if (slowMode && !isAdmin) {\n      const messageInput = document.querySelector<HTMLDivElement>(editableInputCssSelector);\n\n      const nowSeconds = getServerTime();\n      const secondsSinceLastMessage = lastMessageSendTimeSeconds.current\n        && Math.floor(nowSeconds - lastMessageSendTimeSeconds.current);\n      const nextSendDateNotReached = slowMode.nextSendDate && slowMode.nextSendDate > nowSeconds;\n\n      if (\n        (secondsSinceLastMessage && secondsSinceLastMessage < slowMode.seconds)\n        || nextSendDateNotReached\n      ) {\n        const secondsRemaining = nextSendDateNotReached\n          ? slowMode.nextSendDate! - nowSeconds\n          : slowMode.seconds - secondsSinceLastMessage!;\n        showDialog({\n          data: {\n            message: oldLang('SlowModeHint', formatMediaDuration(secondsRemaining)),\n            isSlowMode: true,\n            hasErrorKey: false,\n          },\n        });\n\n        messageInput?.blur();\n\n        return false;\n      }\n    }\n    return true;\n  });\n\n  const canSendAttachments = (attachmentsToSend: ApiAttachment[]): boolean => {\n    if (!currentMessageList && !storyId) {\n      return false;\n    }\n\n    const { text } = parseHtmlAsFormattedText(getHtml());\n    if (!text && !attachmentsToSend.length) {\n      return false;\n    }\n    if (!validateTextLength(text, true)) return false;\n    if (!checkSlowMode()) return false;\n\n    return true;\n  };\n\n  const sendAttachments = useLastCallback(({\n    attachments: attachmentsToSend,\n    sendCompressed = attachmentSettings.shouldCompress,\n    sendGrouped = attachmentSettings.shouldSendGrouped,\n    isSilent,\n    scheduledAt,\n    isInvertedMedia,\n  }: {\n    attachments: ApiAttachment[];\n    sendCompressed?: boolean;\n    sendGrouped?: boolean;\n    isSilent?: boolean;\n    scheduledAt?: number;\n    isInvertedMedia?: true;\n  }) => {\n    if (!currentMessageList && !storyId) {\n      return;\n    }\n    isSilent = isSilent || isSilentPosting;\n\n    const { text, entities } = parseHtmlAsFormattedText(getHtml());\n\n    isInvertedMedia = text && sendCompressed && sendGrouped ? isInvertedMedia : undefined;\n\n    if (editingMessage) {\n      editMessage({\n        messageList: currentMessageList,\n        text,\n        entities,\n        attachments: prepareAttachmentsToSend(attachmentsToSend, sendCompressed),\n      });\n    } else {\n      sendMessage({\n        messageList: currentMessageList,\n        text,\n        entities,\n        scheduledAt,\n        isSilent,\n        shouldUpdateStickerSetOrder,\n        attachments: prepareAttachmentsToSend(attachmentsToSend, sendCompressed),\n        shouldGroupMessages: sendGrouped,\n        isInvertedMedia,\n      });\n    }\n\n    lastMessageSendTimeSeconds.current = getServerTime();\n\n    clearDraft({ chatId, isLocalOnly: true });\n\n    // Wait until message animation starts\n    requestMeasure(() => {\n      resetComposer();\n    });\n  });\n\n  const handleSendAttachmentsFromModal = useLastCallback((\n    sendCompressed: boolean,\n    sendGrouped: boolean,\n    isInvertedMedia?: true,\n  ) => {\n    if (canSendAttachments(attachments)) {\n      if (editingMessage) {\n        sendAttachments({\n          attachments,\n          sendCompressed,\n          sendGrouped,\n          isInvertedMedia,\n        });\n        return;\n      }\n\n      handleActionWithPaymentConfirmation(sendAttachments, {\n        attachments,\n        sendCompressed,\n        sendGrouped,\n        isInvertedMedia,\n      });\n    }\n  });\n\n  const handleSendAttachments = useLastCallback((\n    sendCompressed: boolean,\n    sendGrouped: boolean,\n    isSilent?: boolean,\n    scheduledAt?: number,\n    isInvertedMedia?: true,\n  ) => {\n    if (canSendAttachments(attachments)) {\n      sendAttachments({\n        attachments,\n        sendCompressed,\n        sendGrouped,\n        isSilent,\n        scheduledAt,\n        isInvertedMedia,\n      });\n    }\n  });\n\n  const handleSendCore = useLastCallback(\n    (currentAttachments: ApiAttachment[], isSilent = false, scheduledAt?: number) => {\n      const { text, entities } = parseHtmlAsFormattedText(getHtml());\n\n      if (currentAttachments.length) {\n        if (canSendAttachments(currentAttachments)) {\n          sendAttachments({\n            attachments: currentAttachments,\n            scheduledAt,\n            isSilent,\n          });\n        }\n        return;\n      }\n\n      if (!text && !isForwarding) {\n        return;\n      }\n\n      if (!validateTextLength(text)) return;\n\n      const messageInput = document.querySelector<HTMLDivElement>(editableInputCssSelector);\n\n      const effectId = effect?.id;\n\n      if (text || isForwarding) {\n        if (!checkSlowMode()) return;\n\n        const isInvertedMedia = hasWebPagePreview ? attachmentSettings.isInvertedMedia : undefined;\n\n        if (areEffectsSupported) saveEffectInDraft({ chatId, threadId, effectId: undefined });\n\n        sendMessage({\n          messageList: currentMessageList,\n          text,\n          entities,\n          scheduledAt,\n          isSilent,\n          shouldUpdateStickerSetOrder,\n          isInvertedMedia,\n          effectId,\n          webPageMediaSize: attachmentSettings.webPageMediaSize,\n          webPageUrl: hasWebPagePreview ? webPagePreview!.url : undefined,\n          isForwarding,\n        });\n      }\n\n      lastMessageSendTimeSeconds.current = getServerTime();\n      clearDraft({\n        chatId, threadId, isLocalOnly: true, shouldKeepReply: isForwarding,\n      });\n\n      if (IS_IOS && messageInput && messageInput === document.activeElement) {\n        applyIosAutoCapitalizationFix(messageInput);\n      }\n\n      // Wait until message animation starts\n      requestMeasure(() => {\n        resetComposer();\n      });\n    },\n  );\n\n  const handleSend = useLastCallback(async (isSilent = false, scheduledAt?: number) => {\n    if (!currentMessageList && !storyId) {\n      return;\n    }\n\n    isSilent = isSilent || isSilentPosting;\n\n    let currentAttachments = attachments;\n\n    if (activeVoiceRecording) {\n      const record = await stopRecordingVoice();\n      const ttlSeconds = isViewOnceEnabled ? ONE_TIME_MEDIA_TTL_SECONDS : undefined;\n      if (record) {\n        const { blob, duration, waveform } = record;\n        currentAttachments = [await buildAttachment(\n          VOICE_RECORDING_FILENAME,\n          blob,\n          { voice: { duration, waveform }, ttlSeconds },\n        )];\n      }\n    }\n    // TODO:translate text\n    const { text } = parseHtmlAsFormattedText(getHtml());\n    // TODO:translate text\n    const langCode = RoomStorage.getRoomTranslateLanguage(chatId);\n    if (langCode && text) {\n      setIsInlineAILoading(true);\n      try {\n        const result = await callApi('translateTextByTencent', {\n          text: [{ text }],\n          toLanguageCode: langCode,\n        });\n        if (result && result[0].text) {\n          setHtml(result[0].text);\n        }\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.log(error);\n      }\n      setIsInlineAILoading(false);\n    }\n    handleSendCore(currentAttachments, isSilent, scheduledAt);\n  });\n\n  const handleSendWithConfirmation = useLastCallback((isSilent = false, scheduledAt?: number) => {\n    handleActionWithPaymentConfirmation(handleSend, isSilent, scheduledAt);\n  });\n\n  const handleClickBotMenu = useLastCallback(() => {\n    if (botMenuButton?.type !== 'webApp') {\n      return;\n    }\n\n    const parsedLink = tryParseDeepLink(botMenuButton.url);\n\n    if (parsedLink?.type === 'publicUsernameOrBotLink' && parsedLink.appName) {\n      processDeepLink(botMenuButton.url);\n    } else {\n      callAttachBot({\n        chatId, url: botMenuButton.url, threadId,\n      });\n    }\n  });\n\n  const handleActivateBotCommandMenu = useLastCallback(() => {\n    closeSymbolMenu();\n    openBotCommandMenu();\n  });\n\n  const handleMessageSchedule = useLastCallback((\n    args: ScheduledMessageArgs, scheduledAt: number, messageList: MessageList, effectId?: string,\n  ) => {\n    if (args && 'queryId' in args) {\n      const { id, queryId, isSilent } = args;\n      sendInlineBotResult({\n        id,\n        chatId,\n        threadId,\n        queryId,\n        scheduledAt,\n        isSilent: isSilent || isSilentPosting,\n      });\n      return;\n    }\n\n    const { isSilent, ...restArgs } = args || {};\n\n    if (!args || Object.keys(restArgs).length === 0) {\n      void handleSend(Boolean(isSilent), scheduledAt);\n    } else if (args.sendCompressed !== undefined || args.sendGrouped !== undefined) {\n      const { sendCompressed = false, sendGrouped = false, isInvertedMedia } = args;\n      void handleSendAttachments(sendCompressed, sendGrouped, isSilent, scheduledAt, isInvertedMedia);\n    } else {\n      sendMessage({\n        ...args,\n        messageList,\n        scheduledAt,\n        effectId,\n      });\n    }\n  });\n\n  useEffectWithPrevDeps(([prevContentToBeScheduled]) => {\n    if (currentMessageList && contentToBeScheduled && contentToBeScheduled !== prevContentToBeScheduled) {\n      requestCalendar((scheduledAt) => {\n        handleMessageSchedule(contentToBeScheduled, scheduledAt, currentMessageList);\n      });\n    }\n  }, [contentToBeScheduled, currentMessageList, handleMessageSchedule, requestCalendar]);\n\n  useEffect(() => {\n    if (requestedDraft) {\n      insertFormattedTextAndUpdateCursor(requestedDraft);\n      resetOpenChatWithDraft();\n\n      requestNextMutation(() => {\n        const messageInput = document.getElementById(editableInputId)!;\n        focusEditableElement(messageInput, true);\n      });\n    }\n  }, [editableInputId, requestedDraft, resetOpenChatWithDraft, setHtml]);\n\n  useEffect(() => {\n    if (requestedDraftFiles?.length) {\n      void handleFileSelect(requestedDraftFiles);\n      resetOpenChatWithDraft();\n    }\n  }, [handleFileSelect, requestedDraftFiles, resetOpenChatWithDraft]);\n\n  const handleCustomEmojiSelect = useLastCallback((emoji: ApiSticker, inInputId?: string) => {\n    const emojiSetId = 'id' in emoji.stickerSetInfo && emoji.stickerSetInfo.id;\n    if (!emoji.isFree && !isCurrentUserPremium && !isChatWithSelf && emojiSetId !== chatEmojiSetId) {\n      showCustomEmojiPremiumNotification();\n      return;\n    }\n\n    insertCustomEmojiAndUpdateCursor(emoji, inInputId);\n  });\n\n  const handleCustomEmojiSelectAttachmentModal = useLastCallback((emoji: ApiSticker) => {\n    handleCustomEmojiSelect(emoji, EDITABLE_INPUT_MODAL_ID);\n  });\n\n  const handleGifSelect = useLastCallback((gif: ApiVideo, isSilent?: boolean, isScheduleRequested?: boolean) => {\n    if (!currentMessageList && !storyId) {\n      return;\n    }\n\n    isSilent = isSilent || isSilentPosting;\n\n    if (isInScheduledList || isScheduleRequested) {\n      forceShowSymbolMenu();\n      requestCalendar((scheduledAt) => {\n        cancelForceShowSymbolMenu();\n        handleActionWithPaymentConfirmation(handleMessageSchedule, { gif, isSilent }, scheduledAt, currentMessageList!);\n        requestMeasure(() => {\n          resetComposer(true);\n        });\n      });\n    } else {\n      handleActionWithPaymentConfirmation(sendMessage, { messageList: currentMessageList, gif, isSilent });\n      requestMeasure(() => {\n        resetComposer(true);\n      });\n    }\n  });\n\n  const handleStickerSelect = useLastCallback((\n    sticker: ApiSticker,\n    isSilent?: boolean,\n    isScheduleRequested?: boolean,\n    shouldPreserveInput = false,\n    canUpdateStickerSetsOrder?: boolean,\n  ) => {\n    if (!currentMessageList && !storyId) {\n      return;\n    }\n\n    isSilent = isSilent || isSilentPosting;\n\n    sticker = {\n      ...sticker,\n      isPreloadedGlobally: true,\n    };\n\n    if (isInScheduledList || isScheduleRequested) {\n      forceShowSymbolMenu();\n      requestCalendar((scheduledAt) => {\n        cancelForceShowSymbolMenu();\n        handleActionWithPaymentConfirmation(\n          handleMessageSchedule, { sticker, isSilent }, scheduledAt, currentMessageList!,\n        );\n        requestMeasure(() => {\n          resetComposer(shouldPreserveInput);\n        });\n      });\n    } else {\n      handleActionWithPaymentConfirmation(\n        sendMessage,\n        {\n          messageList: currentMessageList,\n          sticker,\n          isSilent,\n          shouldUpdateStickerSetOrder: shouldUpdateStickerSetOrder && canUpdateStickerSetsOrder,\n        },\n      );\n      clearDraft({ chatId, threadId, isLocalOnly: true });\n\n      requestMeasure(() => {\n        resetComposer(shouldPreserveInput);\n      });\n    }\n  });\n\n  const handleInlineBotSelect = useLastCallback((\n    inlineResult: ApiBotInlineResult | ApiBotInlineMediaResult, isSilent?: boolean, isScheduleRequested?: boolean,\n  ) => {\n    if (!currentMessageList && !storyId) {\n      return;\n    }\n\n    isSilent = isSilent || isSilentPosting;\n\n    if (isInScheduledList || isScheduleRequested) {\n      requestCalendar((scheduledAt) => {\n        handleActionWithPaymentConfirmation(handleMessageSchedule,\n          {\n            id: inlineResult.id,\n            queryId: inlineResult.queryId,\n            isSilent,\n          },\n          scheduledAt,\n          currentMessageList!);\n      });\n    } else {\n      handleActionWithPaymentConfirmation(sendInlineBotResult,\n        {\n          id: inlineResult.id,\n          queryId: inlineResult.queryId,\n          threadId,\n          chatId,\n          isSilent,\n        });\n    }\n\n    const messageInput = document.querySelector<HTMLDivElement>(editableInputCssSelector);\n    if (IS_IOS && messageInput && messageInput === document.activeElement) {\n      applyIosAutoCapitalizationFix(messageInput);\n    }\n\n    clearDraft({ chatId, isLocalOnly: true });\n    requestMeasure(() => {\n      resetComposer();\n    });\n  });\n\n  const handleBotCommandSelect = useLastCallback(() => {\n    clearDraft({ chatId, isLocalOnly: true });\n    requestMeasure(() => {\n      resetComposer();\n    });\n  });\n\n  const handlePollSend = useLastCallback((poll: ApiNewPoll) => {\n    if (!currentMessageList) {\n      return;\n    }\n\n    if (isInScheduledList) {\n      requestCalendar((scheduledAt) => {\n        handleActionWithPaymentConfirmation(\n          handleMessageSchedule,\n          { poll },\n          scheduledAt,\n          currentMessageList,\n        );\n      });\n      closePollModal();\n    } else {\n      handleActionWithPaymentConfirmation(\n        sendMessage,\n        { messageList: currentMessageList, poll, isSilent: isSilentPosting },\n      );\n      closePollModal();\n    }\n  });\n\n  const sendSilent = useLastCallback((additionalArgs?: ScheduledMessageArgs) => {\n    if (isInScheduledList) {\n      requestCalendar((scheduledAt) => {\n        handleMessageSchedule({ ...additionalArgs, isSilent: true }, scheduledAt, currentMessageList!);\n      });\n    } else if (additionalArgs && ('sendCompressed' in additionalArgs || 'sendGrouped' in additionalArgs)) {\n      const { sendCompressed = false, sendGrouped = false, isInvertedMedia } = additionalArgs;\n      void handleSendAttachments(sendCompressed, sendGrouped, true, undefined, isInvertedMedia);\n    } else {\n      void handleSend(true);\n    }\n  });\n\n  const handleSendAsMenuOpen = useLastCallback(() => {\n    const messageInput = document.querySelector<HTMLDivElement>(editableInputCssSelector);\n\n    if (!isMobile || messageInput !== document.activeElement) {\n      closeBotCommandMenu();\n      closeSymbolMenu();\n      openSendAsMenu();\n      return;\n    }\n\n    messageInput?.blur();\n    setTimeout(() => {\n      closeBotCommandMenu();\n      closeSymbolMenu();\n      openSendAsMenu();\n    }, MOBILE_KEYBOARD_HIDE_DELAY_MS);\n  });\n\n  useEffect(() => {\n    if (!isComposerBlocked) return;\n\n    setHtml('');\n  }, [isComposerBlocked, setHtml, attachments]);\n\n  const insertTextAndUpdateCursorAttachmentModal = useLastCallback((text: string) => {\n    insertTextAndUpdateCursor(text, EDITABLE_INPUT_MODAL_ID);\n  });\n\n  const removeSymbol = useLastCallback((inInputId = editableInputId) => {\n    const selection = window.getSelection()!;\n\n    if (selection.rangeCount) {\n      const selectionRange = selection.getRangeAt(0);\n      if (isSelectionInsideInput(selectionRange, inInputId)) {\n        document.execCommand('delete', false);\n        return;\n      }\n    }\n\n    setHtml(deleteLastCharacterOutsideSelection(getHtml()));\n  });\n\n  const removeSymbolAttachmentModal = useLastCallback(() => {\n    removeSymbol(EDITABLE_INPUT_MODAL_ID);\n  });\n\n  const handleAllScheduledClick = useLastCallback(() => {\n    openThread({\n      chatId, threadId, type: 'scheduled', noForumTopicPanel: true,\n    });\n  });\n\n  const handleGiftClick = useLastCallback(() => {\n    openGiftModal({ forUserId: chatId });\n  });\n\n  const handleToggleSilentPosting = useLastCallback(() => {\n    const newValue = !isSilentPosting;\n    updateChatSilentPosting({ chatId, isEnabled: newValue });\n\n    showNotification({\n      localId: 'silentPosting',\n      icon: newValue ? 'mute' : 'unmute',\n      message: lang(`ComposerSilentPosting${newValue ? 'Enabled' : 'Disabled'}Tootlip`),\n    });\n  });\n\n  useEffect(() => {\n    if (isRightColumnShown && isMobile) {\n      closeSymbolMenu();\n    }\n  }, [isRightColumnShown, closeSymbolMenu, isMobile]);\n\n  useEffect(() => {\n    if (!isReady) return;\n\n    if (isSelectModeActive) {\n      disableHover();\n    } else {\n      setTimeout(() => {\n        enableHover();\n      }, SELECT_MODE_TRANSITION_MS);\n    }\n  }, [isSelectModeActive, enableHover, disableHover, isReady]);\n\n  const hasText = useDerivedState(() => Boolean(getHtml()), [getHtml]);\n\n  const withBotMenuButton = isChatWithBot && botMenuButton?.type === 'webApp' && !editingMessage\n    && messageListType === 'thread';\n  const isBotMenuButtonOpen = withBotMenuButton && !hasText && !activeVoiceRecording;\n\n  const [timedPlaceholderLangKey, timedPlaceholderDate] = useMemo(() => {\n    if (slowMode?.nextSendDate) {\n      return ['SlowModeWait', slowMode.nextSendDate];\n    }\n\n    if (stealthMode?.activeUntil && isInStoryViewer) {\n      return ['StealthModeActiveHint', stealthMode.activeUntil];\n    }\n\n    return [];\n  }, [isInStoryViewer, slowMode?.nextSendDate, stealthMode?.activeUntil]);\n\n  const isComposerHasFocus = isBotKeyboardOpen || isSymbolMenuOpen || isEmojiTooltipOpen || isSendAsMenuOpen\n    || isMentionTooltipOpen || isInlineBotTooltipOpen || isBotCommandMenuOpen || isAttachMenuOpen\n    || isStickerTooltipOpen || isChatCommandTooltipOpen || isCustomEmojiTooltipOpen || isBotMenuButtonOpen\n  || isCustomSendMenuOpen || Boolean(activeVoiceRecording) || attachments.length > 0 || isInputHasFocus;\n  const isReactionSelectorOpen = isComposerHasFocus && !isReactionPickerOpen && isInStoryViewer && !isAttachMenuOpen\n    && !isSymbolMenuOpen;\n\n  const placeholder = useMemo(() => {\n    if (activeVoiceRecording && windowWidth <= SCREEN_WIDTH_TO_HIDE_PLACEHOLDER) {\n      return '';\n    }\n\n    if (!isComposerBlocked) {\n      if (botKeyboardPlaceholder) return botKeyboardPlaceholder;\n      if (inputPlaceholder) return inputPlaceholder;\n      if (paidMessagesStars) {\n        return lang('ComposerPlaceholderPaidMessage', {\n          amount: formatStarsAsIcon(lang, paidMessagesStars, { asFont: true, className: 'placeholder-star-icon' }),\n        }, {\n          withNodes: true,\n        });\n      }\n      if (chat?.isForum && chat?.isForumAsMessages && threadId === MAIN_THREAD_ID) {\n        return replyToTopic\n          ? lang('ComposerPlaceholderTopic', { topic: replyToTopic.title })\n          : lang('ComposerPlaceholderTopicGeneral');\n      }\n      if (isChannel) {\n        return lang(isSilentPosting ? 'ComposerPlaceholderBroadcastSilent' : 'ComposerPlaceholderBroadcast');\n      }\n      return lang('ComposerPlaceholder');\n    }\n\n    if (isInStoryViewer) return lang('ComposerStoryPlaceholderLocked');\n\n    return lang('ComposerPlaceholderNoText');\n  }, [\n    activeVoiceRecording, botKeyboardPlaceholder, chat, inputPlaceholder, isChannel, isComposerBlocked,\n    isInStoryViewer, isSilentPosting, lang, replyToTopic, threadId, windowWidth, paidMessagesStars,\n  ]);\n\n  useEffect(() => {\n    if (isComposerHasFocus) {\n      onFocus?.();\n    } else {\n      onBlur?.();\n    }\n  }, [isComposerHasFocus, onBlur, onFocus]);\n\n  const {\n    shouldRender: shouldRenderReactionSelector,\n    transitionClassNames: reactionSelectorTransitonClassNames,\n  } = useShowTransitionDeprecated(isReactionSelectorOpen);\n  const areVoiceMessagesNotAllowed = mainButtonState === MainButtonState.Record\n    && (!canAttachMedia || !canSendVoiceByPrivacy || !canSendVoices);\n\n  const mainButtonHandler = useLastCallback(() => {\n    switch (mainButtonState) {\n      case MainButtonState.Forward:\n        onForward?.();\n        break;\n      case MainButtonState.Send:\n        handleSendWithConfirmation();\n        break;\n      case MainButtonState.Record: {\n        if (areVoiceMessagesNotAllowed) {\n          if (!canSendVoiceByPrivacy) {\n            showNotification({\n              message: oldLang('VoiceMessagesRestrictedByPrivacy', chat?.title),\n            });\n          } else if (!canSendVoices) {\n            showAllowedMessageTypesNotification({ chatId, messageListType });\n          }\n        } else {\n          setIsViewOnceEnabled(false);\n          void startRecordingVoice();\n        }\n        break;\n      }\n      case MainButtonState.Edit:\n        handleEditComplete();\n        break;\n      case MainButtonState.Schedule:\n        if (activeVoiceRecording) {\n          pauseRecordingVoice();\n        }\n        if (!currentMessageList) {\n          return;\n        }\n        requestCalendar((scheduledAt) => {\n          handleMessageSchedule({}, scheduledAt, currentMessageList, effect?.id);\n        });\n        break;\n      default:\n        break;\n    }\n  });\n\n  const scheduledDefaultDate = new Date();\n  scheduledDefaultDate.setSeconds(0);\n  scheduledDefaultDate.setMilliseconds(0);\n\n  const scheduledMaxDate = new Date();\n  scheduledMaxDate.setFullYear(scheduledMaxDate.getFullYear() + 1);\n\n  let sendButtonAriaLabel = 'SendMessage';\n  switch (mainButtonState) {\n    case MainButtonState.Forward:\n      sendButtonAriaLabel = 'Forward';\n      break;\n    case MainButtonState.Edit:\n      sendButtonAriaLabel = 'Save edited message';\n      break;\n    case MainButtonState.Record:\n      sendButtonAriaLabel = !canAttachMedia\n        ? 'Conversation.DefaultRestrictedMedia'\n        : 'AccDescrVoiceMessage';\n  }\n\n  const fullClassName = buildClassName(\n    'Composer',\n    !isSelectModeActive && 'shown',\n    isHoverDisabled && 'hover-disabled',\n    isMounted && 'mounted',\n    className,\n  );\n\n  const handleToggleReaction = useLastCallback((reaction: ApiReaction) => {\n    let text: string | undefined;\n    let entities: ApiMessageEntity[] | undefined;\n\n    if (reaction.type === 'emoji') {\n      text = reaction.emoticon;\n    }\n\n    if (reaction.type === 'custom') {\n      const sticker = getGlobal().customEmojis.byId[reaction.documentId];\n      if (!sticker) {\n        return;\n      }\n\n      if (!sticker.isFree && !isCurrentUserPremium && !isChatWithSelf) {\n        showCustomEmojiPremiumNotification();\n        return;\n      }\n      const customEmojiMessage = parseHtmlAsFormattedText(buildCustomEmojiHtml(sticker));\n      text = customEmojiMessage.text;\n      entities = customEmojiMessage.entities;\n    }\n\n    handleActionWithPaymentConfirmation(sendMessage, { text, entities, isReaction: true });\n    closeReactionPicker();\n  });\n\n  const handleToggleEffectReaction = useLastCallback((reaction: ApiReaction) => {\n    setReactionEffect({ chatId, threadId, reaction });\n\n    closeReactionPicker();\n  });\n\n  const handleReactionPickerOpen = useLastCallback((position: IAnchorPosition) => {\n    openStoryReactionPicker({\n      peerId: chatId,\n      storyId: storyId!,\n      position,\n      sendAsMessage: true,\n    });\n  });\n\n  const handleLikeStory = useLastCallback(() => {\n    const reaction = sentStoryReaction ? undefined : HEART_REACTION;\n    sendStoryReaction({\n      peerId: chatId,\n      storyId: storyId!,\n      containerId: getStoryKey(chatId, storyId!),\n      reaction,\n    });\n  });\n\n  const handleSendScheduled = useLastCallback(() => {\n    requestCalendar((scheduledAt) => {\n      handleMessageSchedule({}, scheduledAt, currentMessageList!);\n    });\n  });\n\n  const handleSendSilent = useLastCallback(() => {\n    handleActionWithPaymentConfirmation(sendSilent);\n  });\n\n  const handleSendWhenOnline = useLastCallback(() => {\n    handleActionWithPaymentConfirmation(\n      handleMessageSchedule, {}, SCHEDULED_WHEN_ONLINE, currentMessageList!, effect?.id,\n    );\n  });\n\n  const handleSendScheduledAttachments = useLastCallback(\n    (sendCompressed: boolean, sendGrouped: boolean, isInvertedMedia?: true) => {\n      requestCalendar((scheduledAt) => {\n        handleActionWithPaymentConfirmation(handleMessageSchedule,\n          { sendCompressed, sendGrouped, isInvertedMedia },\n          scheduledAt,\n          currentMessageList!);\n      });\n    },\n  );\n\n  const handleSendSilentAttachments = useLastCallback(\n    (sendCompressed: boolean, sendGrouped: boolean, isInvertedMedia?: true) => {\n      handleActionWithPaymentConfirmation(sendSilent, { sendCompressed, sendGrouped, isInvertedMedia });\n    },\n  );\n\n  const handleRemoveEffect = useLastCallback(() => { saveEffectInDraft({ chatId, threadId, effectId: undefined }); });\n\n  const handleStopEffect = useLastCallback(() => { hideEffectInComposer({ }); });\n\n  const onSend = useMemo(() => {\n    switch (mainButtonState) {\n      case MainButtonState.Edit:\n        return handleEditComplete;\n      case MainButtonState.Schedule:\n        return handleSendScheduled;\n      default:\n        return handleSendWithConfirmation;\n    }\n  }, [mainButtonState, handleEditComplete, handleSendWithConfirmation]);\n\n  const withBotCommands = isChatWithBot && botMenuButton?.type === 'commands' && !editingMessage\n    && botCommands !== false && !activeVoiceRecording;\n\n  const effectEmoji = areEffectsSupported && effect?.emoticon;\n\n  const shouldRenderPaidBadge = Boolean(paidMessagesStars && mainButtonState === MainButtonState.Send);\n\n  return (\n    <div className={fullClassName}>\n      {isInMessageList && canAttachMedia && isReady && (\n        <DropArea\n          isOpen={dropAreaState !== DropAreaState.None}\n          withQuick={dropAreaState === DropAreaState.QuickFile || prevDropAreaState === DropAreaState.QuickFile}\n          onHide={onDropHide!}\n          onFileSelect={handleFileSelect}\n          editingMessage={editingMessage}\n        />\n      )}\n      {shouldRenderReactionSelector && !isNeedPremium && (\n        <ReactionSelector\n          topReactions={topReactions}\n          allAvailableReactions={availableReactions}\n          onToggleReaction={handleToggleReaction}\n          isPrivate\n          isReady={isReady}\n          canBuyPremium={canBuyPremium}\n          isCurrentUserPremium={isCurrentUserPremium}\n          isInSavedMessages={isChatWithSelf}\n          isInStoryViewer={isInStoryViewer}\n          canPlayAnimatedEmojis={canPlayAnimatedEmojis}\n          onShowMore={handleReactionPickerOpen}\n          className={reactionSelectorTransitonClassNames}\n        />\n      )}\n      <AttachmentModal\n        chatId={chatId}\n        threadId={threadId}\n        canShowCustomSendMenu={canShowCustomSendMenu}\n        attachments={attachments}\n        getHtml={getHtml}\n        isReady={isReady}\n        shouldSuggestCompression={shouldSuggestCompression}\n        shouldForceCompression={shouldForceCompression}\n        shouldForceAsFile={shouldForceAsFile}\n        isForCurrentMessageList={isForCurrentMessageList}\n        isForMessage={isInMessageList}\n        shouldSchedule={!paidMessagesStars && isInScheduledList}\n        canSchedule={!paidMessagesStars}\n        forceDarkTheme={isInStoryViewer}\n        onCaptionUpdate={onCaptionUpdate}\n        onSendSilent={handleSendSilentAttachments}\n        onSend={handleSendAttachmentsFromModal}\n        onSendScheduled={handleSendScheduledAttachments}\n        onFileAppend={handleAppendFiles}\n        onClear={handleClearAttachments}\n        onAttachmentsUpdate={handleSetAttachments}\n        onCustomEmojiSelect={handleCustomEmojiSelectAttachmentModal}\n        onRemoveSymbol={removeSymbolAttachmentModal}\n        onEmojiSelect={insertTextAndUpdateCursorAttachmentModal}\n        editingMessage={editingMessage}\n        onSendWhenOnline={handleSendWhenOnline}\n        canScheduleUntilOnline={canScheduleUntilOnline && !isViewOnceEnabled}\n        paidMessagesStars={paidMessagesStars}\n      />\n      <PollModal\n        isOpen={pollModal.isOpen}\n        isQuiz={pollModal.isQuiz}\n        shouldBeAnonymous={isChannel}\n        onClear={closePollModal}\n        onSend={handlePollSend}\n      />\n      <SendAsMenu\n        isOpen={isSendAsMenuOpen}\n        onClose={closeSendAsMenu}\n        chatId={chatId}\n        selectedSendAsId={sendAsId}\n        sendAsPeerIds={sendAsPeerIds}\n        isCurrentUserPremium={isCurrentUserPremium}\n      />\n      <MentionTooltip\n        isOpen={isMentionTooltipOpen}\n        filteredUsers={mentionFilteredUsers}\n        onInsertUserName={insertMention}\n        onClose={closeMentionTooltip}\n      />\n      <ChatCommandTooltip\n        isOpen={isChatCommandTooltipOpen}\n        chatId={chatId}\n        withUsername={Boolean(chatBotCommands)}\n        botCommands={botTooltipCommands}\n        quickReplies={quickReplyCommands}\n        getHtml={getHtml}\n        self={currentUser!}\n        quickReplyMessages={quickReplyMessages}\n        onClick={handleBotCommandSelect}\n        onClose={closeChatCommandTooltip}\n      />\n      <div className={\n        buildClassName('composer-wrapper', isInStoryViewer && 'with-story-tweaks', isNeedPremium && 'is-need-premium')\n      }\n      >\n        {!isNeedPremium && (\n          <svg className=\"svg-appendix\" width=\"9\" height=\"20\">\n            <defs>\n              <filter\n                x=\"-50%\"\n                y=\"-14.7%\"\n                width=\"200%\"\n                height=\"141.2%\"\n                filterUnits=\"objectBoundingBox\"\n                id=\"composerAppendix\"\n              >\n                <feOffset dy=\"1\" in=\"SourceAlpha\" result=\"shadowOffsetOuter1\" />\n                <feGaussianBlur stdDeviation=\"1\" in=\"shadowOffsetOuter1\" result=\"shadowBlurOuter1\" />\n                <feColorMatrix\n                  values=\"0 0 0 0 0.0621962482 0 0 0 0 0.138574144 0 0 0 0 0.185037364 0 0 0 0.15 0\"\n                  in=\"shadowBlurOuter1\"\n                />\n              </filter>\n            </defs>\n            <g fill=\"none\" fill-rule=\"evenodd\">\n              <path d=\"M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 016 17z\" fill=\"#000\" filter=\"url(#composerAppendix)\" />\n              <path d=\"M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 016 17z\" fill=\"#FFF\" className=\"corner\" />\n            </g>\n          </svg>\n        )}\n        {isInMessageList && (\n          <>\n            <InlineBotTooltip\n              isOpen={isInlineBotTooltipOpen}\n              botId={inlineBotId}\n              isGallery={isInlineBotTooltipGallery}\n              inlineBotResults={inlineBotResults}\n              switchPm={inlineBotSwitchPm}\n              switchWebview={inlineBotSwitchWebview}\n              loadMore={loadMoreForInlineBot}\n              isSavedMessages={isChatWithSelf}\n              canSendGifs={canSendGifs}\n              isCurrentUserPremium={isCurrentUserPremium}\n              onSelectResult={handleInlineBotSelect}\n              onClose={closeInlineBotTooltip}\n            />\n            <ComposerEmbeddedMessage\n              onClear={handleEmbeddedClear}\n              shouldForceShowEditing={Boolean(shouldForceShowEditing && editingMessage)}\n              chatId={chatId}\n              threadId={threadId}\n              messageListType={messageListType}\n            />\n            <WebPagePreview\n              chatId={chatId}\n              threadId={threadId}\n              getHtml={getHtml}\n              isDisabled={!canAttachEmbedLinks || hasAttachments}\n              isEditing={Boolean(editingMessage)}\n            />\n          </>\n        )}\n        <div className={buildClassName('message-input-wrapper', getPeerColorClass(currentUser))}>\n          {isInMessageList && (\n            <>\n              {withBotMenuButton && (\n                <BotMenuButton\n                  isOpen={isBotMenuButtonOpen}\n                  text={botMenuButton.text}\n                  isDisabled={Boolean(activeVoiceRecording)}\n                  onClick={handleClickBotMenu}\n                />\n              )}\n              {withBotCommands && (\n                <ResponsiveHoverButton\n                  className={buildClassName(\n                    'bot-commands', 'composer-action-button',\n                  )}\n                  round\n                  disabled={botCommands === undefined}\n                  color=\"translucent\"\n                  onActivate={handleActivateBotCommandMenu}\n                  ariaLabel=\"Open bot command keyboard\"\n                >\n                  <Icon name=\"bot-commands-filled\" />\n                </ResponsiveHoverButton>\n              )}\n              {canShowSendAs && (sendAsUser || sendAsChat) && (\n                <Button\n                  round\n                  color=\"translucent\"\n                  onClick={isSendAsMenuOpen ? closeSendAsMenu : handleSendAsMenuOpen}\n                  ariaLabel={oldLang('SendMessageAsTitle')}\n                  className={buildClassName(\n                    'send-as-button',\n                    'composer-action-button',\n                    shouldAnimateSendAsButtonRef.current && 'appear-animation',\n                  )}\n                >\n                  <Avatar\n                    peer={sendAsUser || sendAsChat}\n                    size=\"tiny\"\n                  />\n                </Button>\n              )}\n            </>\n          )}\n          {((!isComposerBlocked || canSendGifs || canSendStickers) && !isNeedPremium && !isAccountFrozen) && (\n            <SymbolMenuButton\n              chatId={chatId}\n              threadId={threadId}\n              isMobile={isMobile}\n              isReady={isReady}\n              isSymbolMenuOpen={isSymbolMenuOpen}\n              openSymbolMenu={openSymbolMenu}\n              closeSymbolMenu={closeSymbolMenu}\n              canSendStickers={canSendStickers}\n              canSendGifs={canSendGifs}\n              isMessageComposer={isInMessageList}\n              onGifSelect={handleGifSelect}\n              onStickerSelect={handleStickerSelect}\n              onCustomEmojiSelect={handleCustomEmojiSelect}\n              onRemoveSymbol={removeSymbol}\n              onEmojiSelect={insertTextAndUpdateCursor}\n              closeBotCommandMenu={closeBotCommandMenu}\n              closeSendAsMenu={closeSendAsMenu}\n              isSymbolMenuForced={isSymbolMenuForced}\n              canSendPlainText={!isComposerBlocked}\n              inputCssSelector={editableInputCssSelector}\n              idPrefix={type}\n              forceDarkTheme={isInStoryViewer}\n            />\n          )}\n          <MessageInput\n            ref={inputRef}\n            id={inputId}\n            editableInputId={editableInputId}\n            customEmojiPrefix={type}\n            isStoryInput={isInStoryViewer}\n            chatId={chatId}\n            canSendPlainText={!isComposerBlocked}\n            threadId={threadId}\n            isReady={isReady}\n            isActive={!hasAttachments}\n            getHtml={getHtml}\n            placeholder={placeholder}\n            timedPlaceholderDate={timedPlaceholderDate}\n            timedPlaceholderLangKey={timedPlaceholderLangKey}\n            forcedPlaceholder={inlineBotHelp}\n            canAutoFocus={isReady && isForCurrentMessageList && !hasAttachments && isInMessageList}\n            noFocusInterception={hasAttachments}\n            shouldSuppressFocus={isMobile && isSymbolMenuOpen}\n            shouldSuppressTextFormatter={isEmojiTooltipOpen || isMentionTooltipOpen || isInlineBotTooltipOpen}\n            onUpdate={setHtml}\n            onSend={onSend}\n            onSuppressedFocus={closeSymbolMenu}\n            onFocus={markInputHasFocus}\n            onBlur={unmarkInputHasFocus}\n            isNeedPremium={isNeedPremium}\n            messageListType={messageListType}\n          />\n          {isInMessageList && (\n            <>\n              {((isInlineBotLoading && Boolean(inlineBotId)) || isInlineAILoading) && (\n                <Spinner color=\"gray\" className=\"flex-shrink-0\" />\n              )}\n              <Transition\n                className=\"composer-action-buttons-container\"\n                slideClassName=\"composer-action-buttons\"\n                activeKey={Number(hasText)}\n                direction=\"inverse\"\n                name=\"slideFadeAndroid\"\n              >\n                {!hasText && (\n                  <>\n                    {isChannel && (\n                      <Transition className=\"composer-action-button\" name=\"reveal\" activeKey={Number(isSilentPosting)}>\n                        <Button\n                          round\n                          faded\n                          className=\"composer-action-button\"\n                          color=\"translucent\"\n                          onClick={handleToggleSilentPosting}\n                          ariaLabel={lang(\n                            isSilentPosting ? 'AriaComposerSilentPostingDisable' : 'AriaComposerSilentPostingEnable',\n                          )}\n                        >\n                          <Icon name={isSilentPosting ? 'mute' : 'unmute'} />\n                        </Button>\n                      </Transition>\n                    )}\n                    {withScheduledButton && (\n                      <Button\n                        round\n                        faded\n                        className=\"composer-action-button scheduled-button\"\n                        color=\"translucent\"\n                        onClick={handleAllScheduledClick}\n                        ariaLabel={lang('AriaComposerOpenScheduled')}\n                      >\n                        <Icon name=\"schedule\" />\n                      </Button>\n                    )}\n                    {shouldShowGiftButton && (\n                      <Button\n                        round\n                        faded\n                        className=\"composer-action-button\"\n                        color=\"translucent\"\n                        onClick={handleGiftClick}\n                      >\n                        <Icon name=\"gift\" />\n                      </Button>\n                    )}\n                    {Boolean(botKeyboardMessageId) && !activeVoiceRecording && !editingMessage && (\n                      <ResponsiveHoverButton\n                        className={buildClassName('composer-action-button', isBotKeyboardOpen && 'activated')}\n                        round\n                        color=\"translucent\"\n                        onActivate={openBotKeyboard}\n                        ariaLabel={lang('AriaComposerBotKeyboard')}\n                      >\n                        <Icon name=\"bot-command\" />\n                      </ResponsiveHoverButton>\n                    )}\n                  </>\n                )}\n              </Transition>\n            </>\n          )}\n          {activeVoiceRecording && Boolean(currentRecordTime) && (\n            <span className=\"recording-state\">\n              {formatVoiceRecordDuration(currentRecordTime - startRecordTimeRef.current!)}\n            </span>\n          )}\n          <GrammarToolWrapper getHtml={getHtml} setHtml={setHtml} />\n          <InputTranslate chatId={chatId} />\n          {!isNeedPremium && (\n            <AttachMenu\n              chatId={chatId}\n              threadId={threadId}\n              editingMessage={editingMessage}\n              canEditMedia={canMediaBeReplaced}\n              isButtonVisible={!activeVoiceRecording}\n              canAttachMedia={canAttachMedia}\n              canAttachPolls={canAttachPolls}\n              canSendPhotos={canSendPhotos}\n              canSendVideos={canSendVideos}\n              canSendDocuments={canSendDocuments}\n              canSendAudios={canSendAudios}\n              onFileSelect={handleFileSelect}\n              onPollCreate={openPollModal}\n              isScheduled={isInScheduledList}\n              attachBots={isInMessageList ? attachBots : undefined}\n              peerType={attachMenuPeerType}\n              shouldCollectDebugLogs={shouldCollectDebugLogs}\n              theme={theme}\n              onMenuOpen={onAttachMenuOpen}\n              onMenuClose={onAttachMenuClose}\n              messageListType={messageListType}\n              paidMessagesStars={paidMessagesStars}\n            />\n          )}\n          {isInMessageList && Boolean(botKeyboardMessageId) && (\n            <BotKeyboardMenu\n              messageId={botKeyboardMessageId}\n              isOpen={isBotKeyboardOpen}\n              onClose={closeBotKeyboard}\n            />\n          )}\n          {isInMessageList && botCommands && (\n            <BotCommandMenu\n              isOpen={isBotCommandMenuOpen}\n              botCommands={botCommands}\n              onClose={closeBotCommandMenu}\n            />\n          )}\n          <CustomEmojiTooltip\n            key={`custom-emoji-tooltip-${editableInputId}`}\n            chatId={chatId}\n            isOpen={isCustomEmojiTooltipOpen}\n            onCustomEmojiSelect={insertCustomEmoji}\n            addRecentCustomEmoji={addRecentCustomEmoji}\n            onClose={closeCustomEmojiTooltip}\n          />\n          <StickerTooltip\n            key={`sticker-tooltip-${editableInputId}`}\n            chatId={chatId}\n            threadId={threadId}\n            isOpen={isStickerTooltipOpen}\n            onStickerSelect={handleStickerSelect}\n            onClose={closeStickerTooltip}\n          />\n          <EmojiTooltip\n            key={`emoji-tooltip-${editableInputId}`}\n            isOpen={isEmojiTooltipOpen}\n            emojis={filteredEmojis}\n            customEmojis={filteredCustomEmojis}\n            addRecentEmoji={addRecentEmoji}\n            addRecentCustomEmoji={addRecentCustomEmoji}\n            onEmojiSelect={insertEmoji}\n            onCustomEmojiSelect={insertEmoji}\n            onClose={closeEmojiTooltip}\n          />\n        </div>\n      </div>\n      {canSendOneTimeMedia && activeVoiceRecording && (\n        <Button\n          className={buildClassName('view-once', isViewOnceEnabled && 'active')}\n          round\n          color=\"secondary\"\n          ariaLabel={oldLang('Chat.PlayOnceVoiceMessageTooltip')}\n          onClick={toogleViewOnceEnabled}\n        >\n          <Icon name=\"view-once\" />\n          <Icon name=\"one-filled\" />\n        </Button>\n      )}\n      {activeVoiceRecording && (\n        <Button\n          round\n          color=\"danger\"\n          className=\"cancel\"\n          onClick={stopRecordingVoice}\n          ariaLabel=\"Cancel voice recording\"\n        >\n          <Icon name=\"delete\" />\n        </Button>\n      )}\n      {isInStoryViewer && !activeVoiceRecording && (\n        <Button\n          round\n          className=\"story-reaction-button\"\n          color=\"secondary\"\n          onClick={handleLikeStory}\n          onContextMenu={handleStoryPickerContextMenu}\n          onMouseDown={handleBeforeStoryPickerContextMenu}\n          ariaLabel={oldLang('AccDescrLike')}\n          ref={storyReactionRef}\n        >\n          {sentStoryReaction && (\n            <ReactionAnimatedEmoji\n              key={getReactionKey(sentStoryReaction)}\n              containerId={getStoryKey(chatId, storyId!)}\n              reaction={sentStoryReaction}\n              withEffectOnly={isSentStoryReactionHeart}\n            />\n          )}\n          {(!sentStoryReaction || isSentStoryReactionHeart) && (\n            <Icon name=\"heart\" className={buildClassName(isSentStoryReactionHeart && 'story-reaction-heart')} />\n          )}\n        </Button>\n      )}\n      <Button\n        ref={mainButtonRef}\n        round\n        color=\"secondary\"\n        className={buildClassName(\n          mainButtonState,\n          'main-button',\n          !isReady && 'not-ready',\n          activeVoiceRecording && 'recording',\n        )}\n        disabled={areVoiceMessagesNotAllowed}\n        allowDisabledClick\n        noFastClick\n        ariaLabel={oldLang(sendButtonAriaLabel)}\n        onClick={mainButtonHandler}\n        onContextMenu={\n          mainButtonState === MainButtonState.Send && canShowCustomSendMenu ? handleContextMenu : undefined\n        }\n      >\n        <Icon name=\"send\" />\n        <Icon name=\"microphone-alt\" />\n        {onForward && <Icon name=\"forward\" />}\n        {isInMessageList && <Icon name=\"schedule\" />}\n        {isInMessageList && <Icon name=\"check\" />}\n        <Button\n          className={buildClassName('paidStarsBadge', shouldRenderPaidBadge && 'visible')}\n          nonInteractive\n          size=\"tiny\"\n          color=\"stars\"\n          pill\n          fluid\n        >\n          <div className=\"paidStarsBadgeText\">\n            <Icon name=\"star\" className={buildClassName('star-amount-icon', className)} />\n            <AnimatedCounter\n              ref={counterRef}\n              text={lang.number(starsForAllMessages)}\n            />\n          </div>\n        </Button>\n      </Button>\n      {effectEmoji && (\n        <span className=\"effect-icon\" onClick={handleRemoveEffect}>\n          {renderText(effectEmoji)}\n        </span>\n      )}\n      {effect && canPlayEffect && (\n        <MessageEffect\n          shouldPlay={shouldPlayEffect}\n          effect={effect}\n          onStop={handleStopEffect}\n        />\n      )}\n      {canShowCustomSendMenu && (\n        <CustomSendMenu\n          isOpen={isCustomSendMenuOpen}\n          canSchedule={!paidMessagesStars && isInMessageList && !isViewOnceEnabled}\n          canScheduleUntilOnline={canScheduleUntilOnline && !isViewOnceEnabled}\n          onSendSilent={!isChatWithSelf ? handleSendSilent : undefined}\n          onSendSchedule={!isInScheduledList ? handleSendScheduled : undefined}\n          onSendWhenOnline={handleSendWhenOnline}\n          onRemoveEffect={handleRemoveEffect}\n          onClose={handleContextMenuClose}\n          onCloseAnimationEnd={handleContextMenuHide}\n          isSavedMessages={isChatWithSelf}\n          chatId={chatId}\n          withEffects={areEffectsSupported}\n          hasCurrentEffect={Boolean(effect)}\n          effectReactions={effectReactions}\n          allAvailableReactions={availableReactions}\n          onToggleReaction={handleToggleEffectReaction}\n          isCurrentUserPremium={isCurrentUserPremium}\n          isInSavedMessages={isChatWithSelf}\n          isInStoryViewer={isInStoryViewer}\n          canPlayAnimatedEmojis={canPlayAnimatedEmojis}\n        />\n      )}\n      {calendar}\n      <PaymentMessageConfirmDialog\n        isOpen={isPaymentMessageConfirmDialogOpen}\n        onClose={closeConfirmModalPayForMessage}\n        userName={chat ? getPeerTitle(lang, chat) : undefined}\n        messagePriceInStars={paidMessagesStars || 0}\n        messagesCount={messagesCount}\n        shouldAutoApprove={shouldPaidMessageAutoApprove}\n        setAutoApprove={setShouldPaidMessageAutoApprove}\n        confirmHandler={paymentMessageConfirmDialogHandler}\n      />\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, {\n    chatId, threadId, storyId, messageListType, isMobile, type,\n  }): StateProps => {\n    const chat = selectChat(global, chatId);\n    const chatBot = !isSystemBot(chatId) ? selectBot(global, chatId) : undefined;\n    const isChatWithBot = Boolean(chatBot);\n    const isChatWithSelf = selectIsChatWithSelf(global, chatId);\n    const isChatWithUser = isUserId(chatId);\n    const userFullInfo = isChatWithUser ? selectUserFullInfo(global, chatId) : undefined;\n    const paidMessagesStars = selectPeerPaidMessagesStars(global, chatId);\n\n    const chatFullInfo = !isChatWithUser ? selectChatFullInfo(global, chatId) : undefined;\n    const messageWithActualBotKeyboard = (isChatWithBot || !isChatWithUser)\n      && selectNewestMessageWithBotKeyboardButtons(global, chatId, threadId);\n    const {\n      shouldSuggestStickers, shouldSuggestCustomEmoji, shouldUpdateStickerSetOrder, shouldPaidMessageAutoApprove,\n    } = global.settings.byKey;\n    const { language, shouldCollectDebugLogs } = selectSharedSettings(global);\n    const {\n      forwardMessages: { messageIds: forwardMessageIds },\n    } = selectTabState(global);\n    const baseEmojiKeywords = global.emojiKeywords[BASE_EMOJI_KEYWORD_LANG];\n    const emojiKeywords = language !== BASE_EMOJI_KEYWORD_LANG ? global.emojiKeywords[language] : undefined;\n    const botKeyboardMessageId = messageWithActualBotKeyboard ? messageWithActualBotKeyboard.id : undefined;\n    const keyboardMessage = botKeyboardMessageId ? selectChatMessage(global, chatId, botKeyboardMessageId) : undefined;\n    const { currentUserId } = global;\n    const currentUser = selectUser(global, currentUserId!)!;\n    const defaultSendAsId = chatFullInfo ? chatFullInfo?.sendAsId || currentUserId : undefined;\n    const sendAsId = chat?.sendAsPeerIds && defaultSendAsId && (\n      chat.sendAsPeerIds.some((peer) => peer.id === defaultSendAsId)\n        ? defaultSendAsId\n        : (chat?.adminRights?.anonymous ? chat?.id : undefined)\n    );\n    const sendAsUser = sendAsId ? selectUser(global, sendAsId) : undefined;\n    const sendAsChat = !sendAsUser && sendAsId ? selectChat(global, sendAsId) : undefined;\n    const requestedDraft = selectRequestedDraft(global, chatId);\n    const requestedDraftFiles = selectRequestedDraftFiles(global, chatId);\n\n    const tabState = selectTabState(global);\n    const isStoryViewerOpen = Boolean(tabState.storyViewer.storyId);\n\n    const currentMessageList = selectCurrentMessageList(global);\n    const isForCurrentMessageList = chatId === currentMessageList?.chatId\n      && threadId === currentMessageList?.threadId\n      && messageListType === currentMessageList?.type\n      && !isStoryViewerOpen;\n    const user = selectUser(global, chatId);\n    const canSendVoiceByPrivacy = (user && !userFullInfo?.noVoiceMessages) ?? true;\n    const slowMode = chatFullInfo?.slowMode;\n    const isCurrentUserPremium = selectIsCurrentUserPremium(global);\n\n    const editingDraft = messageListType === 'scheduled'\n      ? selectEditingScheduledDraft(global, chatId)\n      : selectEditingDraft(global, chatId, threadId);\n\n    const story = storyId && selectPeerStory(global, chatId, storyId);\n    const sentStoryReaction = story && 'sentReaction' in story ? story.sentReaction : undefined;\n    const draft = selectDraft(global, chatId, threadId);\n    const replyToMessage = draft?.replyInfo\n      ? selectChatMessage(global, chatId, draft.replyInfo.replyToMsgId)\n      : undefined;\n    const replyToTopic = chat?.isForum && chat.isForumAsMessages && threadId === MAIN_THREAD_ID && replyToMessage\n      ? selectTopicFromMessage(global, replyToMessage)\n      : undefined;\n    const isInScheduledList = messageListType === 'scheduled';\n\n    const canSendQuickReplies = isChatWithUser && !isChatWithBot && !isInScheduledList && !isChatWithSelf;\n\n    const noWebPage = selectNoWebPage(global, chatId, threadId);\n    const isSilentPosting = chat && getChatNotifySettings(\n      chat,\n      selectNotifyDefaults(global),\n      selectNotifyException(global, chatId),\n    )?.isSilentPosting;\n\n    const areEffectsSupported = isChatWithUser && !isChatWithBot\n    && !isInScheduledList && !isChatWithSelf && type !== 'story' && chatId !== SERVICE_NOTIFICATIONS_USER_ID;\n    const canPlayEffect = selectPerformanceSettingsValue(global, 'stickerEffects');\n    const shouldPlayEffect = tabState.shouldPlayEffectInComposer;\n    const effectId = areEffectsSupported && draft?.effectId;\n    const effect = effectId ? global.availableEffectById[effectId] : undefined;\n    const effectReactions = global.reactions.effectReactions;\n\n    const maxMessageLength = global.config?.maxMessageLength || DEFAULT_MAX_MESSAGE_LENGTH;\n    const isForwarding = chatId === tabState.forwardMessages.toChatId;\n    const starsBalance = global.stars?.balance.amount || 0;\n    const isStarsBalanceModalOpen = Boolean(tabState.starsBalanceModal);\n    const isAccountFrozen = selectIsCurrentUserFrozen(global);\n    const isAppConfigLoaded = global.isAppConfigLoaded;\n\n    return {\n      availableReactions: global.reactions.availableReactions,\n      topReactions: type === 'story' ? global.reactions.topReactions : undefined,\n      isOnActiveTab: !tabState.isBlurred,\n      editingMessage: selectEditingMessage(global, chatId, threadId, messageListType),\n      draft,\n      chat,\n      isChatWithBot,\n      isChatWithSelf,\n      isForCurrentMessageList,\n      canScheduleUntilOnline: selectCanScheduleUntilOnline(global, chatId),\n      isChannel: chat ? isChatChannel(chat) : undefined,\n      isRightColumnShown: selectIsRightColumnShown(global, isMobile),\n      isSelectModeActive: selectIsInSelectMode(global),\n      withScheduledButton: (\n        messageListType === 'thread'\n        && (userFullInfo || chatFullInfo)?.hasScheduledMessages\n      ),\n      isInScheduledList,\n      botKeyboardMessageId,\n      botKeyboardPlaceholder: keyboardMessage?.keyboardPlaceholder,\n      isForwarding,\n      forwardedMessagesCount: isForwarding ? forwardMessageIds!.length : undefined,\n      pollModal: tabState.pollModal,\n      stickersForEmoji: global.stickers.forEmoji.stickers,\n      customEmojiForEmoji: global.customEmojis.forEmoji.stickers,\n      chatFullInfo,\n      topInlineBotIds: global.topInlineBots?.userIds,\n      currentUserId,\n      currentUser,\n      contentToBeScheduled: tabState.contentToBeScheduled,\n      shouldSuggestStickers,\n      shouldSuggestCustomEmoji,\n      shouldUpdateStickerSetOrder,\n      recentEmojis: global.recentEmojis,\n      baseEmojiKeywords: baseEmojiKeywords?.keywords,\n      emojiKeywords: emojiKeywords?.keywords,\n      inlineBots: tabState.inlineBots.byUsername,\n      isInlineBotLoading: tabState.inlineBots.isLoading,\n      botCommands: userFullInfo ? (userFullInfo.botInfo?.commands || false) : undefined,\n      botMenuButton: userFullInfo?.botInfo?.menuButton,\n      sendAsUser,\n      sendAsChat,\n      sendAsId,\n      editingDraft,\n      requestedDraft,\n      requestedDraftFiles,\n      attachBots: global.attachMenu.bots,\n      attachMenuPeerType: selectChatType(global, chatId),\n      theme: selectTheme(global),\n      fileSizeLimit: selectCurrentLimit(global, 'uploadMaxFileparts') * MAX_UPLOAD_FILEPART_SIZE,\n      captionLimit: selectCurrentLimit(global, 'captionLength'),\n      isCurrentUserPremium,\n      canSendVoiceByPrivacy,\n      attachmentSettings: global.attachmentSettings,\n      slowMode,\n      currentMessageList,\n      isReactionPickerOpen: selectIsReactionPickerOpen(global),\n      canBuyPremium: !isCurrentUserPremium && !selectIsPremiumPurchaseBlocked(global),\n      canPlayAnimatedEmojis: selectCanPlayAnimatedEmojis(global),\n      canSendOneTimeMedia: !isChatWithSelf && isChatWithUser && !isChatWithBot && !isInScheduledList,\n      shouldCollectDebugLogs,\n      sentStoryReaction,\n      stealthMode: global.stories.stealthMode,\n      replyToTopic,\n      quickReplyMessages: global.quickReplies.messagesById,\n      quickReplies: global.quickReplies.byId,\n      canSendQuickReplies,\n      noWebPage,\n      webPagePreview: selectTabState(global).webPagePreview,\n      isContactRequirePremium: userFullInfo?.isContactRequirePremium,\n      effect,\n      effectReactions,\n      areEffectsSupported,\n      canPlayEffect,\n      shouldPlayEffect,\n      maxMessageLength,\n      paidMessagesStars,\n      shouldPaidMessageAutoApprove,\n      isSilentPosting,\n      isPaymentMessageConfirmDialogOpen: tabState.isPaymentMessageConfirmDialogOpen,\n      starsBalance,\n      isStarsBalanceModalOpen,\n      shouldDisplayGiftsButton: userFullInfo?.shouldDisplayGiftsButton,\n      disallowedGifts: userFullInfo?.disallowedGifts,\n      isAccountFrozen,\n      isAppConfigLoaded,\n    };\n  },\n)(Composer));\n","import { useState } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiAttachment, ApiMessage } from '../../../../api/types';\n\nimport { canReplaceMessageMedia, getAttachmentMediaType } from '../../../../global/helpers';\nimport { MEMO_EMPTY_ARRAY } from '../../../../util/memo';\nimport buildAttachment from '../helpers/buildAttachment';\n\nimport useLastCallback from '../../../../hooks/useLastCallback';\nimport useOldLang from '../../../../hooks/useOldLang';\n\nexport default function useAttachmentModal({\n  attachments,\n  fileSizeLimit,\n  setHtml,\n  setAttachments,\n  chatId,\n  canSendAudios,\n  canSendVideos,\n  canSendPhotos,\n  canSendDocuments,\n  insertNextText,\n  editedMessage,\n}: {\n  attachments: ApiAttachment[];\n  fileSizeLimit: number;\n  setHtml: (html: string) => void;\n  setAttachments: (attachments: ApiAttachment[]) => void;\n  chatId: string;\n  canSendAudios?: boolean;\n  canSendVideos?: boolean;\n  canSendPhotos?: boolean;\n  canSendDocuments?: boolean;\n  insertNextText: VoidFunction;\n  editedMessage: ApiMessage | undefined;\n}) {\n  const lang = useOldLang();\n  const { openLimitReachedModal, showAllowedMessageTypesNotification, showNotification } = getActions();\n  const [shouldForceAsFile, setShouldForceAsFile] = useState<boolean>(false);\n  const [shouldForceCompression, setShouldForceCompression] = useState<boolean>(false);\n  const [shouldSuggestCompression, setShouldSuggestCompression] = useState<boolean | undefined>(undefined);\n\n  const handleClearAttachments = useLastCallback(() => {\n    setAttachments(MEMO_EMPTY_ARRAY);\n    insertNextText();\n  });\n\n  const handleSetAttachments = useLastCallback(\n    (newValue: ApiAttachment[] | ((current: ApiAttachment[]) => ApiAttachment[])) => {\n      const newAttachments = typeof newValue === 'function' ? newValue(attachments) : newValue;\n      if (!newAttachments.length) {\n        handleClearAttachments();\n        return;\n      }\n\n      if (newAttachments.some((attachment) => {\n        const type = getAttachmentMediaType(attachment);\n\n        return (type === 'audio' && !canSendAudios && !canSendDocuments)\n          || (type === 'video' && !canSendVideos && !canSendDocuments)\n          || (type === 'photo' && !canSendPhotos && !canSendDocuments)\n          || (type === 'file' && !canSendDocuments);\n      })) {\n        showAllowedMessageTypesNotification({ chatId });\n      } else if (newAttachments.some(({ size }) => size > fileSizeLimit)) {\n        openLimitReachedModal({\n          limit: 'uploadMaxFileparts',\n        });\n      } else {\n        setAttachments(newAttachments);\n        const shouldForce = newAttachments.some((attachment) => {\n          const type = getAttachmentMediaType(attachment);\n\n          return (type === 'audio' && !canSendAudios)\n            || (type === 'video' && !canSendVideos)\n            || (type === 'photo' && !canSendPhotos);\n        });\n\n        setShouldForceAsFile(Boolean(shouldForce && canSendDocuments));\n        setShouldForceCompression(!canSendDocuments);\n      }\n    },\n  );\n\n  const handleAppendFiles = useLastCallback(async (files: File[], isSpoiler?: boolean) => {\n    if (editedMessage) {\n      const newAttachment = await buildAttachment(files[0].name, files[0]);\n      const canReplace = editedMessage && canReplaceMessageMedia(editedMessage, newAttachment);\n\n      if (editedMessage?.groupedId) {\n        if (canReplace) {\n          handleSetAttachments([newAttachment]);\n        } else {\n          showNotification({ message: lang('lng_edit_media_album_error') });\n        }\n      } else {\n        handleSetAttachments([newAttachment]);\n      }\n    } else {\n      const newAttachments = await Promise.all(files.map((file) => (\n        buildAttachment(file.name, file, { shouldSendAsSpoiler: isSpoiler || undefined })\n      )));\n      handleSetAttachments([...attachments, ...newAttachments]);\n    }\n  });\n\n  const handleFileSelect = useLastCallback(async (files: File[], suggestCompression?: boolean) => {\n    if (editedMessage) {\n      const newAttachment = await buildAttachment(files[0].name, files[0]);\n      const canReplace = editedMessage && canReplaceMessageMedia(editedMessage, newAttachment);\n\n      if (editedMessage?.groupedId) {\n        if (canReplace) {\n          handleSetAttachments([newAttachment]);\n        } else {\n          showNotification({ message: lang('lng_edit_media_album_error') });\n        }\n      } else {\n        handleSetAttachments([newAttachment]);\n      }\n    } else {\n      const newAttachments = await Promise.all(files.map((file) => buildAttachment(file.name, file)));\n      handleSetAttachments(newAttachments);\n    }\n    setShouldSuggestCompression(suggestCompression);\n  });\n\n  return {\n    shouldSuggestCompression,\n    handleAppendFiles,\n    handleFileSelect,\n    onCaptionUpdate: setHtml,\n    handleClearAttachments,\n    handleSetAttachments,\n    shouldForceCompression,\n    shouldForceAsFile,\n  };\n}\n","import { useEffect, useRef, useState } from '../../../../lib/teact/teact';\n\nimport { requestMutation } from '../../../../lib/fasterdom/fasterdom';\nimport { IS_SAFARI, IS_VOICE_RECORDING_SUPPORTED } from '../../../../util/browser/windowEnvironment';\nimport captureEscKeyListener from '../../../../util/captureEscKeyListener';\nimport * as voiceRecording from '../../../../util/voiceRecording';\n\nimport useLastCallback from '../../../../hooks/useLastCallback';\n\ntype ActiveVoiceRecording =\n  { stop: () => Promise<voiceRecording.Result>; pause: NoneToVoidFunction }\n  | undefined;\n\nconst useVoiceRecording = () => {\n  // eslint-disable-next-line no-null/no-null\n  const recordButtonRef = useRef<HTMLButtonElement>(null);\n  const [activeVoiceRecording, setActiveVoiceRecording] = useState<ActiveVoiceRecording>();\n  const startRecordTimeRef = useRef<number>();\n  const [currentRecordTime, setCurrentRecordTime] = useState<number | undefined>();\n  const [isViewOnceEnabled, setIsViewOnceEnabled] = useState(false);\n\n  useEffect(() => {\n    // Preloading worker fixes silent first record on iOS\n    if (IS_SAFARI && IS_VOICE_RECORDING_SUPPORTED) {\n      void voiceRecording.init();\n    }\n  }, []);\n\n  const startRecordingVoice = useLastCallback(async () => {\n    try {\n      const { stop, pause } = await voiceRecording.start((tickVolume: number) => {\n        if (recordButtonRef.current) {\n          if (startRecordTimeRef.current && Date.now() % 4 === 0) {\n            requestMutation(() => {\n              if (!recordButtonRef.current) return;\n              recordButtonRef.current.style.boxShadow = `0 0 0 ${(tickVolume || 0) * 50}px rgba(0,0,0,.15)`;\n            });\n          }\n          setCurrentRecordTime(Date.now());\n        }\n      });\n      startRecordTimeRef.current = Date.now();\n      setCurrentRecordTime(Date.now());\n\n      setActiveVoiceRecording({ stop, pause });\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n    }\n  });\n\n  const pauseRecordingVoice = useLastCallback(() => {\n    if (!activeVoiceRecording) {\n      return undefined;\n    }\n\n    requestMutation(() => {\n      if (recordButtonRef.current) {\n        recordButtonRef.current!.style.boxShadow = 'none';\n      }\n    });\n\n    try {\n      return activeVoiceRecording!.pause();\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n      return undefined;\n    }\n  });\n\n  const stopRecordingVoice = useLastCallback(() => {\n    if (!activeVoiceRecording) {\n      return undefined;\n    }\n\n    setActiveVoiceRecording(undefined);\n    startRecordTimeRef.current = undefined;\n    setCurrentRecordTime(undefined);\n\n    requestMutation(() => {\n      if (recordButtonRef.current) {\n        recordButtonRef.current.style.boxShadow = 'none';\n      }\n    });\n\n    try {\n      return activeVoiceRecording!.stop();\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n      return undefined;\n    }\n  });\n\n  useEffect(() => {\n    return activeVoiceRecording ? captureEscKeyListener(stopRecordingVoice) : undefined;\n  }, [activeVoiceRecording, stopRecordingVoice]);\n\n  const toogleViewOnceEnabled = useLastCallback(() => {\n    setIsViewOnceEnabled(!isViewOnceEnabled);\n  });\n\n  return {\n    startRecordingVoice,\n    pauseRecordingVoice,\n    stopRecordingVoice,\n    activeVoiceRecording,\n    currentRecordTime,\n    recordButtonRef,\n    startRecordTimeRef,\n    isViewOnceEnabled,\n    setIsViewOnceEnabled,\n    toogleViewOnceEnabled,\n  };\n};\n\nexport default useVoiceRecording;\n","export default function deleteLastCharacterOutsideSelection(html: string) {\n  const tempInput = document.createElement('div');\n  tempInput.contentEditable = 'true';\n  tempInput.style.position = 'absolute';\n  tempInput.style.left = '-10000px';\n  tempInput.style.top = '-10000px';\n  tempInput.innerHTML = html;\n  tempInput.className = 'allow-selection'; // Patch for Safari\n  document.body.appendChild(tempInput);\n  let element = tempInput.lastChild!;\n\n  if (element.lastChild) {\n    // Selects the last and the deepest child of the element.\n    while (element.lastChild) {\n      element = element.lastChild;\n    }\n  }\n\n  // Gets length of the element's content.\n  const textLength = element.textContent!.length;\n  const range = document.createRange();\n  const selection = window.getSelection()!;\n\n  // Sets selection position to the end of the element.\n  range.setStart(element, textLength);\n  range.setEnd(element, textLength);\n  selection.removeAllRanges();\n  selection.addRange(range);\n  document.execCommand('delete', false);\n\n  const result = tempInput.innerHTML;\n  document.body.removeChild(tempInput);\n\n  return result;\n}\n","/* eslint-disable max-len */\nimport React from 'react';\n\nimport SerenaIcon from '../assets/serena.png';\n\nconst suggestions = [\n  'Who is interested in early investments in GameFi projects?',\n  'Which meme KOLs are worth following?',\n  'Which of my contacts interacts with Paulo the most?',\n  'Which friends do Paulo and I share?',\n  'Find messages about Twitter Space collaboration.',\n];\nconst AISearchSugesstionsMessage = (props:{ handleSearch: (query:string)=>void }) => {\n  const { handleSearch } = props;\n  return (\n    <div className=\"flex flex-col mx-[22px]\">\n      <img className=\"w-[52px] h-[52px] rounded-full\" src={SerenaIcon} alt=\"\" />\n      <span className=\"font-bold text-[24px]\">AI Search</span>\n      <span className=\"mb-[12px] text-[14px]\">Intelligent deep search experience.</span>\n      {suggestions.map((item) => {\n        return (\n          <div className=\"px-[10px] py-[6px] mb-[8px] rounded-[8px] bg-[#F8F2FF] text-[14px]\" onClick={() => handleSearch(item)}>\n            {item}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default AISearchSugesstionsMessage;\n","// extracted by mini-css-extract-plugin\nexport default {\"introduceSummary\":\"rf6B3If7\",\"introducePortrait\":\"U5a8L5ja\",\"introduceTranslation\":\"o3wMHYSu\",\"introduceSmartreply\":\"rhP7CCVz\"};","/* eslint-disable max-len */\nimport React from 'react';\nimport { useSWRConfig } from 'swr';\nimport { getGlobal } from '../../../global';\n\nimport eventEmitter, { Actions } from '../lib/EventEmitter';\nimport { selectUser } from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport {\n  createIntroducePortraitMessage, createIntroduceReplyMessage, createIntroduceSummaryMessage, createIntroduceTranslationMessage,\n} from '../globalSummary/summary-utils';\nimport { ChataiStores } from '../store';\n\nimport './global-intoduce-message.scss';\nimport styles from './global-intoduce-message.module.scss';\n\nexport const GlobalIntroduceMessage = () => {\n  const { mutate } = useSWRConfig();\n  const global = getGlobal();\n  const { currentUserId } = global;\n  const currentUser = currentUserId ? selectUser(global, currentUserId) : undefined;\n  const sendSmartreplyIntroduceMessage = () => {\n    const message = createIntroduceReplyMessage();\n    ChataiStores.summary?.storeMessage(message);\n    eventEmitter.emit(Actions.AddSummaryMessage, message);\n    mutate('messages:should-scroll', 'smooth');\n  };\n  const sendSmmaryIntroduceMessage = () => {\n    const message = createIntroduceSummaryMessage();\n    ChataiStores.summary?.storeMessage(message);\n    eventEmitter.emit(Actions.AddSummaryMessage, message);\n    mutate('messages:should-scroll', 'smooth');\n  };\n  const sendPortraitIntroduceMessage = () => {\n    const message = createIntroducePortraitMessage();\n    ChataiStores.summary?.storeMessage(message);\n    eventEmitter.emit(Actions.AddSummaryMessage, message);\n    mutate('messages:should-scroll', 'smooth');\n  };\n  const sendTranslationIntroduceMessage = () => {\n    const message = createIntroduceTranslationMessage();\n    ChataiStores.summary?.storeMessage(message);\n    eventEmitter.emit(Actions.AddSummaryMessage, message);\n    mutate('messages:should-scroll', 'smooth');\n  };\n  return (\n    <div className=\"global-summary-introduce\">\n      <h3>Hi {[currentUser?.firstName, currentUser?.lastName].filter(Boolean).join(' ')} </h3>\n      <h3>How can I help you today</h3>\n      <div className=\"rounded-[16px] p-[15px] grid grid-cols-2 gap-[12px] w-[743px] mt-[10px] mb-[20px] bg-[var(--color-background)]\">\n        <div\n          className={buildClassName(styles.introduceSummary, 'global-summary-introduce-item')}\n          onClick={sendSmmaryIntroduceMessage}\n        >\n          <div className=\"text-[18px] font-bold mb-[10px] text-[var(--color-text)]\">\n             AI Summarize\n          </div>\n          <div className=\"text-[14px] leading-[18px] text-[var(--color-text-secondary)]\">\n            Auto-summarizes your messages and to-dos, and reports on demand.\n          </div>\n        </div>\n        <div\n          className={buildClassName(styles.introducePortrait, 'global-summary-introduce-item')}\n          onClick={sendPortraitIntroduceMessage}\n        >\n          <div className=\"text-[18px] font-bold mb-[10px] text-[var(--color-text)]\">\n             AI Portrait\n          </div>\n          <div className=\"text-[14px] leading-[18px] text-[var(--color-text-secondary)]\">\n            AI reads your chats to build a smart, personalized profileinstantly.\n          </div>\n        </div>\n        <div\n          className={buildClassName(styles.introduceTranslation, 'global-summary-introduce-item')}\n          onClick={sendTranslationIntroduceMessage}\n        >\n          <div className=\"text-[18px] font-bold mb-[10px] text-[var(--color-text)]\">\n             Translation &Grammar\n          </div>\n          <div className=\"text-[14px] leading-[18px] text-[var(--color-text-secondary)]\">\n            Real-time Translation &Grammar Check\n          </div>\n        </div>\n        <div\n          className={buildClassName(styles.introduceSmartreply, 'global-summary-introduce-item')}\n          onClick={sendSmartreplyIntroduceMessage}\n        >\n          <div className=\"text-[18px] font-bold mb-[10px] text-[var(--color-text)]\">\n             Smart Reply\n          </div>\n          <div className=\"text-[14px] leading-[18px] text-[var(--color-text-secondary)]\">\n            Generate personalized replies using conversation context and knowledge base.\n          </div>\n        </div>\n      </div>\n      <div>\n        <h5 className=\"text-[16px] font-normal mb-[16px]\"> You can also ask me like this</h5>\n        <div className=\"flex flex-row flex-wrap gap-[12px]\">\n          <div className=\"p-[8px] rounded-[16px] text-[14px] text-[var(--color-text)] bg-[var(--color-background)]\">\n            Summarize unread messages\n          </div>\n          <div className=\"p-[8px] rounded-[16px] text-[14px] text-[var(--color-text)] bg-[var(--color-background)]\">\n            What are the most discussed crypto today?\n          </div>\n          <div className=\"p-[8px] rounded-[16px] text-[14px] text-[var(--color-text)] bg-[var(--color-background)]\">\n            Help me schedule a meeting for 10 AM tomorrow\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","/* eslint-disable no-null/no-null */\nimport { useEffect, useRef, useState } from 'react';\n\nlet activeId: string | null = null;\n\ntype UseSpeechPlayerResult = {\n  isSpeaking: boolean;\n  speak: (text: string, options?: Partial<SpeechSynthesisUtterance>) => void;\n  stop: () => void;\n};\n\nconst listeners: Record<string, (playing: boolean) => void> = {};\n\nexport function useSpeechPlayer(id: string): UseSpeechPlayerResult {\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const localUtteranceRef = useRef<SpeechSynthesisUtterance | null>(null);\n\n  // \n  useEffect(() => {\n    listeners[id] = (playing) => setIsSpeaking(playing);\n    return () => {\n      delete listeners[id];\n    };\n  }, [id]);\n\n  const speak = (text: string, options: Partial<SpeechSynthesisUtterance> = {}) => {\n    // \n    if (speechSynthesis.speaking || speechSynthesis.pending) {\n      speechSynthesis.cancel();\n    }\n\n    const utterance = new SpeechSynthesisUtterance(text);\n    Object.assign(utterance, options);\n    activeId = id;\n    localUtteranceRef.current = utterance;\n\n    utterance.onend = () => {\n      if (activeId === id) {\n        listeners[id]?.(false);\n        activeId = null;\n      }\n    };\n\n    utterance.onerror = () => {\n      if (activeId === id) {\n        listeners[id]?.(false);\n        activeId = null;\n      }\n    };\n\n    //  speaking false\n    Object.entries(listeners).forEach(([key, fn]) => fn(key === id));\n    speechSynthesis.speak(utterance);\n  };\n\n  const stop = () => {\n    if (activeId === id && (speechSynthesis.speaking || speechSynthesis.pending)) {\n      speechSynthesis.cancel();\n      listeners[id]?.(false);\n      activeId = null;\n    }\n  };\n\n  return { isSpeaking, speak, stop };\n}\n","/* eslint-disable no-null/no-null */\n/* eslint-disable no-console */\n/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable max-len */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport type { Message } from 'ai';\nimport copy from 'copy-to-clipboard';\nimport { getActions, getGlobal } from '../../../global';\n\nimport type { CustomSummaryTemplate } from '../store/chatai-summary-template-store';\n\nimport { isUserId } from '../../../global/helpers';\nimport { selectChat, selectUser } from '../../../global/selectors';\nimport useOldLang from '../hook/useOldLang';\nimport { useSpeechPlayer } from '../hook/useSpeechPlayer';\nimport {\n  CopyIcon, DeleteIcon, VoiceIcon,\n  VoiceingIcon,\n} from '../icons';\nimport { cn, formatTimestamp, formatTimestampRange } from '../utils/util';\n\nimport Avatar from '../component/Avatar';\nimport ErrorBoundary from '../ErrorBoundary';\nimport { DrawerKey, useDrawerStore } from '../globalSummary/DrawerContext';\n\nimport ActionsIcon from '../assets/actions.png';\nimport CalendarIcon from '../assets/calendar.png';\nimport ChainTrendIcon from '../assets/chain-trend.png';\nimport CheckIcon from '../assets/check.png';\nimport KeyBusinessIcon from '../assets/key-business.png';\nimport MessageIcon from '../assets/message.png';\nimport SerenaLogoPath from '../assets/serena.png';\nimport UserIcon from '../assets/user.png';\nimport UserGroupIcon from '../assets/user-group.png';\nimport VectorIcon from '../assets/vector.png';\nimport WriteIcon from '../assets/write.png';\n\ninterface IProps {\n  message: Message;\n  deleteMessage: () => void;\n}\ninterface ISummaryInfo {\n  summaryMessageCount: number;\n  summaryStartTime: number;\n  summaryEndTime: number;\n  summaryChatIds: Array<string>;\n}\n\ninterface ISummaryTopicItem {\n  chatId:string;\n  chatRoomName: string;\n  title: string;\n  summaryItems: Array<{\n    content: string;\n    relevantMessageIds: Array<number>;\n  }>;\n}\n\ninterface ISummaryPendingItem {\n  chatId: string;\n  chatRoomName: string;\n  summary: string;\n  relevantMessageIds: number[];\n}\ninterface ISummaryGarbageItem {\n  chatId: string;\n  chatRoomName: string;\n  summary: string;\n  level: 'high' | 'low';\n  relevantMessageIds: number[];\n}\n\nconst CustomizationTopicIcon = {\n  'Most Discussed Coins': VectorIcon,\n  'Most Active Users': UserGroupIcon,\n  'Key business updates': KeyBusinessIcon,\n  'On-Chain Trending Topics': ChainTrendIcon,\n};\n\nconst ChatAvatar = ({\n  chatId, classNames, size, style,\n}: { chatId: string; classNames?: string; size:number;style?: { [key:string]:string } }) => {\n  const global = getGlobal();\n  let peer;\n  if (isUserId(chatId)) {\n    peer = selectUser(global, chatId);\n  } else {\n    peer = selectChat(global, chatId);\n  }\n\n  return (\n    <Avatar\n      style={style}\n      key={chatId}\n      className={cn(classNames, 'overlay-avatar inline-block cursor-pointer')}\n      size={size}\n      peer={peer}\n    />\n  );\n};\n\nconst SummaryTopicItem = ({ topicItem, index }: { topicItem: ISummaryTopicItem; index: number }) => {\n  const { title, summaryItems, chatId } = topicItem;\n  const { openDrawer } = useDrawerStore();\n  if (!summaryItems.length) return null;\n  if (!title) return null;\n  const showMessageDetail = (chatId: string, relevantMessageIds: number[]) => {\n    openDrawer(DrawerKey.OriginalMessages, {\n      relevantMessages: [{ chatId, messageIds: relevantMessageIds }],\n    });\n  };\n  return (\n    <ErrorBoundary>\n      <div>\n        <div className=\"flex flex-row items-center flex-wrap\">\n          <span className=\"text-[16px] font-bold mr-[24px]\">{index + 1}. {title}</span>\n          {chatId && (<ChatAvatar size={20} chatId={chatId} />)}\n        </div>\n        <ul className=\"list-disc pl-[2px] text-[16px] list-inside\">\n          {summaryItems.map((summaryItem: any) => {\n            const { content, relevantMessageIds } = summaryItem;\n            if (!content) return null;\n            return (\n              <li\n                role=\"button\"\n                className=\"cursor-pointer text-[15px] break-words\"\n                onClick={() => showMessageDetail(chatId, relevantMessageIds)}\n              >\n                {content}\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst SummaryPenddingItem = ({ pendingItem }: { pendingItem: ISummaryPendingItem }) => {\n  const { openDrawer } = useDrawerStore();\n  const showMessageDetail = () => {\n    openDrawer(DrawerKey.OriginalMessages, {\n      relevantMessages: [{ chatId: pendingItem.chatId, messageIds: pendingItem.relevantMessageIds }],\n    });\n  };\n  return (\n    <ErrorBoundary>\n      <div\n        className=\"flex gap-[8px] my-[4px] cursor-pointer\"\n        key={pendingItem.chatId}\n        onClick={showMessageDetail}\n      >\n        <img className=\"w-[18px] h-[18px] mt-[2px]\" src={CheckIcon} alt=\"\" />\n        <span className=\"text-[15px]\">{pendingItem.summary}</span>\n        <ChatAvatar size={20} chatId={pendingItem.chatId} />\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst SummaryGarbageItem = ({ garBageItem }: { garBageItem: ISummaryGarbageItem }) => {\n  const {\n    chatId, chatRoomName, level, summary, relevantMessageIds,\n  } = garBageItem;\n  const { openDrawer } = useDrawerStore();\n  const showMessageDetail = (chatId: string, relevantMessageIds: number[]) => {\n    openDrawer(DrawerKey.OriginalMessages, {\n      relevantMessages: [{ chatId, messageIds: relevantMessageIds }],\n    });\n  };\n  return (\n    <ErrorBoundary>\n      <div\n        className=\"flex justify-start gap-[8px] my-[16px]\"\n        key={garBageItem.chatId}\n        onClick={() => { showMessageDetail(chatId, relevantMessageIds); }}\n      >\n        <ChatAvatar chatId={chatId} size={44} />\n        <div>\n          <p className=\"text-[16px] font-semibold leading-[20px] mb-[4px]\">{chatRoomName}</p>\n          <div className=\"flex justify-start gap-[4px]\">\n            {level === 'high' ? (\n              <span className=\"text-[#FF543D] text-[14px] whitespace-nowrap\"> High-Risk</span>\n            ) : (\n              <span className=\"text-[#FF9B05] text-[14px] whitespace-nowrap\"> Low-Risk</span>\n            )}\n            <span className=\"text-[14px] text-[var(--color-text-secondary)]\">{summary}</span>\n          </div>\n        </div>\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst ActionsItems = ({\n  messageId,\n  summaryInfo,\n  mainTopic,\n  pendingMatters,\n  deleteMessage,\n}: {\n  messageId:string;\n  summaryInfo: ISummaryInfo | null;\n  mainTopic: ISummaryTopicItem[];\n  pendingMatters: ISummaryPendingItem[];\n  deleteMessage: () => void;\n}) => {\n  const lang = useOldLang();\n  const { showNotification } = getActions();\n  const { isSpeaking, speak, stop } = useSpeechPlayer(messageId);\n  const handleCopy = () => {\n    const { summaryStartTime, summaryEndTime } = summaryInfo || {};\n    const timeRange = formatTimestampRange(summaryStartTime, summaryEndTime);\n    const copyText = `Chat Summary\\nTime Range: ${timeRange}\\n\\nKey Topics:\\n${mainTopic.map((item:ISummaryTopicItem) => `${item.title}:\\n ${item.summaryItems.map((subItem) => subItem.content).join(';\\n ')}`).join('\\n')}\\n\\nActions Items:\\n${pendingMatters.map((item) => `${item.chatRoomName}: ${item.summary}`).join('\\n')}\\n`;\n    copy(copyText);\n    showNotification({\n      message: lang('TextCopied'),\n    });\n  };\n  const handleVoicePlay = () => {\n    const { summaryStartTime, summaryEndTime } = summaryInfo || {};\n    const timeRange = formatTimestampRange(summaryStartTime, summaryEndTime);\n    const voiceText = `Chat Summary\\nTime Range: ${timeRange}\\n\\nKey Topics:\\n${mainTopic.map((item:ISummaryTopicItem) => `${item.title}:\\n ${item.summaryItems.map((subItem) => subItem.content).join(';\\n ')}`).join('\\n')}\\n\\nActions Items:\\n${pendingMatters.map((item) => `${item.chatRoomName}: ${item.summary}`).join('\\n')}`;\n\n    if (isSpeaking) {\n      stop();\n    } else {\n      speak(voiceText);\n    }\n  };\n  return (\n    <div className=\"message-actions flex items-center gap-[8px]\">\n      <div className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\" onClick={handleCopy}>\n        <CopyIcon size={24} />\n      </div>\n      {isSpeaking ? (\n        <div\n          className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\"\n          onClick={stop}\n        >\n          <VoiceingIcon size={24} />\n        </div>\n      ) : (\n        <div\n          className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\"\n          onClick={handleVoicePlay}\n        >\n          <VoiceIcon size={24} />\n        </div>\n      )}\n      <div className=\"w-[20px] h-[20px] cursor-pointer\" onClick={deleteMessage}>\n        <DeleteIcon size={20} />\n      </div>\n    </div>\n  );\n};\n\nconst SummaryInfoContent = ({ summaryInfo }:{ summaryInfo:ISummaryInfo }) => {\n  return (\n    <ErrorBoundary>\n      <div>\n        <div className=\"flex items-center gap-[8px]\">\n          <img className=\"w-[52px] h-[52px] rounded-full ml-[-60px]\" src={SerenaLogoPath} alt=\"\" />\n          <div>\n            <p className=\"text-[16px] font-semibold\">Serena</p>\n            {summaryInfo?.summaryEndTime ? (\n              <p className=\"text-[14px] text-[#A8A6AC]\">{formatTimestamp(summaryInfo.summaryEndTime)}</p>\n            ) : null}\n          </div>\n        </div>\n        <p className=\"text-[22px] font-bold mb-[16px]\">Chat Summary</p>\n        <div className=\"flex items-center gap-[20px]\">\n          <p className=\"flex items-center gap-[8px]\">\n            <img className=\"w-[16px] h-[16px]\" src={CalendarIcon} alt=\"\" />\n            <div className=\"flex items-center gap-[4px]\">\n              <span className=\"mr-[4px] font-bold text-[14px]\">Time range:</span>\n              {formatTimestampRange(summaryInfo?.summaryStartTime, summaryInfo?.summaryEndTime)}\n            </div>\n          </p>\n          <p className=\"flex items-center gap-[8px]\">\n            <img className=\"w-[16px] h-[16px]\" src={MessageIcon} alt=\"\" />\n            <div className=\"flex items-center gap-[4px]\">\n              <span className=\"font-bold text-[14px]\">Messages:</span>\n              {summaryInfo?.summaryMessageCount ? (\n                <span>{summaryInfo?.summaryMessageCount}</span>\n              ) : null}\n            </div>\n          </p>\n        </div>\n        {summaryInfo?.summaryChatIds ? (\n          <div className=\"flex items-center gap-[8px] mb-[18px]\">\n            <img className=\"w-[16px] h-[16px]\" src={UserIcon} alt=\"\" />\n            <span className=\"font-bold text-[14px]\">Groups/friends: </span>\n            <div className=\"flex items-center\">\n              {summaryInfo.summaryChatIds.slice(0, 10).map((id: string, index: number) => {\n                return (\n                  <ChatAvatar\n                    style={{ zIndex: `${String(summaryInfo.summaryChatIds.length - index)};` }}\n                    chatId={id}\n                    size={24}\n                    classNames=\"summary-avatar-group !border-solid-[2px] !border-white ml-[-4px]\"\n                    key={id}\n                  />\n                );\n              })}\n              {summaryInfo.summaryChatIds.length > 10 ? (\n                <div className=\"w-[24px] h-[24px] rounded-full bg-[#979797] text-[12px] whitespace-nowrap flex items-center justify-center\">{summaryInfo.summaryChatIds.length - 10}+</div>\n              ) : null}\n            </div>\n          </div>\n        ) : null}\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst MainSummaryContent = ({\n  messageId,\n  customizationTemplate,\n  summaryInfo,\n  customizationTopic,\n  mainTopic,\n  pendingMatters,\n  deleteMessage,\n}: {\n  messageId:string;\n  customizationTemplate:CustomSummaryTemplate | null;\n  summaryInfo: ISummaryInfo | null;\n  customizationTopic: ISummaryTopicItem[];\n  mainTopic: ISummaryTopicItem[];\n  pendingMatters: ISummaryPendingItem[];\n  deleteMessage: () => void;\n}) => {\n  return (\n    <div className=\"w-max-[693px] rounded-[10px] pl-[82px] pr-[25px] pt-[20px] pb-[25px] bg-[var(--color-background)]\">\n      {/* summary info  */}\n      {summaryInfo && <SummaryInfoContent summaryInfo={summaryInfo} />}\n      {/* customization topic  */}\n      {customizationTopic.length > 0 && customizationTemplate && (\n        <div>\n          <p className=\"flex items-center gap-[8px] mb-[16px]\">\n            <span className=\"text-[18px] font-bold\">{customizationTemplate.title}</span>\n            {\n              CustomizationTopicIcon?.[customizationTemplate.title as keyof typeof CustomizationTopicIcon] ? (\n                <img className=\"w-[16px] h-[16px]\" src={CustomizationTopicIcon?.[customizationTemplate.title as keyof typeof CustomizationTopicIcon]} alt=\"\" />\n              ) : (\n                <img className=\"w-[16px] h-[16px]\" src={WriteIcon} alt=\"\" />\n              )\n            }\n          </p>\n          {customizationTopic.map((item, index) => (\n            <SummaryTopicItem topicItem={item} index={index} />\n          ))}\n        </div>\n      )}\n      {/* maintopic  */}\n      {mainTopic.length > 0 && (\n        <div>\n          <p className=\"flex items-center gap-[8px] mb-[16px]\">\n            <span className=\"text-[18px] font-bold\">Key Topics</span>\n            <img className=\"w-[16px] h-[16px]\" src={WriteIcon} alt=\"\" />\n          </p>\n          {mainTopic.map((item, index) => (\n            <SummaryTopicItem topicItem={item} index={index} key={item.title} />\n          ))}\n        </div>\n      )}\n      {/* pending actions  */}\n      {pendingMatters.length > 0 && (\n        <div>\n          <p className=\"flex items-center gap-[8px] mb-[16px]\">\n            <span className=\"text-[18px] font-bold\">Actions Items</span>\n            <img className=\"w-[16px] h-[16px]\" src={ActionsIcon} alt=\"\" />\n          </p>\n          {pendingMatters.map((item) => (<SummaryPenddingItem pendingItem={item} />))}\n        </div>\n      )}\n      {/* action buttons  */}\n      <ActionsItems messageId={messageId} summaryInfo={summaryInfo} mainTopic={mainTopic} pendingMatters={pendingMatters} deleteMessage={deleteMessage} />\n    </div>\n  );\n};\nconst SummaryContent = ({\n  messageId,\n  customizationTemplate,\n  summaryInfo,\n  customizationTopic,\n  mainTopic,\n  pendingMatters,\n  garbageMessage,\n  deleteMessage,\n}:\n{\n  messageId: string;\n  customizationTemplate:CustomSummaryTemplate | null;\n  summaryInfo: ISummaryInfo | null;\n  customizationTopic: ISummaryTopicItem[];\n  mainTopic: ISummaryTopicItem[];\n  pendingMatters: ISummaryPendingItem[];\n  garbageMessage: ISummaryGarbageItem[];\n  deleteMessage: () => void;\n}) => {\n  return (\n    <>\n      {(!mainTopic.length && !pendingMatters.length && !customizationTopic.length) ? null : (\n        <MainSummaryContent\n          messageId={messageId}\n          customizationTemplate={customizationTemplate}\n          customizationTopic={customizationTopic}\n          summaryInfo={summaryInfo}\n          mainTopic={mainTopic}\n          pendingMatters={pendingMatters}\n          deleteMessage={deleteMessage}\n        />\n      )}\n\n      {garbageMessage && garbageMessage.length > 0 && (\n        <div className=\"w-max-[693px] rounded-[10px] bg-[var(--color-background)] pl-[82px] pr-[25px] pt-[20px] pb-[25px] mt-[10px]\">\n          <div className=\"flex items-center gap-[8px]\">\n            <img className=\"w-[52px] h-[52px] rounded-full ml-[-60px]\" src={SerenaLogoPath} alt=\"\" />\n            <div>\n              <p className=\"text-[16px] font-semibold\">Serena</p>\n              {summaryInfo?.summaryEndTime ? (\n                <p className=\"text-[14px] text-[#A8A6AC]\">{formatTimestamp(summaryInfo.summaryEndTime)}</p>\n              ) : null}\n            </div>\n          </div>\n          <p className=\"text-[22px] font-bold mb-[16px]\">Spam Filtering</p>\n          <div className=\"flex items-center gap-[20px]\">\n            <p className=\"flex items-center gap-[8px]\">\n              <img className=\"w-[16px] h-[16px]\" src={CalendarIcon} alt=\"\" />\n              <div className=\"flex items-center\">\n                <span className=\"mr-[4px]\">Time range:</span>\n                {formatTimestampRange(summaryInfo?.summaryStartTime, summaryInfo?.summaryEndTime)}\n              </div>\n            </p>\n          </div>\n          {garbageMessage.map((item) => (<SummaryGarbageItem garBageItem={item} />))}\n        </div>\n      )}\n    </>\n  );\n};\nconst GlobalSummaryMessage = (props: IProps) => {\n  const { message, deleteMessage } = props;\n  const [summaryInfo, setSummaryInfo] = useState<ISummaryInfo | null>(null);\n  const [customizationTemplate, setCustomizationTemplate] = useState<CustomSummaryTemplate | null>(null);\n  const [customizationTopic, setCustomizationTopic] = useState<ISummaryTopicItem[]>([]);\n  const [mainTopic, setMainTopic] = useState<ISummaryTopicItem[]>([]);\n  const [pendingMatters, setPendingMatters] = useState<ISummaryPendingItem[]>([]);\n  const [garbageMessage, setGarbageMessage] = useState<ISummaryGarbageItem[]>([]);\n  const parseMessage = useCallback((messageContent: string) => {\n    const messageObj = JSON.parse(messageContent);\n    const {\n      mainTopic, pendingMatters, garbageMessage, customizationTopic, summaryInfo, customizationTemplate,\n    } = messageObj;\n    if (customizationTopic) {\n      setCustomizationTopic(customizationTopic as ISummaryTopicItem[]);\n    }\n    if (mainTopic) {\n      setMainTopic(mainTopic as ISummaryTopicItem[]);\n    }\n    if (pendingMatters) {\n      setPendingMatters(pendingMatters as ISummaryPendingItem[]);\n    }\n    if (garbageMessage) {\n      setGarbageMessage(garbageMessage as ISummaryGarbageItem[]);\n    }\n    if (summaryInfo) {\n      setSummaryInfo(summaryInfo as ISummaryInfo);\n    }\n    if (customizationTemplate) {\n      setCustomizationTemplate(customizationTemplate);\n    }\n  }, []);\n  useEffect(() => {\n    try {\n      parseMessage(message.content);\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  }, [message, parseMessage]);\n  if (!summaryInfo) {\n    return null;\n  }\n  return (\n    <SummaryContent\n      messageId={message.id}\n      customizationTopic={customizationTopic}\n      customizationTemplate={customizationTemplate}\n      summaryInfo={summaryInfo}\n      mainTopic={mainTopic}\n      pendingMatters={pendingMatters}\n      garbageMessage={garbageMessage}\n      deleteMessage={deleteMessage}\n    />\n  );\n};\n\nexport default GlobalSummaryMessage;\n","/* eslint-disable max-len */\n/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable no-console */\n/* eslint-disable no-null/no-null */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport type { ITimezone } from 'react-timezone-select';\nimport TimezoneSelect from 'react-timezone-select';\nimport type { Message } from 'ai';\nimport {\n  Button, ConfigProvider, DatePicker, Input,\n  theme,\n} from 'antd';\nimport type { RangePickerProps } from 'antd/es/date-picker';\nimport type { Dayjs } from 'dayjs';\nimport dayjs from 'dayjs';\nimport type { ITimezoneOption } from 'react-timezone-select/dist/index.d';\nimport { getGlobal } from '../../../global';\n\nimport eventEmitter, { Actions } from '../lib/EventEmitter';\nimport { selectTheme } from '../../../global/selectors';\nimport { CHATAI_IDB_STORE } from '../../../util/browser/idb';\nimport { CloseIcon } from '../icons';\n\nimport CalendarIcon from '../assets/calendar.png';\nimport DefaultAvatar from '../assets/default-avatar.png';\nimport GoogleMeetIcon from '../assets/google-meet.png';\nimport UserIcon from '../assets/user.png';\nimport WriteIcon from '../assets/write.png';\n\nexport const FormLabel = (props: { lable: 'title' | 'time' | 'guests' | 'meet' }) => {\n  const [title, setTitle] = useState('');\n  const [icon, setIcon] = useState('');\n  const { lable: label } = props;\n  useEffect(() => {\n    switch (label) {\n      case 'title':\n        setIcon(WriteIcon);\n        setTitle('Title');\n        break;\n      case 'time':\n        setIcon(CalendarIcon);\n        setTitle('Time');\n        break;\n      case 'guests':\n        setIcon(UserIcon);\n        setTitle('Guests');\n        break;\n      case 'meet':\n        setIcon(GoogleMeetIcon);\n        setTitle('Meeting link');\n        break;\n    }\n  }, [label]);\n  return (\n    <div className=\"flex items-center gap-[8px]\">\n      <img src={icon} alt=\"\" className=\"w-[16px] h-[16px]\" />\n      <span className=\"text-[14px] font-semibold\">{title}</span>\n    </div>\n  );\n};\n\nconst ErrorTip = ({ message }: { message: string }) => {\n  return (\n    <div className=\"text-[12px] leading-[18px] text-red-400\">{message}</div>\n  );\n};\n\nconst EmailItem = ({ email, onDelete }: { email: string; onDelete: (email: string) => void }) => {\n  return (\n    <div className=\"flex items-center gap-[8px] py-[10px]\">\n      <img className=\"w-[24px] h-[24px] rounded-full\" src={DefaultAvatar} alt=\"\" />\n      <span className=\"text-[14px] text-black\">{email}</span>\n      <div\n        className=\"ml-auto cursor-pointer w-[20px] h-[20px] rounded-full text-[#979797] bg-[#F3F3F3] flex items-center justify-center\"\n        onClick={() => onDelete(email)}\n      >\n        <CloseIcon size={14} />\n      </div>\n    </div>\n  );\n};\nconst GoogleEventCreateMessage = ({ message }: { message: Message }) => {\n  const disabledDate: RangePickerProps['disabledDate'] = useCallback((current: dayjs.Dayjs) => {\n    // Can not select days before today and today\n    return current && current < dayjs().startOf('day');\n  }, []);\n  const { RangePicker } = DatePicker;\n  const [title, setTitle] = useState('');\n  const [email, setEmail] = useState('');\n  const [startDate, setStartDate] = useState<string>('');\n  const [endDate, setEndDate] = useState<string>('');\n  const [emails, setEmails] = useState<string[]>([]);\n  const [emailError, setEmailError] = useState('');\n  const [dateError, setDateError] = useState('');\n  const [titleError, setTitleError] = useState('');\n  const [selectedTimezone, setSelectedTimezone] = useState<ITimezone>(\n    Intl.DateTimeFormat().resolvedOptions().timeZone,\n  );\n  const global = getGlobal();\n  const themeKey = selectTheme(global);\n  useEffect(() => {\n    console.log('selectedTimezone', selectedTimezone);\n  }, [selectedTimezone]);\n  const validateEmail = (email: string) => {\n    const re = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return re.test(email);\n  };\n  const handleTitleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setTitle(e.target.value);\n    if (e.target.value) {\n      setTitleError('');\n    }\n  }, []);\n  const handleTimeZoomChange = useCallback((item: ITimezoneOption) => {\n    setSelectedTimezone(item.value);\n  }, []);\n  const handleTimeChange = useCallback((dates: null | (Dayjs | null)[], dateStrings: string[]) => {\n    if (dates) {\n      console.log('From: ', dates[0], ', to: ', dates[1]);\n      console.log('From: ', dateStrings[0], ', to: ', dateStrings[1]);\n      setStartDate(dateStrings[0]);\n      setEndDate(dateStrings[1]);\n      setDateError('');\n    }\n  }, []);\n  const handleEmailChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setEmail(e.target.value);\n  }, []);\n  const handleEmailComplete = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const emailStr = e.target.value;\n    if (!emailStr) {\n      setEmail('');\n      return;\n    }\n    if (validateEmail(emailStr)) {\n      setEmails((prev) => [...prev, emailStr]);\n      setEmail('');\n      setEmailError('');\n    } else {\n      setEmailError('Please enter the correct email address');\n    }\n  }, []);\n  const handleEmailEnter = useCallback((e: React.KeyboardEvent<HTMLInputElement>) => {\n    const emailStr = e.currentTarget.value;\n    if (!emailStr) {\n      setEmail('');\n      return;\n    }\n    if (validateEmail(emailStr)) {\n      setEmails((prev) => [...prev, emailStr]);\n      setEmail('');\n      setEmailError('');\n    } else {\n      setEmailError('Please enter the correct email address');\n    }\n  }, []);\n  const handleDeleteEmail = useCallback((email: string) => {\n    setEmails((prev) => prev.filter((item) => item !== email));\n  }, []);\n  const handleSubmit = useCallback(async () => {\n    if (!title) {\n      setTitleError('Please enter the title');\n      return;\n    }\n    if (!startDate || !endDate) {\n      setDateError('Please select the date');\n    }\n    const googleToken = await CHATAI_IDB_STORE.get('google-token');\n    const attendees: { email: string }[] = [];\n    if (emails.length) {\n      emails.forEach((email) => {\n        attendees.push({\n          email,\n        });\n      });\n    }\n    const event = {\n      summary: title,\n      start: { dateTime: new Date(startDate), timeZone: selectedTimezone },\n      end: { dateTime: new Date(endDate), timeZone: selectedTimezone },\n      attendees,\n      reminders: {\n        useDefault: false,\n        overrides: [\n          { method: 'email', minutes: 30 },\n          { method: 'popup', minutes: 10 },\n        ],\n      },\n      conferenceData: {\n        createRequest: {\n          requestId: `test-${Date.now()}`,\n          conferenceSolutionKey: { type: 'hangoutsMeet' },\n        },\n      },\n    };\n    fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events?conferenceDataVersion=1&alt=json&key=AIzaSyAtEl_iCCVN7Gv-xs1kfpcGCfD9IYO-UhU', {\n      method: 'POST',\n      headers: {\n        Authorization: `Bearer ${googleToken}`,\n      },\n      body: JSON.stringify(event),\n    }).then((response) => response.json()).then((res) => {\n      eventEmitter.emit(Actions.CreateCalendarSuccess, {\n        message,\n        response: res,\n      });\n    }).catch((err) => {\n      console.log(err);\n    });\n  }, [emails, endDate, message, selectedTimezone, startDate, title]);\n  return (\n    <ConfigProvider theme={{ algorithm: themeKey === 'dark' ? theme.darkAlgorithm : theme.defaultAlgorithm }}>\n      <div className=\"google-event-create-message px-[12px]\">\n        <div className=\"p-[10px] border border-solid border-[#D9D9D9] rounded-[16px] w-[326px] bg-white dark:bg-[#292929] dark:border-[#292929]\">\n          <span className=\"text-[14px] font-semibold mb-[16px]\">Please tell me the event details. </span>\n          <div className=\"flex flex-col gap-[8px] mb-[12px]\">\n            <FormLabel lable=\"title\" />\n            <Input value={title} onChange={handleTitleChange} />\n            {titleError && <ErrorTip message={titleError} />}\n          </div>\n          <div className=\"flex flex-col gap-[8px] mb-[12px]\">\n            <FormLabel lable=\"time\" />\n            <div className=\"flex flex-col items-center gap-[8px]\">\n              <RangePicker\n                disabledDate={disabledDate}\n                presets={[\n                  {\n                    label: <span aria-label=\"Current Time to End of Day\">Now ~ EOD</span>,\n                    value: () => [dayjs(), dayjs().endOf('day')], // 5.8.0+ support function\n                  },\n                ]}\n                showTime\n                format=\"YYYY/MM/DD HH:mm\"\n                onChange={handleTimeChange}\n              />\n              <TimezoneSelect\n                className=\"bg-white dark:bg-[#141414]\"\n                value={selectedTimezone}\n                onChange={handleTimeZoomChange}\n              />\n            </div>\n            {dateError && <ErrorTip message={dateError} />}\n          </div>\n          <div className=\"flex flex-col gap-[8px] mb-[12px]\">\n            <FormLabel lable=\"guests\" />\n            <Input\n              value={email}\n              onChange={handleEmailChange}\n              onBlur={handleEmailComplete}\n              onPressEnter={handleEmailEnter}\n            />\n            {emailError && <ErrorTip message={emailError} />}\n            {emails.length > 0 && (\n              emails.map((email) => (\n                <EmailItem email={email} key={email} onDelete={handleDeleteEmail} />\n              ))\n            )}\n          </div>\n          <Button type=\"primary\" className=\"!bg-[#8C42F0] w-full\" htmlType=\"submit\" onClick={handleSubmit}>\n            Confirm\n          </Button>\n        </div>\n      </div>\n    </ConfigProvider>\n  );\n};\n\nexport default GoogleEventCreateMessage;\n","/* eslint-disable max-len */\n/* eslint-disable no-console */\n/* eslint-disable no-null/no-null */\nimport React, { useEffect, useState } from 'react';\nimport type { Message } from 'ai';\n\nimport { FormLabel } from './google-event-create-messages';\n\nconst GoogleEventDetailMessage = ({ message }:{ message:Message }) => {\n  const [messageContent, setMessageContent] = useState<any>(null);\n  useEffect(() => {\n    try {\n      const parsedMessage = JSON.parse(message.content);\n      setMessageContent(parsedMessage);\n    } catch (error) {\n      console.error('Error parsing message content:', error);\n    }\n  }, [message]);\n  if (!messageContent) {\n    return null;\n  }\n  return (\n    <div className=\"px-[12px]\">\n      <div className=\"flex-col gap-[12px] p-[10px] border border-solid  border-[#D9D9D9] rounded-[16px] w-[326px]bg-white dark:bg-[#292929] dark:border-[#292929]\">\n        <div className=\"text-[14px] font-semibold\">Event details</div>\n        <div>\n          <FormLabel lable=\"title\" />\n          <span className=\"text-[14px]\">{messageContent?.summary}</span>\n        </div>\n        {messageContent?.attendees?.length > 0 && (\n          <div>\n            <FormLabel lable=\"guests\" />\n            {messageContent?.attendees?.map((attendee: any) => (\n              <div className=\"text-[14px]\" key={attendee.email}>{attendee.email}</div>\n            ))}\n          </div>\n        )}\n        <div>\n          <FormLabel lable=\"time\" />\n          <div className=\"flex flex-col\">\n            <span className=\"text-[14px]\">{messageContent.start.dateTime} - {messageContent.end.dateTime}</span>\n            <span className=\"text-[14px] text-[#979797]\">{messageContent.start.timeZone}</span>\n          </div>\n        </div>\n        <div>\n          <FormLabel lable=\"meet\" />\n          <span className=\"text-[14px]\">{messageContent?.hangoutLink}</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default GoogleEventDetailMessage;\n","/* eslint-disable @typescript-eslint/no-use-before-define */\n/* eslint-disable no-console */\n/* eslint-disable no-null/no-null */\n/* eslint-disable max-len */\nimport React, {\n  useCallback,\n} from 'react';\nimport type { Message } from 'ai';\n\nimport eventEmitter, { Actions } from '../lib/EventEmitter';\nimport { CHATAI_IDB_STORE } from '../../../util/browser/idb';\nimport { loginWithGoogle } from '../utils/google-api';\n\nimport GoogleIcon from '../assets/google.png';\n\nconst GoogleLoginAuthMessage = ({ message }:{ message:Message }) => {\n  const updateToken = useCallback((accessToken:string) => {\n    CHATAI_IDB_STORE.set('google-token', accessToken);\n    eventEmitter.emit(Actions.UpdateGoogleToken, {\n      message,\n      token: accessToken,\n    });\n    eventEmitter.emit(Actions.GoogleAuthSuccess);\n  }, [message]);\n\n  const handleLogin = () => {\n    loginWithGoogle().then(({ accessToken }) => {\n      updateToken(accessToken);\n    });\n  };\n\n  return (\n    <div className=\"px-[12px]\">\n      <div className=\"p-[10px] border-solid border-[#D9D9D9] rounded-[16px] w-[316px] bg-white dark:bg-[#292929]\">\n        <span>This service requires access to your Google Calendar.</span>\n        <div\n          className=\"w-auto flex items-center cursor-pointer hover:opacity-80 gap-[8px] bg-[#F3F3F3] px-[12px] py-[10px] rounded-[6px]\"\n          onClick={handleLogin}\n        >\n          <img src={GoogleIcon} alt=\"\" />\n          <span>Google authorization</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default GoogleLoginAuthMessage;\n","/* eslint-disable max-len */\n/* eslint-disable no-null/no-null */\nimport React, { useEffect, useState } from 'react';\nimport type { Message } from 'ai';\nimport { getActions, getGlobal } from '../../../global';\n\nimport { getChatTitle, isUserId } from '../../../global/helpers';\nimport { selectChat } from '../../../global/selectors';\nimport useOldLang from '../hook/useOldLang';\n\nimport Avatar from '../component/Avatar';\n\nexport const GroupSearchMessage = ({ message }: { message: Message }) => {\n  const [chatIds, setChatIds] = useState<string[]>([]);\n  const global = getGlobal();\n  const lang = useOldLang();\n\n  const handleClick = (chatId: string) => {\n    const chat = selectChat(global, chatId);\n    if (chat) {\n      getActions().openChat({ id: chatId });\n    }\n  };\n  const renderChatAvatar = (chatId: string) => {\n    if (isUserId(chatId)) {\n      return null;\n    }\n    let membersCount:number;\n    let title:string;\n    const chat = selectChat(global, chatId);\n    if (chat) {\n      membersCount = chat?.membersCount as number;\n      title = getChatTitle(lang, chat);\n    } else {\n      return null;\n    }\n    return (\n      <div\n        className=\"flex flex-row items-center gap-[8px] cursor-pointer px-[12px] py-[8px] rounded-[12px] hover:bg-[#D9D9D9]\"\n        onClick={() => { handleClick(chatId); }}\n      >\n        <Avatar\n          key={chatId}\n          className=\"overlay-avatar inline-block cursor-pointer\"\n          size={44}\n          peer={chat}\n        />\n        <div className=\"flex flex-col justify-center gap-[4px]\">\n          <span className=\"text-[15px] font-semibold text-black leading-[18px]\">{title}</span>\n          <span className=\"text-[14px] text-[#5E6272] leading-[18px]\">{membersCount} Members</span>\n        </div>\n      </div>\n    );\n  };\n  useEffect(() => {\n    try {\n      const ids = JSON.parse(message.content);\n      setChatIds(ids || []);\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.log(error);\n    }\n  }, [message]);\n  if (chatIds.length === 0) {\n    return <span></span>;\n  }\n  return (\n    <div className=\"p-[10px] mx-[22px] rounded-[16px] border-[1px] border-[#D9D9D9] bg-white dark:bg-[#292929]\">\n      <div className=\"flex flex-col gap-[12px]\">\n        {chatIds.splice(0, 10).map((id) => {\n          return (\n            <>\n              {renderChatAvatar(id)}\n            </>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n","/* eslint-disable max-len */\nimport React from 'react';\n\nimport PortraitBg from '../assets/summary-introduce/portrait.png';\n\nconst listStyle = 'text-[15px] text-[var(--color-text)]';\nconst IntroducePortraitMessage = () => {\n  return (\n    <div className=\"rounded-[16px] w-[488px] bg-[var(--color-background)]\">\n      <img src={PortraitBg} alt=\"\" className=\"w-[490px] h-[259px]\" />\n      <div className=\"py-[14px] px-[12px]\">\n        <h3> User Profiling Feature Overview</h3>\n        <p className={listStyle}>\n          Serena AI intelligently analyzes user behavior and content patterns in Telegram to build a rich, multi-dimensional profile that powers precision operations and smart recommendations.\n        </p>\n        <h3> Key Highlights:</h3>\n        <ul className=\"pl-[24px] list-disc\">\n          <li className={listStyle}>\n            <b>Automatic Behavior Recognition</b>\n            <p>\n              Detects user message frequency, content themes, and published Story-type updates across different Telegram groups.\n            </p>\n          </li>\n          <li className={listStyle}>\n            <b>Topic & Group Pattern Mining</b>\n            <p>\n              Extracts high-frequency discussion topics and active group participation to generate personalized, explainable user tags.\n            </p>\n          </li>\n          <li className={listStyle}>\n            <b>Structured Multi-Group Profiling</b>\n            <p>\n              Presents a comprehensive user profile with basic info, tag classification, dynamic content stream, and cross-group behavioral timeline.\n            </p>\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default IntroducePortraitMessage;\n","/* eslint-disable max-len */\nimport React from 'react';\n\nimport SmartReplyBg from '../assets/summary-introduce/smartreply.png';\n\nconst listStyle = 'text-[15px] text-[var(--color-text)]';\nconst IntroduceSmartreplyMessage = () => {\n  return (\n    <div className=\"rounded-[16px] w-[488px] bg-[var(--color-background)]\">\n      <img src={SmartReplyBg} alt=\"\" className=\"w-[490px] h-[259px]\" />\n      <div className=\"py-[14px] px-[12px]\">\n        <h3> Smart Replies, Smarter Conversations </h3>\n        <ul className=\"pl-[24px] list-disc\">\n          <li className={listStyle}>\n            Say goodbye to repetitive typinglet AI handle your frequently used messages.\n          </li>\n          <li className={listStyle}>\n            Through intelligent semantic recognition in chat scenarios, the system automatically matches and sends preset responses, enabling fast and efficient communication.\n          </li>\n          <li className={listStyle}>\n            Whether it's customer inquiries, daily collaboration, or information confirmation, Smart Replies help you save time and boost response efficiency.\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default IntroduceSmartreplyMessage;\n","/* eslint-disable max-len */\nimport React from 'react';\n\nimport SummaryBg from '../assets/summary-introduce/summarize.png';\n\nconst listStyle = 'text-[15px] text-[var(--color-text)]';\nconst IntroduceSummaryMessage = () => {\n  return (\n    <div className=\"rounded-[16px] w-[488px] bg-[var(--color-background)]\">\n      <img src={SummaryBg} alt=\"\" className=\"w-[490px] h-[259px]\" />\n      <div className=\"py-[14px] px-[12px]\">\n        <h3> Message Summarization </h3>\n        <p className={listStyle}>\n          The Message Summarization feature uses AI to automatically extract key content from IM conversations and periodically generate summary reports. It helps users efficiently grasp important group updates, improve information retrieval, and avoid missing critical messages.\n        </p>\n        <h3> Key Capabilities:</h3>\n        <ul className=\"pl-[24px] list-disc\">\n          <li className={listStyle}>\n             Automatically extracts topics, key figures, time references, and user insights from chat messages\n          </li>\n          <li className={listStyle}>\n             Intelligently identifies and groups content by chat, ensuring clarity and structure\n          </li>\n          <li className={listStyle}>\n             Automatically generates summary reports during active hours, adapting to peak and off-peak periods\n          </li>\n          <li className={listStyle}>\n             Supports personalized summary customization, allowing users to focus on specific chats or content types\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default IntroduceSummaryMessage;\n","/* eslint-disable max-len */\nimport React from 'react';\n\nimport SummaryBg from '../assets/summary-introduce/summarize.png';\n\nconst listStyle = 'text-[15px] text-[var(--color-text)]';\nconst IntroduceTranslationMessage = () => {\n  return (\n    <div className=\"rounded-[16px] w-[488px] bg-[var(--color-background)]\">\n      <img src={SummaryBg} alt=\"\" className=\"w-[490px] h-[259px]\" />\n      <div className=\"py-[14px] px-[12px]\">\n\n        <h3> Real-time Translation </h3>\n        <ul className=\"pl-[24px] list-disc\">\n          <li className={listStyle}>\n            <b>Instant Translation While Typing:</b> Automatically detects the source language and translates it into the target language in real time.\n          </li>\n          <li className={listStyle}>\n            <b>Multi-language Support:</b> Covers major languages, including English, Chinese, Japanese, French, German, Spanish, and more.\n          </li>\n          <li className={listStyle}>\n            <b>Context-aware Translation:</b> Enhances accuracy and fluency by leveraging message context and chat history.\n          </li>\n        </ul>\n        <h3> Grammar & Style Check </h3>\n        <ul className=\"pl-[24px] list-disc\">\n          <li className={listStyle}>\n            <b>Automatic Error Detection:</b> Identifies spelling, grammar, and sentence structure issues.\n          </li>\n          <li className={listStyle}>\n            <b>Expression Optimization:</b> Suggests more natural and professional phrasing suitable for business or formal messages.\n          </li>\n          <li className={listStyle}>\n            <b>Multilingual Correction:</b> Supports grammar checks not only in English but also in other languages, such as Chinese.\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default IntroduceTranslationMessage;\n","/* eslint-disable no-null/no-null */\n/* eslint-disable no-console */\n/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable max-len */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport type { Message } from 'ai';\nimport copy from 'copy-to-clipboard';\nimport { getActions, getGlobal } from '../../../global';\n\nimport { isUserId } from '../../../global/helpers';\nimport { selectChat, selectUser } from '../../../global/selectors';\nimport useOldLang from '../hook/useOldLang';\nimport { useSpeechPlayer } from '../hook/useSpeechPlayer';\nimport {\n  CopyIcon, DeleteIcon, VoiceIcon,\n  VoiceingIcon,\n} from '../icons';\nimport { cn, formatTimestamp } from '../utils/util';\n\nimport Avatar from '../component/Avatar';\nimport ErrorBoundary from '../ErrorBoundary';\n\nimport ActionsIcon from '../assets/actions.png';\nimport CalendarIcon from '../assets/calendar.png';\nimport CheckIcon from '../assets/check.png';\nimport MessageIcon from '../assets/message.png';\nimport UserIcon from '../assets/user.png';\n\ninterface IProps {\n  message: Message;\n  deleteMessage: () => void;\n}\ninterface ISummaryInfo {\n  summaryTime: number;\n  messageCount: number;\n  userIds: Array<string>;\n}\n\ninterface ISummaryPendingItem {\n  summary: string;\n  relevantMessageIds: number[];\n}\n\nconst ChatAvatar = ({\n  chatId, classNames, size, style,\n}: { chatId: string; classNames?: string; size:number;style?: { [key:string]:string } }) => {\n  if (!chatId) return null;\n  const global = getGlobal();\n  let peer;\n  if (isUserId(chatId)) {\n    peer = selectUser(global, chatId);\n  } else {\n    peer = selectChat(global, chatId);\n  }\n\n  return (\n    <Avatar\n      style={style}\n      key={chatId}\n      className={cn(classNames, 'overlay-avatar inline-block cursor-pointer')}\n      size={size}\n      peer={peer}\n    />\n  );\n};\n\nconst SummaryPenddingItem = ({ pendingItem }: { pendingItem: ISummaryPendingItem }) => {\n  return (\n    <ErrorBoundary>\n      <div className=\"flex gap-[8px] my-[4px] cursor-pointer\">\n        <img className=\"w-[18px] h-[18px] mt-[2px]\" src={CheckIcon} alt=\"\" />\n        <span className=\"text-[15px]\">{pendingItem.summary}</span>\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst ActionsItems = ({\n  messageId,\n  pendingMatters,\n  deleteMessage,\n}: {\n  messageId: string;\n  pendingMatters: ISummaryPendingItem[];\n  deleteMessage: () => void;\n}) => {\n  const lang = useOldLang();\n  const { showNotification } = getActions();\n  const { isSpeaking, speak, stop } = useSpeechPlayer(messageId);\n  const handleCopy = () => {\n    const copyText = `Actions Items:\\n${pendingMatters.map((item) => `${item.summary}`).join('\\n')}`;\n    copy(copyText);\n    showNotification({\n      message: lang('TextCopied'),\n    });\n  };\n  const handleVoicePlay = () => {\n    const voiceText = `Actions Items:\\n${pendingMatters.map((item) => `${item.summary}`).join('\\n')}\\n`;\n    if (isSpeaking) {\n      stop();\n    } else {\n      speak(voiceText);\n    }\n  };\n  return (\n    <div className=\"flex items-center gap-[8px]\">\n      <div className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\" onClick={handleCopy}>\n        <CopyIcon size={24} />\n      </div>\n      {isSpeaking ? (\n        <div\n          className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\"\n          onClick={stop}\n        >\n          <VoiceingIcon size={24} />\n        </div>\n      ) : (\n        <div\n          className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\"\n          onClick={handleVoicePlay}\n        >\n          <VoiceIcon size={24} />\n        </div>\n      )}\n      <div className=\"w-[20px] h-[20px] cursor-pointer\" onClick={deleteMessage}>\n        <DeleteIcon size={20} />\n      </div>\n    </div>\n  );\n};\n\nconst ActionInfoContent = ({ summaryInfo }:{ summaryInfo:ISummaryInfo }) => {\n  return (\n    <ErrorBoundary>\n      <div>\n        <p className=\"flex items-center gap-[8px] mb-[16px]\">\n          <span className=\"text-[18px] font-bold\">Actions Items</span>\n          <img className=\"w-[16px] h-[16px]\" src={ActionsIcon} alt=\"\" />\n        </p>\n        <div className=\"flex items-center gap-[20px]\">\n          <p className=\"flex items-center gap-[8px]\">\n            <img className=\"w-[16px] h-[16px]\" src={CalendarIcon} alt=\"\" />\n            <div className=\"flex items-center gap-[4px]\">\n              <span className=\"mr-[4px] font-bold text-[14px]\">Time:</span>\n              {summaryInfo?.summaryTime ? (\n                <p className=\"text-[14px] text-[#A8A6AC]\">{formatTimestamp(summaryInfo.summaryTime)}</p>\n              ) : null}\n            </div>\n          </p>\n          <p className=\"flex items-center gap-[8px]\">\n            <img className=\"w-[16px] h-[16px]\" src={MessageIcon} alt=\"\" />\n            <div className=\"flex items-center gap-[4px]\">\n              <span className=\"font-bold text-[14px]\">Messages:</span>\n              {summaryInfo?.messageCount ? (\n                <span>{summaryInfo?.messageCount}</span>\n              ) : null}\n            </div>\n          </p>\n        </div>\n        {summaryInfo?.userIds ? (\n          <div className=\"flex items-center gap-[8px] mb-[18px]\">\n            <img className=\"w-[16px] h-[16px]\" src={UserIcon} alt=\"\" />\n            <span className=\"font-bold text-[14px]\">Groups/friends: </span>\n            <div className=\"flex items-center\">\n              {summaryInfo.userIds.slice(0, 10).map((id: string, index: number) => {\n                return (\n                  <ChatAvatar\n                    style={{ zIndex: `${String(summaryInfo.userIds.length - index)};` }}\n                    chatId={id}\n                    size={24}\n                    classNames=\"summary-avatar-group !border-solid-[2px] !border-white ml-[-4px]\"\n                    key={id}\n                  />\n                );\n              })}\n              {summaryInfo.userIds.length > 10 ? (\n                <div className=\"w-[24px] h-[24px] rounded-full bg-[#979797] text-[12px] whitespace-nowrap flex items-center justify-center\">{summaryInfo.userIds.length - 10}+</div>\n              ) : null}\n            </div>\n          </div>\n        ) : null}\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst RoomActionMessage = (props: IProps) => {\n  const { message, deleteMessage } = props;\n  const [summaryInfo, setSummaryInfo] = useState<ISummaryInfo | null>(null);\n  const [pendingMatters, setPendingMatters] = useState<ISummaryPendingItem[]>([]);\n  const parseMessage = useCallback((messageContent: string) => {\n    const messageObj = JSON.parse(messageContent);\n    const { pendingMatters, summaryInfo } = messageObj;\n    if (pendingMatters) {\n      setPendingMatters(pendingMatters as ISummaryPendingItem[]);\n    }\n    if (summaryInfo) {\n      setSummaryInfo(summaryInfo as ISummaryInfo);\n    }\n  }, []);\n  useEffect(() => {\n    try {\n      parseMessage(message.content);\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  }, [message, parseMessage]);\n  if (!summaryInfo) {\n    return null;\n  }\n  return (\n    <div className=\"px-[12px] w-full\">\n      {(!pendingMatters.length) ? null : (\n        <div className=\"mx-auto rounded-[10px] px-3 py-2 bg-white dark:bg-[#292929]\">\n          {/* summary info  */}\n          {summaryInfo && <ActionInfoContent summaryInfo={summaryInfo} />}\n          {/* pending actions  */}\n          {pendingMatters.length > 0 && (\n            <div>\n              {pendingMatters.map((item) => (<SummaryPenddingItem pendingItem={item} />))}\n            </div>\n          )}\n          {/* action buttons  */}\n          <ActionsItems messageId={message.id} pendingMatters={pendingMatters} deleteMessage={deleteMessage} />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default RoomActionMessage;\n","/* eslint-disable max-len */\nimport React from 'react';\nimport type { Message } from '@ai-sdk/react';\nimport { getGlobal } from '../../../global';\n\nimport { selectChat } from '../../../global/selectors';\n\nconst actionItemClassName = 'h-[40px] w-fit px-[12px] py-[8px] rounded-[6px] bg-[#F5F1FF] text-[14px] text-[var(--color-text)] dark:bg-[#383838]';\n\nconst RoomAIDescriptionMessage = ({ message }:{ message:Message }) => {\n  const { content: chatId } = message;\n  const global = getGlobal();\n  const chat = selectChat(global, chatId);\n  return (\n    <div className=\"px-[12px]\">\n      <div className=\"px-3 py-2 rounded-xl text-[var(--color-text)] bg-white dark:bg-[#292929]\">\n        <p className=\"text-[14px]\">\n           Hi, welcome to {chat?.title}!\n          Im Serena , your smart assistant in the group.\n        </p>\n        <div className=\"mt-[0.5rem]\">\n          <h3 className=\"text-[14px] font-semibold\"> Heres what I can help you with:</h3>\n          <div className=\"flex flex-col gap-[8px] mt-[0.5rem]\">\n            <div className={actionItemClassName}>\n               Summarize key conversations\n            </div>\n            <div className={actionItemClassName}>\n               Schedule meetings\n            </div>\n            <div className={actionItemClassName}>\n               Action Items\n            </div>\n            <div className={actionItemClassName}>\n               Group search\n            </div>\n            <div className={actionItemClassName}>\n               User Portrait\n            </div>\n            <div className={actionItemClassName}>\n               Project tracking\n            </div>\n          </div>\n        </div>\n        <div className=\"mt-[0.5rem]\">\n          <h3 className=\"text-[14px] font-semibold\"> You can ask me things like:</h3>\n          <ul className=\"list-disc pl-[24px] text-[14px] text-[var(--color-text)]\">\n            <li>What was discussed in the group yesterday?</li>\n            <li>\n              Has there been any mention of client  . feedback in the group?\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default RoomAIDescriptionMessage;\n","/* eslint-disable no-null/no-null */\n/* eslint-disable no-console */\n/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable max-len */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport type { Message } from 'ai';\nimport copy from 'copy-to-clipboard';\nimport { getActions, getGlobal } from '../../../global';\n\nimport { isUserId } from '../../../global/helpers';\nimport { selectChat, selectUser } from '../../../global/selectors';\nimport useOldLang from '../hook/useOldLang';\nimport { useSpeechPlayer } from '../hook/useSpeechPlayer';\nimport {\n  CopyIcon, DeleteIcon, VoiceIcon,\n  VoiceingIcon,\n} from '../icons';\nimport { cn, formatTimestamp } from '../utils/util';\n\nimport Avatar from '../component/Avatar';\nimport ErrorBoundary from '../ErrorBoundary';\n\nimport ActionsIcon from '../assets/actions.png';\nimport CalendarIcon from '../assets/calendar.png';\nimport CheckIcon from '../assets/check.png';\nimport MessageIcon from '../assets/message.png';\nimport UserIcon from '../assets/user.png';\nimport WriteIcon from '../assets/write.png';\n\ninterface IProps {\n  message: Message;\n  deleteMessage: () => void;\n}\ninterface ISummaryInfo {\n  summaryTime: number;\n  messageCount: number;\n  userIds: Array<string>;\n}\n\ninterface ISummaryTopicItem {\n  title: string;\n  summaryItems: Array<{\n    content: string;\n    relevantMessageIds: Array<number>;\n  }>;\n}\n\ninterface ISummaryPendingItem {\n  summary: string;\n  relevantMessageIds: number[];\n}\ninterface ISummaryGarbageItem {\n  summary: string;\n  level: 'high' | 'low';\n  relevantMessageIds: number[];\n}\n\nconst ChatAvatar = ({\n  chatId, classNames, size, style,\n}: { chatId: string; classNames?: string; size:number;style?: { [key:string]:string } }) => {\n  if (!chatId) return null;\n  const global = getGlobal();\n  let peer;\n  if (isUserId(chatId)) {\n    peer = selectUser(global, chatId);\n  } else {\n    peer = selectChat(global, chatId);\n  }\n\n  return (\n    <Avatar\n      style={style}\n      key={chatId}\n      className={cn(classNames, 'overlay-avatar inline-block cursor-pointer')}\n      size={size}\n      peer={peer}\n    />\n  );\n};\n\nconst SummaryTopicItem = ({ topicItem, index }: { topicItem: ISummaryTopicItem; index: number }) => {\n  const { title, summaryItems } = topicItem;\n  if (!summaryItems.length) return null;\n  if (!title) return null;\n  return (\n    <ErrorBoundary>\n      <div>\n        <div className=\"flex flex-row items-center flex-wrap\">\n          <span className=\"text-[16px] font-bold mr-[24px]\">{index + 1}. {title}</span>\n        </div>\n        <ul className=\"list-disc pl-[2px] text-[16px] list-inside\">\n          {summaryItems.map((summaryItem: any) => {\n            const { content } = summaryItem;\n            if (!content) return null;\n            return (\n              <li\n                role=\"button\"\n                className=\"cursor-pointer text-[15px]\"\n              >\n                {content}\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst SummaryPenddingItem = ({ pendingItem }: { pendingItem: ISummaryPendingItem }) => {\n  return (\n    <ErrorBoundary>\n      <div className=\"flex gap-[8px] my-[4px] cursor-pointer\">\n        <img className=\"w-[18px] h-[18px] mt-[2px]\" src={CheckIcon} alt=\"\" />\n        <span className=\"text-[15px]\">{pendingItem.summary}</span>\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst SummaryGarbageItem = ({ garBageItem }: { garBageItem: ISummaryGarbageItem }) => {\n  const { level, summary } = garBageItem;\n  return (\n    <ErrorBoundary>\n      <div className=\"flex justify-start gap-[8px] my-[16px]\">\n        <div className=\"flex justify-start gap-[4px]\">\n          {level === 'high' ? (\n            <span className=\"text-[#FF543D] text-[14px] whitespace-nowrap\"> High-Risk</span>\n          ) : (\n            <span className=\"text-[#FF9B05] text-[14px] whitespace-nowrap\"> Low-Risk</span>\n          )}\n          <span className=\"text-[14px] text-[var(--color-text-secondary)]\">{summary}</span>\n        </div>\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst ActionsItems = ({\n  messageId,\n  summaryInfo,\n  mainTopic,\n  pendingMatters,\n  deleteMessage,\n}: {\n  messageId: string;\n  summaryInfo: ISummaryInfo | null;\n  mainTopic: ISummaryTopicItem[];\n  pendingMatters: ISummaryPendingItem[];\n  deleteMessage: () => void;\n}) => {\n  const lang = useOldLang();\n  const { showNotification } = getActions();\n  const { isSpeaking, speak, stop } = useSpeechPlayer(messageId);\n  const handleCopy = () => {\n    const { summaryTime } = summaryInfo || {};\n    const time = formatTimestamp(summaryTime!);\n    const copyText = `Chat Summary\\nTime: ${time}\\n\\nKey Topics:\\n${mainTopic.map((item:ISummaryTopicItem) => `${item.title}:\\n ${item.summaryItems.map((subItem) => subItem.content).join(';\\n ')}`).join('\\n')}\\n\\nActions Items:\\n${pendingMatters.map((item) => `${item.summary}`).join('\\n')}`;\n    copy(copyText);\n    showNotification({\n      message: lang('TextCopied'),\n    });\n  };\n  const handleVoicePlay = () => {\n    const { summaryTime } = summaryInfo || {};\n    const time = formatTimestamp(summaryTime!);\n    const voiceText = `Chat Summary\\nTime: ${time}\\n\\nKey Topics:\\n${mainTopic.map((item:ISummaryTopicItem) => `${item.title}:\\n ${item.summaryItems.map((subItem) => subItem.content).join(';\\n ')}`).join('\\n')}\\n\\nActions Items:\\n${pendingMatters.map((item) => `${item.summary}`).join('\\n')}`;\n    if (isSpeaking) {\n      stop();\n    } else {\n      speak(voiceText);\n    }\n  };\n  return (\n    <div className=\"flex items-center gap-[8px]\">\n      <div className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\" onClick={handleCopy}>\n        <CopyIcon size={24} />\n      </div>\n      {isSpeaking ? (\n        <div\n          className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\"\n          onClick={stop}\n        >\n          <VoiceingIcon size={24} />\n        </div>\n      ) : (\n        <div\n          className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\"\n          onClick={handleVoicePlay}\n        >\n          <VoiceIcon size={24} />\n        </div>\n      )}\n      <div className=\"w-[20px] h-[20px] cursor-pointer\" onClick={deleteMessage}>\n        <DeleteIcon size={20} />\n      </div>\n    </div>\n  );\n};\n\nconst SummaryInfoContent = ({ summaryInfo }:{ summaryInfo:ISummaryInfo }) => {\n  return (\n    <ErrorBoundary>\n      <div>\n        <p className=\"text-[22px] font-bold mb-[16px]\">Chat Summary</p>\n        <div className=\"flex items-center gap-[20px]\">\n          <p className=\"flex items-center gap-[8px]\">\n            <img className=\"w-[16px] h-[16px]\" src={CalendarIcon} alt=\"\" />\n            <div className=\"flex items-center gap-[4px]\">\n              <span className=\"mr-[4px] font-bold text-[14px]\">Time:</span>\n              {summaryInfo?.summaryTime ? (\n                <p className=\"text-[14px] text-[#A8A6AC]\">{formatTimestamp(summaryInfo.summaryTime)}</p>\n              ) : null}\n            </div>\n          </p>\n          <p className=\"flex items-center gap-[8px]\">\n            <img className=\"w-[16px] h-[16px]\" src={MessageIcon} alt=\"\" />\n            <div className=\"flex items-center gap-[4px]\">\n              <span className=\"font-bold text-[14px]\">Messages:</span>\n              {summaryInfo?.messageCount ? (\n                <span>{summaryInfo?.messageCount}</span>\n              ) : null}\n            </div>\n          </p>\n        </div>\n        {summaryInfo?.userIds ? (\n          <div className=\"flex items-center gap-[8px] mb-[18px]\">\n            <img className=\"w-[16px] h-[16px]\" src={UserIcon} alt=\"\" />\n            <span className=\"font-bold text-[14px]\">Groups/friends: </span>\n            <div className=\"flex items-center\">\n              {summaryInfo.userIds.slice(0, 5).map((id: string, index: number) => {\n                return (\n                  <ChatAvatar\n                    style={{ zIndex: `${String(summaryInfo.userIds.length - index)};` }}\n                    chatId={id}\n                    size={24}\n                    classNames=\"summary-avatar-group !border-solid-[2px] !border-white ml-[-4px]\"\n                    key={id}\n                  />\n                );\n              })}\n              {summaryInfo.userIds.length > 10 ? (\n                <div className=\"w-[24px] h-[24px] rounded-full bg-[#979797] text-[12px] whitespace-nowrap flex items-center justify-center\">{summaryInfo.userIds.length - 10}+</div>\n              ) : null}\n            </div>\n          </div>\n        ) : null}\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nconst MainSummaryContent = ({\n  messageId,\n  summaryInfo,\n  mainTopic,\n  pendingMatters,\n  deleteMessage,\n}: {\n  messageId:string;\n  summaryInfo: ISummaryInfo | null;\n  mainTopic: ISummaryTopicItem[];\n  pendingMatters: ISummaryPendingItem[];\n  deleteMessage: () => void;\n}) => {\n  return (\n    <div className=\"mx-auto rounded-[10px] bg-white px-3 py-2 dark:bg-[#292929]\">\n      {/* summary info  */}\n      {summaryInfo && <SummaryInfoContent summaryInfo={summaryInfo} />}\n      {/* maintopic  */}\n      {mainTopic.length > 0 && (\n        <div>\n          <p className=\"flex items-center gap-[8px] mb-[16px]\">\n            <span className=\"text-[18px] font-bold\">Key Topics</span>\n            <img className=\"w-[16px] h-[16px]\" src={WriteIcon} alt=\"\" />\n          </p>\n          {mainTopic.map((item, index) => (\n            <SummaryTopicItem topicItem={item} index={index} />\n          ))}\n        </div>\n      )}\n      {/* pending actions  */}\n      {pendingMatters.length > 0 && (\n        <div>\n          <p className=\"flex items-center gap-[8px] mb-[16px]\">\n            <span className=\"text-[18px] font-bold\">Actions Items</span>\n            <img className=\"w-[16px] h-[16px]\" src={ActionsIcon} alt=\"\" />\n          </p>\n          {pendingMatters.map((item) => (<SummaryPenddingItem pendingItem={item} />))}\n        </div>\n      )}\n      {/* action buttons  */}\n      <ActionsItems\n        messageId={messageId}\n        summaryInfo={summaryInfo}\n        mainTopic={mainTopic}\n        pendingMatters={pendingMatters}\n        deleteMessage={deleteMessage}\n      />\n    </div>\n  );\n};\nconst RoomSummaryMessage = (props: IProps) => {\n  const { message, deleteMessage } = props;\n  const [summaryInfo, setSummaryInfo] = useState<ISummaryInfo | null>(null);\n  const [mainTopic, setMainTopic] = useState<ISummaryTopicItem[]>([]);\n  const [pendingMatters, setPendingMatters] = useState<ISummaryPendingItem[]>([]);\n  const parseMessage = useCallback((messageContent: string) => {\n    const messageObj = JSON.parse(messageContent);\n    const {\n      mainTopic, pendingMatters, summaryInfo,\n    } = messageObj;\n    if (mainTopic) {\n      setMainTopic(mainTopic as ISummaryTopicItem[]);\n    }\n    if (pendingMatters) {\n      setPendingMatters(pendingMatters as ISummaryPendingItem[]);\n    }\n    if (summaryInfo) {\n      setSummaryInfo(summaryInfo as ISummaryInfo);\n    }\n  }, []);\n  useEffect(() => {\n    try {\n      parseMessage(message.content);\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  }, [message, parseMessage]);\n  if (!summaryInfo) {\n    return null;\n  }\n  return (\n    <div className=\"px-[12px] w-full\">\n      {(!mainTopic.length && !pendingMatters.length) ? null : (\n        <MainSummaryContent\n          messageId={message.id}\n          summaryInfo={summaryInfo}\n          mainTopic={mainTopic}\n          pendingMatters={pendingMatters}\n          deleteMessage={deleteMessage}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default RoomSummaryMessage;\n","/* eslint-disable max-len */\n/* eslint-disable no-console */\n/* eslint-disable no-null/no-null */\nimport React, { useEffect, useState } from 'react';\nimport type { Message } from 'ai';\nimport copy from 'copy-to-clipboard';\nimport { getActions } from '../../../global';\n\nimport useOldLang from '../hook/useOldLang';\nimport { useSpeechPlayer } from '../hook/useSpeechPlayer';\nimport {\n  CopyIcon, DeleteIcon, VoiceIcon, VoiceingIcon,\n} from '../icons';\nimport { formatTimestamp } from '../utils/util';\n\nimport ChatAvatar from '../component/ChatAvatar';\nimport { DrawerKey, useDrawerStore } from '../globalSummary/DrawerContext';\n\nimport DangerIcon from '../assets/danger.png';\nimport SerenaLogoPath from '../assets/serena.png';\n\ninterface IProps {\n  message: Message;\n  deleteMessage: () => void;\n}\n\ninterface UrgentMessage {\n  chatId: string;\n  messageId:number;\n  content:string;\n}\n\nconst ActionsItems = ({\n  messageId,\n  messages,\n  deleteMessage,\n}: {\n  messageId:string;\n  messages:UrgentMessage[];\n  deleteMessage: () => void;\n}) => {\n  const lang = useOldLang();\n  const { showNotification } = getActions();\n  const { isSpeaking, speak, stop } = useSpeechPlayer(messageId);\n  const handleCopy = () => {\n    const copyText = `Urgent Alert\\n${messages.map((item) => `${item.content}`).join('\\n')}`;\n    copy(copyText);\n    showNotification({\n      message: lang('TextCopied'),\n    });\n  };\n  const handleVoicePlay = () => {\n    const voiceText = `Urgent Alert\\n${messages.map((item) => `${item.content}`).join('\\n')}`;\n    if (isSpeaking) {\n      stop();\n    } else {\n      speak(voiceText);\n    }\n  };\n  return (\n    <div className=\"message-actions flex items-center gap-[8px]\">\n      <div className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\" onClick={handleCopy}>\n        <CopyIcon size={24} />\n      </div>\n      {isSpeaking ? (\n        <div\n          className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\"\n          onClick={stop}\n        >\n          <VoiceingIcon size={24} />\n        </div>\n      ) : (\n        <div\n          className=\"w-[24px] h-[24px] text-[#676B74] cursor-pointer\"\n          onClick={handleVoicePlay}\n        >\n          <VoiceIcon size={24} />\n        </div>\n      )}\n      <div className=\"w-[20px] h-[20px] cursor-pointer\" onClick={deleteMessage}>\n        <DeleteIcon size={20} />\n      </div>\n    </div>\n  );\n};\nconst UrgentCheckMessage = (props:IProps) => {\n  const { message, deleteMessage } = props;\n  const [urgentMessage, setUrgentMessage] = useState<UrgentMessage[]>([]);\n  const { openDrawer } = useDrawerStore();\n  useEffect(() => {\n    const parsedMessage = JSON.parse(message.content);\n    if (parsedMessage && typeof parsedMessage === 'object' && parsedMessage.length > 0) {\n      setUrgentMessage(parsedMessage);\n    }\n  }, [message]);\n  if (!urgentMessage || urgentMessage.length === 0) {\n    return null;\n  }\n  const showMessageDetail = (item:UrgentMessage) => {\n    openDrawer(DrawerKey.OriginalMessages, { relevantMessages: [{ chatId: item.chatId, messageIds: [item.messageId] }] });\n  };\n  return (\n    <div className=\"w-max-[693px] rounded-[10px] bg-[var(--color-urgent-message-bg)] pl-[82px] pr-[25px] pt-[20px] pb-[25px] border-[1px] border-[#FFC7C7] dark:border-none\">\n      <div className=\"flex items-center gap-[8px]\">\n        <img className=\"w-[52px] h-[52px] rounded-full ml-[-60px]\" src={SerenaLogoPath} alt=\"\" />\n        <div>\n          <p className=\"text-[16px] font-semibold\">Serena</p>\n          {message.createdAt && (\n            <p className=\"text-[14px] text-[#A8A6AC]\">{formatTimestamp(new Date(message.createdAt).getTime())}</p>\n          )}\n        </div>\n      </div>\n      <div className=\"flex flex-row items-center gap-[8px] mb-[10px]\">\n        <img src={DangerIcon} alt=\"\" className=\"w-[26px] h-[26px]\" />\n        <span className=\"text-[20px] text-[#FF543D] font-bold\">Urgent Alert</span>\n      </div>\n      <ul className=\"list-disc pl-[24px]\">\n        {urgentMessage.map((item) => {\n          return (\n            <li className=\"flex flex-row items-top gap-[8px]\">\n              <span className=\"text-[15px] break-words\" onClick={() => showMessageDetail(item)}>{item.content}</span>\n              <ChatAvatar size={20} chatId={item.chatId} />\n            </li>\n          );\n        })}\n      </ul>\n      <ActionsItems messageId={message.id} messages={urgentMessage} deleteMessage={deleteMessage} />\n    </div>\n  );\n};\n\nexport default UrgentCheckMessage;\n","/* eslint-disable max-len */\n/* eslint-disable no-null/no-null */\nimport React, { useEffect, useState } from 'react';\nimport type { Message } from 'ai';\nimport { getActions, getGlobal } from '../../../global';\n\nimport { getUserFullName, isUserId } from '../../../global/helpers';\nimport { selectChat, selectUser } from '../../../global/selectors';\n\nimport Avatar from '../component/Avatar';\n\nexport const UserSearchMessage = ({ message }: { message: Message }) => {\n  const [senderIds, setSenderIds] = useState<string[]>([]);\n  const global = getGlobal();\n  const handleClick = (userId: string) => {\n    const chat = selectChat(global, userId);\n    if (chat) {\n      getActions().openChat({ id: userId });\n    }\n  };\n  const renderChatAvatar = (userId: string) => {\n    if (!isUserId(userId)) {\n      return null;\n    }\n    let title:string | undefined;\n    const peer = selectUser(global, userId);\n    if (peer) {\n      title = getUserFullName(peer);\n    } else {\n      return null;\n    }\n    return (\n      <div\n        className=\"flex flex-row items-center gap-[8px] cursor-pointer px-[12px] py-[8px] rounded-[12px] hover:bg-[#D9D9D9]\"\n        onClick={() => { handleClick(userId); }}\n      >\n        <Avatar\n          key={userId}\n          className=\"overlay-avatar inline-block cursor-pointer\"\n          size={44}\n          peer={peer}\n        />\n        <div className=\"flex flex-col justify-center gap-[4px]\">\n          <span className=\"text-[15px] font-semibold text-black leading-[18px]\">{title}</span>\n        </div>\n      </div>\n    );\n  };\n  useEffect(() => {\n    try {\n      const ids = JSON.parse(message.content);\n      setSenderIds(ids || []);\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.log(error);\n    }\n  }, [message]);\n  if (senderIds.length === 0) {\n    return null;\n  }\n  return (\n    <div className=\"p-[10px] mx-[22px] rounded-[16px] border-[1px] border-[#D9D9D9] bg-white dark:bg-[#292929]\">\n      <div className=\"flex flex-col gap-[12px]\">\n        {senderIds.splice(0, 10).map((id) => {\n          return (\n            <>\n              {renderChatAvatar(id)}\n            </>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n","/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable react/jsx-props-no-spreading */\n/* eslint-disable react/jsx-no-useless-fragment */\n// @ts-nocheck\nimport React, { memo } from 'react';\nimport ReactMarkdown, { type Components } from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\n\nimport { CodeBlock } from './code-block';\n\nconst components: Partial<Components> = {\n  code: CodeBlock,\n  pre: ({ children }) => <>{children}</>,\n  ol: ({ node, children, ...props }) => {\n    return (\n      <ol className=\"list-decimal list-outside ml-4\" {...props}>\n        {children}\n      </ol>\n    );\n  },\n  li: ({ node, children, ...props }) => {\n    return (\n      <li className=\"py-1\" {...props}>\n        {children}\n      </li>\n    );\n  },\n  ul: ({ node, children, ...props }) => {\n    return (\n      <ul className=\"list-decimal list-outside ml-4\" {...props}>\n        {children}\n      </ul>\n    );\n  },\n  strong: ({ node, children, ...props }) => {\n    return (\n      <span className=\"font-semibold\" {...props}>\n        {children}\n      </span>\n    );\n  },\n  a: ({ node, children, ...props }) => {\n    return (\n      <a\n        className=\"text-blue-500 hover:underline\"\n        target=\"_blank\"\n        rel=\"noreferrer\"\n      >\n        {children}\n      </a>\n    );\n  },\n  h1: ({ node, children, ...props }) => {\n    return (\n      <h1 className=\"text-3xl font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h1>\n    );\n  },\n  h2: ({ node, children, ...props }) => {\n    return (\n      <h2 className=\"text-2xl font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h2>\n    );\n  },\n  h3: ({ node, children, ...props }) => {\n    return (\n      <h3 className=\"text-xl font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h3>\n    );\n  },\n  h4: ({ node, children, ...props }) => {\n    return (\n      <h4 className=\"text-lg font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h4>\n    );\n  },\n  h5: ({ node, children, ...props }) => {\n    return (\n      <h5 className=\"text-base font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h5>\n    );\n  },\n  h6: ({ node, children, ...props }) => {\n    return (\n      <h6 className=\"text-sm font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h6>\n    );\n  },\n};\n\nconst remarkPlugins = [remarkGfm];\n\nconst NonMemoizedMarkdown = ({ children }: { children: string }) => {\n  return (\n    <ReactMarkdown remarkPlugins={remarkPlugins} components={components}>\n      {children}\n    </ReactMarkdown>\n  );\n};\n\nexport const Markdown = memo(\n  NonMemoizedMarkdown,\n  (prevProps, nextProps) => prevProps.children === nextProps.children,\n);\n","/* eslint-disable react/jsx-props-no-spreading */\n/* eslint-disable max-len */\n/* eslint-disable react/react-in-jsx-scope */\nimport React from 'react';\n\ninterface CodeBlockProps {\n  node: any;\n  inline: boolean;\n  className: string;\n  children: any;\n}\n\nexport function CodeBlock({\n  node,\n  inline,\n  className,\n  children,\n  ...props\n}: CodeBlockProps) {\n  if (!inline) {\n    return (\n      <div className=\"not-prose flex flex-col\">\n        <pre\n          {...props}\n          className=\"text-sm w-full overflow-x-auto dark:bg-zinc-900 p-4 border border-zinc-200 dark:border-zinc-700 rounded-xl dark:text-zinc-50 text-zinc-900\"\n        >\n          <code className=\"whitespace-pre-wrap break-words\">{children}</code>\n        </pre>\n      </div>\n    );\n  } else {\n    return (\n      <code\n        className={`${className} text-sm bg-zinc-100 dark:bg-zinc-800 py-0.5 px-1 rounded-md`}\n        {...props}\n      >\n        {children}\n      </code>\n    );\n  }\n}\n","// @ts-nocheck\nimport React, { useState } from 'react';\nimport { AnimatePresence, motion } from 'framer-motion';\n\nimport { ChevronDownIcon, LoaderIcon } from './icons';\nimport { Markdown } from './markdown';\n\ninterface MessageReasoningProps {\n  isLoading: boolean;\n  reasoning: string;\n}\n\nexport function MessageReasoning({\n  isLoading,\n  reasoning,\n}: MessageReasoningProps) {\n  const [isExpanded, setIsExpanded] = useState(true);\n\n  const variants = {\n    collapsed: {\n      height: 0,\n      opacity: 0,\n      marginTop: 0,\n      marginBottom: 0,\n    },\n    expanded: {\n      height: 'auto',\n      opacity: 1,\n      marginTop: '1rem',\n      marginBottom: '0.5rem',\n    },\n  };\n\n  return (\n    <div className=\"flex flex-col\">\n      {isLoading ? (\n        <div className=\"flex flex-row gap-2 items-center\">\n          <div className=\"font-medium\">Reasoning</div>\n          <div className=\"animate-spin\">\n            <LoaderIcon />\n          </div>\n        </div>\n      ) : (\n        <div className=\"flex flex-row gap-2 items-center\">\n          <div className=\"font-medium\">Reasoned for a few seconds</div>\n          <div\n            className=\"cursor-pointer\"\n            onClick={() => {\n              setIsExpanded(!isExpanded);\n            }}\n          >\n            <ChevronDownIcon />\n          </div>\n        </div>\n      )}\n\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            key=\"content\"\n            initial=\"collapsed\"\n            animate=\"expanded\"\n            exit=\"collapsed\"\n            variants={variants}\n            transition={{ duration: 0.2, ease: 'easeInOut' }}\n            className=\"pl-4 text-zinc-600 dark:text-zinc-400 border-l flex flex-col gap-4 overflow-hidden\"\n          >\n            <Markdown>{reasoning}</Markdown>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n","import React from 'react';\nimport type { Attachment } from 'ai';\n\nimport { LoaderIcon } from './icons';\n\nexport const PreviewAttachment = ({\n  attachment,\n  isUploading = false,\n}: {\n  attachment: Attachment;\n  isUploading?: boolean;\n}) => {\n  const { name, url, contentType } = attachment;\n\n  return (\n    <div className=\"flex flex-col gap-2\">\n      <div className=\"w-20 h-16 aspect-video bg-muted rounded-md relative flex flex-col items-center justify-center\">\n        {contentType ? (\n          contentType.startsWith('image') ? (\n            // NOTE: it is recommended to use next/image for images\n            <img\n              key={url}\n              src={url}\n              alt={name ?? 'An image attachment'}\n              className=\"rounded-md size-full object-cover\"\n            />\n          ) : (\n            <div className=\"\" />\n          )\n        ) : (\n          <div className=\"\" />\n        )}\n\n        {isUploading && (\n          <div className=\"animate-spin absolute text-zinc-500\">\n            <LoaderIcon />\n          </div>\n        )}\n      </div>\n      <div className=\"text-xs text-zinc-500 max-w-16 truncate\">{name}</div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Message } from \"ai\";\nimport { SVGProps } from \"react\";\nimport { ThinkingMessage } from \"../message\";\nimport buildClassName from \"../../../util/buildClassName\";\nimport { ApiMediaFormat, ApiMessage } from \"../../../api/types\";\nimport { getPhotoMediaHash, isOwnMessage } from \"../../../global/helpers\";\nimport { getActions, getGlobal } from \"../../../global\";\nimport { selectTheme } from \"../../../global/selectors\";\nimport { useWaveformCanvas } from \"../../common/Audio\";\nimport useMedia from \"../hook/useMedia\";\nimport { MediaViewerOrigin } from \"../../../types\";\nimport SerenaPath from \"../../chatAssistant/assets/serena.png\";\n\ntype IProps = {\n  message: Message;\n};\n\nexport type MessageStatus = \"loading\" | \"success\" | \"error\";\n\nconst RoomAIMediaMessage: React.FC<IProps> = (props) => {\n  const global = getGlobal();\n  const theme = selectTheme(global);\n\n  let content: any = {};\n  let message: ApiMessage | undefined = undefined;\n  let summaryInfo: any = {};\n  let isAuto: boolean = false;\n  let status: MessageStatus = \"loading\";\n  try {\n    content = JSON.parse(props?.message.content);\n    message = content?.message;\n    try {\n      summaryInfo = JSON.parse(content?.summaryInfo);\n    } catch (error) {}\n    isAuto = content?.isAuto;\n    status = content?.status;\n  } catch (error) {}\n\n  const isOwn = message ? isOwnMessage(message) : false;\n  const waveformCanvasRef = message?.content?.voice\n    ? useWaveformCanvas(theme, message?.content?.voice, 1, isOwn)\n    : undefined;\n\n  const imgBlobUrl = message?.content?.photo\n    ? useMedia(\n        message?.content?.photo\n          ? getPhotoMediaHash(message?.content?.photo, \"inline\")\n          : undefined,\n        false,\n        ApiMediaFormat.BlobUrl\n      )\n    : undefined;\n  const fullMediaData = message?.content?.photo?.blobUrl || imgBlobUrl;\n  const forcedWidth = message?.content?.photo?.thumbnail?.width;\n  const withBlurredBackground = Boolean(forcedWidth);\n\n  function getTitle() {\n    if (!message) return \"\";\n\n    const { webPage, photo, document, audio, voice } = message?.content;\n    if (webPage) {\n      return \"Summarize this webpage\";\n    } else if (photo) {\n      return \"Summarize this image\";\n    } else if (document) {\n      return \"Summarize this document\";\n    } else if (audio) {\n      return \"Summarize this audio\";\n    } else if (voice) {\n      return \"Summarize this voice\";\n    }\n  }\n\n  function onPreviewClick() {\n    const { openMediaViewer } = getActions();\n\n    openMediaViewer({\n      chatId: message?.chatId,\n      threadId: -1,\n      messageId: message?.id,\n      origin: MediaViewerOrigin.Inline,\n      withDynamicLoading: true,\n    });\n  }\n\n  function renderMessageContent() {\n    if (!message) return \"\";\n\n    const { webPage, photo, document, audio, voice } = message?.content;\n    if (webPage) {\n      return (\n        <div className={buildClassName(\"flex\", !isAuto ? \"justify-end\" : \"\")}>\n          <div className=\"rounded-[16px] bg-[var(--color-background)] p-3 text-[var(--color-text)] break-all\">\n            {message?.content?.webPage?.url}\n          </div>\n        </div>\n      );\n    } else if (photo) {\n      return (\n        fullMediaData && (\n          <div className={buildClassName(\"flex\", !isAuto ? \"justify-end\" : \"\")}>\n            <img\n              src={fullMediaData}\n              className={buildClassName(\n                \"full-media cursor-pointer\",\n                withBlurredBackground && \"with-blurred-bg\"\n              )}\n              alt=\"\"\n              style={{ width: `${forcedWidth ?? 0}px` } as React.CSSProperties}\n              onClick={onPreviewClick}\n            />\n          </div>\n        )\n      );\n    } else if (document) {\n      return (\n        <div className={buildClassName(\"flex\", !isAuto ? \"justify-end\" : \"\")}>\n          <div className=\"rounded-[16px] bg-[var(--color-background)] p-3 text-[var(--color-text)] break-all\">\n            {message?.content.document?.fileName}\n          </div>\n        </div>\n      );\n    } else if (audio) {\n      return (\n        <div className={buildClassName(\"flex\", !isAuto ? \"justify-end\" : \"\")}>\n          <div className=\"rounded-[16px] bg-[var(--color-background)] p-3 text-[var(--color-text)] break-all\">\n            {message?.content.audio?.fileName}\n          </div>\n        </div>\n      );\n    } else if (voice) {\n      return (\n        <div className={buildClassName(\"flex\", !isAuto ? \"justify-end\" : \"\")}>\n          <div className=\"rounded-[16px] bg-[var(--color-background)] p-3 text-[var(--color-text)] break-all\">\n            {message?.content?.voice && (\n              <div className=\"waveform-wrapper\">\n                <div className=\"waveform\" draggable={false}>\n                  <canvas ref={waveformCanvasRef} />\n                </div>\n              </div>\n            )}\n            {message?.content?.audio && (\n              <p\n                className=\"title\"\n                dir=\"auto\"\n                title={message?.content?.audio?.title}\n              >\n                {message?.content?.audio?.title}\n              </p>\n            )}\n          </div>\n        </div>\n      );\n    }\n  }\n\n  function renderSummary() {\n    if (!message) return \"\";\n\n    const { webPage, photo } = message?.content;\n    if (webPage) {\n      return (\n        <div className=\"rounded-[16px] bg-[var(--color-background)] p-3 text-[var(--color-text)]\">\n          <div className=\"font-[600] text-[16px]\">\n            Summary of the Article: \"{summaryInfo?.title}\"\n          </div>\n          <div className=\"flex flex-col gap-[6px] mt-3\">\n            <div className=\"font-[600]\">Key Highlights:</div>\n            <div className=\"flex flex-col\">\n              {summaryInfo?.highlights?.map((item: any, index: number) => {\n                return (\n                  <div className=\"flex flex-col\">\n                    <div className=\"flex flex-row items-center flex-wrap\">\n                      <span className=\"mr-[24px]\">\n                        {index + 1}. {item?.title}\n                      </span>\n                    </div>\n                    <ul className=\"list-disc list-inside ml-3 mb-1\">\n                      {item?.content?.map((contentItem: any) => {\n                        return <li className=\"break-word\">{contentItem}</li>;\n                      })}\n                    </ul>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      );\n    } else if (photo) {\n      return (\n        <div className=\"rounded-[16px] bg-[var(--color-background)] text-[var(--color-text)] p-3 text-[14px]\">\n          {isAuto ? (\n            <div className=\"font-[600]\">Image summarize</div>\n          ) : (\n            <div className=\"flex items-center gap-2\">\n              <img src={SerenaPath} className=\"w-[18px] h-[18px]\" />\n              Serena AI\n            </div>\n          )}\n          <div className=\"flex flex-col gap-[6px] mt-2\">\n            {summaryInfo?.text}\n          </div>\n        </div>\n      );\n    } else {\n      return (\n        <div className=\"rounded-[16px] bg-[var(--color-background)] p-3 text-[var(--color-text)]\">\n          <div className=\"font-[600] text-[16px]\">Key Highlights:</div>\n          <div className=\"flex flex-col mt-2\">\n            {summaryInfo?.map((item: any) => {\n              return (\n                <div className=\"flex flex-col\">\n                  <div className=\"flex flex-row items-center flex-wrap\">\n                    <span className=\"mr-[24px] font-[600]\">{item?.title}</span>\n                  </div>\n                  <ul className=\"list-disc list-inside ml-3 mb-1\">\n                    {item?.content?.map((contentItem: any) => {\n                      return <li className=\"break-word\">{contentItem}</li>;\n                    })}\n                  </ul>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      );\n    }\n  }\n\n\n\n  return (\n    <div className=\"flex flex-col gap-2 px-3 text-[14px]\">\n      {!isAuto && (\n        <div className=\"text-right\">\n          <AIRoomBubble>{getTitle()}</AIRoomBubble>\n        </div>\n      )}\n      {renderMessageContent()}\n      {status === \"loading\" ? (\n        <ThinkingMessage />\n      ) : status === \"error\" ? (\n        <div className=\"rounded-[16px] bg-[#FFF9F9] text-[#000] p-3 text-[14px] border-[1px] border-[#FFC7C7]\">\n          {content?.errorMsg}\n        </div>\n      ) : (\n        renderSummary()\n      )}\n    </div>\n  );\n};\n\nexport default RoomAIMediaMessage;\n\nexport const AIRoomBubble = ({ children }: { children: React.ReactNode }) => {\n  return (\n    <div className=\"bg-[var(--color-ai-room-bubble-bg)] py-2 px-3 rounded-t-[16px] rounded-bl-[16px] text-right inline-flex relative\">\n      {children}\n      <div className=\"absolute bottom-[-3px] right-[-9px] text-[var(--color-ai-room-bubble-bg)]\">\n        <AppendixIcon />\n      </div>\n    </div>\n  );\n};\n\nexport const AppendixIcon = (props: SVGProps<SVGSVGElement>) => (\n  <svg width={9} height={20} {...props}>\n    <defs>\n      <filter\n        id=\"a\"\n        width=\"200%\"\n        height=\"141.2%\"\n        x=\"-50%\"\n        y=\"-14.7%\"\n        filterUnits=\"objectBoundingBox\"\n      >\n        <feOffset dy={1} in=\"SourceAlpha\" result=\"shadowOffsetOuter1\" />\n        <feGaussianBlur\n          in=\"shadowOffsetOuter1\"\n          result=\"shadowBlurOuter1\"\n          stdDeviation={1}\n        />\n        <feColorMatrix\n          in=\"shadowBlurOuter1\"\n          values=\"0 0 0 0 0.0621962482 0 0 0 0 0.138574144 0 0 0 0 0.185037364 0 0 0 0.15 0\"\n        />\n      </filter>\n    </defs>\n    <g fill=\"none\" fillRule=\"evenodd\">\n      <path\n        fill=\"currentColor\"\n        d=\"M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 0 1 6 17z\"\n        filter=\"url(#a)\"\n      />\n      <path\n        fill=\"currentColor\"\n        d=\"M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 0 1 6 17z\"\n      />\n    </g>\n  </svg>\n);\n","import React from \"react\";\nimport { getActions, getGlobal } from \"../../../global\";\nimport { Message } from \"ai\";\nimport { selectCurrentChat } from \"../../../global/selectors\";\nimport { ApiDraft } from \"../../../api/types\";\nimport { ChataiStores } from \"../store\";\nimport buildClassName from \"../../../util/buildClassName\";\nimport { MessageStatus } from \"./room-ai-media-message\";\nimport { ThinkingMessage } from \"../message\";\n\ntype IProps = {\n  message: Message;\n};\nconst ReplyMentionMessage = (props: IProps) => {\n  const { message } = props;\n  let content: any = {};\n  let messageId: number = 0;\n  let disabled = false;\n  let status: MessageStatus = \"loading\";\n  try {\n    content = JSON.parse(message.content);\n    messageId = content?.messageId;\n    disabled = content?.disabled;\n    status = content?.status;\n  } catch (error) {}\n\n  function onReplyClick(text: string) {\n    if (disabled) return;\n    const global = getGlobal();\n    const { saveReplyDraft, sendMessage, clearDraft } = getActions();\n    const currentChat = selectCurrentChat(global);\n    if (currentChat && messageId) {\n      const chatId = currentChat.id;\n      const threadId = -1;\n      saveReplyDraft({\n        chatId,\n        threadId,\n        draft: {\n          replyInfo: {\n            type: \"message\",\n            replyToMsgId: messageId,\n            replyToPeerId: undefined,\n          },\n        } as ApiDraft,\n        isLocalOnly: true,\n      });\n      sendMessage({\n        messageList: {\n          chatId,\n          threadId,\n          type: \"thread\",\n        },\n        text,\n      });\n      clearDraft({ chatId, isLocalOnly: true });\n      // disable the reply button\n      ChataiStores.message?.storeMessage({\n        ...message,\n        chatId,\n        timestamp: new Date().getTime(),\n        content: JSON.stringify({\n          disabled: true,\n          ...content,\n        }),\n      });\n    }\n  }\n\n  return (\n    <div className=\"rounded-[16px] bg-[var(--color-background)] text-[var(--color-text)] mx-2 p-3 w-full text-[14px]\">\n      <div className=\"font-[600]\">You were mentioned:</div>\n      <div>\"{content?.content}\"</div>\n      {status == \"loading\" ? (\n        <ThinkingMessage />\n      ) : status === \"error\" ? (\n        <div className=\"rounded-[16px] bg-[#FFF9F9] text-[#000] p-3 text-[14px] border-[1px] border-[#FFC7C7]\">\n          {content?.errorMsg}\n        </div>\n      ) : (\n        <>\n          <div>Here are a few reply suggestions for you </div>\n          <div className=\"flex flex-col gap-[6px] mt-2\">\n            {content?.replys?.map((reply: any, index: number) => {\n              return (\n                <div\n                  className={buildClassName(\n                    \"bg-[#F4F4F4] rounded-[6px] p-[6px] \",\n                    disabled\n                      ? \"cursor-not-allowed opacity-50\"\n                      : \"cursor-pointer hover:opacity-80\"\n                  )}\n                  key={index}\n                  onClick={() => onReplyClick(reply?.reply)}\n                >\n                  \"{reply}\"\n                </div>\n              );\n            })}\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default ReplyMentionMessage;\n","/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable jsx-quotes */\n/* eslint-disable max-len */\n/* eslint-disable no-null/no-null */\n// @ts-nocheck\n\nimport React, { memo, useMemo } from 'react';\nimport type { Message } from 'ai';\nimport cx from 'classnames';\nimport equal from 'fast-deep-equal';\nimport { AnimatePresence, motion } from 'framer-motion';\n\nimport { cn } from '../../lib/utils';\nimport AISearchSugesstionsMessage from './messages/ai-search-sugesstion-message';\nimport { GlobalIntroduceMessage } from './messages/global-introduce-message';\nimport GlobalSummaryMessage from './messages/global-summary-message';\nimport GoogleEventCreateMessage from './messages/google-event-create-messages';\nimport GoogleEventDetailMessage from './messages/google-event-detail-message';\nimport GoogleLoginAuthMessage from './messages/google-login-auth-message';\nimport { GroupSearchMessage } from './messages/group-search-message';\nimport IntroducePortraitMessage from './messages/introduce-portrait-message';\nimport IntroduceSmartreplyMessage from './messages/introduce-smartreply-message';\nimport IntroduceSummaryMessage from './messages/introduce-summary-message';\nimport IntroduceTranslationMessage from './messages/introduce-translation-message';\nimport RoomActionMessage from './messages/room-actions-message';\nimport RoomAIDescriptionMessage from './messages/room-ai-des-message';\nimport RoomSummaryMessage from './messages/room-summary-message';\n// import SummaryMessage from './summary-message';\nimport UrgentCheckMessage from './messages/urgent-check-message';\n// import { useScrollToBottom } from './use-scroll-to-bottom';\nimport { UserSearchMessage } from './messages/user-search-message';\nimport { LoadingIcon } from './icons';\nimport { Markdown } from './markdown';\nimport { MessageReasoning } from './message-reasoning';\nimport { PreviewAttachment } from './preview-attachment';\nimport RoomAIMediaMessage from \"./messages/room-ai-media-message\";\nimport ReplyMentionMessage from \"./messages/room-ai-reply-mention-message\"\nimport ErrorBoundary from './ErrorBoundary';\n\nexport enum AIMessageType {\n  GlobalSummary = 'global-summary',\n  UrgentCheck = 'urgent-message-check',\n  GroupSearch = 'group-search',\n  UserSearch = 'user-search',\n  GoogleAuth = 'google-auth',\n  GoogleEventInsert = 'google-event-insert',\n  GoogleEventDetail = 'google-event-detail',\n  RoomSummary = 'room-summary',\n  RoomActions = 'room-actions',\n  SmartreplyIntroduce = 'global-smartreply-introduce',\n  SummaryIntroduce = 'global-summary-introduce',\n  TranslationIntroduce = 'global-translation-introduce',\n  PortraitIntroduce = 'global-portrait-introduce',\n  GlobalIntroduce = 'global-introduce',\n  RoomAIDescription = 'room-ai-description',\n  AISearchSugesstion = 'ai-search-sugesstion',\n  AIReplyMention = 'room-ai-reply-mention',\n  AIMediaSummary = 'room-ai-media-summary',\n  Default = 'default',\n}\n\nconst DefaultMessage = ({ message, isLoading }:{ message: Message;isLoading:boolean }) => {\n  return (\n    <motion.div\n      className=\"w-full px-[12px] group/message\"\n      initial={{ y: 5, opacity: 0 }}\n      animate={{ y: 0, opacity: 1 }}\n      data-role={message.role}\n    >\n      <div className='flex gap-4 w-full group-data-[role=user]/message:ml-auto group-data-[role=user]/message:max-w-2xl'>\n        <div className=\"flex flex-col gap-4 w-full\">\n          {message.experimental_attachments && (\n            <div className=\"flex flex-row justify-end gap-2\">\n              {message.experimental_attachments.map((attachment) => (\n                <PreviewAttachment\n                  key={attachment.url}\n                  attachment={attachment}\n                />\n              ))}\n            </div>\n          )}\n\n          {message.reasoning && (\n            <MessageReasoning\n              isLoading={isLoading}\n              reasoning={message.reasoning}\n            />\n          )}\n\n          {(message.content || message.reasoning) && (\n            <div className=\"flex flex-row gap-2 items-start w-full\">\n              <div\n                className={cn('w-auto flex flex-col gap-4 bg-white text-[var(--color-text)] px-3 py-2 rounded-xl dark:bg-[#292929]', {\n                  '!bg-[#E8D7FF] text-black ml-auto':\n                      message.role === 'user',\n                })}\n              >\n                <Markdown>{message.content as string}</Markdown>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </motion.div>\n  );\n};\nconst PurePreviewMessage = ({\n  message,\n  isLoading,\n  deleteMessage,\n}: {\n  message: Message;\n  isLoading: boolean;\n  deleteMessage?: (messageId: string) => void;\n}) => {\n  const messageType:AIMessageType | undefined = useMemo(() => {\n    const matched = message?.annotations?.find(\n      (item) => item\n      && typeof item === 'object'\n      && 'type' in item\n      && Object.values(AIMessageType).includes(item.type as AIMessageType),\n    );\n\n    const type = matched?.type as AIMessageType || AIMessageType.Default;\n    return type;\n  }, [message]);\n\n  return (\n    <AnimatePresence>\n      {messageType === AIMessageType.GlobalSummary && (\n        <ErrorBoundary>\n          <GlobalSummaryMessage\n            message={message}\n            // eslint-disable-next-line react/jsx-no-bind\n            deleteMessage={() => deleteMessage?.(message.id)}\n          />\n        </ErrorBoundary>\n      )}\n      {messageType === AIMessageType.UrgentCheck && (\n        <UrgentCheckMessage\n          message={message}\n          // eslint-disable-next-line react/jsx-no-bind\n          deleteMessage={() => deleteMessage?.(message.id)}\n        />\n      )}\n      {messageType === AIMessageType.GroupSearch && (<GroupSearchMessage message={message} />)}\n      {messageType === AIMessageType.UserSearch && (<UserSearchMessage message={message} />)}\n      {messageType === AIMessageType.GoogleAuth && (<GoogleLoginAuthMessage message={message} />)}\n      {messageType === AIMessageType.GoogleEventInsert && (<GoogleEventCreateMessage message={message} />)}\n      {messageType === AIMessageType.GoogleEventDetail && (<GoogleEventDetailMessage message={message} />)}\n      {messageType === AIMessageType.RoomSummary && (\n        <RoomSummaryMessage\n          message={message}\n          // eslint-disable-next-line react/jsx-no-bind\n          deleteMessage={() => deleteMessage?.(message.id)}\n        />\n      )}\n      {messageType === AIMessageType.RoomActions && (\n        <RoomActionMessage\n          message={message}\n          // eslint-disable-next-line react/jsx-no-bind\n          deleteMessage={() => deleteMessage?.(message.id)}\n        />\n      )}\n      {messageType === AIMessageType.SmartreplyIntroduce && (<IntroduceSmartreplyMessage />)}\n      {messageType === AIMessageType.SummaryIntroduce && (<IntroduceSummaryMessage />)}\n      {messageType === AIMessageType.TranslationIntroduce && (<IntroduceTranslationMessage />)}\n      {messageType === AIMessageType.PortraitIntroduce && (<IntroducePortraitMessage />)}\n      {messageType === AIMessageType.GlobalIntroduce && (<GlobalIntroduceMessage />)}\n      {messageType === AIMessageType.RoomAIDescription && (<RoomAIDescriptionMessage message={message} />)}\n      {messageType === AIMessageType.AISearchSugesstion && (<AISearchSugesstionsMessage />)}\n      {messageType === AIMessageType.AIReplyMention && (<ReplyMentionMessage message={message} />)}\n      {messageType === AIMessageType.AIMediaSummary && (<RoomAIMediaMessage message={message} />)}\n      {messageType === AIMessageType.Default && (<DefaultMessage message={message} isLoading={isLoading} />)}\n    </AnimatePresence>\n  );\n};\n\nexport const PreviewMessage = memo(\n  PurePreviewMessage,\n  (prevProps, nextProps) => {\n    if (prevProps.isLoading !== nextProps.isLoading) return false;\n    if (prevProps.message.reasoning !== nextProps.message.reasoning) return false;\n    if (prevProps.message.content !== nextProps.message.content) return false;\n    if (\n      !equal(\n        prevProps.message.toolInvocations,\n        nextProps.message.toolInvocations,\n      )\n    ) return false;\n    return true;\n  },\n);\n\nexport const ThinkingMessage = () => {\n  const role = 'assistant';\n\n  return (\n    <motion.div\n      className=\"w-full px-[12px] group/message \"\n      initial={{ y: 5, opacity: 0 }}\n      animate={{ y: 0, opacity: 1, transition: { delay: 1 } }}\n      data-role={role}\n    >\n      <div\n        className={cx(\n          'flex gap-4 group-data-[role=user]/message:px-3 w-full group-data-[role=user]/message:w-fit group-data-[role=user]/message:ml-auto group-data-[role=user]/message:max-w-2xl group-data-[role=user]/message:py-2 rounded-xl',\n          {\n            'group-data-[role=user]/message:bg-muted': true,\n          },\n        )}\n      >\n        <LoadingIcon size={40} />\n      </div>\n    </motion.div>\n  );\n};\n","/* eslint-disable max-len */\n/* eslint-disable no-null/no-null */\nimport React, {\n  memo, useRef,\n} from 'react';\nimport type { UseChatHelpers } from '@ai-sdk/react';\nimport type { Message } from 'ai';\nimport equal from 'fast-deep-equal';\nimport { motion } from 'framer-motion';\n\nimport { useMessages } from './hook/use-messages';\nimport { cn } from './utils/util';\nimport { PreviewMessage, ThinkingMessage } from './message';\n\nimport './messages.scss';\n\ninterface MessagesProps {\n  chatId: string;\n  className?: string;\n  isLoading?: boolean;\n  status: UseChatHelpers['status'];\n  messages: Array<Message>;\n  hasMore?: boolean;\n  deleteMessage?: (messageId: string) => void;\n  loadMore: () => Promise<void>;\n}\nfunction PureMessages({\n  chatId,\n  className,\n  isLoading,\n  status,\n  messages,\n  hasMore,\n  deleteMessage,\n  loadMore,\n}: MessagesProps) {\n  const upLoadRef = useRef(false);\n  const anchorRef = useRef<HTMLDivElement | null>(null);\n  const {\n    containerRef: messagesContainerRef,\n    endRef: messagesEndRef,\n    onViewportEnter,\n    onViewportLeave,\n  } = useMessages({\n    chatId: chatId!,\n    status,\n  });\n  const isAuxiliary = (message: Message) => {\n    return message?.annotations?.some((item) => item && typeof item === 'object' && 'isAuxiliary' in item && item.isAuxiliary === true) ?? false;\n  };\n  const handleScroll = () => {\n    const container = messagesContainerRef.current;\n    if (!container || upLoadRef.current) return;\n\n    const { scrollTop } = container;\n\n    if (scrollTop === 0 && hasMore) {\n      upLoadRef.current = true;\n      const anchor = container.firstChild?.firstChild as HTMLDivElement || null;\n      anchorRef.current = anchor;\n      loadMore().finally(() => {\n        upLoadRef.current = false;\n        if (anchorRef.current) {\n          anchorRef.current.scrollIntoView({ behavior: 'instant', block: 'start' });\n        }\n        // scrollBuffer.current = calculateBuffer();\n      });\n    }\n  };\n\n  return (\n    <div\n      ref={messagesContainerRef}\n      onScroll={handleScroll}\n      className={cn('flex flex-col min-w-0 gap-[10px] h-full overflow-y-auto relative pt-4 ai-message-container', className)}\n    >\n      {messages.map((message, index) => {\n        if (!isAuxiliary(message)) {\n          return (\n            <PreviewMessage\n              message={message}\n              deleteMessage={deleteMessage}\n              key={message.id}\n              isLoading={status === 'streaming' && messages.length - 1 === index}\n            />\n          );\n        } else {\n          return null;\n        }\n      })}\n\n      {\n        (\n          (status === 'submitted'\n          && messages.length > 0\n          && messages[messages.length - 1].role === 'user') || isLoading\n        ) && <ThinkingMessage />\n      }\n      <motion.div\n        ref={messagesEndRef}\n        className=\"shrink-0 min-w-[24px] min-h-[24px]\"\n        onViewportLeave={onViewportLeave}\n        onViewportEnter={onViewportEnter}\n      />\n    </div>\n\n  );\n}\nexport const Messages = memo(PureMessages, (prevProps, nextProps) => {\n  if (prevProps.status !== nextProps.status) return false;\n  if (prevProps.status && nextProps.status) return false;\n  if (prevProps.messages.length !== nextProps.messages.length) return false;\n  if (!equal(prevProps.messages, nextProps.messages)) return false;\n\n  return true;\n});\n","import { useEffect, useRef, useState } from 'react';\nimport type { UseChatHelpers } from '@ai-sdk/react';\n\nimport { useScrollToBottom } from './use-scroll-to-bottom';\n\nfunction scrollUntilStable({\n  container,\n  scrollToBottom,\n  maxAttempts = 30,\n  interval = 50,\n}: {\n  container: HTMLElement;\n  scrollToBottom: (behavior?: ScrollBehavior) => void;\n  maxAttempts?: number;\n  interval?: number;\n}) {\n  let lastScrollHeight = container.scrollHeight;\n  let attempts = 0;\n\n  const tick = () => {\n    const current = container.scrollHeight;\n\n    if (current !== lastScrollHeight) {\n      scrollToBottom('instant');\n      lastScrollHeight = current;\n      attempts = 0; // reset\n    } else {\n      attempts++;\n    }\n\n    if (attempts < maxAttempts) {\n      requestAnimationFrame(() => setTimeout(tick, interval));\n    }\n  };\n\n  tick();\n}\nexport function useMessages({\n  chatId,\n  status,\n}: {\n  chatId: string;\n  status: UseChatHelpers['status'];\n}) {\n  const {\n    containerRef,\n    endRef,\n    isAtBottom,\n    scrollToBottom,\n    onViewportEnter,\n    onViewportLeave,\n  } = useScrollToBottom();\n\n  const hasScrollToBottom = useRef(false);\n\n  const [hasSentMessage, setHasSentMessage] = useState(false);\n\n  useEffect(() => {\n    if (status === 'submitted') {\n      setHasSentMessage(true);\n    }\n  }, [status]);\n\n  useEffect(() => {\n    if (!hasScrollToBottom.current && containerRef.current) {\n      scrollUntilStable({\n        container: containerRef.current,\n        scrollToBottom,\n      });\n      hasScrollToBottom.current = true;\n    }\n  }, [containerRef, scrollToBottom]);\n\n  return {\n    containerRef,\n    endRef,\n    isAtBottom,\n    scrollToBottom,\n    onViewportEnter,\n    onViewportLeave,\n    hasSentMessage,\n  };\n}\n","/* eslint-disable max-len */\n/* eslint-disable no-null/no-null */\nimport { useCallback, useEffect, useRef } from 'react';\nimport useSWR from 'swr';\n\ntype ScrollFlag = ScrollBehavior | false;\n\nexport function useScrollToBottom() {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const endRef = useRef<HTMLDivElement>(null);\n\n  const { data: isAtBottom = false, mutate: setIsAtBottom } = useSWR(\n    'messages:is-at-bottom',\n    null,\n    { fallbackData: false },\n  );\n\n  const { data: scrollBehavior = false, mutate: setScrollBehavior } = useSWR<ScrollFlag>('messages:should-scroll', null, { fallbackData: false });\n\n  useEffect(() => {\n    if (scrollBehavior) {\n      endRef.current?.scrollIntoView({ behavior: scrollBehavior });\n      setScrollBehavior(false);\n    }\n  }, [setScrollBehavior, scrollBehavior]);\n\n  const scrollToBottom = useCallback(\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    (scrollBehavior: ScrollBehavior = 'smooth') => {\n      setScrollBehavior(scrollBehavior);\n    },\n    [setScrollBehavior],\n  );\n\n  function onViewportEnter() {\n    setIsAtBottom(true);\n  }\n\n  function onViewportLeave() {\n    setIsAtBottom(false);\n  }\n\n  return {\n    containerRef,\n    endRef,\n    isAtBottom,\n    scrollToBottom,\n    onViewportEnter,\n    onViewportLeave,\n  };\n}\n","import type { RefObject } from 'react';\nimport { useEffect, useState } from '../../../../lib/teact/teact';\nimport { getGlobal } from '../../../../global';\n\nimport type { ApiChatMember, ApiUser } from '../../../../api/types';\nimport type { Signal } from '../../../../util/signals';\nimport { ApiMessageEntityTypes } from '../../../../api/types';\n\nimport { requestNextMutation } from '../../../../lib/fasterdom/fasterdom';\nimport { getMainUsername, getUserFirstOrLastName } from '../../../../global/helpers';\nimport { filterPeersByQuery } from '../../../../global/helpers/peers';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport { pickTruthy, unique } from '../../../../util/iteratees';\nimport { getCaretPosition, getHtmlBeforeSelection, setCaretPosition } from '../../../../util/selection';\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\n\nimport { useThrottledResolver } from '../../../../hooks/useAsyncResolvers';\nimport useDerivedSignal from '../../../../hooks/useDerivedSignal';\nimport useFlag from '../../../../hooks/useFlag';\nimport useLastCallback from '../../../../hooks/useLastCallback';\n\nconst THROTTLE = 300;\n\nlet RE_USERNAME_SEARCH: RegExp;\ntry {\n  RE_USERNAME_SEARCH = /(^|\\s)@[-_\\p{L}\\p{M}\\p{N}]*$/gui;\n} catch (e) {\n  // Support for older versions of Firefox\n  RE_USERNAME_SEARCH = /(^|\\s)@[-_\\d\\w-]*$/gi;\n}\n\nexport default function useMentionTooltip(\n  isEnabled: boolean,\n  getHtml: Signal<string>,\n  setHtml: (html: string) => void,\n  getSelectionRange: Signal<Range | undefined>,\n  inputRef: RefObject<HTMLDivElement>,\n  groupChatMembers?: ApiChatMember[],\n  topInlineBotIds?: string[],\n  currentUserId?: string,\n) {\n  const [filteredUsers, setFilteredUsers] = useState<ApiUser[] | undefined>();\n  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = useFlag(false);\n\n  const extractUsernameTagThrottled = useThrottledResolver(() => {\n    const html = getHtml();\n    if (!isEnabled || !getSelectionRange()?.collapsed || !html.includes('@')) return undefined;\n\n    const htmlBeforeSelection = getHtmlBeforeSelection(inputRef.current!);\n\n    return prepareForRegExp(htmlBeforeSelection).match(RE_USERNAME_SEARCH)?.[0].trim();\n  }, [isEnabled, getHtml, getSelectionRange, inputRef], THROTTLE);\n\n  const getUsernameTag = useDerivedSignal(\n    extractUsernameTagThrottled, [extractUsernameTagThrottled, getHtml, getSelectionRange], true,\n  );\n\n  const getWithInlineBots = useDerivedSignal(() => {\n    return isEnabled && getHtml().startsWith('@');\n  }, [getHtml, isEnabled]);\n\n  useEffect(() => {\n    const usernameTag = getUsernameTag();\n\n    if (!usernameTag || !(groupChatMembers || topInlineBotIds)) {\n      setFilteredUsers(undefined);\n      return;\n    }\n\n    // No need for expensive global updates on users, so we avoid them\n    const usersById = getGlobal().users.byId;\n    if (!usersById) {\n      setFilteredUsers(undefined);\n      return;\n    }\n\n    const memberIds = groupChatMembers?.reduce((acc: string[], member) => {\n      if (member.userId !== currentUserId) {\n        acc.push(member.userId);\n      }\n\n      return acc;\n    }, []);\n\n    const filter = usernameTag.substring(1);\n    const filteredIds = filterPeersByQuery({\n      ids: unique([\n        ...((getWithInlineBots() && topInlineBotIds) || []),\n        ...(memberIds || []),\n      ]),\n      query: filter,\n      type: 'user',\n    });\n\n    setFilteredUsers(Object.values(pickTruthy(usersById, filteredIds)));\n  }, [currentUserId, groupChatMembers, topInlineBotIds, getUsernameTag, getWithInlineBots]);\n\n  const insertMention = useLastCallback((user: ApiUser, forceFocus = false) => {\n    if (!user.usernames && !getUserFirstOrLastName(user)) {\n      return;\n    }\n\n    const mainUsername = getMainUsername(user);\n    const userFirstOrLastName = getUserFirstOrLastName(user) || '';\n    const htmlToInsert = mainUsername\n      ? `@${mainUsername}`\n      : `<a\n          class=\"text-entity-link\"\n          data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n          data-user-id=\"${user.id}\"\n          contenteditable=\"false\"\n          dir=\"auto\"\n        >${userFirstOrLastName}</a>`;\n\n    const inputEl = inputRef.current!;\n    const htmlBeforeSelection = getHtmlBeforeSelection(inputEl);\n    const fixedHtmlBeforeSelection = cleanWebkitNewLines(htmlBeforeSelection);\n    const atIndex = fixedHtmlBeforeSelection.lastIndexOf('@');\n    const shiftCaretPosition = (mainUsername ? mainUsername.length + 1 : userFirstOrLastName.length)\n      - (fixedHtmlBeforeSelection.length - atIndex);\n\n    if (atIndex !== -1) {\n      const newHtml = `${fixedHtmlBeforeSelection.substr(0, atIndex)}${htmlToInsert}&nbsp;`;\n      const htmlAfterSelection = cleanWebkitNewLines(inputEl.innerHTML).substring(fixedHtmlBeforeSelection.length);\n      const caretPosition = getCaretPosition(inputEl);\n      setHtml(`${newHtml}${htmlAfterSelection}`);\n\n      requestNextMutation(() => {\n        const newCaretPosition = caretPosition + shiftCaretPosition + 1;\n        focusEditableElement(inputEl, forceFocus);\n        if (newCaretPosition >= 0) {\n          setCaretPosition(inputEl, newCaretPosition);\n        }\n      });\n    }\n\n    setFilteredUsers(undefined);\n  });\n\n  useEffect(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);\n\n  return {\n    isMentionTooltipOpen: Boolean(filteredUsers?.length && !isManuallyClosed),\n    closeMentionTooltip: markManuallyClosed,\n    insertMention,\n    mentionFilteredUsers: filteredUsers,\n  };\n}\n\n// Webkit replaces the line break with the `<div><br /></div>` or `<div></div>` code.\n// It is necessary to clean the html to a single form before processing.\nfunction cleanWebkitNewLines(html: string) {\n  return html.replace(/<div>(<br>|<br\\s?\\/>)?<\\/div>/gi, '<br>');\n}\n","import { useMemo } from '../../../../lib/teact/teact';\n\nimport { mapValues } from '../../../../util/iteratees';\nimport { useChatAnimationType } from './useChatAnimationType';\n\nimport usePreviousDeprecated from '../../../../hooks/usePreviousDeprecated';\n\nexport default function useOrderDiff(orderedIds: (string | number)[] | undefined, key?: string) {\n  const orderById = useMemo(() => {\n    if (!orderedIds) {\n      return undefined;\n    }\n\n    return orderedIds.reduce((acc, id, i) => {\n      acc[id] = i;\n      return acc;\n    }, {} as Record<string, number>);\n  }, [orderedIds]);\n\n  const prevOrderById = usePreviousDeprecated(orderById);\n  const prevChatId = usePreviousDeprecated(key);\n\n  const orderDiffById = useMemo(() => {\n    if (!orderById || !prevOrderById || key !== prevChatId) {\n      return {};\n    }\n\n    return mapValues(orderById, (order, id) => {\n      return prevOrderById[id] !== undefined ? order - prevOrderById[id] : -Infinity;\n    });\n  }, [key, orderById, prevChatId, prevOrderById]);\n\n  const getAnimationType = useChatAnimationType(orderDiffById);\n\n  return {\n    orderDiffById,\n    getAnimationType,\n  };\n}\n","import { type RefObject } from 'react';\nimport { useEffect } from '../../../../lib/teact/teact';\n\nimport { requestMutation } from '../../../../lib/fasterdom/fasterdom';\nimport { REM } from '../../../common/helpers/mediaDimensions';\n\nimport useLastCallback from '../../../../hooks/useLastCallback';\n\nconst OFFSET_X = REM;\n\nexport default function useOverlayPosition({\n  anchorRef,\n  overlayRef,\n  isMirrored,\n  isForMessageEffect,\n  isDisabled,\n  id,\n} : {\n  anchorRef: RefObject<HTMLDivElement>;\n  overlayRef: RefObject<HTMLDivElement>;\n  isMirrored?: boolean;\n  isForMessageEffect?: boolean;\n  isDisabled?: boolean;\n  id?: string;\n}) {\n  const updatePosition = useLastCallback(() => {\n    const element = overlayRef.current;\n    const anchor = anchorRef.current;\n    if (!element || !anchor) {\n      return;\n    }\n\n    const anchorRect = anchor.getBoundingClientRect();\n    const elementRect = element.getBoundingClientRect();\n    const windowWidth = window.innerWidth;\n\n    requestMutation(() => {\n      const anchorCenterY = anchorRect.top + anchorRect.height / 2;\n      const anchorBottomY = anchorRect.bottom;\n      const y = isForMessageEffect ? anchorBottomY : anchorCenterY;\n      element.style.top = `${y - elementRect.height / 2}px`;\n\n      if (isMirrored) {\n        element.style.left = `${anchorRect.left - OFFSET_X}px`;\n      } else {\n        element.style.right = `${windowWidth - anchorRect.right - OFFSET_X}px`;\n      }\n    });\n  });\n\n  useEffect(() => {\n    if (isDisabled) return;\n    updatePosition();\n  }, [isDisabled, id]);\n\n  useEffect(() => {\n    if (isDisabled) return undefined;\n\n    const messagesContainer = anchorRef.current!.closest<HTMLDivElement>('.MessageList')!;\n    if (!messagesContainer) return undefined;\n\n    messagesContainer.addEventListener('scroll', updatePosition, { passive: true });\n\n    return () => {\n      messagesContainer.removeEventListener('scroll', updatePosition);\n    };\n  }, [isDisabled, anchorRef]);\n\n  return updatePosition;\n}\n","const MAX_NESTING_PARENTS = 5;\n\nexport function isSelectionInsideInput(selectionRange: Range, inputId: string) {\n  const { commonAncestorContainer } = selectionRange;\n  let parentNode: HTMLElement | null = commonAncestorContainer as HTMLElement;\n  let iterations = 1;\n  while (parentNode && parentNode.id !== inputId && iterations < MAX_NESTING_PARENTS) {\n    parentNode = parentNode.parentElement;\n    iterations++;\n  }\n\n  return Boolean(parentNode && parentNode.id === inputId);\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport useForceUpdate from './useForceUpdate';\nimport useLastCallback from './useLastCallback';\nimport useSyncEffect from './useSyncEffect';\n\nexport default function useForumPanelRender(isForumPanelOpen = false) {\n  const shouldRenderForumPanelRef = useRef(isForumPanelOpen);\n  const isAnimationStartedRef = useRef(false);\n  const forceUpdate = useForceUpdate();\n\n  useSyncEffect(() => {\n    if (isForumPanelOpen) {\n      shouldRenderForumPanelRef.current = true;\n    }\n  }, [isForumPanelOpen]);\n\n  const handleForumPanelAnimationEnd = useLastCallback(() => {\n    shouldRenderForumPanelRef.current = false;\n    isAnimationStartedRef.current = false;\n    forceUpdate();\n  });\n\n  const handleForumPanelAnimationStart = useLastCallback(() => {\n    isAnimationStartedRef.current = true;\n    forceUpdate();\n  });\n\n  return {\n    shouldRenderForumPanel: shouldRenderForumPanelRef.current,\n    isAnimationStarted: isAnimationStartedRef.current,\n    handleForumPanelAnimationEnd,\n    handleForumPanelAnimationStart,\n  };\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"LaOdPURl\",\"backgroundWrapper\":\"zDnMa37m\",\"background\":\"EdXfeKWY\",\"stickerWrapper\":\"o_DYZEMV\"};","import React, { memo, useRef } from '../../../lib/teact/teact';\n\nimport type { ApiStarGiftUnique } from '../../../api/types';\n\nimport { getGiftAttributes } from '../../common/helpers/gifts';\n\nimport { type ObserveFn } from '../../../hooks/useIntersectionObserver';\n\nimport RadialPatternBackground from '../../common/profile/RadialPatternBackground';\nimport StickerView from '../../common/StickerView';\n\nimport styles from './WebPageUniqueGift.module.scss';\n\ntype OwnProps = {\n  gift: ApiStarGiftUnique;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  onClick?: NoneToVoidFunction;\n};\n\nconst STAR_GIFT_STICKER_SIZE = 120;\n\nconst WebPageUniqueGift = ({\n  gift,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  onClick,\n}: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  const stickerRef = useRef<HTMLDivElement>(null);\n  const {\n    backdrop, model, pattern,\n  } = getGiftAttributes(gift)!;\n\n  const backgroundColors = [backdrop!.centerColor, backdrop!.edgeColor];\n\n  return (\n    <div\n      className={styles.root}\n      onClick={onClick}\n    >\n      <div className={styles.backgroundWrapper}>\n        <RadialPatternBackground\n          className={styles.background}\n          backgroundColors={backgroundColors}\n          patternColor={backdrop!.patternColor}\n          patternIcon={pattern!.sticker}\n        />\n      </div>\n      <div ref={stickerRef} className={styles.stickerWrapper}>\n        <StickerView\n          containerRef={stickerRef}\n          sticker={model!.sticker}\n          size={STAR_GIFT_STICKER_SIZE}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default memo(WebPageUniqueGift);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useMemo, useRef } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { ApiMessage, ApiTypeStory } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport { AudioOrigin, type ThemeKey } from '../../../types';\n\nimport { getMessageWebPage } from '../../../global/helpers';\nimport { selectCanPlayAnimatedEmojis } from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport { tryParseDeepLink } from '../../../util/deepLinkParser';\nimport trimText from '../../../util/trimText';\nimport renderText from '../../common/helpers/renderText';\nimport { calculateMediaDimensions } from './helpers/mediaDimensions';\nimport { getWebpageButtonLangKey } from './helpers/webpageType';\n\nimport useDynamicColorListener from '../../../hooks/stickers/useDynamicColorListener';\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useEnsureStory from '../../../hooks/useEnsureStory';\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Audio from '../../common/Audio';\nimport Document from '../../common/Document';\nimport EmojiIconBackground from '../../common/embedded/EmojiIconBackground';\nimport PeerColorWrapper from '../../common/PeerColorWrapper';\nimport SafeLink from '../../common/SafeLink';\nimport StickerView from '../../common/StickerView';\nimport Button from '../../ui/Button';\nimport BaseStory from './BaseStory';\nimport Photo from './Photo';\nimport Video from './Video';\nimport WebPageUniqueGift from './WebPageUniqueGift';\n\nimport './WebPage.scss';\n\nconst MAX_TEXT_LENGTH = 170; // symbols\nconst WEBPAGE_STORY_TYPE = 'telegram_story';\nconst WEBPAGE_GIFT_TYPE = 'telegram_nft';\nconst STICKER_SIZE = 80;\nconst EMOJI_SIZE = 38;\n\ntype OwnProps = {\n  message: ApiMessage;\n  noAvatars?: boolean;\n  canAutoLoad?: boolean;\n  canAutoPlay?: boolean;\n  inPreview?: boolean;\n  asForwarded?: boolean;\n  isDownloading?: boolean;\n  isProtected?: boolean;\n  isConnected?: boolean;\n  backgroundEmojiId?: string;\n  theme: ThemeKey;\n  story?: ApiTypeStory;\n  shouldWarnAboutSvg?: boolean;\n  autoLoadFileMaxSizeMb?: number;\n  lastPlaybackTimestamp?: number;\n  isEditing?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  onAudioPlay?: NoneToVoidFunction;\n  onMediaClick?: NoneToVoidFunction;\n  onDocumentClick?: NoneToVoidFunction;\n  onCancelMediaTransfer?: NoneToVoidFunction;\n  onContainerClick?: ((e: React.MouseEvent) => void);\n};\ntype StateProps = {\n  canPlayAnimatedEmojis: boolean;\n};\n\nconst WebPage: FC<OwnProps & StateProps> = ({\n  message,\n  noAvatars,\n  canAutoLoad,\n  canAutoPlay,\n  inPreview,\n  asForwarded,\n  isDownloading = false,\n  isProtected,\n  isConnected,\n  story,\n  theme,\n  backgroundEmojiId,\n  shouldWarnAboutSvg,\n  autoLoadFileMaxSizeMb,\n  lastPlaybackTimestamp,\n  isEditing,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  onMediaClick,\n  onDocumentClick,\n  onContainerClick,\n  onAudioPlay,\n  onCancelMediaTransfer,\n}) => {\n  const { openUrl, openTelegramLink } = getActions();\n  const webPage = getMessageWebPage(message);\n  const { isMobile } = useAppLayout();\n  // eslint-disable-next-line no-null/no-null\n  const stickersRef = useRef<HTMLDivElement>(null);\n\n  const oldLang = useOldLang();\n  const lang = useLang();\n\n  const handleMediaClick = useLastCallback(() => {\n    onMediaClick!();\n  });\n\n  const handleContainerClick = useLastCallback((e: React.MouseEvent) => {\n    onContainerClick?.(e);\n  });\n\n  const handleOpenTelegramLink = useLastCallback(() => {\n    if (!webPage) return;\n\n    openTelegramLink({\n      url: webPage.url,\n    });\n  });\n\n  const { story: storyData, stickers } = webPage || {};\n\n  useEnsureStory(storyData?.peerId, storyData?.id, story);\n\n  const hasCustomColor = stickers?.isWithTextColor || stickers?.documents?.[0]?.shouldUseTextColor;\n  const customColor = useDynamicColorListener(stickersRef, undefined, !hasCustomColor);\n\n  const linkTimestamp = useMemo(() => {\n    const parsedLink = webPage?.url && tryParseDeepLink(webPage?.url);\n    if (!parsedLink || !('timestamp' in parsedLink)) return undefined;\n    return parsedLink.timestamp;\n  }, [webPage?.url]);\n\n  if (!webPage) {\n    return undefined;\n  }\n\n  const {\n    siteName,\n    url,\n    displayUrl,\n    title,\n    description,\n    photo,\n    video,\n    audio,\n    type,\n    document,\n    mediaSize,\n  } = webPage;\n  const isStory = type === WEBPAGE_STORY_TYPE;\n  const isGift = type === WEBPAGE_GIFT_TYPE;\n  const isExpiredStory = story && 'isDeleted' in story;\n\n  const resultType = stickers?.isEmoji ? 'telegram_emojiset' : type;\n  const quickButtonLangKey = !inPreview && !isExpiredStory ? getWebpageButtonLangKey(resultType) : undefined;\n  const quickButtonTitle = quickButtonLangKey && lang(quickButtonLangKey);\n\n  const truncatedDescription = trimText(description, MAX_TEXT_LENGTH);\n  const isArticle = Boolean(truncatedDescription || title || siteName);\n  let isSquarePhoto = Boolean(stickers);\n  if (isArticle && webPage?.photo && !webPage.video && !webPage.document) {\n    const { width, height } = calculateMediaDimensions({\n      media: webPage.photo,\n      isOwn: message.isOutgoing,\n      isInWebPage: true,\n      asForwarded,\n      noAvatars,\n      isMobile,\n    });\n    isSquarePhoto = (width === height || mediaSize === 'small') && mediaSize !== 'large';\n  }\n  const isMediaInteractive = (photo || video) && onMediaClick && !isSquarePhoto;\n\n  const className = buildClassName(\n    'WebPage',\n    inPreview && 'in-preview',\n    !isEditing && inPreview && 'interactive',\n    isSquarePhoto && 'with-square-photo',\n    !photo && !video && !inPreview && 'without-media',\n    video && 'with-video',\n    !isArticle && 'no-article',\n    document && 'with-document',\n    quickButtonTitle && 'with-quick-button',\n    isGift && 'with-gift',\n  );\n\n  function renderQuickButton(caption: string) {\n    return (\n      <Button\n        className=\"WebPage--quick-button\"\n        size=\"tiny\"\n        color=\"translucent\"\n        isRectangular\n        noForcedUpperCase\n        onClick={handleOpenTelegramLink}\n      >\n        {caption}\n      </Button>\n    );\n  }\n\n  return (\n    <PeerColorWrapper\n      className={className}\n      data-initial={(siteName || displayUrl)[0]}\n      dir={oldLang.isRtl ? 'rtl' : 'auto'}\n      onClick={handleContainerClick}\n    >\n      <div className={buildClassName(\n        'WebPage--content',\n        isStory && 'is-story',\n        isGift && 'is-gift',\n      )}\n      >\n        {backgroundEmojiId && (\n          <EmojiIconBackground\n            emojiDocumentId={backgroundEmojiId}\n            className=\"WebPage--background-icons\"\n          />\n        )}\n        {isStory && (\n          <BaseStory story={story} isProtected={isProtected} isConnected={isConnected} isPreview />\n        )}\n        {isGift && !inPreview && (\n          <WebPageUniqueGift\n            gift={webPage.gift!}\n            observeIntersectionForLoading={observeIntersectionForLoading}\n            observeIntersectionForPlaying={observeIntersectionForPlaying}\n            onClick={handleOpenTelegramLink}\n          />\n        )}\n        {isArticle && (\n          <div\n            className={buildClassName('WebPage-text', !inPreview && 'WebPage-text_interactive')}\n            onClick={!inPreview ? () => openUrl({ url, shouldSkipModal: true }) : undefined}\n          >\n            <SafeLink className=\"site-name\" url={url} text={siteName || displayUrl} />\n            {(!inPreview || isGift) && title && (\n              <p className=\"site-title\">{renderText(title)}</p>\n            )}\n            {truncatedDescription && !isGift && (\n              <p className=\"site-description\">{renderText(truncatedDescription, ['emoji', 'br'])}</p>\n            )}\n          </div>\n        )}\n        {photo && !isGift && !video && !document && (\n          <Photo\n            photo={photo}\n            isOwn={message.isOutgoing}\n            isInWebPage\n            observeIntersection={observeIntersectionForLoading}\n            noAvatars={noAvatars}\n            canAutoLoad={canAutoLoad}\n            size={isSquarePhoto ? 'pictogram' : 'inline'}\n            asForwarded={asForwarded}\n            nonInteractive={!isMediaInteractive}\n            isDownloading={isDownloading}\n            isProtected={isProtected}\n            theme={theme}\n            onClick={isMediaInteractive ? handleMediaClick : undefined}\n            onCancelUpload={onCancelMediaTransfer}\n          />\n        )}\n        {!inPreview && video && (\n          <Video\n            video={video}\n            isOwn={message.isOutgoing}\n            isInWebPage\n            observeIntersectionForLoading={observeIntersectionForLoading!}\n            noAvatars={noAvatars}\n            canAutoLoad={canAutoLoad}\n            canAutoPlay={canAutoPlay}\n            asForwarded={asForwarded}\n            isDownloading={isDownloading}\n            isProtected={isProtected}\n            lastPlaybackTimestamp={lastPlaybackTimestamp || linkTimestamp}\n            onClick={isMediaInteractive ? handleMediaClick : undefined}\n            onCancelUpload={onCancelMediaTransfer}\n          />\n        )}\n        {!inPreview && audio && (\n          <Audio\n            theme={theme}\n            message={message}\n            origin={AudioOrigin.Inline}\n            noAvatars={noAvatars}\n            isDownloading={isDownloading}\n            onPlay={onAudioPlay}\n            onCancelUpload={onCancelMediaTransfer}\n          />\n        )}\n        {!inPreview && document && (\n          <Document\n            document={document}\n            message={message}\n            observeIntersection={observeIntersectionForLoading}\n            autoLoadFileMaxSizeMb={autoLoadFileMaxSizeMb}\n            onMediaClick={onDocumentClick}\n            onCancelUpload={onCancelMediaTransfer}\n            isDownloading={isDownloading}\n            shouldWarnAboutSvg={shouldWarnAboutSvg}\n          />\n        )}\n        {!inPreview && stickers && (\n          <div\n            ref={stickersRef}\n            className={buildClassName(\n              'media-inner', 'square-image', stickers.isEmoji && 'WebPage--emoji-grid', 'WebPage--stickers',\n            )}\n          >\n            {stickers.documents.map((sticker) => (\n              <div key={sticker.id} className=\"WebPage--sticker\">\n                <StickerView\n                  containerRef={stickersRef}\n                  sticker={sticker}\n                  shouldLoop\n                  size={stickers.isEmoji ? EMOJI_SIZE : STICKER_SIZE}\n                  customColor={customColor}\n                  observeIntersectionForPlaying={observeIntersectionForPlaying}\n                  observeIntersectionForLoading={observeIntersectionForLoading}\n                />\n              </div>\n            ))}\n          </div>\n        )}\n        {inPreview && displayUrl && !isArticle && (\n          <div className=\"WebPage-text\">\n            <p className=\"site-name\">{displayUrl}</p>\n            <p className=\"site-description\">{oldLang('Chat.Empty.LinkPreview')}</p>\n          </div>\n        )}\n      </div>\n      {quickButtonTitle && renderQuickButton(quickButtonTitle)}\n    </PeerColorWrapper>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global): StateProps => {\n    return {\n      canPlayAnimatedEmojis: selectCanPlayAnimatedEmojis(global),\n    };\n  },\n)(WebPage));\n","import type { RegularLangKey } from '../../../../types/language';\n\n// https://github.com/telegramdesktop/tdesktop/blob/3da787791f6d227f69b32bf4003bc6071d05e2ac/Telegram/SourceFiles/history/view/history_view_view_button.cpp#L51\nexport function getWebpageButtonLangKey(type?: string): RegularLangKey | undefined {\n  switch (type) {\n    case 'telegram_channel_request':\n    case 'telegram_megagroup_request':\n    case 'telegram_chat_request':\n      return 'ViewButtonRequestJoin';\n    case 'telegram_message':\n      return 'ViewButtonMessage';\n    case 'telegram_bot':\n      return 'ViewButtonBot';\n    case 'telegram_voicechat':\n      return 'ViewButtonVoiceChat';\n    case 'telegram_livestream':\n      return 'ViewButtonVoiceChatChannel';\n    case 'telegram_megagroup':\n    case 'telegram_chat':\n      return 'ViewButtonGroup';\n    case 'telegram_channel':\n      return 'ViewButtonChannel';\n    case 'telegram_user':\n      return 'ViewButtonUser';\n    case 'telegram_botapp':\n      return 'ViewButtonBotApp';\n    case 'telegram_chatlist':\n      return 'ViewChatList';\n    case 'telegram_story':\n      return 'ViewButtonStory';\n    case 'telegram_channel_boost':\n    case 'telegram_group_boost':\n      return 'ViewButtonBoost';\n    case 'telegram_stickerset':\n      return 'ViewButtonStickerset';\n    case 'telegram_emojiset':\n      return 'ViewButtonEmojiset';\n    case 'telegram_nft':\n      return 'ViewButtonGiftUnique';\n    default:\n      return undefined;\n  }\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"AN8wkEiR\",\"ghost\":\"ANWk2pWP\",\"scale\":\"kMHxyoSt\",\"elementContainer\":\"UDCMfXxs\"};","import React, { memo } from '../../../lib/teact/teact';\nimport { getGlobal } from '../../../global';\n\nimport { SNAP_EFFECT_CONTAINER_ID, SNAP_EFFECT_ID, SVG_NAMESPACE } from '../../../config';\nimport { selectCanAnimateSnapEffect } from '../../../global/selectors';\nimport jsxToHtml from '../../../util/element/jsxToHtml';\nimport generateUniqueId from '../../../util/generateUniqueId';\n\nimport styles from './SnapEffectContainer.module.scss';\n\nconst VISIBLITY_MARGIN = 50;\nconst DURATION = 1000;\n\nconst SnapEffectContainer = () => {\n  return (\n    <div className={styles.root} id={SNAP_EFFECT_CONTAINER_ID} />\n  );\n};\n\nexport default memo(SnapEffectContainer);\n\nexport function animateSnap(element: HTMLElement) {\n  const global = getGlobal();\n  const canPlayEffect = selectCanAnimateSnapEffect(global);\n  if (!canPlayEffect) return false;\n  // Get element current fixed position on screen\n  const rect = element.getBoundingClientRect();\n  const x = rect.left + window.scrollX;\n  const y = rect.top + window.scrollY;\n  const width = rect.width;\n  const height = rect.height;\n\n  // Check for visibility\n  if (x + width + VISIBLITY_MARGIN < 0 || x - VISIBLITY_MARGIN > window.innerWidth\n    || y + height + VISIBLITY_MARGIN < 0 || y - VISIBLITY_MARGIN > window.innerHeight) {\n    return false;\n  }\n\n  const seed = Math.floor(Date.now() / 1000);\n  const filterId = `${SNAP_EFFECT_ID}-${generateUniqueId()}`;\n\n  const component = (\n    <svg\n      className={styles.ghost}\n      width={width}\n      height={height}\n      style={`left: ${x}px; top: ${y}px;`}\n      viewBox={`0 0 ${width} ${height}`}\n    >\n      <defs>\n        {createFilter(filterId, Math.min(width, height), seed)}\n      </defs>\n      <g filter={`url(#${filterId})`}>\n        <foreignObject className={styles.elementContainer} width={width} height={height} />\n      </g>\n    </svg>\n  );\n\n  const svg = jsxToHtml(component)[0] as HTMLElement;\n  const foreignObject = svg.querySelector('foreignObject')!;\n\n  const computedStyle = window.getComputedStyle(element);\n  const clone = element.cloneNode(true) as HTMLElement;\n  Array.from(computedStyle).forEach((key) => (\n    clone.style.setProperty(key, computedStyle.getPropertyValue(key), 'important')\n  ));\n\n  foreignObject.appendChild(clone);\n\n  const snapContainer = document.getElementById(SNAP_EFFECT_CONTAINER_ID)!;\n  snapContainer.appendChild(svg);\n\n  svg.addEventListener('animationend', () => {\n    snapContainer.removeChild(svg);\n  }, {\n    once: true,\n  });\n\n  return true;\n}\n\nfunction createFilter(id: string, smallestSide: number, baseSeed: number = 42) {\n  return (\n    <filter\n      xmlns={SVG_NAMESPACE}\n      id={id}\n      x=\"-150%\"\n      y=\"-150%\"\n      width=\"400%\"\n      height=\"400%\"\n      color-interpolation-filters=\"sRGB\"\n    >\n      <feTurbulence type=\"fractalNoise\" baseFrequency=\"0.5\" numOctaves=\"1\" result=\"dustNoise\" seed={baseSeed} />\n      <feComponentTransfer in=\"dustNoise\" result=\"dustNoiseMask\">\n        <feFuncA type=\"linear\" slope=\"5\" intercept=\"0\">\n          <animate attributeName=\"slope\" values=\"5; 2; 1; 0\" dur={`${DURATION}ms`} fill=\"freeze\" />\n        </feFuncA>\n      </feComponentTransfer>\n      <feComposite in=\"SourceGraphic\" in2=\"dustNoiseMask\" operator=\"in\" result=\"dustySource\" />\n      <feTurbulence\n        type=\"fractalNoise\"\n        baseFrequency=\"0.015\"\n        numOctaves=\"1\"\n        result=\"displacementNoise1\"\n        seed={baseSeed + 1}\n      />\n      <feTurbulence\n        type=\"fractalNoise\"\n        baseFrequency=\"1\"\n        numOctaves=\"2\"\n        result=\"displacementNoise2\"\n        seed={baseSeed + 2}\n      />\n      <feMerge result=\"combinedNoise\">\n        <feMergeNode in=\"displacementNoise1\" />\n        <feMergeNode in=\"displacementNoise2\" />\n      </feMerge>\n      <feDisplacementMap in=\"dustySource\" in2=\"combinedNoise\" scale=\"0\" xChannelSelector=\"R\" yChannelSelector=\"G\">\n        <animate attributeName=\"scale\" values={`0; ${smallestSide * 3}`} dur={`${DURATION}ms`} fill=\"freeze\" />\n      </feDisplacementMap>\n    </filter>\n  );\n}\n","import type { ApiPaidMedia } from '../../../../api/types';\n\nexport default function getSingularPaidMedia(media?: ApiPaidMedia) {\n  if (!media || media.extendedMedia.length !== 1) {\n    return {\n      photo: undefined,\n      video: undefined,\n    };\n  }\n\n  const singularMedia = media.extendedMedia[0];\n  const isPreview = 'mediaType' in singularMedia;\n  const photo = isPreview ? (!singularMedia.duration ? singularMedia : undefined) : singularMedia.photo;\n  const video = isPreview ? (singularMedia.duration ? singularMedia : undefined) : singularMedia.video;\n\n  return { photo, video };\n}\n","/* eslint-disable no-bitwise */\n// Based on\n// https://github.com/telegramdesktop/tdesktop/blob/dev/Telegram/SourceFiles/ui/grouped_layout.cpp\n// https://github.com/overtake/TelegramSwift/blob/master/Telegram-Mac/GroupedLayout.swift#L83\n\nimport type { ApiDimensions, ApiMessage } from '../../../../api/types';\nimport type { IAlbum } from '../../../../types';\n\nimport { getMessageContent } from '../../../../global/helpers';\nimport { clamp } from '../../../../util/math';\nimport { getAvailableWidth } from '../../../common/helpers/mediaDimensions';\nimport { calculateMediaDimensions } from './mediaDimensions';\n\nexport const AlbumRectPart = {\n  None: 0,\n  Top: 1,\n  Right: 2,\n  Bottom: 4,\n  Left: 8,\n};\n\ntype IAttempt = {\n  lineCounts: number[];\n  heights: number[];\n};\nexport type IMediaDimensions = {\n  width: number;\n  height: number;\n  x: number;\n  y: number;\n};\ntype IMediaLayout = {\n  dimensions: IMediaDimensions;\n  sides: number;\n};\ntype ILayoutParams = {\n  ratios: number[];\n  proportions: string;\n  averageRatio: number;\n  maxWidth: number;\n  minWidth: number;\n  maxHeight: number;\n  spacing: number;\n};\nexport type IAlbumLayout = {\n  layout: IMediaLayout[];\n  containerStyle: ApiDimensions;\n};\n\nfunction getRatios(messages: ApiMessage[], isSingleMessage?: boolean, isMobile?: boolean) {\n  const isOutgoing = messages[0].isOutgoing;\n  const allMedia = (isSingleMessage\n    ? messages[0].content.paidMedia!.extendedMedia.map((media) => (\n      'mediaType' in media ? media : (media.photo || media.video)\n    ))\n    : messages.map((message) => (\n      getMessageContent(message).photo || getMessageContent(message).video\n    ))\n  ).filter(Boolean);\n  return allMedia.map(\n    (media) => {\n      const dimensions = calculateMediaDimensions({\n        media,\n        isOwn: isOutgoing,\n        isMobile,\n      }) as ApiDimensions;\n\n      return dimensions.width / dimensions.height;\n    },\n  );\n}\n\nfunction getProportions(ratios: number[]) {\n  return ratios.map((ratio) => (ratio > 1.2 ? 'w' : (ratio < 0.8 ? 'n' : 'q'))).join('');\n}\n\nfunction getAverageRatio(ratios: number[]) {\n  return ratios.reduce((result, ratio) => ratio + result, 1) / ratios.length;\n}\n\nfunction accumulate(list: number[], initValue: number) {\n  return list.reduce((accumulator, item) => accumulator + item, initValue);\n}\n\nfunction cropRatios(ratios: number[], averageRatio: number) {\n  return ratios.map((ratio) => {\n    return (averageRatio > 1.1 ? clamp(ratio, 1, 2.75) : clamp(ratio, 0.6667, 1));\n  });\n}\n\nfunction calculateContainerSize(layout: IMediaLayout[]) {\n  const styles: ApiDimensions = { width: 0, height: 0 };\n  layout.forEach(({\n    dimensions,\n    sides,\n  }) => {\n    if (sides & AlbumRectPart.Right) {\n      styles.width = dimensions.width + dimensions.x;\n    }\n    if (sides & AlbumRectPart.Bottom) {\n      styles.height = dimensions.height + dimensions.y;\n    }\n  });\n\n  return styles;\n}\n\nexport function calculateAlbumLayout(\n  isOwn: boolean,\n  noAvatars: boolean,\n  album: IAlbum,\n  isMobile?: boolean,\n): IAlbumLayout {\n  const spacing = 2;\n  const ratios = getRatios(album.messages, album.isPaidMedia, isMobile);\n  const proportions = getProportions(ratios);\n  const averageRatio = getAverageRatio(ratios);\n  const albumCount = ratios.length;\n  const forceCalc = ratios.some((ratio) => ratio > 2);\n  const maxWidth = getAvailableWidth(isOwn, false, noAvatars, isMobile);\n  const maxHeight = maxWidth;\n\n  let layout;\n\n  const params = {\n    ratios,\n    proportions,\n    averageRatio,\n    maxWidth,\n    minWidth: 100,\n    maxHeight,\n    spacing,\n  };\n\n  if (albumCount >= 5 || forceCalc) {\n    layout = layoutWithComplexLayouter(params);\n  } else if (albumCount === 2) {\n    layout = layoutTwo(params);\n  } else if (albumCount === 3) {\n    layout = layoutThree(params);\n  } else {\n    layout = layoutFour(params);\n  }\n\n  return {\n    layout,\n    containerStyle: calculateContainerSize(layout),\n  };\n}\n\nfunction layoutWithComplexLayouter({\n  ratios: originalRatios,\n  averageRatio,\n  maxWidth,\n  minWidth,\n  spacing,\n  maxHeight = (4 * maxWidth) / 3,\n}: ILayoutParams) {\n  const ratios = cropRatios(originalRatios, averageRatio);\n  const count = originalRatios.length;\n  const result = new Array(count);\n  const attempts: IAttempt[] = [];\n\n  const multiHeight = (offset: number, attemptCount: number) => {\n    const attemptRatios = ratios.slice(offset, offset + attemptCount);\n    const sum = accumulate(attemptRatios, 0);\n\n    return (maxWidth - (attemptCount - 1) * spacing) / sum;\n  };\n\n  const pushAttempt = (lineCounts: number[]) => {\n    const heights: number[] = [];\n    let offset = 0;\n    lineCounts.forEach((currentCount) => {\n      heights.push(multiHeight(offset, currentCount));\n      offset += currentCount;\n    });\n\n    attempts.push({\n      lineCounts,\n      heights,\n    });\n  };\n\n  for (let first = 1; first !== count; ++first) {\n    const second = count - first;\n    if (first <= 3 && second <= 3) {\n      pushAttempt([first, second]);\n    }\n  }\n\n  for (let first = 1; first !== count - 1; ++first) {\n    for (let second = 1; second !== count - first; ++second) {\n      const third = count - first - second;\n      if (first <= 3 && second <= (averageRatio < 0.85 ? 4 : 3) && third <= 3) {\n        pushAttempt([first, second, third]);\n      }\n    }\n  }\n\n  for (let first = 1; first !== count - 1; ++first) {\n    for (let second = 1; second !== count - first; ++second) {\n      for (let third = 1; third !== count - first - second; ++third) {\n        const fourth = count - first - second - third;\n        if (first <= 3 && second <= 3 && third <= 3 && fourth <= 4) {\n          pushAttempt([first, second, third, fourth]);\n        }\n      }\n    }\n  }\n\n  let optimalAttempt: IAttempt | undefined;\n  let optimalDiff = 0;\n  for (let i = 0; i < attempts.length; i++) {\n    const {\n      heights,\n      lineCounts,\n    } = attempts[i];\n    const lineCount = lineCounts.length;\n    const totalHeight = accumulate(heights, 0) + spacing * (lineCount - 1);\n    const minLineHeight = Math.min(...heights);\n    const bad1 = minLineHeight < minWidth ? 1.5 : 1;\n    const bad2 = (() => {\n      for (let line = 1; line !== lineCount; ++line) {\n        if (lineCounts[line - 1] > lineCounts[line]) {\n          return 1.5;\n        }\n      }\n\n      return 1;\n    })();\n    const diff = Math.abs(totalHeight - maxHeight) * bad1 * bad2;\n\n    if (!optimalAttempt || diff < optimalDiff) {\n      optimalAttempt = attempts[i];\n      optimalDiff = diff;\n    }\n  }\n\n  const optimalCounts = optimalAttempt!.lineCounts;\n  const optimalHeights = optimalAttempt!.heights;\n  const rowCount = optimalCounts.length;\n  let index = 0;\n  let y = 0;\n  for (let row = 0; row !== rowCount; ++row) {\n    const colCount = optimalCounts[row];\n    const lineHeight = optimalHeights[row];\n    const height = Math.round(lineHeight);\n    let x = 0;\n\n    for (let col = 0; col !== colCount; ++col) {\n      const sides = AlbumRectPart.None\n        | (row === 0 ? AlbumRectPart.Top : AlbumRectPart.None)\n        | (row === rowCount - 1 ? AlbumRectPart.Bottom : AlbumRectPart.None)\n        | (col === 0 ? AlbumRectPart.Left : AlbumRectPart.None)\n        | (col === colCount - 1 ? AlbumRectPart.Right : AlbumRectPart.None);\n      const ratio = ratios[index];\n      const width = col === colCount - 1 ? maxWidth - x : Math.round(ratio * lineHeight);\n      result[index] = {\n        dimensions: {\n          x,\n          y,\n          width,\n          height,\n        },\n        sides,\n      };\n      x += width + spacing;\n      ++index;\n    }\n    y += height + spacing;\n  }\n\n  return result;\n}\n\nfunction layoutTwo(params: ILayoutParams) {\n  const {\n    ratios,\n    proportions,\n    averageRatio,\n  } = params;\n  return proportions === 'ww' && averageRatio > 1.4 && ratios[1] - ratios[0] < 0.2\n    ? layoutTwoTopBottom(params)\n    : proportions === 'ww' || proportions === 'qq'\n      ? layoutTwoLeftRightEqual(params)\n      : layoutTwoLeftRight(params);\n}\n\nfunction layoutTwoTopBottom(params: ILayoutParams) {\n  const {\n    ratios,\n    maxWidth,\n    spacing,\n    maxHeight,\n  } = params;\n  const height = Math.round(Math.min(maxWidth / ratios[0], Math.min(maxWidth / ratios[1], (maxHeight - spacing) / 2)));\n\n  return [{\n    dimensions: {\n      x: 0,\n      y: 0,\n      width: maxWidth,\n      height,\n    },\n    sides: AlbumRectPart.Left | AlbumRectPart.Top | AlbumRectPart.Right,\n  }, {\n    dimensions: {\n      x: 0,\n      y: height + spacing,\n      width: maxWidth,\n      height,\n    },\n    sides: AlbumRectPart.Left | AlbumRectPart.Bottom | AlbumRectPart.Right,\n  }];\n}\n\nfunction layoutTwoLeftRightEqual(params: ILayoutParams) {\n  const {\n    ratios,\n    maxWidth,\n    spacing,\n    maxHeight,\n  } = params;\n  const width = (maxWidth - spacing) / 2;\n  const height = Math.round(Math.min(width / ratios[0], Math.min(width / ratios[1], maxHeight)));\n  return [{\n    dimensions: {\n      x: 0,\n      y: 0,\n      width,\n      height,\n    },\n    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom,\n  }, {\n    dimensions: {\n      x: width + spacing,\n      y: 0,\n      width,\n      height,\n    },\n    sides: AlbumRectPart.Top | AlbumRectPart.Right | AlbumRectPart.Bottom,\n  }];\n}\n\nfunction layoutTwoLeftRight(params: ILayoutParams) {\n  const {\n    ratios,\n    minWidth,\n    maxWidth,\n    spacing,\n    maxHeight,\n  } = params;\n  const minimalWidth = Math.round(1.5 * minWidth);\n  const secondWidth = Math.min(\n    Math.round(\n      Math.max(\n        0.4 * (maxWidth - spacing),\n        (maxWidth - spacing) / ratios[0] / (1 / ratios[0] + 1 / ratios[1]),\n      ),\n    ),\n    maxWidth - spacing - minimalWidth,\n  );\n  const firstWidth = maxWidth - secondWidth - spacing;\n  const height = Math.min(maxHeight, Math.round(Math.min(firstWidth / ratios[0], secondWidth / ratios[1])));\n\n  return [{\n    dimensions: {\n      x: 0,\n      y: 0,\n      width: firstWidth,\n      height,\n    },\n    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom,\n  }, {\n    dimensions: {\n      x: firstWidth + spacing,\n      y: 0,\n      width: secondWidth,\n      height,\n    },\n    sides: AlbumRectPart.Top | AlbumRectPart.Right | AlbumRectPart.Bottom,\n  }];\n}\n\nfunction layoutThree(params: ILayoutParams) {\n  const { proportions } = params;\n\n  return proportions[0] === 'n'\n    ? layoutThreeLeftAndOther(params)\n    : layoutThreeTopAndOther(params);\n}\n\nfunction layoutThreeLeftAndOther(params: ILayoutParams) {\n  const {\n    maxHeight,\n    spacing,\n    ratios,\n    maxWidth,\n    minWidth,\n  } = params;\n  const firstHeight = maxHeight;\n  const thirdHeight = Math.round(\n    Math.min(\n      (maxHeight - spacing) / 2,\n      (ratios[1] * (maxWidth - spacing)) / (ratios[2] + ratios[1]),\n    ),\n  );\n  const secondHeight = firstHeight - thirdHeight - spacing;\n  const rightWidth = Math.max(\n    minWidth,\n    Math.round(\n      Math.min(\n        (maxWidth - spacing) / 2,\n        Math.min(\n          thirdHeight * ratios[2],\n          secondHeight * ratios[1],\n        ),\n      ),\n    ),\n  );\n  const leftWidth = Math.min(Math.round(firstHeight * ratios[0]), maxWidth - spacing - rightWidth);\n\n  return [{\n    dimensions: {\n      x: 0,\n      y: 0,\n      width: leftWidth,\n      height: firstHeight,\n    },\n    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom,\n  }, {\n    dimensions: {\n      x: leftWidth + spacing,\n      y: 0,\n      width: rightWidth,\n      height: secondHeight,\n    },\n    sides: AlbumRectPart.Top | AlbumRectPart.Right,\n  }, {\n    dimensions: {\n      x: leftWidth + spacing,\n      y: secondHeight + spacing,\n      width: rightWidth,\n      height: thirdHeight,\n    },\n    sides: AlbumRectPart.Bottom | AlbumRectPart.Right,\n  }];\n}\n\nfunction layoutThreeTopAndOther(params: ILayoutParams) {\n  const {\n    maxWidth,\n    ratios,\n    maxHeight,\n    spacing,\n  } = params;\n  const firstWidth = maxWidth;\n  const firstHeight = Math.round(Math.min(firstWidth / ratios[0], 0.66 * (maxHeight - spacing)));\n  const secondWidth = (maxWidth - spacing) / 2;\n  const secondHeight = Math.min(\n    maxHeight - firstHeight - spacing,\n    Math.round(Math.min(\n      secondWidth / ratios[1],\n      secondWidth / ratios[2],\n    )),\n  );\n  const thirdWidth = firstWidth - secondWidth - spacing;\n\n  return [{\n    dimensions: {\n      x: 0,\n      y: 0,\n      width: firstWidth,\n      height: firstHeight,\n    },\n    sides: AlbumRectPart.Left | AlbumRectPart.Top | AlbumRectPart.Right,\n  }, {\n    dimensions: {\n      x: 0,\n      y: firstHeight + spacing,\n      width: secondWidth,\n      height: secondHeight,\n    },\n    sides: AlbumRectPart.Bottom | AlbumRectPart.Left,\n  }, {\n    dimensions: {\n      x: secondWidth + spacing,\n      y: firstHeight + spacing,\n      width: thirdWidth,\n      height: secondHeight,\n    },\n    sides: AlbumRectPart.Bottom | AlbumRectPart.Right,\n  }];\n}\n\nfunction layoutFour(params: ILayoutParams) {\n  const { proportions } = params;\n\n  return proportions[0] === 'w'\n    ? layoutFourTopAndOther(params)\n    : layoutFourLeftAndOther(params);\n}\n\nfunction layoutFourTopAndOther({\n  maxWidth,\n  ratios,\n  spacing,\n  maxHeight,\n  minWidth,\n}: ILayoutParams) {\n  const w = maxWidth;\n  const h0 = Math.round(Math.min(w / ratios[0], 0.66 * (maxHeight - spacing)));\n  const h = Math.round((maxWidth - 2 * spacing) / (ratios[1] + ratios[2] + ratios[3]));\n  const w0 = Math.max(minWidth, Math.round(Math.min(0.4 * (maxWidth - 2 * spacing), h * ratios[1])));\n  const w2 = Math.round(Math.max(Math.max(minWidth, 0.33 * (maxWidth - 2 * spacing)), h * ratios[3]));\n  const w1 = w - w0 - w2 - 2 * spacing;\n  const h1 = Math.min(maxHeight - h0 - spacing, h);\n\n  return [{\n    dimensions: {\n      x: 0,\n      y: 0,\n      width: w,\n      height: h0,\n    },\n    sides: AlbumRectPart.Left | AlbumRectPart.Top | AlbumRectPart.Right,\n  }, {\n    dimensions: {\n      x: 0,\n      y: h0 + spacing,\n      width: w0,\n      height: h1,\n    },\n    sides: AlbumRectPart.Bottom | AlbumRectPart.Left,\n  }, {\n    dimensions: {\n      x: w0 + spacing,\n      y: h0 + spacing,\n      width: w1,\n      height: h1,\n    },\n    sides: AlbumRectPart.Bottom,\n  }, {\n    dimensions: {\n      x: w0 + spacing + w1 + spacing,\n      y: h0 + spacing,\n      width: w2,\n      height: h1,\n    },\n    sides: AlbumRectPart.Right | AlbumRectPart.Bottom,\n  }];\n}\n\nfunction layoutFourLeftAndOther({\n  maxHeight,\n  ratios,\n  maxWidth,\n  spacing,\n  minWidth,\n}: ILayoutParams) {\n  const h = maxHeight;\n  const w0 = Math.round(Math.min(h * ratios[0], 0.6 * (maxWidth - spacing)));\n  const w = Math.round((maxHeight - 2 * spacing) / (1 / ratios[1] + 1 / ratios[2] + 1 / ratios[3]));\n  const h0 = Math.round(w / ratios[1]);\n  const h1 = Math.round(w / ratios[2]);\n  const h2 = h - h0 - h1 - 2 * spacing;\n  const w1 = Math.max(minWidth, Math.min(maxWidth - w0 - spacing, w));\n\n  return [{\n    dimensions: {\n      x: 0,\n      y: 0,\n      width: w0,\n      height: h,\n    },\n    sides: AlbumRectPart.Top | AlbumRectPart.Left | AlbumRectPart.Bottom,\n  }, {\n    dimensions: {\n      x: w0 + spacing,\n      y: 0,\n      width: w1,\n      height: h0,\n    },\n    sides: AlbumRectPart.Top | AlbumRectPart.Right,\n  }, {\n    dimensions: {\n      x: w0 + spacing,\n      y: h0 + spacing,\n      width: w1,\n      height: h1,\n    },\n    sides: AlbumRectPart.Right,\n  }, {\n    dimensions: {\n      x: w0 + spacing,\n      y: h0 + h1 + 2 * spacing,\n      width: w1,\n      height: h2,\n    },\n    sides: AlbumRectPart.Bottom | AlbumRectPart.Right,\n  }];\n}\n","import type { FastTextApi } from '../lib/fasttextweb/fasttext.worker';\nimport type { Connector } from './PostMessageConnector';\n\nimport { IS_TRANSLATION_SUPPORTED } from './browser/windowEnvironment';\n\nimport Deferred from './Deferred';\nimport { createConnector } from './PostMessageConnector';\n\nconst WORKER_INIT_DELAY = 4000;\n\nconst DEFAULT_THRESHOLD = 0.2;\nconst DEFAULT_LABELS_COUNT = 5;\n\nlet worker: Connector<FastTextApi> | undefined;\nconst initializationDeferred = new Deferred();\n\nif (IS_TRANSLATION_SUPPORTED) {\n  setTimeout(initWorker, WORKER_INIT_DELAY);\n}\n\nfunction initWorker() {\n  if (!worker) {\n    worker = createConnector<FastTextApi>(\n      new Worker(new URL('../lib/fasttextweb/fasttext.worker.ts', import.meta.url)),\n    );\n    initializationDeferred.resolve();\n  }\n}\n\nexport async function detectLanguage(text: string, threshold = DEFAULT_THRESHOLD) {\n  if (!worker) await initializationDeferred.promise;\n  const result = await worker!.request({ name: 'detectLanguage', args: [text, threshold] });\n  return result;\n}\n\nexport async function detectLanguageProbability(\n  text: string, labelsCount = DEFAULT_LABELS_COUNT, threshold = DEFAULT_THRESHOLD,\n) {\n  if (!worker) await initializationDeferred.promise;\n  const result = await worker!.request({ name: 'detectLanguageProbability', args: [text, labelsCount, threshold] });\n  return result;\n}\n","import { useEffect } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiMessage } from '../../../../api/types';\nimport type { Signal } from '../../../../util/signals';\n\nimport LimitedMap from '../../../../util/primitives/LimitedMap';\nimport { throttle } from '../../../../util/schedulers';\n\n// https://github.com/DrKLO/Telegram/blob/dfd74f809e97d1ecad9672fc7388cb0223a95dfc/TMessagesProj/src/main/java/org/telegram/messenger/TranslateController.java#L35\nconst MIN_MESSAGES_CHECKED = 8;\nconst MIN_TRANSLATABLE_RATIO = 0.3;\nconst MIN_DETECTABLE_RATIO = 0.6;\n\nconst THROTTLE_DELAY = 1000;\nconst MESSAGES_LIMIT = 150;\n\ntype MessageMetadata = {\n  id: number;\n  isTranslatable: boolean;\n  detectedLanguage: string | undefined;\n};\n\nconst CHAT_STATS = new Map<string, LimitedMap<number, MessageMetadata>>();\n\nexport default function useDetectChatLanguage(\n  message: ApiMessage, detectedLanguage?: string, isDisabled?: boolean, getIsReady?: Signal<boolean>,\n) {\n  useEffect(() => {\n    if (isDisabled || (getIsReady && !getIsReady())) return;\n\n    const isTranslatable = Boolean(message.content.text?.text.length);\n    processMessageMetadata(message.chatId, message.id, isTranslatable, detectedLanguage);\n  }, [message, detectedLanguage, isDisabled, getIsReady]);\n}\n\nconst throttledMakeChatDecision = throttle(makeChatDecision, THROTTLE_DELAY);\n\nfunction processMessageMetadata(chatId: string, id: number, isTranslatable: boolean, detectedLanguage?: string) {\n  const chatStats = CHAT_STATS.get(chatId) || new LimitedMap<number, MessageMetadata>(MESSAGES_LIMIT);\n\n  const previousMetadata = chatStats.get(id);\n  if (previousMetadata && previousMetadata.detectedLanguage === detectedLanguage\n    && previousMetadata.isTranslatable === isTranslatable\n  ) {\n    return;\n  }\n\n  chatStats.set(id, {\n    id,\n    isTranslatable,\n    detectedLanguage,\n  });\n\n  CHAT_STATS.set(chatId, chatStats);\n\n  throttledMakeChatDecision(chatId);\n}\n\nfunction makeChatDecision(chatId: string) {\n  const { updateChatDetectedLanguage } = getActions();\n  const chatStats = CHAT_STATS.get(chatId);\n  if (!chatStats) {\n    return;\n  }\n\n  const messagesChecked = chatStats.size;\n  if (messagesChecked < MIN_MESSAGES_CHECKED) {\n    return;\n  }\n\n  let translatableCount = 0;\n  let detectableCount = 0;\n  const languageOccurrences = new Map<string, number>();\n\n  for (const metadata of chatStats.values()) {\n    if (metadata.isTranslatable) {\n      translatableCount++;\n    }\n\n    if (metadata.detectedLanguage) {\n      detectableCount++;\n    }\n\n    const language = metadata.detectedLanguage;\n    if (language) {\n      const occurrences = languageOccurrences.get(language) || 0;\n      languageOccurrences.set(language, occurrences + 1);\n    }\n  }\n\n  const translatableRatio = translatableCount / messagesChecked;\n  const detectableRatio = detectableCount / messagesChecked;\n\n  if (translatableRatio < MIN_TRANSLATABLE_RATIO || detectableRatio < MIN_DETECTABLE_RATIO) {\n    return;\n  }\n\n  const mostFrequentLanguage = Array.from(languageOccurrences.entries())\n    .sort(([, a], [, b]) => b - a)[0][0];\n\n  updateChatDetectedLanguage({\n    chatId,\n    detectedLanguage: mostFrequentLanguage,\n  });\n}\n","import type { RefObject } from 'react';\nimport type React from '../../../../lib/teact/teact';\nimport { useEffect, useRef } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { Signal } from '../../../../util/signals';\n\nimport { requestMeasure } from '../../../../lib/fasterdom/fasterdom';\nimport { IS_ANDROID, IS_TOUCH_ENV } from '../../../../util/browser/windowEnvironment';\nimport { captureEvents, SwipeDirection } from '../../../../util/captureEvents';\nimport stopEvent from '../../../../util/stopEvent';\nimport windowSize from '../../../../util/windowSize';\nimport { REM } from '../../../common/helpers/mediaDimensions';\nimport { preventMessageInputBlur } from '../../helpers/preventMessageInputBlur';\n\nimport useFlag from '../../../../hooks/useFlag';\nimport useThrottledCallback from '../../../../hooks/useThrottledCallback';\n\nconst ANDROID_KEYBOARD_HIDE_DELAY_MS = 350;\nconst SWIPE_ANIMATION_DURATION = 150;\nconst QUICK_REACTION_DOUBLE_TAP_DELAY = 200;\nconst QUICK_REACTION_AREA_WIDTH = 3 * REM;\nconst QUICK_REACTION_AREA_HEIGHT = Number(REM);\nconst GROUP_MESSAGE_HOVER_ATTRIBUTE = 'data-is-document-group-hover';\n\nexport default function useOuterHandlers(\n  selectMessage: (e?: React.MouseEvent<HTMLDivElement, MouseEvent>, groupedId?: string) => void,\n  containerRef: RefObject<HTMLDivElement>,\n  messageId: number,\n  isInSelectMode: boolean,\n  canReply: boolean,\n  isProtected: boolean,\n  onContextMenu: (e: React.MouseEvent) => void,\n  handleBeforeContextMenu: (e: React.MouseEvent) => void,\n  chatId: string,\n  isContextMenuShown: boolean,\n  quickReactionRef: RefObject<HTMLDivElement>,\n  shouldHandleMouseLeave: boolean,\n  getIsMessageListReady?: Signal<boolean>,\n) {\n  const { updateDraftReplyInfo, sendDefaultReaction } = getActions();\n\n  const [isQuickReactionVisible, markQuickReactionVisible, unmarkQuickReactionVisible] = useFlag();\n  const [isSwiped, markSwiped, unmarkSwiped] = useFlag();\n  const doubleTapTimeoutRef = useRef<NodeJS.Timeout>();\n\n  function handleMouseDown(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    preventMessageInputBlur(e);\n    handleBeforeContextMenu(e);\n  }\n\n  const handleMouseMove = useThrottledCallback((e: React.MouseEvent) => {\n    const quickReactionContainer = quickReactionRef.current;\n    if (!quickReactionContainer) return;\n\n    const { clientX, clientY } = e;\n    const {\n      x: quickReactionX, width: quickReactionWidth, y: quickReactionY, height: quickReactionHeight,\n    } = quickReactionContainer.getBoundingClientRect();\n    const x = quickReactionX + quickReactionWidth / 2;\n    const y = quickReactionY + quickReactionHeight / 2;\n\n    const isVisibleX = Math.abs(x - clientX) < QUICK_REACTION_AREA_WIDTH;\n    const isVisibleY = Math.abs(y - clientY) < QUICK_REACTION_AREA_HEIGHT;\n    if (isVisibleX && isVisibleY) {\n      markQuickReactionVisible();\n    } else {\n      unmarkQuickReactionVisible();\n    }\n  }, [quickReactionRef], requestMeasure);\n\n  function handleSendQuickReaction(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    e.stopPropagation();\n    sendDefaultReaction({\n      chatId,\n      messageId,\n    });\n  }\n\n  function handleTap(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (IS_ANDROID) {\n      const target = e.target as HTMLDivElement;\n      if (!target.classList.contains('text-content') && !target.classList.contains('Message')) {\n        return;\n      }\n\n      if (windowSize.getIsKeyboardVisible()) {\n        setTimeout(() => {\n          onContextMenu(e);\n        }, ANDROID_KEYBOARD_HIDE_DELAY_MS);\n      } else {\n        onContextMenu(e);\n      }\n    }\n  }\n\n  function handleDoubleTap() {\n    sendDefaultReaction({\n      chatId,\n      messageId,\n    });\n  }\n\n  function handleClick(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (isInSelectMode) {\n      selectMessage(e);\n      return;\n    }\n\n    if (!IS_TOUCH_ENV) return;\n\n    if (doubleTapTimeoutRef.current) {\n      clearInterval(doubleTapTimeoutRef.current);\n      doubleTapTimeoutRef.current = undefined;\n      handleDoubleTap();\n      return;\n    }\n\n    doubleTapTimeoutRef.current = setTimeout(() => {\n      doubleTapTimeoutRef.current = undefined;\n      handleTap(e);\n    }, QUICK_REACTION_DOUBLE_TAP_DELAY);\n  }\n\n  function handleContextMenu(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (IS_ANDROID) {\n      if ((e.target as HTMLElement).matches('a[href]') || isContextMenuShown) {\n        return;\n      }\n\n      e.preventDefault();\n      selectMessage();\n    } else {\n      onContextMenu(e);\n    }\n  }\n\n  function handleContainerDoubleClick() {\n    if (IS_TOUCH_ENV || !canReply) return;\n\n    updateDraftReplyInfo({\n      replyToMsgId: messageId, replyToPeerId: undefined, quoteText: undefined, quoteOffset: undefined,\n    });\n  }\n\n  function stopPropagation(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    e.stopPropagation();\n  }\n\n  useEffect(() => {\n    if (!IS_TOUCH_ENV || isInSelectMode || !canReply || isContextMenuShown || !getIsMessageListReady?.()) {\n      return undefined;\n    }\n\n    let startedAt: number | undefined;\n    return captureEvents(containerRef.current!, {\n      selectorToPreventScroll: '.MessageList',\n      excludedClosestSelector: '.no-word-wrap',\n      onSwipe: ((e, direction) => {\n        if (direction === SwipeDirection.Left) {\n          if (!startedAt) {\n            startedAt = Date.now();\n          }\n\n          markSwiped();\n\n          return true;\n        }\n\n        return false;\n      }),\n      onRelease: () => {\n        if (!startedAt || !canReply) {\n          return;\n        }\n\n        updateDraftReplyInfo({ replyToMsgId: messageId });\n\n        setTimeout(unmarkSwiped, Math.max(0, SWIPE_ANIMATION_DURATION - (Date.now() - startedAt)));\n        startedAt = undefined;\n      },\n    });\n  }, [\n    containerRef, isInSelectMode, messageId, markSwiped, unmarkSwiped, canReply, isContextMenuShown,\n    getIsMessageListReady,\n  ]);\n\n  function handleMouseLeave(e: React.MouseEvent<HTMLDivElement>) {\n    // Because `mousemove` event is throttled, we need to also throttle `mouseleave` event,\n    // so the order of events is preserved\n    requestMeasure(unmarkQuickReactionVisible);\n    if (shouldHandleMouseLeave) handleDocumentGroupMouseLeave(e);\n  }\n\n  return {\n    handleMouseDown: !isInSelectMode ? handleMouseDown : undefined,\n    handleClick,\n    handleContextMenu: !isInSelectMode ? handleContextMenu : (isProtected ? stopEvent : undefined),\n    handleDoubleClick: !isInSelectMode ? handleContainerDoubleClick : undefined,\n    handleContentDoubleClick: !IS_TOUCH_ENV ? stopPropagation : undefined,\n    handleMouseMove,\n    handleSendQuickReaction,\n    handleMouseLeave,\n    isSwiped,\n    isQuickReactionVisible,\n    handleDocumentGroupMouseEnter,\n  };\n}\n\nfunction handleDocumentGroupMouseEnter(e: React.MouseEvent<HTMLDivElement>) {\n  const lastGroupElement = getLastElementInDocumentGroup(e.currentTarget);\n  if (lastGroupElement) {\n    lastGroupElement.setAttribute(GROUP_MESSAGE_HOVER_ATTRIBUTE, '');\n  }\n}\n\nfunction handleDocumentGroupMouseLeave(e: React.MouseEvent<HTMLDivElement>) {\n  const lastGroupElement = getLastElementInDocumentGroup(e.currentTarget);\n  if (lastGroupElement) {\n    lastGroupElement.removeAttribute(GROUP_MESSAGE_HOVER_ATTRIBUTE);\n  }\n}\n\nfunction getLastElementInDocumentGroup(element: Element) {\n  let current: Element | null = element;\n\n  do {\n    current = current.nextElementSibling;\n  } while (current && !current.classList.contains('last-in-document-group'));\n\n  return current;\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { useRef } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiPeer, ApiTypeStory } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\n\nimport {\n  getStoryMediaHash,\n} from '../../../global/helpers';\nimport { getPeerTitle } from '../../../global/helpers/peers';\nimport buildClassName from '../../../util/buildClassName';\nimport { getPictogramDimensions } from '../helpers/mediaDimensions';\nimport renderText from '../helpers/renderText';\n\nimport { useFastClick } from '../../../hooks/useFastClick';\nimport { useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Icon from '../icons/Icon';\nimport PeerColorWrapper from '../PeerColorWrapper';\n\nimport './EmbeddedMessage.scss';\n\ntype OwnProps = {\n  story?: ApiTypeStory;\n  sender?: ApiPeer;\n  noUserColors?: boolean;\n  isProtected?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  onClick: NoneToVoidFunction;\n};\n\nconst NBSP = '\\u00A0';\n\nconst EmbeddedStory: FC<OwnProps> = ({\n  story,\n  sender,\n  noUserColors,\n  isProtected,\n  observeIntersectionForLoading,\n  onClick,\n}) => {\n  const { showNotification } = getActions();\n\n  const lang = useOldLang();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const isIntersecting = useIsIntersecting(ref, observeIntersectionForLoading);\n  const isFullStory = story && 'content' in story;\n  const isExpiredStory = story && 'isDeleted' in story;\n  const isVideoStory = isFullStory && Boolean(story.content.video);\n  const title = isFullStory ? 'Story' : (isExpiredStory ? 'ExpiredStory' : 'Loading');\n\n  const mediaBlobUrl = useMedia(isFullStory && getStoryMediaHash(story, 'pictogram'), !isIntersecting);\n  const mediaThumbnail = isVideoStory ? story.content.video!.thumbnail?.dataUri : undefined;\n  const pictogramUrl = mediaBlobUrl || mediaThumbnail;\n\n  const senderTitle = sender ? getPeerTitle(lang, sender) : undefined;\n  const handleFastClick = useLastCallback(() => {\n    if (story && !isExpiredStory) {\n      onClick();\n    } else {\n      showNotification({\n        message: lang('StoryNotFound'),\n      });\n    }\n  });\n\n  const { handleClick, handleMouseDown } = useFastClick(handleFastClick);\n\n  return (\n    <PeerColorWrapper\n      ref={ref}\n      peerColor={sender?.color}\n      noUserColors={noUserColors}\n      shouldReset\n      className={buildClassName(\n        'EmbeddedMessage',\n        pictogramUrl && 'with-thumb',\n      )}\n      onClick={handleClick}\n      onMouseDown={handleMouseDown}\n    >\n      {pictogramUrl && renderPictogram(pictogramUrl, isProtected)}\n      <div className=\"message-text with-message-color\">\n        <p className=\"embedded-text-wrapper\">\n          {isExpiredStory && (\n            <Icon name=\"story-expired\" className=\"embedded-origin-icon\" />\n          )}\n          {isFullStory && (\n            <Icon name=\"story-reply\" className=\"embedded-origin-icon\" />\n          )}\n          {lang(title)}\n        </p>\n        <div className=\"message-title\">{renderText(senderTitle || NBSP)}</div>\n      </div>\n    </PeerColorWrapper>\n  );\n};\n\nfunction renderPictogram(\n  srcUrl: string,\n  isProtected?: boolean,\n) {\n  const { width, height } = getPictogramDimensions();\n\n  return (\n    <div className=\"embedded-thumb\">\n      <img\n        src={srcUrl}\n        width={width}\n        height={height}\n        alt=\"\"\n        className=\"pictogram\"\n        draggable={false}\n      />\n      {isProtected && <span className=\"protector\" />}\n    </div>\n  );\n}\n\nexport default EmbeddedStory;\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport type { ApiTopic } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\nimport { getTopicColorCssVariable } from '../../util/forumColors';\nimport { REM } from './helpers/mediaDimensions';\nimport renderText from './helpers/renderText';\n\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Icon from './icons/Icon';\nimport TopicIcon from './TopicIcon';\n\nimport styles from './TopicChip.module.scss';\n\nimport blankSrc from '../../assets/blank.png';\n\ntype OwnProps = {\n  topic?: ApiTopic;\n  className?: string;\n  onClick?: NoneToVoidFunction;\n};\n\nconst TOPIC_ICON_SIZE = 1.125 * REM;\n\nconst TopicChip: FC<OwnProps> = ({\n  topic,\n  className,\n  onClick,\n}) => {\n  const lang = useOldLang();\n  return (\n    <div\n      className={buildClassName(styles.root, className)}\n      style={`--topic-button-accent-color: var(${getTopicColorCssVariable(topic?.iconColor)})`}\n      onClick={onClick}\n    >\n      {topic\n        ? <TopicIcon topic={topic} size={TOPIC_ICON_SIZE} />\n        : <img src={blankSrc} alt=\"\" draggable={false} />}\n      {topic?.title ? renderText(topic.title) : lang('Loading')}\n      {topic?.isClosed && <Icon name=\"lock\" />}\n      <Icon name=\"next\" />\n    </div>\n  );\n};\n\nexport default memo(TopicChip);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"JldIqqof\"};","import type { MouseEvent as ReactMouseEvent } from 'react';\nimport type { FC } from '../../../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../../global';\n\nimport type { OwnProps as PhotoProps } from '../Photo';\nimport type { OwnProps as VideoProps } from '../Video';\n\nimport {\n  selectIsInSelectMode,\n  selectIsMessageSelected,\n} from '../../../../global/selectors';\nimport buildClassName from '../../../../util/buildClassName';\n\nimport useLastCallback from '../../../../hooks/useLastCallback';\n\nimport Icon from '../../../common/icons/Icon';\n\ntype OwnProps<T> =\n  (PhotoProps<T> | VideoProps<T>) & {\n    clickArg: number;\n    noSelectControls?: boolean;\n  };\n\ntype StateProps = {\n  isInSelectMode?: boolean;\n  isSelected?: boolean;\n};\n\nexport default function withSelectControl(WrappedComponent: FC) {\n  // eslint-disable-next-line @typescript-eslint/comma-dangle\n  const ComponentWithSelectControl = <T,>(props: OwnProps<T> & StateProps) => {\n    const {\n      isInSelectMode,\n      isSelected,\n      dimensions,\n      clickArg,\n    } = props;\n    const { toggleMessageSelection } = getActions();\n\n    const handleMessageSelect = useLastCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>) => {\n      e.stopPropagation();\n      toggleMessageSelection({ messageId: clickArg, withShift: e?.shiftKey });\n    });\n\n    const newProps = useMemo(() => {\n      const { dimensions: dims, onClick } = props;\n      return {\n        ...props,\n        isInSelectMode,\n        isSelected,\n        dimensions: {\n          ...dims,\n          x: 0,\n          y: 0,\n        },\n        onClick: isInSelectMode ? undefined : onClick,\n      };\n    }, [props, isInSelectMode, isSelected]);\n\n    return (\n      <div\n        className={buildClassName('album-item-select-wrapper', isSelected && 'is-selected')}\n        style={dimensions ? `left: ${dimensions.x}px; top: ${dimensions.y}px;` : ''}\n        onClick={isInSelectMode ? handleMessageSelect : undefined}\n      >\n        {isInSelectMode && (\n          <div className=\"message-select-control\">\n            {isSelected && (\n              <Icon name=\"select\" />\n            )}\n          </div>\n        )}\n        {/* eslint-disable-next-line react/jsx-props-no-spreading */}\n        <WrappedComponent {...newProps} />\n      </div>\n    );\n  };\n\n  return memo(withGlobal<OwnProps<unknown>>(\n    (global, ownProps) => {\n      const { clickArg, noSelectControls } = ownProps;\n      return {\n        isInSelectMode: !noSelectControls && selectIsInSelectMode(global),\n        isSelected: !noSelectControls && selectIsMessageSelected(global, clickArg),\n      };\n    },\n  )(ComponentWithSelectControl)) as typeof ComponentWithSelectControl;\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { useMemo } from '../../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../../global';\n\nimport type { ApiMessage } from '../../../api/types';\nimport type { GlobalState, TabState } from '../../../global/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { IAlbum, ThemeKey } from '../../../types';\nimport type { IAlbumLayout } from './helpers/calculateAlbumLayout';\n\nimport {\n  getIsDownloading, getMessageContent, getMessageHtmlId, getMessagePhoto,\n} from '../../../global/helpers';\nimport {\n  selectActiveDownloads,\n  selectCanAutoLoadMedia,\n  selectCanAutoPlayMedia,\n  selectTheme,\n} from '../../../global/selectors';\nimport { getMessageKey } from '../../../util/keys/messageKey';\nimport { AlbumRectPart } from './helpers/calculateAlbumLayout';\nimport withSelectControl from './hocs/withSelectControl';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nimport Photo from './Photo';\nimport Video from './Video';\n\nimport './Album.scss';\n\nconst PhotoWithSelect = withSelectControl(Photo);\nconst VideoWithSelect = withSelectControl(Video);\n\ntype OwnProps = {\n  album: IAlbum;\n  observeIntersection: ObserveFn;\n  hasCustomAppendix?: boolean;\n  isOwn: boolean;\n  isProtected?: boolean;\n  albumLayout: IAlbumLayout;\n  onMediaClick: (messageId: number, index?: number) => void;\n};\n\ntype StateProps = {\n  theme: ThemeKey;\n  uploadsByKey: GlobalState['fileUploads']['byMessageKey'];\n  activeDownloads: TabState['activeDownloads'];\n};\n\nconst Album: FC<OwnProps & StateProps> = ({\n  album,\n  observeIntersection,\n  hasCustomAppendix,\n  isOwn,\n  isProtected,\n  albumLayout,\n  onMediaClick,\n  uploadsByKey,\n  activeDownloads,\n  theme,\n}) => {\n  const { cancelUploadMedia } = getActions();\n\n  const { content: { paidMedia } } = album.mainMessage;\n\n  const mediaCount = album.isPaidMedia ? paidMedia!.extendedMedia.length : album.messages.length;\n\n  const handlePaidMediaClick = useLastCallback((index: number) => {\n    onMediaClick(album.mainMessage.id, index);\n  });\n\n  const handleAlbumMessageClick = useLastCallback((messageId: number) => {\n    onMediaClick(messageId);\n  });\n\n  const handleCancelUpload = useLastCallback((messageId: number) => {\n    cancelUploadMedia({ chatId: album.mainMessage.chatId, messageId });\n  });\n\n  const messages = useMemo(() => {\n    if (album.isPaidMedia) {\n      return album.mainMessage.content.paidMedia!.extendedMedia.map(() => album.mainMessage);\n    }\n\n    return album.messages;\n  }, [album]);\n\n  function renderAlbumMessage(message: ApiMessage, index: number) {\n    const renderingPaidMedia = album.isPaidMedia ? message.content.paidMedia?.extendedMedia[index] : undefined;\n    const paidPhotoOrPreview = renderingPaidMedia && 'mediaType' in renderingPaidMedia\n      ? renderingPaidMedia : renderingPaidMedia?.photo;\n    const paidVideoOrPreview = renderingPaidMedia && 'mediaType' in renderingPaidMedia\n      ? renderingPaidMedia : renderingPaidMedia?.video;\n    const photo = paidPhotoOrPreview || getMessagePhoto(message);\n    const video = paidVideoOrPreview || getMessageContent(message).video;\n\n    const fileUpload = uploadsByKey[getMessageKey(message)];\n    const uploadProgress = fileUpload?.progress;\n    const { dimensions, sides } = albumLayout.layout[index];\n\n    // Ignoring global updates is a known drawback here\n    const canAutoLoad = selectCanAutoLoadMedia(getGlobal(), message);\n    const canAutoPlay = selectCanAutoPlayMedia(getGlobal(), message);\n\n    if (photo) {\n      const shouldAffectAppendix = hasCustomAppendix && (\n        // eslint-disable-next-line no-bitwise\n        (isOwn ? index === mediaCount - 1 : Boolean(sides & AlbumRectPart.Left && sides & AlbumRectPart.Bottom))\n      );\n\n      return (\n        <PhotoWithSelect\n          id={`album-media-${getMessageHtmlId(message.id, album.isPaidMedia ? index : undefined)}`}\n          photo={photo}\n          isOwn={isOwn}\n          observeIntersectionForLoading={observeIntersection}\n          canAutoLoad={canAutoLoad}\n          shouldAffectAppendix={shouldAffectAppendix}\n          uploadProgress={uploadProgress}\n          dimensions={dimensions}\n          isProtected={isProtected}\n          clickArg={album.isPaidMedia ? index : message.id}\n          onClick={album.isPaidMedia ? handlePaidMediaClick : handleAlbumMessageClick}\n          onCancelUpload={handleCancelUpload}\n          isDownloading={photo.mediaType !== 'extendedMediaPreview' && getIsDownloading(activeDownloads, photo)}\n          theme={theme}\n          noSelectControls={album.isPaidMedia}\n        />\n      );\n    } else if (video) {\n      return (\n        <VideoWithSelect\n          id={`album-media-${getMessageHtmlId(message.id)}`}\n          video={video}\n          observeIntersectionForLoading={observeIntersection}\n          canAutoLoad={canAutoLoad}\n          canAutoPlay={canAutoPlay}\n          uploadProgress={uploadProgress}\n          dimensions={dimensions}\n          isProtected={isProtected}\n          clickArg={album.isPaidMedia ? index : message.id}\n          onClick={album.isPaidMedia ? handlePaidMediaClick : handleAlbumMessageClick}\n          onCancelUpload={handleCancelUpload}\n          isDownloading={video.mediaType !== 'extendedMediaPreview' && getIsDownloading(activeDownloads, video)}\n          theme={theme}\n          noSelectControls={album.isPaidMedia}\n        />\n      );\n    }\n\n    return undefined;\n  }\n\n  const { width: containerWidth, height: containerHeight } = albumLayout.containerStyle;\n\n  return (\n    <div\n      className=\"Album\"\n      style={`width: ${containerWidth}px; height: ${containerHeight}px;`}\n    >\n      {messages.map(renderAlbumMessage)}\n    </div>\n  );\n};\n\nexport default withGlobal<OwnProps>(\n  (global): StateProps => {\n    const theme = selectTheme(global);\n    const activeDownloads = selectActiveDownloads(global);\n\n    return {\n      theme,\n      uploadsByKey: global.fileUploads.byMessageKey,\n      activeDownloads,\n    };\n  },\n)(Album);\n","import { useEffect, useRef } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ActiveEmojiInteraction } from '../../../types';\n\nimport { IS_ELECTRON } from '../../../util/browser/windowEnvironment';\nimport buildStyle from '../../../util/buildStyle';\nimport safePlay from '../../../util/safePlay';\nimport { REM } from '../helpers/mediaDimensions';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\n\nconst SIZE = 7 * REM;\nconst INTERACTION_BUNCH_TIME = 1000;\nconst MS_DIVIDER = 1000;\nconst TIME_DEFAULT = 0;\n\nexport default function useAnimatedEmoji(\n  chatId?: string,\n  messageId?: number,\n  soundId?: string,\n  activeEmojiInteractions?: ActiveEmojiInteraction[],\n  isOwn?: boolean,\n  emoji?: string,\n  preferredSize?: number,\n) {\n  const {\n    interactWithAnimatedEmoji, sendEmojiInteraction, sendWatchingEmojiInteraction,\n  } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  // eslint-disable-next-line no-null/no-null\n  const audioRef = useRef<HTMLAudioElement | undefined>(null);\n\n  const soundMediaData = useMedia(soundId ? `document${soundId}` : undefined, !soundId);\n\n  const size = preferredSize || SIZE;\n  const style = buildStyle(`width: ${size}px`, `height: ${size}px`, emoji && !IS_ELECTRON && 'cursor: pointer');\n\n  const interactions = useRef<number[] | undefined>(undefined);\n  const startedInteractions = useRef<number | undefined>(undefined);\n  const sendInteractionBunch = useLastCallback(() => {\n    const container = ref.current;\n\n    if (!container) return;\n\n    sendEmojiInteraction({\n      chatId: chatId!,\n      messageId: messageId!,\n      emoji: emoji!,\n      interactions: interactions.current!,\n    });\n    startedInteractions.current = undefined;\n    interactions.current = undefined;\n  });\n\n  const play = useLastCallback(() => {\n    const audio = audioRef.current;\n    if (soundMediaData) {\n      if (audio) {\n        audio.pause();\n        audio.remove();\n      }\n      audioRef.current = new Audio();\n      audioRef.current.src = soundMediaData;\n      safePlay(audioRef.current);\n      audioRef.current.addEventListener('ended', () => {\n        audioRef.current = undefined;\n      }, { once: true });\n    }\n  });\n\n  const handleClick = useLastCallback(() => {\n    play();\n\n    const container = ref.current;\n\n    if (!emoji || !container || !messageId || !chatId) {\n      return;\n    }\n\n    const { x, y } = container.getBoundingClientRect();\n\n    interactWithAnimatedEmoji({\n      emoji: emoji!,\n      x,\n      y,\n      startSize: size,\n      isReversed: !isOwn,\n    });\n\n    if (!interactions.current) {\n      interactions.current = [];\n      startedInteractions.current = performance.now();\n      setTimeout(sendInteractionBunch, INTERACTION_BUNCH_TIME);\n    }\n\n    interactions.current.push(startedInteractions.current\n      ? (performance.now() - startedInteractions.current) / MS_DIVIDER\n      : TIME_DEFAULT);\n  });\n\n  // Set an end anchor for remote activated interaction\n  useEffect(() => {\n    const container = ref.current;\n\n    if (!container || !activeEmojiInteractions) return;\n\n    activeEmojiInteractions.forEach(({\n      id,\n      startSize,\n      messageId: interactionMessageId,\n    }) => {\n      if (startSize || messageId !== interactionMessageId) {\n        return;\n      }\n\n      const { x, y } = container.getBoundingClientRect();\n\n      sendWatchingEmojiInteraction({\n        id,\n        chatId: chatId!,\n        emoticon: emoji!,\n        startSize: size,\n        x,\n        y,\n        isReversed: !isOwn,\n      });\n      play();\n    });\n  }, [activeEmojiInteractions, chatId, emoji, isOwn, messageId, play, sendWatchingEmojiInteraction, size]);\n\n  return {\n    ref,\n    size,\n    style,\n    handleClick,\n  };\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../global';\n\nimport type { ApiSticker } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { ActiveEmojiInteraction } from '../../../types';\n\nimport {\n  selectAnimatedEmojiEffect,\n  selectAnimatedEmojiSound,\n  selectCanPlayAnimatedEmojis,\n} from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport { LIKE_STICKER_ID } from '../../common/helpers/mediaDimensions';\nimport { getCustomEmojiSize } from '../composer/helpers/customEmoji';\n\nimport useAnimatedEmoji from '../../common/hooks/useAnimatedEmoji';\n\nimport CustomEmoji from '../../common/CustomEmoji';\n\nimport './AnimatedEmoji.scss';\n\ntype OwnProps = {\n  customEmojiId: string;\n  withEffects?: boolean;\n  isOwn?: boolean;\n  forceLoadPreview?: boolean;\n  messageId?: number;\n  chatId?: string;\n  activeEmojiInteractions?: ActiveEmojiInteraction[];\n  observeIntersection?: ObserveFn;\n};\n\ninterface StateProps {\n  sticker?: ApiSticker;\n  effect?: ApiSticker;\n  soundId?: string;\n  noPlay?: boolean;\n}\n\nconst AnimatedCustomEmoji: FC<OwnProps & StateProps> = ({\n  isOwn,\n  customEmojiId,\n  messageId,\n  chatId,\n  activeEmojiInteractions,\n  sticker,\n  effect,\n  soundId,\n  noPlay,\n  observeIntersection,\n}) => {\n  const {\n    ref,\n    size,\n    style,\n    handleClick,\n  } = useAnimatedEmoji(\n    chatId, messageId, soundId, activeEmojiInteractions, isOwn, effect?.emoji, getCustomEmojiSize(1),\n  );\n\n  return (\n    <CustomEmoji\n      ref={ref}\n      documentId={customEmojiId}\n      className={buildClassName('AnimatedEmoji media-inner', sticker?.id === LIKE_STICKER_ID && 'like-sticker-thumb')}\n      style={style}\n      size={size}\n      isBig\n      noPlay={noPlay}\n      withSharedAnimation\n      forceOnHeavyAnimation={Boolean(effect && activeEmojiInteractions?.length)}\n      observeIntersectionForLoading={observeIntersection}\n      onClick={handleClick}\n    />\n  );\n};\n\nexport default memo(withGlobal<OwnProps>((global, { customEmojiId, withEffects }) => {\n  const sticker = global.customEmojis.byId[customEmojiId];\n\n  return {\n    sticker,\n    effect: sticker?.emoji && withEffects ? selectAnimatedEmojiEffect(global, sticker.emoji) : undefined,\n    soundId: sticker?.emoji && selectAnimatedEmojiSound(global, sticker.emoji),\n    noPlay: !selectCanPlayAnimatedEmojis(global),\n  };\n})(AnimatedCustomEmoji));\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../global';\n\nimport type { ApiSticker } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { ActiveEmojiInteraction } from '../../../types';\n\nimport {\n  selectAnimatedEmoji,\n  selectAnimatedEmojiEffect,\n  selectAnimatedEmojiSound,\n} from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport { LIKE_STICKER_ID } from '../../common/helpers/mediaDimensions';\n\nimport { useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useAnimatedEmoji from '../../common/hooks/useAnimatedEmoji';\n\nimport AnimatedIconFromSticker from '../../common/AnimatedIconFromSticker';\n\nimport './AnimatedEmoji.scss';\n\ntype OwnProps = {\n  emoji: string;\n  withEffects?: boolean;\n  isOwn?: boolean;\n  observeIntersection?: ObserveFn;\n  forceLoadPreview?: boolean;\n  messageId?: number;\n  chatId?: string;\n  activeEmojiInteractions?: ActiveEmojiInteraction[];\n};\n\ninterface StateProps {\n  sticker?: ApiSticker;\n  effect?: ApiSticker;\n  soundId?: string;\n}\n\nconst QUALITY = 1;\n\nconst AnimatedEmoji: FC<OwnProps & StateProps> = ({\n  isOwn,\n  observeIntersection,\n  forceLoadPreview,\n  messageId,\n  chatId,\n  activeEmojiInteractions,\n  sticker,\n  effect,\n  soundId,\n}) => {\n  const {\n    ref,\n    size,\n    style,\n    handleClick,\n  } = useAnimatedEmoji(chatId, messageId, soundId, activeEmojiInteractions, isOwn, effect?.emoji);\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  return (\n    <AnimatedIconFromSticker\n      sticker={sticker}\n      size={size}\n      quality={QUALITY}\n      noLoad={!isIntersecting}\n      forcePreview={forceLoadPreview}\n      play={isIntersecting}\n      forceAlways\n      ref={ref}\n      className={buildClassName('AnimatedEmoji media-inner', sticker?.id === LIKE_STICKER_ID && 'like-sticker-thumb')}\n      style={style}\n      onClick={handleClick}\n    />\n  );\n};\n\nexport default memo(withGlobal<OwnProps>((global, { emoji, withEffects }) => {\n  return {\n    sticker: selectAnimatedEmoji(global, emoji),\n    effect: withEffects ? selectAnimatedEmojiEffect(global, emoji) : undefined,\n    soundId: selectAnimatedEmojiSound(global, emoji),\n  };\n})(AnimatedEmoji));\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../../lib/teact/teact';\nimport { getActions, getGlobal } from '../../../global';\n\nimport type { ApiCommentsInfo } from '../../../api/types';\n\nimport { selectIsCurrentUserFrozen, selectPeer } from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatIntegerCompact } from '../../../util/textFormat';\n\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useAsyncRendering from '../../right/hooks/useAsyncRendering';\n\nimport AnimatedCounter from '../../common/AnimatedCounter';\nimport Avatar from '../../common/Avatar';\nimport Icon from '../../common/icons/Icon';\nimport Spinner from '../../ui/Spinner';\n\nimport './CommentButton.scss';\n\ntype OwnProps = {\n  threadInfo: ApiCommentsInfo;\n  disabled?: boolean;\n  isLoading?: boolean;\n  isCustomShape?: boolean;\n  asActionButton?: boolean;\n};\n\nconst SHOW_LOADER_DELAY = 450;\n\nconst CommentButton: FC<OwnProps> = ({\n  isCustomShape,\n  threadInfo,\n  disabled,\n  isLoading,\n  asActionButton,\n}) => {\n  const { openThread, openFrozenAccountModal } = getActions();\n\n  const shouldRenderLoading = useAsyncRendering([isLoading], SHOW_LOADER_DELAY);\n\n  const oldLang = useOldLang();\n  const lang = useLang();\n  const {\n    originMessageId, chatId, messagesCount, lastMessageId, lastReadInboxMessageId, recentReplierIds, originChannelId,\n  } = threadInfo;\n\n  const handleClick = useLastCallback(() => {\n    const global = getGlobal();\n    if (selectIsCurrentUserFrozen(global)) {\n      openFrozenAccountModal();\n      return;\n    }\n    openThread({\n      isComments: true, chatId, originMessageId, originChannelId,\n    });\n  });\n\n  const recentRepliers = useMemo(() => {\n    if (!recentReplierIds?.length) {\n      return undefined;\n    }\n\n    // No need for expensive global updates on chats and users, so we avoid them\n    const global = getGlobal();\n\n    return recentReplierIds.map((peerId) => {\n      return selectPeer(global, peerId);\n    }).filter(Boolean);\n  }, [recentReplierIds]);\n\n  if (messagesCount === undefined) {\n    return undefined;\n  }\n\n  function renderRecentRepliers() {\n    return (\n      Boolean(recentRepliers?.length) && (\n        <div className=\"recent-repliers\" dir={oldLang.isRtl ? 'rtl' : 'ltr'}>\n          {recentRepliers!.map((peer) => (\n            <Avatar\n              key={peer.id}\n              size=\"small\"\n              peer={peer}\n            />\n          ))}\n        </div>\n      )\n    );\n  }\n\n  const hasUnread = Boolean(lastReadInboxMessageId && lastMessageId && lastReadInboxMessageId < lastMessageId);\n\n  const commentsText = messagesCount ? (oldLang('CommentsCount', '%COMMENTS_COUNT%', undefined, messagesCount))\n    .split('%')\n    .map((s) => {\n      return (s === 'COMMENTS_COUNT' ? <AnimatedCounter text={formatIntegerCompact(lang, messagesCount)} /> : s);\n    })\n    : undefined;\n\n  return (\n    <div\n      data-cnt={formatIntegerCompact(lang, messagesCount)}\n      className={buildClassName(\n        'CommentButton',\n        hasUnread && 'has-unread',\n        disabled && 'disabled',\n        isCustomShape && 'CommentButton-custom-shape',\n        isLoading && 'loading',\n        asActionButton && 'as-action-button',\n      )}\n      dir={oldLang.isRtl ? 'rtl' : 'ltr'}\n      onClick={handleClick}\n      role=\"button\"\n      tabIndex={0}\n    >\n      <Icon\n        name=\"comments-sticker\"\n        className={buildClassName(\n          'CommentButton_icon-comments',\n          isLoading && shouldRenderLoading && 'CommentButton_hidden',\n        )}\n      />\n      {!recentRepliers?.length && <Icon name=\"comments\" />}\n      {renderRecentRepliers()}\n      <div className=\"label\" dir=\"auto\">\n        {messagesCount ? commentsText : oldLang('LeaveAComment')}\n      </div>\n      <div className=\"CommentButton_right\">\n        {isLoading && (\n          <Spinner\n            className={buildClassName(\n              'CommentButton_loading',\n              !shouldRenderLoading && 'CommentButton_hidden',\n            )}\n            color={isCustomShape ? 'white' : 'blue'}\n          />\n        ) }\n        <Icon\n          name=\"next\"\n          className={buildClassName(\n            'CommentButton_icon-open',\n            isLoading && shouldRenderLoading && 'CommentButton_hidden',\n          )}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default memo(CommentButton);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"AAHWWWvU\",\"info-container\":\"tpDpg82n\",\"infoContainer\":\"tpDpg82n\",\"info\":\"fpYynE5s\",\"name\":\"_PNTJc_V\",\"phone\":\"JP_3wes8\",\"divider\":\"_OSJcuqH\",\"buttons\":\"Blui4M4G\",\"button\":\"ReDHhQHm\",\"disabled\":\"XAeKpuIZ\",\"emoji-icon-background\":\"SjZYi3sJ\",\"emojiIconBackground\":\"SjZYi3sJ\"};","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { ApiContact, ApiCountryCode, ApiUser } from '../../../api/types';\n\nimport { getCanAddContact, getUserFullName } from '../../../global/helpers';\nimport { selectUser } from '../../../global/selectors';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { formatPhoneNumberWithCode } from '../../../util/phoneNumber';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Avatar from '../../common/Avatar';\nimport PeerColorWrapper from '../../common/PeerColorWrapper';\nimport Button from '../../ui/Button';\n\nimport styles from './Contact.module.scss';\n\ntype OwnProps = {\n  contact: ApiContact;\n  noUserColors?: boolean;\n};\n\ntype StateProps = {\n  user?: ApiUser;\n  phoneCodeList: ApiCountryCode[];\n};\n\nconst UNREGISTERED_CONTACT_ID = '0';\n\nconst Contact: FC<OwnProps & StateProps> = ({\n  contact, user, phoneCodeList, noUserColors,\n}) => {\n  const lang = useOldLang();\n  const {\n    openChat, openAddContactDialog, showNotification, openChatWithInfo,\n  } = getActions();\n\n  const { phoneNumber, userId } = contact;\n  const isRegistered = userId !== UNREGISTERED_CONTACT_ID;\n  const canAddContact = isRegistered && user && getCanAddContact(user);\n\n  const handleOpenChat = useLastCallback(() => {\n    openChat({ id: userId });\n  });\n\n  const handleAddContact = useLastCallback(() => {\n    openAddContactDialog({ userId: user?.id });\n  });\n\n  const handleClick = useLastCallback(() => {\n    if (user) {\n      openChatWithInfo({ id: userId });\n    } else {\n      copyTextToClipboard(phoneNumber);\n      showNotification({ message: lang('PhoneCopied') });\n    }\n  });\n\n  return (\n    <PeerColorWrapper\n      noUserColors={noUserColors}\n      peer={user}\n      emojiIconClassName={styles.emojiIconBackground}\n      className={styles.root}\n    >\n      <div className={styles.infoContainer} onClick={handleClick}>\n        <Avatar size=\"medium\" peer={user} text={getContactName(contact)} />\n        <div className={styles.info}>\n          <div className={styles.name}>\n            {user ? getUserFullName(user) : getContactName(contact)}\n          </div>\n          <div className={styles.phone}>\n            {formatPhoneNumberWithCode(phoneCodeList, phoneNumber)}\n          </div>\n        </div>\n      </div>\n      {isRegistered && (\n        <>\n          <div className={styles.divider} />\n          <div className={styles.buttons}>\n            <Button\n              isText\n              color=\"translucent\"\n              ripple\n              size=\"tiny\"\n              onClick={handleOpenChat}\n              className={styles.button}\n            >\n              {lang('SharedContactMessage')}\n            </Button>\n            {canAddContact && (\n              <Button\n                isText\n                color=\"translucent\"\n                ripple\n                size=\"tiny\"\n                onClick={handleAddContact}\n                className={styles.button}\n              >\n                {lang('SharedContactAdd')}\n              </Button>\n            )}\n          </div>\n        </>\n      )}\n    </PeerColorWrapper>\n  );\n};\n\nfunction getContactName(contact: ApiContact) {\n  if (contact.firstName && contact.lastName) {\n    return `${contact.firstName} ${contact.lastName}`;\n  }\n\n  if (contact.firstName) {\n    return contact.firstName;\n  }\n\n  if (contact.lastName) {\n    return contact.lastName;\n  }\n\n  return '';\n}\n\nexport default withGlobal<OwnProps>((global, { contact }): StateProps => {\n  const {\n    countryList: { phoneCodes: phoneCodeList },\n  } = global;\n  const user = selectUser(global, contact.userId);\n\n  return {\n    user,\n    phoneCodeList,\n  };\n})(Contact);\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './ContextMenuContainer';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst ContextMenuContainerAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const ContextMenuContainer = useModuleLoader(Bundles.Extra, 'ContextMenuContainer', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return ContextMenuContainer ? <ContextMenuContainer {...props} /> : undefined;\n};\n\nexport default ContextMenuContainerAsync;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"HMB5LgeX\",\"title\":\"vZnCPl3t\",\"content\":\"k_dGolcu\",\"separator\":\"qRaSs5iA\",\"footnote\":\"EDmr0wJG\",\"collapsed\":\"hYzpXwTM\",\"cutoutWrapper\":\"nfCzKu78\",\"collapseIcon\":\"mxPizZpR\",\"clickable\":\"Cj2cLczd\"};","import React, { memo, useMemo, useRef } from '../../../lib/teact/teact';\n\nimport type { ApiFactCheck } from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { renderTextWithEntities } from '../../common/helpers/renderTextWithEntities';\n\nimport useCollapsibleLines from '../../../hooks/element/useCollapsibleLines';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Icon from '../../common/icons/Icon';\nimport PeerColorWrapper from '../../common/PeerColorWrapper';\nimport Separator from '../../ui/Separator';\n\nimport styles from './FactCheck.module.scss';\n\ntype OwnProps = {\n  factCheck: ApiFactCheck;\n  isToggleDisabled?: boolean;\n};\n\nconst COLOR = {\n  color: 0,\n};\nconst MAX_LINES = 4;\n\nconst FactCheck = ({ factCheck, isToggleDisabled }: OwnProps) => {\n  const lang = useOldLang();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const cutoutRef = useRef<HTMLDivElement>(null);\n  const {\n    isCollapsed, isCollapsible, setIsCollapsed,\n  } = useCollapsibleLines(ref, MAX_LINES, cutoutRef);\n\n  const countryLocalized = useMemo(() => {\n    if (!factCheck.countryCode || !lang.code) return undefined;\n\n    const displayNames = new Intl.DisplayNames([lang.code], { type: 'region' });\n    return displayNames.of(factCheck.countryCode);\n  }, [factCheck.countryCode, lang.code]);\n\n  const canExpand = !isToggleDisabled && isCollapsed;\n\n  const handleExpand = useLastCallback(() => {\n    setIsCollapsed(false);\n  });\n\n  const handleToggle = useLastCallback(() => {\n    setIsCollapsed((prev) => !prev);\n  });\n\n  if (!factCheck.text) {\n    return undefined;\n  }\n\n  return (\n    <PeerColorWrapper peerColor={COLOR} className={styles.root} onClick={canExpand ? handleExpand : undefined}>\n      <div\n        ref={cutoutRef}\n        className={buildClassName(styles.cutoutWrapper, isCollapsed && styles.collapsed)}\n      >\n        <div className={styles.title}>{lang('FactCheck')}</div>\n        <div ref={ref} className={styles.content}>\n          {renderTextWithEntities({\n            text: factCheck.text.text,\n            entities: factCheck.text.entities,\n          })}\n        </div>\n        <Separator className={styles.separator} />\n        <div className={styles.footnote}>{lang('FactCheckFooter', countryLocalized)}</div>\n      </div>\n      {isCollapsible && (\n        <div\n          className={buildClassName(styles.collapseIcon, !isToggleDisabled && styles.clickable)}\n          onClick={!isToggleDisabled ? handleToggle : undefined}\n          aria-hidden\n        >\n          <Icon name={isCollapsed ? 'down' : 'up'} />\n        </div>\n      )}\n    </PeerColorWrapper>\n  );\n};\n\nexport default memo(FactCheck);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMessage } from '../../../api/types';\n\nimport { getGamePreviewPhotoHash, getGamePreviewVideoHash, getMessageText } from '../../../global/helpers';\n\nimport useMedia from '../../../hooks/useMedia';\n\nimport Skeleton from '../../ui/placeholder/Skeleton';\n\nimport './Game.scss';\n\nconst DEFAULT_PREVIEW_DIMENSIONS = {\n  width: 480,\n  height: 270,\n};\n\ntype OwnProps = {\n  message: ApiMessage;\n  canAutoLoadMedia?: boolean;\n};\n\nconst Game: FC<OwnProps> = ({\n  message,\n  canAutoLoadMedia,\n}) => {\n  const { clickBotInlineButton } = getActions();\n  const game = message.content.game!;\n  const {\n    title, description,\n  } = game;\n\n  const photoHash = getGamePreviewPhotoHash(game);\n  const videoHash = getGamePreviewVideoHash(game);\n  const photoBlobUrl = useMedia(photoHash, !canAutoLoadMedia);\n  const videoBlobUrl = useMedia(videoHash, !canAutoLoadMedia);\n\n  const handleGameClick = () => {\n    clickBotInlineButton({\n      chatId: message.chatId,\n      messageId: message.id,\n      button: message.inlineButtons![0][0],\n    });\n  };\n\n  return (\n    <div className=\"Game\">\n      <div\n        className=\"preview\"\n        style={`width: ${DEFAULT_PREVIEW_DIMENSIONS.width}px; height: ${DEFAULT_PREVIEW_DIMENSIONS.height}px`}\n        onClick={handleGameClick}\n      >\n        {!photoBlobUrl && !videoBlobUrl && (\n          <Skeleton className=\"skeleton preview-content\" />\n        )}\n        {photoBlobUrl && (\n          <img\n            className=\"preview-content\"\n            src={photoBlobUrl}\n            alt={title}\n            draggable={false}\n          />\n        )}\n        {videoBlobUrl && (\n          <video\n            className=\"preview-content\"\n            playsInline\n            muted\n            disablePictureInPicture\n            autoPlay\n            loop\n            src={videoBlobUrl}\n          />\n        )}\n      </div>\n      <div className=\"title\">{title}</div>\n      {!getMessageText(message) && <div className=\"description\">{description}</div>}\n    </div>\n  );\n};\n\nexport default memo(Game);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"CbpKtOey\",\"title\":\"ogvcv3mr\",\"sticker\":\"hjjKhvVv\",\"resultSticker\":\"JEiR48jJ\",\"count\":\"n_QCMv_A\",\"section\":\"MSFa9BPf\",\"description\":\"HfZ6SuLI\",\"peers\":\"rPyyNYxK\",\"peer\":\"FV70u896\",\"button\":\"jMBw7STU\",\"result\":\"ZQ4aVVkI\",\"separator\":\"ao0x1YnS\"};","import React, {\n  memo, useMemo, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../../global';\n\nimport type {\n  ApiChat, ApiGiveaway, ApiGiveawayInfo, ApiGiveawayResults, ApiMessage, ApiPeer, ApiSticker,\n} from '../../../api/types';\n\nimport {\n  getChatTitle, getUserFullName, isOwnMessage,\n} from '../../../global/helpers';\nimport { isApiPeerChat } from '../../../global/helpers/peers';\nimport {\n  selectCanPlayAnimatedEmojis,\n  selectChat,\n  selectForwardedSender,\n  selectGiftStickerForDuration,\n} from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatDateAtTime, formatDateTimeToString } from '../../../util/dates/dateFormat';\nimport { isoToEmoji } from '../../../util/emoji/emoji';\nimport { getServerTime } from '../../../util/serverTime';\nimport { callApi } from '../../../api/gramjs';\nimport { LOCAL_TGS_URLS } from '../../common/helpers/animatedAssets';\nimport renderText from '../../common/helpers/renderText';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport AnimatedIconFromSticker from '../../common/AnimatedIconFromSticker';\nimport AnimatedIconWithPreview from '../../common/AnimatedIconWithPreview';\nimport PeerChip from '../../common/PeerChip';\nimport Button from '../../ui/Button';\nimport ConfirmDialog from '../../ui/ConfirmDialog';\nimport Separator from '../../ui/Separator';\n\nimport styles from './Giveaway.module.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n};\n\ntype StateProps = {\n  chat: ApiChat;\n  sender?: ApiPeer;\n  giftSticker?: ApiSticker;\n  canPlayAnimatedEmojis?: boolean;\n};\n\nconst NBSP = '\\u00A0';\nconst GIFT_STICKER_SIZE = 175;\nconst RESULT_STICKER_SIZE = 150;\n\nconst Giveaway = ({\n  chat,\n  sender,\n  message,\n  canPlayAnimatedEmojis,\n  giftSticker,\n}: OwnProps & StateProps) => {\n  const { openChat } = getActions();\n\n  const isLoadingInfo = useRef(false);\n  const [giveawayInfo, setGiveawayInfo] = useState<ApiGiveawayInfo | undefined>();\n\n  const lang = useOldLang();\n  const { giveaway, giveawayResults } = message.content;\n  const isResults = Boolean(giveawayResults);\n  const {\n    months, untilDate, prizeDescription, stars,\n  } = (giveaway || giveawayResults)!;\n\n  const isOwn = isOwnMessage(message);\n\n  const quantity = isResults ? giveawayResults.winnersCount : giveaway!.quantity;\n\n  const hasEnded = getServerTime() > untilDate;\n\n  const countryList = useMemo(() => {\n    if (isResults) return undefined;\n    const translatedNames = new Intl.DisplayNames([lang.code!, 'en'].filter(Boolean), { type: 'region' });\n    return giveaway?.countries?.map((countryCode) => (\n      `${isoToEmoji(countryCode)}${NBSP}${translatedNames.of(countryCode)}`\n    )).join(', ');\n  }, [giveaway, isResults, lang.code]);\n\n  const handlePeerClick = useLastCallback((channelId: string) => {\n    openChat({ id: channelId });\n  });\n\n  const handleShowInfoClick = useLastCallback(async () => {\n    if (isLoadingInfo.current) return;\n\n    isLoadingInfo.current = true;\n    const result = await callApi('fetchGiveawayInfo', {\n      peer: chat,\n      messageId: message.id,\n    });\n    setGiveawayInfo(result);\n    isLoadingInfo.current = false;\n  });\n\n  const handleCloseInfo = useLastCallback(() => {\n    setGiveawayInfo(undefined);\n  });\n\n  const giveawayInfoTitle = useMemo(() => {\n    if (!giveawayInfo) return undefined;\n    return lang(giveawayInfo.type === 'results' ? 'BoostingGiveawayEnd' : 'BoostingGiveAwayAbout');\n  }, [giveawayInfo, lang]);\n\n  function renderGiveawayDescription(media: ApiGiveaway) {\n    const channelIds = media.channelIds;\n    return (\n      <>\n        <div className={styles.section}>\n          <strong className={styles.title}>\n            {renderText(lang('BoostingGiveawayPrizes'), ['simple_markdown'])}\n          </strong>\n          {prizeDescription && (\n            <>\n              <p className={styles.description}>\n                {renderText(\n                  lang('BoostingGiveawayMsgPrizes', [quantity, prizeDescription], undefined, quantity),\n                  ['simple_markdown'],\n                )}\n              </p>\n              <Separator>{lang('BoostingGiveawayMsgWithDivider')}</Separator>\n            </>\n          )}\n          <p className={styles.description}>\n            {message?.content?.giveaway?.stars ? (\n              <>\n                {renderText(\n                  lang('Chat.Giveaway.Message.Stars.PrizeText', lang('Stars', message?.content?.giveaway?.stars)),\n                  ['simple_markdown'],\n                )}\n                <br />\n                {renderText(lang('AmongWinners', quantity), ['simple_markdown'])}\n              </>\n            ) : (\n              <>\n                {renderText(lang('Chat.Giveaway.Info.Subscriptions', quantity), ['simple_markdown'])}\n                <br />\n                {renderText(lang(\n                  'ActionGiftPremiumSubtitle',\n                  lang('Chat.Giveaway.Info.Months', months),\n                ), ['simple_markdown'])}\n              </>\n            )}\n          </p>\n        </div>\n        <div className={styles.section}>\n          <strong className={styles.title}>\n            {renderText(lang('BoostingGiveawayMsgParticipants'), ['simple_markdown'])}\n          </strong>\n          <p className={styles.description}>\n            {renderText(lang('BoostingGiveawayMsgAllSubsPlural', channelIds.length), ['simple_markdown'])}\n          </p>\n          <div className={styles.peers}>\n            {channelIds.map((peerId) => (\n              <PeerChip\n                peerId={peerId}\n                forceShowSelf\n                withPeerColors={!isOwn}\n                className={styles.peer}\n                clickArg={peerId}\n                onClick={handlePeerClick}\n              />\n            ))}\n          </div>\n          {countryList && (\n            <span>{renderText(lang('Chat.Giveaway.Message.CountriesFrom', countryList))}</span>\n          )}\n        </div>\n        <div className={styles.section}>\n          <strong className={styles.title}>\n            {renderText(lang('BoostingWinnersDate'), ['simple_markdown'])}\n          </strong>\n          <p className={styles.description}>\n            {formatDateTimeToString(untilDate * 1000, lang.code, true)}\n          </p>\n        </div>\n      </>\n    );\n  }\n\n  function renderGiveawayResultsDescription(media: ApiGiveawayResults) {\n    const winnerIds = media.winnerIds;\n    return (\n      <>\n        <div className={styles.section}>\n          <strong className={styles.title}>\n            {renderText(lang('BoostingGiveawayResultsMsgWinnersSelected'), ['simple_markdown'])}\n          </strong>\n          <p className={styles.description}>\n            {renderText(lang('BoostingGiveawayResultsMsgWinnersTitle', winnerIds.length), ['simple_markdown'])}\n          </p>\n          <strong className={styles.title}>\n            {lang('lng_prizes_results_winners')}\n          </strong>\n          <div className={styles.peers}>\n            {winnerIds.map((peerId) => (\n              <PeerChip\n                peerId={peerId}\n                forceShowSelf\n                withPeerColors={!isOwn}\n                className={styles.peer}\n                clickArg={peerId}\n                onClick={handlePeerClick}\n              />\n            ))}\n          </div>\n        </div>\n        <div className={styles.section}>\n          <p className={styles.description}>\n            {lang('BoostingGiveawayResultsMsgAllWinnersReceivedLinks')}\n          </p>\n        </div>\n      </>\n    );\n  }\n\n  function renderGiveawayInfo() {\n    if (!sender || !giveawayInfo) return undefined;\n    const isResultsInfo = giveawayInfo.type === 'results';\n\n    const chatTitle = isApiPeerChat(sender) ? getChatTitle(lang, sender) : getUserFullName(sender);\n    const endDate = formatDateAtTime(lang, untilDate * 1000);\n    const otherChannelsCount = giveaway?.channelIds ? giveaway.channelIds.length - 1 : 0;\n    const otherChannelsString = lang('Chat.Giveaway.Info.OtherChannels', otherChannelsCount);\n    const isSeveral = otherChannelsCount > 0;\n\n    const firstKey = isResultsInfo ? 'BoostingGiveawayHowItWorksTextEnd' : 'BoostingGiveawayHowItWorksText';\n    const giveawayDuration = isResultsInfo ? lang('Chat.Giveaway.Info.Months', months) : lang('Stars', stars, 'i');\n    const firstParagraph = lang(firstKey, [chatTitle, quantity, giveawayDuration], undefined, quantity);\n\n    const additionalPrizes = prizeDescription\n      ? lang('BoostingGiveawayHowItWorksIncludeText', [chatTitle, quantity, prizeDescription], undefined, quantity)\n      : undefined;\n\n    let secondKey = '';\n    if (isResultsInfo) {\n      secondKey = isSeveral ? 'BoostingGiveawayHowItWorksSubTextSeveralEnd' : 'BoostingGiveawayHowItWorksSubTextEnd';\n    } else {\n      secondKey = isSeveral ? 'BoostingGiveawayHowItWorksSubTextSeveral' : 'BoostingGiveawayHowItWorksSubText';\n    }\n    let secondParagraph = lang(secondKey, [endDate, quantity, chatTitle, otherChannelsCount], undefined, quantity);\n    if (isResultsInfo && giveawayInfo.activatedCount) {\n      secondParagraph += ` ${lang('BoostingGiveawayUsedLinksPlural', giveawayInfo.activatedCount)}`;\n    }\n\n    let result = '';\n\n    if (isResultsInfo) {\n      if (giveawayInfo.isRefunded) {\n        result = lang('BoostingGiveawayCanceledByPayment');\n      } else {\n        result = lang(giveawayInfo.isWinner ? 'BoostingGiveawayYouWon' : 'BoostingGiveawayYouNotWon');\n      }\n    }\n\n    let lastParagraph = '';\n    if (isResultsInfo) {\n      // Nothing\n    } else if (giveawayInfo.disallowedCountry) {\n      lastParagraph = lang('BoostingGiveawayNotEligibleCountry');\n    } else if (giveawayInfo.adminDisallowedChatId) {\n      // Since rerenders are not expected, we can use the global state directly\n      const chatsById = getGlobal().chats.byId;\n      const disallowedChat = chatsById[giveawayInfo.adminDisallowedChatId];\n      const disallowedChatTitle = disallowedChat && getChatTitle(lang, disallowedChat);\n      lastParagraph = lang('BoostingGiveawayNotEligibleAdmin', disallowedChatTitle);\n    } else if (giveawayInfo.joinedTooEarlyDate) {\n      const joinedTooEarlyDate = formatDateAtTime(lang, giveawayInfo.joinedTooEarlyDate * 1000);\n      lastParagraph = lang('BoostingGiveawayNotEligible', joinedTooEarlyDate);\n    } else if (giveawayInfo.isParticipating) {\n      lastParagraph = isSeveral\n        ? lang('Chat.Giveaway.Info.ParticipatingMany', [chatTitle, otherChannelsCount])\n        : lang('Chat.Giveaway.Info.Participating', chatTitle);\n    } else {\n      lastParagraph = isSeveral\n        ? lang('Chat.Giveaway.Info.NotQualifiedMany', [chatTitle, otherChannelsString, endDate])\n        : lang('Chat.Giveaway.Info.NotQualified', [chatTitle, endDate]);\n    }\n\n    return (\n      <>\n        {result && (\n          <p className={styles.result}>\n            {renderText(result, ['simple_markdown'])}\n          </p>\n        )}\n        <p>\n          {renderText(firstParagraph, ['simple_markdown'])}\n        </p>\n        {additionalPrizes && (\n          <p>\n            {renderText(additionalPrizes, ['simple_markdown'])}\n          </p>\n        )}\n        <p>\n          {renderText(secondParagraph, ['simple_markdown'])}\n        </p>\n        {lastParagraph && (\n          <p>\n            {renderText(lastParagraph, ['simple_markdown'])}\n          </p>\n        )}\n      </>\n    );\n  }\n\n  return (\n    <div className={styles.root}>\n      <div className={buildClassName(styles.sticker, isResults && styles.resultSticker)}>\n        {isResults ? (\n          <AnimatedIconWithPreview\n            size={RESULT_STICKER_SIZE}\n            tgsUrl={LOCAL_TGS_URLS.PartyPopper}\n            nonInteractive\n            noLoop\n          />\n        ) : (\n          <AnimatedIconFromSticker\n            sticker={giftSticker}\n            play={canPlayAnimatedEmojis && hasEnded}\n            noLoop\n            nonInteractive\n            size={GIFT_STICKER_SIZE}\n          />\n        )}\n        <span className={styles.count}>\n          {`x${quantity}`}\n        </span>\n      </div>\n      {isResults ? renderGiveawayResultsDescription(giveawayResults) : renderGiveawayDescription(giveaway!)}\n      <Button\n        className={styles.button}\n        color=\"adaptive\"\n        size=\"smaller\"\n        onClick={handleShowInfoClick}\n      >\n        {lang('BoostingHowItWork')}\n      </Button>\n      <ConfirmDialog\n        isOpen={Boolean(giveawayInfo)}\n        isOnlyConfirm\n        title={giveawayInfoTitle}\n        confirmHandler={handleCloseInfo}\n        onClose={handleCloseInfo}\n      >\n        {renderGiveawayInfo()}\n      </ConfirmDialog>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { message }): StateProps => {\n    const { giveaway } = message.content;\n    const chat = selectChat(global, message.chatId)!;\n    const sender = selectChat(global, giveaway?.channelIds[0]!)\n      || selectForwardedSender(global, message) || chat;\n\n    const sticker = giveaway && selectGiftStickerForDuration(global, giveaway.months);\n\n    return {\n      chat,\n      sender,\n      giftSticker: sticker,\n      canPlayAnimatedEmojis: selectCanPlayAnimatedEmojis(global),\n    };\n  },\n)(Giveaway));\n","import type { FC, TeactNode } from '../../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../../lib/teact/teact';\n\nimport type { ApiKeyboardButton, ApiMessage } from '../../../api/types';\nimport type { ActionPayloads } from '../../../global/types';\n\nimport { RE_TME_LINK } from '../../../config';\nimport renderKeyboardButtonText from '../composer/helpers/renderKeyboardButtonText';\n\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\n\nimport './InlineButtons.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  onClick: (payload: ActionPayloads['clickBotInlineButton']) => void;\n};\n\nconst InlineButtons: FC<OwnProps> = ({ message, onClick }) => {\n  const lang = useOldLang();\n\n  const renderIcon = (button: ApiKeyboardButton) => {\n    const { type } = button;\n    switch (type) {\n      case 'url': {\n        if (!RE_TME_LINK.test(button.url)) {\n          return <Icon className=\"corner-icon\" name=\"arrow-right\" />;\n        }\n        break;\n      }\n      case 'urlAuth':\n        return <Icon className=\"corner-icon\" name=\"arrow-right\" />;\n      case 'buy':\n      case 'receipt':\n        return <Icon className=\"corner-icon\" name=\"card\" />;\n      case 'switchBotInline':\n        return <Icon className=\"corner-icon\" name=\"share-filled\" />;\n      case 'webView':\n      case 'simpleWebView':\n        return <Icon className=\"corner-icon\" name=\"webapp\" />;\n      case 'copy':\n        return <Icon className=\"corner-icon\" name=\"copy\" />;\n    }\n    return undefined;\n  };\n\n  const buttonTexts = useMemo(() => {\n    const texts: TeactNode[][] = [];\n    message.inlineButtons!.forEach((row) => {\n      texts.push(row.map((button) => renderKeyboardButtonText(lang, button)));\n    });\n    return texts;\n  }, [lang, message.inlineButtons]);\n\n  return (\n    <div className=\"InlineButtons\">\n      {message.inlineButtons!.map((row, i) => (\n        <div className=\"row\">\n          {row.map((button, j) => (\n            <Button\n              size=\"tiny\"\n              ripple\n              disabled={button.type === 'unsupported'}\n              // eslint-disable-next-line react/jsx-no-bind\n              onClick={() => onClick({ chatId: message.chatId, messageId: message.id, button })}\n            >\n              <span className=\"inline-button-text\">\n                {buttonTexts[i][j]}\n              </span>\n              {renderIcon(button)}\n            </Button>\n          ))}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default memo(InlineButtons);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useRef } from '../../../lib/teact/teact';\n\nimport type { ApiMessage } from '../../../api/types';\nimport type { ThemeKey } from '../../../types';\n\nimport { CUSTOM_APPENDIX_ATTRIBUTE, MESSAGE_CONTENT_SELECTOR } from '../../../config';\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { getMessageInvoice, getWebDocumentHash } from '../../../global/helpers';\nimport buildStyle from '../../../util/buildStyle';\nimport { formatCurrency } from '../../../util/formatCurrency';\nimport renderText from '../../common/helpers/renderText';\nimport getCustomAppendixBg from './helpers/getCustomAppendixBg';\n\nimport useLang from '../../../hooks/useLang';\nimport useLayoutEffectWithPrevDeps from '../../../hooks/useLayoutEffectWithPrevDeps';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useBlurredMediaThumbRef from './hooks/useBlurredMediaThumbRef';\n\nimport Skeleton from '../../ui/placeholder/Skeleton';\n\nimport './Invoice.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  shouldAffectAppendix?: boolean;\n  isInSelectMode?: boolean;\n  isSelected?: boolean;\n  theme: ThemeKey;\n  forcedWidth?: number;\n};\n\nconst Invoice: FC<OwnProps> = ({\n  message,\n  shouldAffectAppendix,\n  isInSelectMode,\n  isSelected,\n  theme,\n  forcedWidth,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const oldLang = useOldLang();\n  const lang = useLang();\n  const invoice = getMessageInvoice(message);\n\n  const {\n    title,\n    description,\n    amount,\n    currency,\n    isTest,\n    photo,\n  } = invoice!;\n\n  const photoUrl = useMedia(getWebDocumentHash(photo));\n  const withBlurredBackground = Boolean(forcedWidth);\n  const blurredBackgroundRef = useBlurredMediaThumbRef(photoUrl, !withBlurredBackground);\n  const messageId = message.id;\n\n  useLayoutEffectWithPrevDeps(([prevShouldAffectAppendix]) => {\n    if (!shouldAffectAppendix) {\n      if (prevShouldAffectAppendix) {\n        ref.current!.closest<HTMLDivElement>(MESSAGE_CONTENT_SELECTOR)!.removeAttribute(CUSTOM_APPENDIX_ATTRIBUTE);\n      }\n      return;\n    }\n\n    if (photoUrl) {\n      const contentEl = ref.current!.closest<HTMLDivElement>(MESSAGE_CONTENT_SELECTOR)!;\n      getCustomAppendixBg(photoUrl, false, messageId, isSelected, theme).then((appendixBg) => {\n        requestMutation(() => {\n          contentEl.style.setProperty('--appendix-bg', appendixBg);\n          contentEl.setAttribute(CUSTOM_APPENDIX_ATTRIBUTE, '');\n        });\n      });\n    }\n  }, [shouldAffectAppendix, photoUrl, isInSelectMode, isSelected, theme, messageId]);\n\n  const width = forcedWidth || photo?.dimensions?.width;\n\n  const style = buildStyle(\n    photo?.dimensions && `width: ${width}px`,\n    photo?.dimensions && `aspect-ratio: ${photo.dimensions.width} / ${photo.dimensions.height}`,\n    Boolean(!photo?.dimensions && forcedWidth) && `width: ${forcedWidth}px`,\n  );\n\n  return (\n    <div\n      ref={ref}\n      className=\"Invoice\"\n    >\n      {title && (\n        <p className=\"title\">{renderText(title)}</p>\n      )}\n      {description && (\n        <div className=\"info\">{renderText(description, ['emoji', 'br'])}</div>\n      )}\n      <div className={`description ${photo ? 'has-image' : ''}`}>\n        {Boolean(photo) && (\n          <div className=\"invoice-image-container\">\n            {withBlurredBackground && <canvas ref={blurredBackgroundRef} className=\"thumbnail blurred-bg\" />}\n            {photoUrl && (\n              <img\n                className=\"invoice-image\"\n                src={photoUrl}\n                alt=\"\"\n                style={style}\n                crossOrigin=\"anonymous\"\n                draggable={false}\n              />\n            )}\n            {!photoUrl && photo && (\n              <Skeleton\n                width={width}\n                height={photo.dimensions?.height}\n                forceAspectRatio\n              />\n            )}\n          </div>\n        )}\n        <p className=\"description-text\">\n          {formatCurrency(lang, amount, currency, { iconClassName: 'invoice-currency-icon' })}\n          {isTest && <span className=\"test-invoice\">{oldLang('PaymentTestInvoice')}</span>}\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(Invoice);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"dCK8GQ_8\",\"duration\":\"CWT8ZMwV\",\"buy\":\"C38zhCDM\",\"spoiler\":\"CG55VZP1\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMessage } from '../../../api/types';\n\nimport { getMessageInvoice } from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatMediaDuration } from '../../../util/dates/dateFormat';\nimport { formatCurrencyAsString } from '../../../util/formatCurrency';\n\nimport useInterval from '../../../hooks/schedulers/useInterval';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Icon from '../../common/icons/Icon';\nimport MediaSpoiler from '../../common/MediaSpoiler';\n\nimport styles from './InvoiceMediaPreview.module.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  isConnected: boolean;\n};\n\nconst POLLING_INTERVAL = 30000;\n\nconst InvoiceMediaPreview: FC<OwnProps> = ({\n  message,\n  isConnected,\n}) => {\n  const { openInvoice, loadExtendedMedia } = getActions();\n  const lang = useOldLang();\n  const invoice = getMessageInvoice(message);\n\n  const { chatId, id } = message;\n\n  const refreshExtendedMedia = useLastCallback(() => {\n    loadExtendedMedia({ chatId, ids: [id] });\n  });\n\n  useInterval(refreshExtendedMedia, isConnected ? POLLING_INTERVAL : undefined);\n\n  const {\n    amount,\n    currency,\n    extendedMedia,\n  } = invoice!;\n\n  const {\n    width, height, thumbnail, duration,\n  } = extendedMedia!;\n\n  const handleClick = useLastCallback(() => {\n    openInvoice({\n      type: 'message',\n      chatId,\n      messageId: id,\n      isExtendedMedia: true,\n    });\n  });\n\n  return (\n    <div\n      className={buildClassName(styles.root, 'media-inner')}\n      onClick={handleClick}\n    >\n      <MediaSpoiler\n        thumbDataUri={thumbnail?.dataUri}\n        width={width}\n        height={height}\n        isVisible\n        className={styles.spoiler}\n      />\n      {Boolean(duration) && <div className={styles.duration}>{formatMediaDuration(duration)}</div>}\n      <div className={styles.buy}>\n        <Icon name=\"lock\" className={styles.lock} />\n        {lang('Checkout.PayPrice', formatCurrencyAsString(amount, currency))}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(InvoiceMediaPreview);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useEffect, useLayoutEffect, useMemo, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMessage, ApiPeer } from '../../../api/types';\nimport type { ThemeKey } from '../../../types';\n\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport {\n  buildStaticMapHash,\n  getMessageLocation,\n  isGeoLiveExpired,\n} from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatCountdownShort, formatLocationLastUpdate } from '../../../util/dates/dateFormat';\nimport {\n  getMetersPerPixel, getVenueColor, getVenueIconUrl,\n} from '../../../util/map';\nimport { getServerTime } from '../../../util/serverTime';\n\nimport useInterval from '../../../hooks/schedulers/useInterval';\nimport useTimeout from '../../../hooks/schedulers/useTimeout';\nimport useForceUpdate from '../../../hooks/useForceUpdate';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\nimport usePreviousDeprecated from '../../../hooks/usePreviousDeprecated';\nimport useDevicePixelRatio from '../../../hooks/window/useDevicePixelRatio';\n\nimport Avatar from '../../common/Avatar';\nimport Skeleton from '../../ui/placeholder/Skeleton';\n\nimport './Location.scss';\n\nimport mapPin from '../../../assets/map-pin.svg';\n\nconst TIMER_RADIUS = 12;\nconst TIMER_CIRCUMFERENCE = TIMER_RADIUS * 2 * Math.PI;\nconst MOVE_THRESHOLD = 0.0001; // ~11m\nconst DEFAULT_MAP_CONFIG = {\n  width: 400,\n  height: 300,\n  zoom: 16,\n};\n\ntype OwnProps = {\n  message: ApiMessage;\n  peer?: ApiPeer;\n  isInSelectMode?: boolean;\n  isSelected?: boolean;\n  theme: ThemeKey;\n};\n\nconst Location: FC<OwnProps> = ({\n  message,\n  peer,\n}) => {\n  const { openMapModal } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const countdownRef = useRef<HTMLDivElement>(null);\n  const lang = useOldLang();\n  const forceUpdate = useForceUpdate();\n\n  const location = getMessageLocation(message)!;\n  const { mediaType, geo } = location;\n\n  const serverTime = getServerTime();\n  const isExpired = isGeoLiveExpired(message);\n  const secondsBeforeEnd = (mediaType === 'geoLive' && !isExpired) ? message.date + location.period - serverTime\n    : undefined;\n\n  const [point, setPoint] = useState(geo);\n\n  const shouldRenderText = mediaType === 'venue' || (mediaType === 'geoLive' && !isExpired);\n  const { width, height, zoom } = DEFAULT_MAP_CONFIG;\n  const dpr = useDevicePixelRatio();\n\n  const mediaHash = buildStaticMapHash(point, width, height, zoom, dpr);\n  const mediaBlobUrl = useMedia(mediaHash);\n  const prevMediaBlobUrl = usePreviousDeprecated(mediaBlobUrl, true);\n  const mapBlobUrl = mediaBlobUrl || prevMediaBlobUrl;\n\n  const accuracyRadiusPx = useMemo(() => {\n    if (mediaType !== 'geoLive' || !point.accuracyRadius) {\n      return 0;\n    }\n\n    const { lat, accuracyRadius } = point;\n    return accuracyRadius / getMetersPerPixel(lat, zoom);\n  }, [mediaType, point, zoom]);\n\n  const handleClick = () => {\n    openMapModal({ geoPoint: point, zoom });\n  };\n\n  const updateCountdown = useLastCallback((countdownEl: HTMLDivElement) => {\n    if (mediaType !== 'geoLive') return;\n    const svgEl = countdownEl.lastElementChild!;\n    const timerEl = countdownEl.firstElementChild!;\n\n    const timeLeft = message.date + location.period - getServerTime();\n    const strokeDashOffset = (1 - timeLeft / location.period) * TIMER_CIRCUMFERENCE;\n    const text = formatCountdownShort(lang, timeLeft * 1000);\n    timerEl.textContent = text;\n    svgEl.firstElementChild!.setAttribute('stroke-dashoffset', `-${strokeDashOffset}`);\n  });\n\n  useLayoutEffect(() => {\n    if (countdownRef.current) {\n      updateCountdown(countdownRef.current);\n    }\n  }, [updateCountdown]);\n\n  useEffect(() => {\n    // Prevent map refetching for slight location changes\n    if (Math.abs(geo.lat - point.lat) < MOVE_THRESHOLD && Math.abs(geo.long - point.long) < MOVE_THRESHOLD) {\n      if (point.accuracyRadius !== geo.accuracyRadius) {\n        setPoint({\n          ...point,\n          accuracyRadius: geo.accuracyRadius,\n        });\n      }\n      return;\n    }\n    setPoint(geo);\n  }, [geo, point]);\n\n  useTimeout(() => {\n    forceUpdate();\n  }, !isExpired ? (secondsBeforeEnd || 0) * 1000 : undefined);\n\n  useInterval(() => {\n    requestMutation(() => {\n      const countdownEl = countdownRef.current;\n      if (countdownEl) {\n        updateCountdown(countdownEl);\n      }\n    });\n  }, secondsBeforeEnd ? 1000 : undefined);\n\n  function renderInfo() {\n    if (!shouldRenderText) return undefined;\n    if (mediaType === 'venue') {\n      return (\n        <div className=\"location-info\">\n          <div className=\"location-info-title\">\n            {location.title}\n          </div>\n          <div className=\"location-info-subtitle\">\n            {location.address}\n          </div>\n        </div>\n      );\n    }\n    if (mediaType === 'geoLive') {\n      return (\n        <div className=\"location-info\">\n          <div className=\"location-info-title\">{lang('AttachLiveLocation')}</div>\n          <div className=\"location-info-subtitle\">\n            {formatLocationLastUpdate(lang, serverTime, message.editDate)}\n          </div>\n          {!isExpired && (\n            <div className=\"geo-countdown\" ref={countdownRef}>\n              <span className=\"geo-countdown-text\" />\n              <svg width=\"32px\" height=\"32px\">\n                <circle\n                  cx=\"16\"\n                  cy=\"16\"\n                  r={TIMER_RADIUS}\n                  className=\"geo-countdown-progress\"\n                  transform=\"rotate(-90, 16, 16)\"\n                  stroke-dasharray={TIMER_CIRCUMFERENCE}\n                  stroke-dashoffset=\"0\"\n                />\n              </svg>\n            </div>\n          )}\n        </div>\n      );\n    }\n    return undefined;\n  }\n\n  function renderMap() {\n    if (!mapBlobUrl) return <Skeleton width={width} height={height} />;\n    return (\n      <img\n        className=\"full-media map\"\n        src={mapBlobUrl}\n        alt=\"Location on a map\"\n        draggable={false}\n        style={`width: ${DEFAULT_MAP_CONFIG.width}px; height: ${DEFAULT_MAP_CONFIG.height}px;`}\n      />\n    );\n  }\n\n  function renderPin() {\n    const pinClassName = buildClassName(\n      'pin',\n      mediaType,\n      isExpired && 'expired',\n    );\n    if (mediaType === 'geoLive') {\n      return (\n        <div className={pinClassName}>\n          <PinSvg />\n          <Avatar peer={peer} className=\"location-avatar\" />\n          {location.heading !== undefined && (\n            <div className=\"direction\" style={`--direction: ${location.heading}deg`} />\n          )}\n        </div>\n      );\n    }\n\n    if (mediaType === 'venue') {\n      const color = getVenueColor(location.venueType);\n      const iconSrc = getVenueIconUrl(location.venueType);\n      if (iconSrc) {\n        return (\n          <div className={pinClassName} style={`--pin-color: ${color}`}>\n            <PinSvg />\n            <img src={iconSrc} draggable={false} className=\"venue-icon\" alt=\"\" />\n          </div>\n        );\n      }\n    }\n\n    return (\n      <img className={pinClassName} draggable={false} src={mapPin} alt=\"\" />\n    );\n  }\n\n  function renderOverlay() {\n    if (!mapBlobUrl) return undefined;\n\n    return (\n      <>\n        {Boolean(accuracyRadiusPx) && !isExpired && (\n          <div\n            className=\"location-accuracy\"\n            style={`width: ${accuracyRadiusPx * 2}px; height: ${accuracyRadiusPx * 2}px`}\n          />\n        )}\n        {renderPin()}\n      </>\n    );\n  }\n\n  return (\n    <div\n      ref={ref}\n      className=\"Location media-inner interactive\"\n      onClick={handleClick}\n    >\n      <div className=\"map-wrapper\">\n        {renderMap()}\n        {renderOverlay()}\n      </div>\n      {renderInfo()}\n    </div>\n  );\n};\n\nfunction PinSvg() {\n  return (\n    <svg className=\"round-pin\" style=\"enable-background:new 0 0 64 64\" viewBox=\"0 0 64 64\">\n      <circle cx=\"32\" cy=\"32\" r=\"24.5\" />\n      <path d=\"M32 8c13.23 0 24 10.77 24 24S45.23 56 32 56 8 45.23 8 32 18.77 8 32 8m0-1C18.19 7 7 18.19 7 32s11.19 25 25 25 25-11.19 25-25S45.81 7 32 7z\" />\n      <path d=\"m29.38 57.67-1.98-1.59 3.02-1.66L32 51.54l1.58 2.88 3.02 1.66-1.91 1.53L32 60.73z\" />\n      <path d=\"m32 52.58 1.07 1.95.14.26.26.14 2.24 1.22-1.33 1.06-.07.06-.06.07L32 59.96l-2.24-2.61-.06-.07-.07-.06-1.33-1.06 2.24-1.22.26-.14.14-.26L32 52.58m0-2.08-1.94 3.56L26.5 56l2.5 2 3 3.5 3-3.5 2.5-2-3.56-1.94L32 50.5z\" />\n    </svg>\n  );\n}\n\nexport default memo(Location);\n","import type { FC, TeactNode } from '../../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type {\n  ApiAvailableReaction, ApiMessage, ApiMessageOutgoingStatus, ApiThreadInfo,\n} from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { formatDateTimeToString, formatPastTimeShort, formatTime } from '../../../util/dates/dateFormat';\nimport { formatStarsAsIcon } from '../../../util/localization/format';\nimport { formatIntegerCompact } from '../../../util/textFormat';\nimport renderText from '../../common/helpers/renderText';\n\nimport useFlag from '../../../hooks/useFlag';\nimport useLang from '../../../hooks/useLang';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport AnimatedCounter from '../../common/AnimatedCounter';\nimport Icon from '../../common/icons/Icon';\nimport MessageOutgoingStatus from '../../common/MessageOutgoingStatus';\n\nimport './MessageMeta.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  withReactionOffset?: boolean;\n  outgoingStatus?: ApiMessageOutgoingStatus;\n  signature?: string;\n  availableReactions?: ApiAvailableReaction[];\n  noReplies?: boolean;\n  repliesThreadInfo?: ApiThreadInfo;\n  isTranslated?: boolean;\n  isPinned?: boolean;\n  withFullDate?: boolean;\n  effectEmoji?: string;\n  onClick: (e: React.MouseEvent<HTMLDivElement>) => void;\n  onTranslationClick: (e: React.MouseEvent<HTMLDivElement>) => void;\n  onEffectClick: (e: React.MouseEvent<HTMLDivElement>) => void;\n  renderQuickReactionButton?: () => TeactNode | undefined;\n  onOpenThread: NoneToVoidFunction;\n  paidMessageStars?: number;\n};\n\nconst MessageMeta: FC<OwnProps> = ({\n  message,\n  outgoingStatus,\n  signature,\n  withReactionOffset,\n  repliesThreadInfo,\n  renderQuickReactionButton,\n  noReplies,\n  isTranslated,\n  isPinned,\n  withFullDate,\n  effectEmoji,\n  onClick,\n  onTranslationClick,\n  onEffectClick,\n  onOpenThread,\n  paidMessageStars,\n}) => {\n  const { showNotification } = getActions();\n\n  const [isActivated, markActivated] = useFlag();\n\n  const oldLang = useOldLang();\n  const lang = useLang();\n\n  function handleImportedClick(e: React.MouseEvent) {\n    e.stopPropagation();\n\n    showNotification({\n      message: {\n        key: 'ImportedInfo',\n      },\n    });\n  }\n\n  function handleOpenThread(e: React.MouseEvent) {\n    e.stopPropagation();\n    onOpenThread();\n  }\n\n  const dateTitle = useMemo(() => {\n    if (!isActivated) return undefined;\n    const createDateTime = formatDateTimeToString(message.date * 1000, oldLang.code, undefined, oldLang.timeFormat);\n    const editDateTime = message.isEdited\n      && formatDateTimeToString(message.editDate! * 1000, oldLang.code, undefined, oldLang.timeFormat);\n    const forwardedDateTime = message.forwardInfo\n      && formatDateTimeToString(\n        (message.forwardInfo.savedDate || message.forwardInfo.date) * 1000,\n        oldLang.code,\n        undefined,\n        oldLang.timeFormat,\n      );\n\n    let text = createDateTime;\n    if (editDateTime) {\n      text += '\\n';\n      text += lang('MessageTooltipEditedDate', { date: editDateTime });\n    }\n    if (forwardedDateTime) {\n      text += '\\n';\n      text += lang('MessageTooltipForwardedDate', { date: forwardedDateTime });\n    }\n\n    return text;\n    // We need to listen to timeformat change\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, [isActivated, oldLang, message, oldLang.timeFormat]);\n\n  const viewsTitle = useMemo(() => {\n    if (!message.viewsCount) return undefined;\n    let text = lang('MessageTooltipViews', {\n      count: lang.number(message.viewsCount),\n    }, { pluralValue: message.viewsCount });\n    if (message.forwardsCount) {\n      text += '\\n';\n      text += lang('MessageTooltipForwards', {\n        count: lang.number(message.forwardsCount),\n      }, { pluralValue: message.forwardsCount });\n    }\n\n    return text;\n  }, [lang, message.forwardsCount, message.viewsCount]);\n\n  const repliesTitle = useMemo(() => {\n    const count = repliesThreadInfo?.messagesCount;\n    if (!count) return undefined;\n    return lang('MessageTooltipReplies', { count }, { pluralValue: count });\n  }, [lang, repliesThreadInfo]);\n\n  const date = useMemo(() => {\n    const time = formatTime(oldLang, message.date * 1000);\n    if (!withFullDate) {\n      return time;\n    }\n\n    return formatPastTimeShort(oldLang, (message.forwardInfo?.date || message.date) * 1000, true);\n  }, [oldLang, message.date, message.forwardInfo?.date, withFullDate]);\n\n  const fullClassName = buildClassName(\n    'MessageMeta',\n    withReactionOffset && 'reactions-offset',\n    message.forwardInfo?.isImported && 'is-imported',\n  );\n\n  return (\n    <span\n      className={fullClassName}\n      dir={lang.isRtl ? 'rtl' : 'ltr'}\n      onClick={onClick}\n      data-ignore-on-paste\n    >\n      {effectEmoji && (\n        <span className=\"message-effect-icon\" onClick={onEffectClick}>\n          {renderText(effectEmoji)}\n        </span>\n      )}\n      {isTranslated && (\n        <Icon name=\"language\" className=\"message-translated\" onClick={onTranslationClick} />\n      )}\n      {Boolean(message.viewsCount) && (\n        <>\n          <span className=\"message-views\" title={viewsTitle}>\n            {formatIntegerCompact(lang, message.viewsCount!)}\n          </span>\n          <Icon name=\"channelviews\" />\n        </>\n      )}\n      {!noReplies && Boolean(repliesThreadInfo?.messagesCount) && (\n        <span onClick={handleOpenThread} className=\"message-replies-wrapper\" title={repliesTitle}>\n          <span className=\"message-replies\">\n            <AnimatedCounter text={formatIntegerCompact(lang, repliesThreadInfo!.messagesCount!)} />\n          </span>\n          <Icon name=\"reply-filled\" />\n        </span>\n      )}\n      {isPinned && (\n        <Icon name=\"pinned-message\" className=\"message-pinned\" />\n      )}\n      {signature && (\n        <span className=\"message-signature\">{renderText(signature)}</span>\n      )}\n      {paidMessageStars && (\n        <span className=\"message-price\">{\n          formatStarsAsIcon(lang, paidMessageStars, {\n            asFont: true,\n            className: 'message-price-star-icon',\n            containerClassName: 'message-price-stars-container',\n          })\n        }\n        </span>\n      )}\n      <span className=\"message-time\" title={dateTitle} onMouseEnter={markActivated}>\n        {message.forwardInfo?.isImported && (\n          <>\n            <span className=\"message-imported\" onClick={handleImportedClick}>\n              {formatDateTimeToString(message.forwardInfo.date * 1000, lang.code, true)}\n            </span>\n            <span className=\"message-imported\" onClick={handleImportedClick}>{lang('MessageMetaImported')}</span>\n          </>\n        )}\n        {message.isEdited && `${lang('MessageMetaEdited')} `}\n        {message.isVideoProcessingPending && `${lang('MessageMetaApproximate')} `}\n        {date}\n      </span>\n      {outgoingStatus && (\n        <MessageOutgoingStatus status={outgoingStatus} />\n      )}\n      {renderQuickReactionButton && renderQuickReactionButton()}\n    </span>\n  );\n};\n\nexport default memo(MessageMeta);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"wqsZyy8u\",\"button\":\"NGmo4ADz\",\"info\":\"iFn6m6hd\",\"reason\":\"l8QfocIQ\",\"arrow\":\"ONmpzmUS\",\"incoming\":\"BfgDXljM\",\"missed\":\"Alra_BWu\",\"canceled\":\"J7xsuCAm\",\"meta\":\"rF5tkx92\",\"duration\":\"kKPKwFzu\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMessage } from '../../../api/types';\nimport type { ApiMessageActionPhoneCall } from '../../../api/types/messageActions';\n\nimport { ARE_CALLS_SUPPORTED } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatTime, formatTimeDuration } from '../../../util/dates/dateFormat';\nimport { getCallMessageKey } from './helpers/messageActions';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\n\nimport styles from './MessagePhoneCall.module.scss';\n\ntype OwnProps = {\n  phoneCall: ApiMessageActionPhoneCall;\n  message: ApiMessage;\n  chatId: string;\n};\n\nconst MessagePhoneCall: FC<OwnProps> = ({\n  phoneCall,\n  message,\n  chatId,\n}) => {\n  const { requestMasterAndRequestCall } = getActions();\n\n  const lang = useOldLang();\n  const {\n    isVideo, reason, duration,\n  } = phoneCall;\n  const isOutgoing = message.isOutgoing;\n  const isMissed = reason === 'missed';\n  const isCancelled = reason === 'busy' || duration === undefined;\n\n  const handleCall = useLastCallback(() => {\n    requestMasterAndRequestCall({ isVideo, userId: chatId });\n  });\n\n  const formattedDuration = useMemo(() => {\n    return phoneCall.duration ? formatTimeDuration(lang, phoneCall.duration) : undefined;\n  }, [lang, phoneCall.duration]);\n\n  const timeFormatted = formatTime(lang, message.date * 1000);\n  return (\n    <div className={styles.root}>\n      <Button\n        size=\"smaller\"\n        color=\"translucent\"\n        round\n        ripple\n        onClick={handleCall}\n        className={styles.button}\n        disabled={!ARE_CALLS_SUPPORTED}\n        ariaLabel={lang(isOutgoing ? 'CallAgain' : 'CallBack')}\n      >\n        <Icon name={isVideo ? 'video-outlined' : 'phone'} />\n      </Button>\n      <div className={styles.info}>\n        <div className={styles.reason}>{lang(getCallMessageKey(phoneCall, message.isOutgoing))}</div>\n        <div className={styles.meta}>\n          <Icon\n            name=\"arrow-right\"\n            className={buildClassName(\n              styles.arrow,\n              isMissed && styles.missed,\n              isCancelled && styles.canceled,\n              !isOutgoing && styles.incoming,\n            )}\n          />\n          <span className={styles.duration}>\n            {formattedDuration ? lang('CallMessageWithDuration', [timeFormatted, formattedDuration]) : timeFormatted}\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(MessagePhoneCall);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"mVaSjZRJ\",\"buyButton\":\"GnKGu6D9\",\"boughtStatus\":\"IGXW5hWr\",\"star\":\"ywiOugiH\",\"buttonText\":\"gLaaVQXr\"};","import React, { memo, type TeactNode, useMemo } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiPaidMedia } from '../../../api/types';\n\nimport { STARS_ICON_PLACEHOLDER } from '../../../config';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatStarsAsIcon } from '../../../util/localization/format';\nimport { replaceWithTeact } from '../../../util/replaceWithTeact';\nimport stopEvent from '../../../util/stopEvent';\n\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport StarIcon from '../../common/icons/StarIcon';\nimport Button from '../../ui/Button';\n\nimport styles from './PaidMediaOverlay.module.scss';\n\ntype OwnProps = {\n  paidMedia: ApiPaidMedia;\n  chatId: string;\n  messageId: number;\n  isOutgoing?: boolean;\n  children?: TeactNode;\n};\n\nconst PaidMediaOverlay = ({\n  paidMedia,\n  chatId,\n  messageId,\n  isOutgoing,\n  children,\n}: OwnProps) => {\n  const { openInvoice } = getActions();\n  const oldLang = useOldLang();\n  const lang = useLang();\n\n  const isClickable = !paidMedia.isBought;\n\n  const buttonText = useMemo(() => {\n    const value = oldLang('UnlockPaidContent', paidMedia.starsAmount);\n\n    return replaceWithTeact(\n      value, STARS_ICON_PLACEHOLDER, <StarIcon className={styles.star} type=\"gold\" size=\"adaptive\" />,\n    );\n  }, [oldLang, paidMedia]);\n\n  const handleClick = useLastCallback((e: React.MouseEvent) => {\n    openInvoice({\n      type: 'message',\n      chatId,\n      messageId,\n    });\n    stopEvent(e);\n  });\n\n  return (\n    <div\n      className={styles.root}\n      onClick={isClickable ? handleClick : undefined}\n    >\n      {children}\n      {isClickable && (\n        <Button\n          className={styles.buyButton}\n          color=\"dark\"\n          size=\"tiny\"\n          fluid\n          pill\n        >\n          <span className={styles.buttonText}>{buttonText}</span>\n        </Button>\n      )}\n      {paidMedia.isBought && (\n        <div className={buildClassName('message-paid-media-status', styles.boughtStatus)}>\n          {isOutgoing\n            ? formatStarsAsIcon(lang, paidMedia.starsAmount)\n            : oldLang('Chat.PaidMedia.Purchased')}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(PaidMediaOverlay);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  useEffect,\n  useState,\n} from '../../../lib/teact/teact';\n\nimport type { ApiPollAnswer, ApiPollResult } from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { renderTextWithEntities } from '../../common/helpers/renderTextWithEntities';\n\nimport useLang from '../../../hooks/useLang';\n\nimport Icon from '../../common/icons/Icon';\n\nimport './PollOption.scss';\n\ntype OwnProps = {\n  answer: ApiPollAnswer;\n  voteResults?: ApiPollResult[];\n  totalVoters?: number;\n  maxVotersCount?: number;\n  correctResults: string[];\n  shouldAnimate: boolean;\n};\n\nconst PollOption: FC<OwnProps> = ({\n  answer,\n  voteResults,\n  totalVoters,\n  maxVotersCount,\n  correctResults,\n  shouldAnimate,\n}) => {\n  const lang = useLang();\n  const result = voteResults && voteResults.find((r) => r.option === answer.option);\n  const correctAnswer = correctResults.length === 0 || correctResults.indexOf(answer.option) !== -1;\n  const showIcon = (correctResults.length > 0 && correctAnswer) || (result?.isChosen);\n  const answerPercent = result ? getPercentage(result.votersCount, totalVoters || 0) : 0;\n  const [finalPercent, setFinalPercent] = useState(shouldAnimate ? 0 : answerPercent);\n  const lineWidth = result ? getPercentage(result.votersCount, maxVotersCount || 0) : 0;\n  const isAnimationDoesNotStart = finalPercent !== answerPercent;\n\n  useEffect(() => {\n    if (shouldAnimate) {\n      setFinalPercent(answerPercent);\n    }\n  }, [shouldAnimate, answerPercent]);\n\n  if (!voteResults || !result) {\n    return undefined;\n  }\n\n  const lineStyle = `width: ${lineWidth}%; transform:scaleX(${isAnimationDoesNotStart ? 0 : 1})`;\n\n  return (\n    <div className=\"PollOption\" dir={lang.isRtl ? 'rtl' : undefined}>\n      <div className={`poll-option-share ${answerPercent === '100' ? 'limit-width' : ''}`}>\n        {answerPercent}%\n        {showIcon && (\n          <span className={buildClassName(\n            'poll-option-chosen',\n            !correctAnswer && 'wrong',\n            shouldAnimate && 'animate',\n          )}\n          >\n            <Icon name={correctAnswer ? 'check' : 'close'} className=\"poll-option-icon\" />\n          </span>\n        )}\n      </div>\n      <div className=\"poll-option-right\">\n        <div className=\"poll-option-text\" dir=\"auto\">\n          {renderTextWithEntities({\n            text: answer.text.text,\n            entities: answer.text.entities,\n          })}\n        </div>\n        <div className={buildClassName('poll-option-answer', showIcon && !correctAnswer && 'wrong')}>\n          {shouldAnimate && (\n            <svg\n              className=\"poll-line\"\n              style={!isAnimationDoesNotStart ? 'stroke-dasharray: 100% 200%; stroke-dashoffset: -44' : ''}\n            >\n              <path d=\"M4.47 5.33v13.6a9 9 0 009 9h13\" />\n            </svg>\n          )}\n          <div\n            className=\"poll-option-line\"\n            style={lineStyle}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nfunction getPercentage(value: number, total: number) {\n  return total > 0 ? ((value / total) * 100).toFixed() : 0;\n}\n\nexport default PollOption;\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from '../../../lib/teact/teact';\nimport { getActions, getGlobal } from '../../../global';\n\nimport type {\n  ApiMessage, ApiPeer, ApiPoll, ApiPollAnswer,\n} from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { OldLangFn } from '../../../hooks/useOldLang';\n\nimport { selectPeer } from '../../../global/selectors';\nimport { formatMediaDuration } from '../../../util/dates/dateFormat';\nimport { getMessageKey } from '../../../util/keys/messageKey';\nimport { getServerTime } from '../../../util/serverTime';\nimport { renderTextWithEntities } from '../../common/helpers/renderTextWithEntities';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport AvatarList from '../../common/AvatarList';\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\nimport CheckboxGroup from '../../ui/CheckboxGroup';\nimport RadioGroup from '../../ui/RadioGroup';\nimport PollOption from './PollOption';\n\nimport './Poll.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  poll: ApiPoll;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  onSendVote: (options: string[]) => void;\n};\n\nconst SOLUTION_CONTAINER_ID = '#middle-column-portals';\nconst SOLUTION_DURATION = 5000;\nconst TIMER_RADIUS = 6;\nconst TIMER_CIRCUMFERENCE = TIMER_RADIUS * 2 * Math.PI;\nconst TIMER_UPDATE_INTERVAL = 1000;\nconst NBSP = '\\u00A0';\n\nconst Poll: FC<OwnProps> = ({\n  message,\n  poll,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  onSendVote,\n}) => {\n  const {\n    loadMessage, openPollResults, requestConfetti, showNotification,\n  } = getActions();\n\n  const { id: messageId, chatId } = message;\n  const { summary, results } = poll;\n  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);\n  const [chosenOptions, setChosenOptions] = useState<string[]>([]);\n  const [wasSubmitted, setWasSubmitted] = useState<boolean>(false);\n  const [closePeriod, setClosePeriod] = useState<number>(\n    !summary.closed && summary.closeDate && summary.closeDate > 0\n      ? Math.min(summary.closeDate - getServerTime(), summary.closePeriod!)\n      : 0,\n  );\n  // eslint-disable-next-line no-null/no-null\n  const countdownRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const timerCircleRef = useRef<SVGCircleElement>(null);\n  const { results: voteResults, totalVoters } = results;\n  const hasVoted = voteResults && voteResults.some((r) => r.isChosen);\n  const canVote = !summary.closed && !hasVoted;\n  const canViewResult = !canVote && summary.isPublic && Number(results.totalVoters) > 0;\n  const isMultiple = canVote && summary.multipleChoice;\n  const recentVoterIds = results.recentVoterIds;\n  const maxVotersCount = voteResults ? Math.max(...voteResults.map((r) => r.votersCount)) : totalVoters;\n  const correctResults = useMemo(() => {\n    return voteResults?.filter((r) => r.isCorrect).map((r) => r.option) || [];\n  }, [voteResults]);\n  const answers = useMemo(() => summary.answers.map((a) => ({\n    label: renderTextWithEntities({\n      text: a.text.text,\n      entities: a.text.entities,\n      observeIntersectionForLoading,\n      observeIntersectionForPlaying,\n    }),\n    value: a.option,\n    hidden: Boolean(summary.quiz && summary.closePeriod && closePeriod <= 0),\n  })), [\n    closePeriod, observeIntersectionForLoading, observeIntersectionForPlaying,\n    summary.answers, summary.closePeriod, summary.quiz,\n  ]);\n\n  useEffect(() => {\n    const chosen = poll.results.results?.find((result) => result.isChosen);\n    if (isSubmitting && chosen) {\n      if (chosen.isCorrect) {\n        requestConfetti({});\n      }\n      setIsSubmitting(false);\n    }\n  }, [isSubmitting, poll.results.results, requestConfetti]);\n\n  useLayoutEffect(() => {\n    if (closePeriod > 0) {\n      setTimeout(() => setClosePeriod(closePeriod - 1), TIMER_UPDATE_INTERVAL);\n    }\n    if (!timerCircleRef.current) return;\n\n    if (closePeriod <= 5) {\n      countdownRef.current!.classList.add('hurry-up');\n    }\n\n    const strokeDashOffset = ((summary.closePeriod! - closePeriod) / summary.closePeriod!) * TIMER_CIRCUMFERENCE;\n    timerCircleRef.current.setAttribute('stroke-dashoffset', `-${strokeDashOffset}`);\n  }, [closePeriod, summary.closePeriod]);\n\n  useEffect(() => {\n    if (summary.quiz && (closePeriod <= 0 || (hasVoted && !summary.closed))) {\n      loadMessage({ chatId, messageId });\n    }\n  }, [chatId, closePeriod, hasVoted, loadMessage, messageId, summary.closed, summary.quiz]);\n\n  // If the client time is not synchronized, the poll must be updated after the closePeriod time has expired.\n  useEffect(() => {\n    let timer: number | undefined;\n\n    if (summary.quiz && !summary.closed && summary.closePeriod && summary.closePeriod > 0) {\n      timer = window.setTimeout(() => {\n        loadMessage({ chatId, messageId });\n      }, summary.closePeriod * 1000);\n    }\n\n    return () => {\n      if (timer) {\n        window.clearTimeout(timer);\n      }\n    };\n  }, [canVote, chatId, loadMessage, messageId, summary.closePeriod, summary.closed, summary.quiz]);\n\n  const recentVoters = useMemo(() => {\n    // No need for expensive global updates on chats or users, so we avoid them\n    const global = getGlobal();\n    return recentVoterIds ? recentVoterIds.reduce((result: ApiPeer[], id) => {\n      const peer = selectPeer(global, id);\n      if (peer) {\n        result.push(peer);\n      }\n\n      return result;\n    }, []) : [];\n  }, [recentVoterIds]);\n\n  const handleRadioChange = useLastCallback((option: string) => {\n    setChosenOptions([option]);\n    setIsSubmitting(true);\n    setWasSubmitted(true);\n    onSendVote([option]);\n  });\n\n  const handleCheckboxChange = useLastCallback((options: string[]) => {\n    setChosenOptions(options);\n  });\n\n  const handleVoteClick = useLastCallback(() => {\n    setIsSubmitting(true);\n    setWasSubmitted(true);\n    onSendVote(chosenOptions);\n  });\n\n  const handleViewResultsClick = useLastCallback(() => {\n    openPollResults({ chatId, messageId });\n  });\n\n  const showSolution = useLastCallback(() => {\n    showNotification({\n      localId: getMessageKey(message),\n      message: renderTextWithEntities({ text: poll.results.solution!, entities: poll.results.solutionEntities }),\n      duration: SOLUTION_DURATION,\n      containerSelector: SOLUTION_CONTAINER_ID,\n    });\n  });\n\n  // Show the solution to quiz if the answer was incorrect\n  useEffect(() => {\n    if (wasSubmitted && hasVoted && summary.quiz && results.results && poll.results.solution) {\n      const correctResult = results.results.find((r) => r.isChosen && r.isCorrect);\n      if (!correctResult) {\n        showSolution();\n      }\n    }\n  }, [hasVoted, wasSubmitted, results.results, summary.quiz, poll.results.solution]);\n\n  const lang = useOldLang();\n\n  function renderResultOption(answer: ApiPollAnswer) {\n    return (\n      <PollOption\n        key={answer.option}\n        shouldAnimate={wasSubmitted || !canVote}\n        answer={answer}\n        voteResults={voteResults}\n        totalVoters={totalVoters}\n        maxVotersCount={maxVotersCount}\n        correctResults={correctResults}\n      />\n    );\n  }\n\n  function renderRecentVoters() {\n    return (\n      recentVoters.length > 0 && (\n        <div className=\"poll-recent-voters\">\n          <AvatarList\n            size=\"micro\"\n            peers={recentVoters}\n          />\n        </div>\n      )\n    );\n  }\n\n  return (\n    <div className=\"Poll\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n      <div className=\"poll-question\">\n        {renderTextWithEntities({\n          text: summary.question.text,\n          entities: summary.question.entities,\n          observeIntersectionForLoading,\n          observeIntersectionForPlaying,\n        })}\n      </div>\n      <div className=\"poll-type\">\n        {lang(getPollTypeString(summary))}\n        {renderRecentVoters()}\n        {closePeriod > 0 && canVote && (\n          <div ref={countdownRef} className=\"poll-countdown\">\n            <span>{formatMediaDuration(closePeriod)}</span>\n            <svg width=\"16px\" height=\"16px\">\n              <circle\n                ref={timerCircleRef}\n                cx=\"8\"\n                cy=\"8\"\n                r={TIMER_RADIUS}\n                className=\"poll-countdown-progress\"\n                transform=\"rotate(-90, 8, 8)\"\n                stroke-dasharray={TIMER_CIRCUMFERENCE}\n                stroke-dashoffset=\"0\"\n              />\n            </svg>\n          </div>\n        )}\n        {summary.quiz && poll.results.solution && !canVote && (\n          <Button\n            round\n            size=\"tiny\"\n            color=\"translucent\"\n            className=\"poll-quiz-help\"\n            onClick={showSolution}\n            ariaLabel=\"Show Solution\"\n          >\n            <Icon name=\"lamp\" />\n          </Button>\n        )}\n      </div>\n      {canVote && (\n        <div\n          className=\"poll-answers\"\n          onClick={stopPropagation}\n        >\n          {isMultiple\n            ? (\n              <CheckboxGroup\n                options={answers}\n                onChange={handleCheckboxChange}\n                disabled={message.isScheduled || isSubmitting}\n                loadingOptions={isSubmitting ? chosenOptions : undefined}\n                isRound\n              />\n            )\n            : (\n              <RadioGroup\n                name={`poll-${messageId}`}\n                options={answers}\n                onChange={handleRadioChange}\n                disabled={message.isScheduled || isSubmitting}\n                loadingOption={isSubmitting ? chosenOptions[0] : undefined}\n              />\n            )}\n        </div>\n      )}\n      {!canVote && (\n        <div className=\"poll-results\">\n          {summary.answers.map(renderResultOption)}\n        </div>\n      )}\n      {!canViewResult && !isMultiple && (\n        <div className=\"poll-voters-count\">{getReadableVotersCount(lang, summary.quiz, results.totalVoters)}</div>\n      )}\n      {isMultiple && (\n        <Button\n          isText\n          disabled={chosenOptions.length === 0}\n          size=\"tiny\"\n          onClick={handleVoteClick}\n        >\n          {lang('PollSubmitVotes')}\n        </Button>\n      )}\n      {canViewResult && (\n        <Button\n          isText\n          size=\"tiny\"\n          onClick={handleViewResultsClick}\n        >\n          {lang('PollViewResults')}\n        </Button>\n      )}\n    </div>\n  );\n};\n\nfunction getPollTypeString(summary: ApiPoll['summary']) {\n  // When we just created the poll, some properties don't exist.\n  if (typeof summary.isPublic === 'undefined') {\n    return NBSP;\n  }\n\n  if (summary.closed) {\n    return 'FinalResults';\n  }\n\n  if (summary.quiz) {\n    return summary.isPublic ? 'QuizPoll' : 'AnonymousQuizPoll';\n  }\n\n  return summary.isPublic ? 'PublicPoll' : 'AnonymousPoll';\n}\n\nfunction getReadableVotersCount(lang: OldLangFn, isQuiz: true | undefined, count?: number) {\n  if (!count) {\n    return lang(isQuiz ? 'Chat.Quiz.TotalVotesEmpty' : 'Chat.Poll.TotalVotesResultEmpty');\n  }\n\n  return lang(isQuiz ? 'Answer' : 'Vote', count, 'i');\n}\n\nfunction stopPropagation(e: React.MouseEvent<HTMLDivElement>) {\n  e.stopPropagation();\n}\n\nexport default memo(Poll);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"FPceNkgD\",\"inactive\":\"hruUWBuj\",\"mirrored\":\"GydRBA08\",\"effect\":\"WMMaWlOL\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { useEffect, useRef } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMessage } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport { ApiMediaFormat } from '../../../api/types';\n\nimport { getStickerMediaHash } from '../../../global/helpers';\nimport { IS_WEBM_SUPPORTED } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { getStickerDimensions } from '../../common/helpers/mediaDimensions';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useFlag from '../../../hooks/useFlag';\nimport { useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useOverlayPosition from './hooks/useOverlayPosition';\n\nimport AnimatedSticker from '../../common/AnimatedSticker';\nimport StickerView from '../../common/StickerView';\nimport Portal from '../../ui/Portal';\n\nimport styles from './Sticker.module.scss';\n\n// https://github.com/telegramdesktop/tdesktop/blob/master/Telegram/SourceFiles/history/view/media/history_view_sticker.cpp#L42\nconst EFFECT_SIZE_MULTIPLIER = 1 + 0.245 * 2;\n\ntype OwnProps = {\n  message: ApiMessage;\n  observeIntersection: ObserveFn;\n  observeIntersectionForPlaying: ObserveFn;\n  shouldLoop?: boolean;\n  shouldPlayEffect?: boolean;\n  withEffect?: boolean;\n  onStopEffect?: VoidFunction;\n};\n\nconst Sticker: FC<OwnProps> = ({\n  message, observeIntersection, observeIntersectionForPlaying, shouldLoop,\n  shouldPlayEffect, withEffect, onStopEffect,\n}) => {\n  const { showNotification, openStickerSet } = getActions();\n\n  const lang = useOldLang();\n  const { isMobile } = useAppLayout();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  // eslint-disable-next-line no-null/no-null\n  const effectRef = useRef<HTMLDivElement>(null);\n\n  const sticker = message.content.sticker!;\n  const { stickerSetInfo, isVideo, hasEffect } = sticker;\n  const isMirrored = !message.isOutgoing;\n\n  const mediaHash = sticker.isPreloadedGlobally ? undefined : (\n    getStickerMediaHash(sticker, isVideo && !IS_WEBM_SUPPORTED ? 'pictogram' : 'inline')!\n  );\n\n  const canLoad = useIsIntersecting(ref, observeIntersection);\n  const canPlay = useIsIntersecting(ref, observeIntersectionForPlaying);\n  const mediaHashEffect = `sticker${sticker.id}?size=f`;\n  const effectBlobUrl = useMedia(\n    mediaHashEffect,\n    !canLoad || !hasEffect || !withEffect,\n    ApiMediaFormat.BlobUrl,\n  );\n  const [isPlayingEffect, startPlayingEffect, stopPlayingEffect] = useFlag();\n\n  const handleEffectEnded = useLastCallback(() => {\n    stopPlayingEffect();\n    onStopEffect?.();\n  });\n\n  useEffect(() => {\n    if (hasEffect && withEffect && canPlay && shouldPlayEffect) {\n      startPlayingEffect();\n    }\n  }, [hasEffect, canPlay, shouldPlayEffect, startPlayingEffect, withEffect]);\n\n  const shouldRenderEffect = hasEffect && withEffect && effectBlobUrl && isPlayingEffect;\n  useOverlayPosition({\n    anchorRef: ref,\n    overlayRef: effectRef,\n    isMirrored,\n    isDisabled: !shouldRenderEffect,\n  });\n\n  const openModal = useLastCallback(() => {\n    openStickerSet({\n      stickerSetInfo: sticker.stickerSetInfo,\n    });\n  });\n\n  const handleClick = useLastCallback(() => {\n    if (hasEffect) {\n      if (isPlayingEffect || !withEffect) {\n        showNotification({\n          message: lang('PremiumStickerTooltip'),\n          action: {\n            action: 'openStickerSet',\n            payload: {\n              stickerSetInfo: sticker.stickerSetInfo,\n            },\n          },\n          actionText: lang('ViewAction'),\n        });\n        return;\n      } else if (withEffect) {\n        startPlayingEffect();\n        return;\n      }\n    }\n    openModal();\n  });\n\n  const isMemojiSticker = 'isMissing' in stickerSetInfo;\n  const { width, height } = getStickerDimensions(sticker, isMobile);\n  const className = buildClassName(\n    'media-inner',\n    styles.root,\n    isMemojiSticker && styles.inactive,\n    hasEffect && isMirrored && styles.mirrored,\n  );\n\n  return (\n    <div\n      ref={ref}\n      className={className}\n      style={`width: ${width}px; height: ${height}px;`}\n      onClick={!isMemojiSticker ? handleClick : undefined}\n    >\n      <StickerView\n        containerRef={ref}\n        sticker={sticker}\n        fullMediaHash={mediaHash}\n        fullMediaClassName=\"full-media\"\n        size={width}\n        shouldLoop={shouldLoop}\n        noLoad={!canLoad}\n        noPlay={!canPlay}\n        withSharedAnimation\n      />\n      {shouldRenderEffect && (\n        <Portal>\n          <AnimatedSticker\n            ref={effectRef}\n            key={mediaHashEffect}\n            className={buildClassName(styles.effect, isMirrored && styles.mirrored)}\n            tgsUrl={effectBlobUrl}\n            size={width * EFFECT_SIZE_MULTIPLIER}\n            play\n            isLowPriority\n            noLoop\n            onEnded={handleEffectEnded}\n          />\n        </Portal>\n      )}\n    </div>\n  );\n};\n\nexport default Sticker;\n","import React, { memo } from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../global';\n\nimport type {\n  ApiMessage, ApiTypeStory,\n} from '../../../api/types';\n\nimport { selectPeerStory } from '../../../global/selectors';\n\nimport BaseStory from './BaseStory';\n\ninterface OwnProps {\n  message: ApiMessage;\n  isProtected?: boolean;\n}\n\ninterface StateProps {\n  story?: ApiTypeStory;\n  isConnected?: boolean;\n}\n\nfunction Story({\n  message, story, isProtected, isConnected,\n}: OwnProps & StateProps) {\n  const { storyData } = message.content;\n\n  return (\n    <BaseStory\n      story={story || storyData}\n      isProtected={isProtected}\n      isConnected={isConnected}\n    />\n  );\n}\n\nexport default memo(withGlobal<OwnProps>((global, { message }): StateProps => {\n  const { id, peerId } = message.content.storyData!;\n\n  return {\n    story: selectPeerStory(global, peerId, id),\n    isConnected: global.connectionState === 'connectionStateReady',\n  };\n})(Story));\n","import React, { memo } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type {\n  ApiMessage, ApiPeer, ApiTypeStory, ApiUser,\n} from '../../../api/types';\n\nimport { getStoryMediaHash, getUserFirstOrLastName } from '../../../global/helpers';\nimport { getPeerTitle } from '../../../global/helpers/peers';\nimport {\n  selectPeer,\n  selectPeerStories,\n  selectPeerStory,\n  selectUser,\n} from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport renderText from '../../common/helpers/renderText';\n\nimport useEnsureStory from '../../../hooks/useEnsureStory';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\n\ninterface OwnProps {\n  message: ApiMessage;\n}\n\ninterface StateProps {\n  story?: ApiTypeStory;\n  peer?: ApiPeer;\n  targetUser?: ApiUser;\n  isUnread?: boolean;\n}\n\nfunction StoryMention({\n  message, story, peer, isUnread, targetUser,\n}: OwnProps & StateProps) {\n  const { openStoryViewer } = getActions();\n\n  const lang = useOldLang();\n\n  const { storyData } = message.content;\n\n  const handleClick = useLastCallback(() => {\n    openStoryViewer({\n      peerId: story!.peerId,\n      storyId: story!.id,\n      isSinglePeer: true,\n      isSingleStory: true,\n    });\n  });\n\n  const isDeleted = story && 'isDeleted' in story;\n  const isLoaded = story && 'content' in story;\n  const video = isLoaded ? story.content.video : undefined;\n  const imageHash = isLoaded\n    ? getStoryMediaHash(story, 'pictogram')\n    : undefined;\n  const imgBlobUrl = useMedia(imageHash);\n  const thumbUrl = imgBlobUrl || video?.thumbnail?.dataUri;\n\n  useEnsureStory(storyData!.peerId, storyData!.id, story);\n\n  function getTitle() {\n    if (peer && 'isSelf' in peer && peer.isSelf) {\n      return isDeleted\n        ? lang('ExpiredStoryMentioned', getUserFirstOrLastName(targetUser))\n        : lang('StoryYouMentionedTitle', getUserFirstOrLastName(targetUser));\n    }\n\n    return isDeleted\n      ? lang('ExpiredStoryMention')\n      : lang('StoryMentionedTitle', getPeerTitle(lang, peer!));\n  }\n\n  return (\n    <div\n      className={buildClassName('action-message-story-mention', isUnread && 'is-unread', isLoaded && 'with-preview')}\n      tabIndex={0}\n      role=\"button\"\n      onClick={isLoaded ? handleClick : undefined}\n    >\n      {isLoaded && (\n        <span className=\"story-media-wrapper\">\n          {thumbUrl && (\n            <img src={thumbUrl} alt=\"\" className=\"story-media\" />\n          )}\n        </span>\n      )}\n\n      <span className=\"story-title\">{renderText(getTitle(), ['emoji', 'simple_markdown'])}</span>\n    </div>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>((global, { message }): StateProps => {\n  const { id, peerId } = message.content.storyData!;\n  const lastReadId = selectPeerStories(global, peerId)?.lastReadId;\n\n  return {\n    story: selectPeerStory(global, peerId, id),\n    peer: selectPeer(global, peerId),\n    targetUser: selectUser(global, message.chatId),\n    isUnread: Boolean(lastReadId && lastReadId < id),\n  };\n})(StoryMention));\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  useUnmountCleanup,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type {\n  ApiAvailableEffect,\n  ApiAvailableReaction,\n  ApiChat,\n  ApiChatMember,\n  ApiMessage,\n  ApiMessageOutgoingStatus,\n  ApiPeer,\n  ApiPoll,\n  ApiReaction,\n  ApiReactionKey,\n  ApiSavedReactionTag,\n  ApiThreadInfo,\n  ApiTopic,\n  ApiTypeStory,\n  ApiUser,\n} from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type {\n  ActiveEmojiInteraction,\n  ChatTranslatedMessages,\n  FocusDirection,\n  IAlbum,\n  MessageListType,\n  ScrollTargetPosition,\n  ThemeKey,\n  ThreadId,\n} from '../../../types';\nimport type { Signal } from '../../../util/signals';\nimport type { OnIntersectPinnedMessage } from '../hooks/usePinnedMessage';\nimport { MAIN_THREAD_ID } from '../../../api/types';\nimport { AudioOrigin } from '../../../types';\n\nimport { EMOJI_STATUS_LOOP_LIMIT, MESSAGE_APPEARANCE_DELAY } from '../../../config';\nimport {\n  areReactionsEmpty,\n  getIsDownloading,\n  getMessageContent,\n  getMessageCustomShape,\n  getMessageDownloadableMedia,\n  getMessageHtmlId,\n  getMessageSingleCustomEmoji,\n  getMessageSingleRegularEmoji,\n  hasMessageText,\n  hasMessageTtl,\n  isAnonymousForwardsChat,\n  isAnonymousOwnMessage,\n  isChatChannel,\n  isChatGroup,\n  isChatPublic,\n  isGeoLiveExpired,\n  isMessageLocal,\n  isMessageTranslatable,\n  isOwnMessage,\n  isReplyToMessage,\n  isSystemBot,\n  isUserId,\n} from '../../../global/helpers';\nimport { getPeerFullTitle } from '../../../global/helpers/peers';\nimport { getMessageReplyInfo, getStoryReplyInfo } from '../../../global/helpers/replies';\nimport {\n  selectActiveDownloads,\n  selectAnimatedEmoji,\n  selectCanAutoLoadMedia,\n  selectCanAutoPlayMedia,\n  selectCanReplyToMessage,\n  selectChat,\n  selectChatFullInfo,\n  selectChatMessage,\n  selectChatTranslations,\n  selectCurrentMiddleSearch,\n  selectDefaultReaction,\n  selectForwardedSender,\n  selectIsChatProtected,\n  selectIsChatWithSelf,\n  selectIsCurrentUserFrozen,\n  selectIsCurrentUserPremium,\n  selectIsDocumentGroupSelected,\n  selectIsInSelectMode,\n  selectIsMessageFocused,\n  selectIsMessageProtected,\n  selectIsMessageSelected,\n  selectMessageIdsByGroupId,\n  selectMessageLastPlaybackTimestamp,\n  selectMessageTimestampableDuration,\n  selectMessageTranslations,\n  selectOutgoingStatus,\n  selectPeer,\n  selectPeerStory,\n  selectPerformanceSettingsValue,\n  selectPollFromMessage,\n  selectReplyMessage,\n  selectRequestedChatTranslationLanguage,\n  selectRequestedMessageTranslationLanguage,\n  selectSender,\n  selectSenderFromHeader,\n  selectShouldDetectChatLanguage,\n  selectShouldLoopStickers,\n  selectTabState,\n  selectTheme,\n  selectThreadInfo,\n  selectTopicFromMessage,\n  selectUploadProgress,\n  selectUser,\n} from '../../../global/selectors';\nimport { selectSharedSettings } from '../../../global/selectors/sharedState';\nimport { IS_ANDROID, IS_ELECTRON, IS_TRANSLATION_SUPPORTED } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { getMessageKey } from '../../../util/keys/messageKey';\nimport stopEvent from '../../../util/stopEvent';\nimport { isElementInViewport } from '../../../util/visibility/isElementInViewport';\nimport { calculateDimensionsForMessageMedia, getStickerDimensions, REM } from '../../common/helpers/mediaDimensions';\nimport { getPeerColorClass } from '../../common/helpers/peerColor';\nimport renderText from '../../common/helpers/renderText';\nimport { getCustomEmojiSize } from '../composer/helpers/customEmoji';\nimport { buildContentClassName } from './helpers/buildContentClassName';\nimport { calculateAlbumLayout } from './helpers/calculateAlbumLayout';\nimport getSingularPaidMedia from './helpers/getSingularPaidMedia';\nimport { calculateMediaDimensions, getMinMediaWidth, MIN_MEDIA_WIDTH_WITH_TEXT } from './helpers/mediaDimensions';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useContextMenuHandlers from '../../../hooks/useContextMenuHandlers';\nimport useEnsureMessage from '../../../hooks/useEnsureMessage';\nimport useEnsureStory from '../../../hooks/useEnsureStory';\nimport useFlag from '../../../hooks/useFlag';\nimport { useOnIntersect } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\nimport usePreviousDeprecated from '../../../hooks/usePreviousDeprecated';\nimport useMessageResizeObserver from '../../../hooks/useResizeMessageObserver';\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport useTextLanguage from '../../../hooks/useTextLanguage';\nimport useDetectChatLanguage from './hooks/useDetectChatLanguage';\nimport useFocusMessage from './hooks/useFocusMessage';\nimport useInnerHandlers from './hooks/useInnerHandlers';\nimport useMessageTranslation from './hooks/useMessageTranslation';\nimport useOuterHandlers from './hooks/useOuterHandlers';\n\nimport Audio from '../../common/Audio';\nimport Avatar from '../../common/Avatar';\nimport CustomEmoji from '../../common/CustomEmoji';\nimport Document from '../../common/Document';\nimport DotAnimation from '../../common/DotAnimation';\nimport EmbeddedMessage from '../../common/embedded/EmbeddedMessage';\nimport EmbeddedStory from '../../common/embedded/EmbeddedStory';\nimport FakeIcon from '../../common/FakeIcon';\nimport Icon from '../../common/icons/Icon';\nimport StarIcon from '../../common/icons/StarIcon';\nimport MessageText from '../../common/MessageText';\nimport ReactionStaticEmoji from '../../common/reactions/ReactionStaticEmoji';\nimport TopicChip from '../../common/TopicChip';\nimport { animateSnap } from '../../main/visualEffects/SnapEffectContainer';\nimport Button from '../../ui/Button';\nimport Album from './Album';\nimport AnimatedCustomEmoji from './AnimatedCustomEmoji';\nimport AnimatedEmoji from './AnimatedEmoji';\nimport CommentButton from './CommentButton';\nimport Contact from './Contact';\nimport ContextMenuContainer from './ContextMenuContainer.async';\nimport FactCheck from './FactCheck';\nimport Game from './Game';\nimport Giveaway from './Giveaway';\nimport InlineButtons from './InlineButtons';\nimport Invoice from './Invoice';\nimport InvoiceMediaPreview from './InvoiceMediaPreview';\nimport Location from './Location';\nimport MessageAppendix from './MessageAppendix';\nimport MessageEffect from './MessageEffect';\nimport MessageMeta from './MessageMeta';\nimport MessagePhoneCall from './MessagePhoneCall';\nimport PaidMediaOverlay from './PaidMediaOverlay';\nimport Photo from './Photo';\nimport Poll from './Poll';\nimport Reactions from './reactions/Reactions';\nimport RoundVideo from './RoundVideo';\nimport Sticker from './Sticker';\nimport Story from './Story';\nimport StoryMention from './StoryMention';\nimport Video from './Video';\nimport WebPage from './WebPage';\n\nimport './Message.scss';\n\ntype MessagePositionProperties = {\n  isFirstInGroup: boolean;\n  isLastInGroup: boolean;\n  isFirstInDocumentGroup: boolean;\n  isLastInDocumentGroup: boolean;\n  isLastInList: boolean;\n};\n\ntype OwnProps =\n  {\n    message: ApiMessage;\n    observeIntersectionForBottom?: ObserveFn;\n    observeIntersectionForLoading?: ObserveFn;\n    observeIntersectionForPlaying?: ObserveFn;\n    album?: IAlbum;\n    noAvatars?: boolean;\n    withAvatar?: boolean;\n    withSenderName?: boolean;\n    threadId: ThreadId;\n    messageListType: MessageListType;\n    noComments: boolean;\n    noReplies: boolean;\n    appearanceOrder: number;\n    isJustAdded: boolean;\n    memoFirstUnreadIdRef?: { current: number | undefined };\n    getIsMessageListReady?: Signal<boolean>;\n    onIntersectPinnedMessage?: OnIntersectPinnedMessage;\n  }\n  & MessagePositionProperties;\n\ntype StateProps = {\n  theme: ThemeKey;\n  forceSenderName?: boolean;\n  sender?: ApiPeer;\n  canShowSender: boolean;\n  originSender?: ApiPeer;\n  botSender?: ApiUser;\n  isThreadTop?: boolean;\n  shouldHideReply?: boolean;\n  replyMessage?: ApiMessage;\n  replyMessageSender?: ApiPeer;\n  replyMessageForwardSender?: ApiPeer;\n  replyMessageChat?: ApiChat;\n  isReplyPrivate?: boolean;\n  replyStory?: ApiTypeStory;\n  storySender?: ApiPeer;\n  outgoingStatus?: ApiMessageOutgoingStatus;\n  uploadProgress?: number;\n  isInDocumentGroup: boolean;\n  isProtected?: boolean;\n  isChatProtected?: boolean;\n  isFocused?: boolean;\n  focusDirection?: FocusDirection;\n  focusedQuote?: string;\n  focusedQuoteOffset?: number;\n  noFocusHighlight?: boolean;\n  scrollTargetPosition?: ScrollTargetPosition;\n  isResizingContainer?: boolean;\n  isForwarding?: boolean;\n  isChatWithSelf?: boolean;\n  isRepliesChat?: boolean;\n  isAnonymousForwards?: boolean;\n  isChannel?: boolean;\n  isGroup?: boolean;\n  canReply?: boolean;\n  highlight?: string;\n  animatedEmoji?: string;\n  animatedCustomEmoji?: string;\n  hasActiveReactions?: boolean;\n  isInSelectMode?: boolean;\n  isSelected?: boolean;\n  isGroupSelected?: boolean;\n  isDownloading?: boolean;\n  threadId?: ThreadId;\n  isPinnedList?: boolean;\n  isPinned?: boolean;\n  canAutoLoadMedia?: boolean;\n  canAutoPlayMedia?: boolean;\n  hasLinkedChat?: boolean;\n  shouldLoopStickers?: boolean;\n  autoLoadFileMaxSizeMb: number;\n  repliesThreadInfo?: ApiThreadInfo;\n  reactionMessage?: ApiMessage;\n  availableReactions?: ApiAvailableReaction[];\n  defaultReaction?: ApiReaction;\n  activeEmojiInteractions?: ActiveEmojiInteraction[];\n  hasUnreadReaction?: boolean;\n  isTranscribing?: boolean;\n  transcribedText?: string;\n  isTranscriptionError?: boolean;\n  hasTranslation?: boolean;\n  isPremium: boolean;\n  senderAdminMember?: ApiChatMember;\n  messageTopic?: ApiTopic;\n  hasTopicChip?: boolean;\n  chatTranslations?: ChatTranslatedMessages;\n  areTranslationsEnabled?: boolean;\n  shouldDetectChatLanguage?: boolean;\n  requestedTranslationLanguage?: string;\n  autoTranslate?: boolean;\n  requestedChatTranslationLanguage?: string;\n  withAnimatedEffects?: boolean;\n  webPageStory?: ApiTypeStory;\n  isConnected: boolean;\n  isLoadingComments?: boolean;\n  shouldWarnAboutSvg?: boolean;\n  senderBoosts?: number;\n  tags?: Record<ApiReactionKey, ApiSavedReactionTag>;\n  canTranscribeVoice?: boolean;\n  viaBusinessBot?: ApiUser;\n  effect?: ApiAvailableEffect;\n  poll?: ApiPoll;\n  maxTimestamp?: number;\n  lastPlaybackTimestamp?: number;\n  paidMessageStars?: number;\n  isChatWithUser?: boolean;\n  isAccountFrozen?: boolean;\n};\n\ntype MetaPosition =\n  'in-text'\n  | 'standalone'\n  | 'none';\ntype ReactionsPosition =\n  'inside'\n  | 'outside'\n  | 'none';\ntype QuickReactionPosition =\n  'in-content'\n  | 'in-meta';\n\nconst NBSP = '\\u00A0';\nconst NO_MEDIA_CORNERS_THRESHOLD = 18;\nconst QUICK_REACTION_SIZE = 1.75 * REM;\nconst EXTRA_SPACE_FOR_REACTIONS = 2.25 * REM;\n\nconst Message: FC<OwnProps & StateProps> = ({\n  message,\n  observeIntersectionForBottom,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  album,\n  noAvatars,\n  withAvatar,\n  withSenderName,\n  noComments,\n  noReplies,\n  appearanceOrder,\n  isJustAdded,\n  isFirstInGroup,\n  isPremium,\n  isLastInGroup,\n  isFirstInDocumentGroup,\n  isLastInDocumentGroup,\n  isTranscribing,\n  transcribedText,\n  hasTranslation,\n  isLastInList,\n  theme,\n  forceSenderName,\n  sender,\n  canShowSender,\n  originSender,\n  botSender,\n  isThreadTop,\n  shouldHideReply,\n  replyMessage,\n  replyMessageSender,\n  replyMessageForwardSender,\n  replyMessageChat,\n  replyStory,\n  isReplyPrivate,\n  storySender,\n  outgoingStatus,\n  uploadProgress,\n  isInDocumentGroup,\n  isLoadingComments,\n  isProtected,\n  isChatProtected,\n  isFocused,\n  focusDirection,\n  focusedQuote,\n  focusedQuoteOffset,\n  noFocusHighlight,\n  scrollTargetPosition,\n  isResizingContainer,\n  isForwarding,\n  isChatWithSelf,\n  isRepliesChat,\n  isAnonymousForwards,\n  isChannel,\n  isGroup,\n  canReply,\n  highlight,\n  animatedEmoji,\n  animatedCustomEmoji,\n  hasActiveReactions,\n  hasLinkedChat,\n  isInSelectMode,\n  isSelected,\n  isGroupSelected,\n  threadId,\n  reactionMessage,\n  availableReactions,\n  defaultReaction,\n  activeEmojiInteractions,\n  messageListType,\n  isPinnedList,\n  isPinned,\n  isDownloading,\n  canAutoLoadMedia,\n  canAutoPlayMedia,\n  shouldLoopStickers,\n  autoLoadFileMaxSizeMb,\n  repliesThreadInfo,\n  hasUnreadReaction,\n  memoFirstUnreadIdRef,\n  senderAdminMember,\n  messageTopic,\n  hasTopicChip,\n  chatTranslations,\n  areTranslationsEnabled,\n  shouldDetectChatLanguage,\n  requestedTranslationLanguage,\n  autoTranslate,\n  requestedChatTranslationLanguage,\n  withAnimatedEffects,\n  webPageStory,\n  isConnected,\n  getIsMessageListReady,\n  shouldWarnAboutSvg,\n  senderBoosts,\n  tags,\n  canTranscribeVoice,\n  viaBusinessBot,\n  effect,\n  poll,\n  maxTimestamp,\n  lastPlaybackTimestamp,\n  onIntersectPinnedMessage,\n  paidMessageStars,\n  isChatWithUser,\n  isAccountFrozen,\n}) => {\n  const {\n    toggleMessageSelection,\n    clickBotInlineButton,\n    disableContextMenuHint,\n    animateUnreadReaction,\n    focusLastMessage,\n    markMentionsRead,\n    requestMessageTranslation,\n  } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const bottomMarkerRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const quickReactionRef = useRef<HTMLDivElement>(null);\n\n  const lang = useOldLang();\n\n  const [isTranscriptionHidden, setTranscriptionHidden] = useState(false);\n  const [isPlayingSnapAnimation, setIsPlayingSnapAnimation] = useState(false);\n  const [isPlayingDeleteAnimation, setIsPlayingDeleteAnimation] = useState(false);\n  const [shouldPlayEffect, requestEffect, hideEffect] = useFlag();\n  const { isMobile, isTouchScreen } = useAppLayout();\n\n  useOnIntersect(bottomMarkerRef, observeIntersectionForBottom);\n\n  const {\n    isContextMenuOpen,\n    contextMenuAnchor,\n    contextMenuTarget,\n    handleBeforeContextMenu,\n    handleContextMenu: onContextMenu,\n    handleContextMenuClose,\n    handleContextMenuHide,\n  } = useContextMenuHandlers(\n    ref,\n    (isTouchScreen && isInSelectMode) || isAccountFrozen,\n    !IS_ELECTRON,\n    IS_ANDROID,\n    getIsMessageListReady,\n  );\n\n  useEffect(() => {\n    if (isContextMenuOpen) {\n      disableContextMenuHint();\n    }\n  }, [isContextMenuOpen, disableContextMenuHint]);\n\n  const noAppearanceAnimation = appearanceOrder <= 0;\n  const [isShown, markShown] = useFlag(noAppearanceAnimation);\n  useEffect(() => {\n    if (noAppearanceAnimation) {\n      return;\n    }\n\n    setTimeout(markShown, appearanceOrder * MESSAGE_APPEARANCE_DELAY);\n  }, [appearanceOrder, markShown, noAppearanceAnimation]);\n\n  useShowTransition({\n    ref,\n    isOpen: isShown || isJustAdded,\n    noMountTransition: noAppearanceAnimation && !isJustAdded,\n    className: false,\n  });\n\n  const {\n    id: messageId, chatId, forwardInfo, viaBotId, isTranscriptionError, factCheck,\n  } = message;\n\n  useUnmountCleanup(() => {\n    if (message.isPinned) {\n      const id = album ? album.mainMessage.id : messageId;\n      onIntersectPinnedMessage?.({ viewportPinnedIdsToRemove: [id] });\n    }\n  });\n\n  const isLocal = isMessageLocal(message);\n  const isOwn = isOwnMessage(message);\n  const isScheduled = messageListType === 'scheduled' || message.isScheduled;\n  const hasMessageReply = isReplyToMessage(message) && !shouldHideReply;\n\n  const { paidMedia } = getMessageContent(message);\n  const { photo: paidMediaPhoto, video: paidMediaVideo } = getSingularPaidMedia(paidMedia);\n\n  const {\n    photo = paidMediaPhoto, video = paidMediaVideo, audio,\n    voice, document, sticker, contact,\n    webPage, invoice, location,\n    action, game, storyData, giveaway,\n    giveawayResults,\n  } = getMessageContent(message);\n\n  const messageReplyInfo = getMessageReplyInfo(message);\n  const storyReplyInfo = getStoryReplyInfo(message);\n\n  const withVoiceTranscription = Boolean(!isTranscriptionHidden && (isTranscriptionError || transcribedText));\n\n  const hasStoryReply = Boolean(storyReplyInfo);\n  const hasThread = Boolean(repliesThreadInfo) && messageListType === 'thread';\n  const isCustomShape = !withVoiceTranscription && getMessageCustomShape(message);\n  const hasAnimatedEmoji = isCustomShape && (animatedEmoji || animatedCustomEmoji);\n  const hasReactions = reactionMessage?.reactions && !areReactionsEmpty(reactionMessage.reactions);\n  const asForwarded = (\n    forwardInfo\n    && (!isChatWithSelf || isScheduled)\n    && !isRepliesChat\n    && !forwardInfo.isLinkedChannelPost\n    && !isAnonymousForwards\n    && !botSender\n  ) || Boolean(storyData && !storyData.isMention);\n  const canShowSenderBoosts = Boolean(senderBoosts) && !asForwarded && isFirstInGroup;\n  const isStoryMention = storyData?.isMention;\n  const isRoundVideo = video?.mediaType === 'video' && video.isRound;\n  const isAlbum = Boolean(album)\n    && (\n      (album.isPaidMedia && paidMedia!.extendedMedia.length > 1)\n      || album.messages.length > 1\n    ) && !album.messages.some((msg) => Object.keys(msg.content).length === 0);\n  const isInDocumentGroupNotFirst = isInDocumentGroup && !isFirstInDocumentGroup;\n  const isInDocumentGroupNotLast = isInDocumentGroup && !isLastInDocumentGroup;\n  const isContextMenuShown = contextMenuAnchor !== undefined;\n  const canShowActionButton = (\n    !(isContextMenuShown || isInSelectMode || isForwarding)\n    && !isInDocumentGroupNotLast\n    && !isStoryMention\n    && !((sticker || hasAnimatedEmoji) && asForwarded)\n  );\n  const canForward = isChannel && !isScheduled && message.isForwardingAllowed\n  && !isChatProtected;\n  const canFocus = Boolean(isPinnedList\n    || (forwardInfo\n      && (forwardInfo.isChannelPost || isChatWithSelf || isRepliesChat || isAnonymousForwards)\n      && forwardInfo.fromMessageId\n    ));\n\n  const hasFactCheck = Boolean(factCheck?.text);\n\n  const hasForwardedCustomShape = asForwarded && isCustomShape;\n  const hasSubheader = hasTopicChip || hasMessageReply || hasStoryReply || hasForwardedCustomShape;\n\n  const selectMessage = useLastCallback((e?: React.MouseEvent<HTMLDivElement, MouseEvent>, groupedId?: string) => {\n    if (isAccountFrozen) return;\n    toggleMessageSelection({\n      messageId,\n      groupedId,\n      ...(e?.shiftKey && { withShift: true }),\n      ...(isAlbum && { childMessageIds: album!.messages.map(({ id }) => id) }),\n    });\n  });\n\n  const messageSender = canShowSender ? sender : undefined;\n\n  const shouldPreferOriginSender = forwardInfo\n    && (isChatWithSelf || isRepliesChat || isAnonymousForwards || !messageSender);\n  const avatarPeer = shouldPreferOriginSender ? originSender : messageSender;\n\n  const messageColorPeer = asForwarded ? originSender : sender;\n  const noUserColors = isOwn && !isCustomShape;\n\n  const senderPeer = (forwardInfo || storyData) ? originSender : messageSender;\n  const hasTtl = hasMessageTtl(message);\n\n  const {\n    handleMouseDown,\n    handleClick,\n    handleContextMenu,\n    handleDoubleClick,\n    handleContentDoubleClick,\n    handleMouseMove,\n    handleSendQuickReaction,\n    handleMouseLeave,\n    isSwiped,\n    isQuickReactionVisible,\n    handleDocumentGroupMouseEnter,\n  } = useOuterHandlers(\n    selectMessage,\n    ref,\n    messageId,\n    Boolean(isInSelectMode),\n    Boolean(canReply),\n    Boolean(isProtected),\n    onContextMenu,\n    handleBeforeContextMenu,\n    chatId,\n    isContextMenuShown,\n    quickReactionRef,\n    isInDocumentGroupNotLast,\n    getIsMessageListReady,\n  );\n\n  const {\n    handleSenderClick,\n    handleViaBotClick,\n    handleReplyClick,\n    handleMediaClick,\n    handleDocumentClick,\n    handleAudioPlay,\n    handleAlbumMediaClick,\n    handlePhotoMediaClick,\n    handleVideoMediaClick,\n    handleMetaClick,\n    handleTranslationClick,\n    handleOpenThread,\n    handleReadMedia,\n    handleCancelUpload,\n    handleVoteSend,\n    handleGroupForward,\n    handleForward,\n    handleFocus,\n    handleFocusForwarded,\n    handleDocumentGroupSelectAll,\n    handleTopicChipClick,\n    handleStoryClick,\n  } = useInnerHandlers({\n    lang,\n    selectMessage,\n    message,\n    chatId,\n    threadId,\n    isInDocumentGroup,\n    asForwarded,\n    isScheduled,\n    album,\n    avatarPeer,\n    senderPeer,\n    botSender,\n    messageTopic,\n    isTranslatingChat: Boolean(requestedChatTranslationLanguage),\n    story: replyStory && 'content' in replyStory ? replyStory : undefined,\n    isReplyPrivate,\n    isRepliesChat,\n    isSavedMessages: isChatWithSelf,\n    lastPlaybackTimestamp,\n  });\n\n  const handleEffectClick = useLastCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n\n    requestEffect();\n  });\n\n  useEffect(() => {\n    if (!isLastInList) {\n      return;\n    }\n\n    if (withVoiceTranscription && transcribedText) {\n      focusLastMessage();\n    }\n  }, [focusLastMessage, isLastInList, transcribedText, withVoiceTranscription]);\n\n  useEffect(() => {\n    const element = ref.current;\n    const isPartialAlbumDelete = message.isInAlbum && album?.messages.some((msg) => !msg.isDeleting);\n    if (message.isDeleting && element && !isPartialAlbumDelete) {\n      if (animateSnap(element)) {\n        setIsPlayingSnapAnimation(true);\n      } else {\n        setIsPlayingDeleteAnimation(true);\n      }\n    }\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps -- Only start animation on `isDeleting` change\n  }, [message.isDeleting]);\n\n  const textMessage = album?.hasMultipleCaptions ? undefined : (album?.captionMessage || message);\n  const hasTextContent = textMessage && hasMessageText(textMessage);\n  const hasText = hasTextContent || hasFactCheck;\n\n  const containerClassName = buildClassName(\n    'Message message-list-item',\n    isFirstInGroup && 'first-in-group',\n    isProtected && 'hide-on-print',\n    isProtected && !hasTextContent ? 'is-protected' : 'allow-selection',\n    isLastInGroup && 'last-in-group',\n    isFirstInDocumentGroup && 'first-in-document-group',\n    isLastInDocumentGroup && 'last-in-document-group',\n    isLastInList && 'last-in-list',\n    isOwn && 'own',\n    Boolean(message.viewsCount) && 'has-views',\n    message.isEdited && 'was-edited',\n    hasMessageReply && 'has-reply',\n    isContextMenuOpen && 'has-menu-open',\n    isFocused && !noFocusHighlight && 'focused',\n    isForwarding && 'is-forwarding',\n    isPlayingDeleteAnimation && 'is-deleting',\n    isPlayingSnapAnimation && 'is-dissolving',\n    isInDocumentGroup && 'is-in-document-group',\n    isAlbum && 'is-album',\n    message.hasUnreadMention && 'has-unread-mention',\n    isSelected && 'is-selected',\n    isInSelectMode && 'is-in-selection-mode',\n    isThreadTop && !withAvatar && 'is-thread-top',\n    Boolean(message.inlineButtons) && 'has-inline-buttons',\n    isSwiped && 'is-swiped',\n    isJustAdded && 'is-just-added',\n    (hasActiveReactions || shouldPlayEffect) && 'has-active-effect',\n    isStoryMention && 'is-story-mention',\n    !canShowActionButton && 'no-action-button',\n  );\n\n  const text = textMessage && getMessageContent(textMessage).text;\n  const isInvertedMedia = Boolean(message.isInvertedMedia);\n\n  const { replyToMsgId, replyToPeerId, isQuote } = messageReplyInfo || {};\n  const { peerId: storyReplyPeerId, storyId: storyReplyId } = storyReplyInfo || {};\n\n  useEffect(() => {\n    if ((sticker?.hasEffect || effect) && ((\n      memoFirstUnreadIdRef?.current && messageId >= memoFirstUnreadIdRef.current\n    ) || isLocal)) {\n      requestEffect();\n    }\n  }, [effect, isLocal, memoFirstUnreadIdRef, messageId, sticker?.hasEffect]);\n\n  const detectedLanguage = useTextLanguage(\n    text?.text,\n    !(areTranslationsEnabled || shouldDetectChatLanguage),\n    getIsMessageListReady,\n  );\n  useDetectChatLanguage(message, detectedLanguage, !shouldDetectChatLanguage, getIsMessageListReady);\n  const shouldTranslate = isMessageTranslatable(message, !requestedChatTranslationLanguage);\n  const { isPending: isTranslationPending, translatedText } = useMessageTranslation(\n    chatTranslations, chatId, shouldTranslate ? messageId : undefined, requestedTranslationLanguage,\n  );\n  // Used to display previous result while new one is loading\n  const previousTranslatedText = usePreviousDeprecated(translatedText, Boolean(shouldTranslate));\n\n  const currentTranslatedText = translatedText || previousTranslatedText;\n\n  const phoneCall = action?.type === 'phoneCall' ? action : undefined;\n\n  const isMediaWithCommentButton = (repliesThreadInfo || (hasLinkedChat && isChannel && isLocal))\n    && !isInDocumentGroupNotLast\n    && messageListType === 'thread'\n    && !noComments;\n  const withCommentButton = repliesThreadInfo?.isCommentsInfo\n    && !isInDocumentGroupNotLast && messageListType === 'thread'\n    && !noComments;\n  const withQuickReactionButton = !isTouchScreen && !phoneCall && !isInSelectMode && defaultReaction\n    && !isInDocumentGroupNotLast && !isStoryMention && !hasTtl && !isAccountFrozen;\n\n  const hasOutsideReactions = !withVoiceTranscription && hasReactions\n    && (isCustomShape || ((photo || video || storyData || (location?.mediaType === 'geo')) && !hasText));\n\n  const contentClassName = buildContentClassName(message, album, {\n    poll,\n    hasSubheader,\n    isCustomShape,\n    isLastInGroup,\n    asForwarded,\n    hasThread: hasThread && !noComments,\n    forceSenderName,\n    hasCommentCounter: hasThread && repliesThreadInfo.messagesCount > 0,\n    hasCommentButton: withCommentButton,\n    hasActionButton: canForward || canFocus,\n    hasReactions,\n    isGeoLiveActive: location?.mediaType === 'geoLive' && !isGeoLiveExpired(message),\n    withVoiceTranscription,\n    peerColorClass: getPeerColorClass(messageColorPeer, noUserColors, true),\n    hasOutsideReactions,\n  });\n\n  const withAppendix = contentClassName.includes('has-appendix');\n  const emojiSize = getCustomEmojiSize(message.emojiOnlyCount);\n\n  const paidMessageStarsInMeta = !isChatWithUser\n    ? (isAlbum && paidMessageStars ? album.messages.length * paidMessageStars : paidMessageStars)\n    : undefined;\n\n  let metaPosition!: MetaPosition;\n  if (phoneCall) {\n    metaPosition = 'none';\n  } else if (isInDocumentGroupNotLast) {\n    metaPosition = 'none';\n  } else if (hasText && !webPage && !emojiSize && !isInvertedMedia) {\n    metaPosition = 'in-text';\n  } else if (isInvertedMedia && !emojiSize && (hasFactCheck || webPage)) {\n    metaPosition = 'in-text';\n  } else {\n    metaPosition = 'standalone';\n  }\n\n  let reactionsPosition!: ReactionsPosition;\n  if (hasReactions) {\n    if (hasOutsideReactions) {\n      reactionsPosition = 'outside';\n    } else if (asForwarded) {\n      metaPosition = 'standalone';\n      reactionsPosition = 'inside';\n    } else {\n      reactionsPosition = 'inside';\n    }\n  } else {\n    reactionsPosition = 'none';\n  }\n\n  const quickReactionPosition: QuickReactionPosition = isCustomShape ? 'in-meta' : 'in-content';\n\n  // \n  // eslint-disable-next-line max-len\n  if (autoTranslate && shouldTranslate && textMessage && !isTranslationPending && !currentTranslatedText && !webPage && !emojiSize && !isInvertedMedia && !hasTranslation) {\n    requestMessageTranslation({\n      chatId,\n      id: messageId,\n    });\n  }\n\n  useEnsureMessage(\n    replyToPeerId || chatId,\n    replyToMsgId,\n    replyMessage,\n    message.id,\n    shouldHideReply || isQuote || isReplyPrivate,\n  );\n\n  useEnsureStory(\n    storyReplyPeerId || chatId,\n    storyReplyId,\n    replyStory,\n  );\n\n  useFocusMessage({\n    elementRef: ref,\n    chatId,\n    isFocused,\n    focusDirection,\n    noFocusHighlight,\n    isResizingContainer,\n    isJustAdded,\n    isQuote: Boolean(focusedQuote),\n    scrollTargetPosition,\n  });\n\n  const viaBusinessBotTitle = viaBusinessBot ? getPeerFullTitle(lang, viaBusinessBot) : undefined;\n\n  const canShowPostAuthor = !message.senderId;\n  const signature = viaBusinessBotTitle || (canShowPostAuthor && message.postAuthorTitle)\n    || ((asForwarded || isChatWithSelf) && forwardInfo?.postAuthorTitle)\n    || undefined;\n\n  useMessageResizeObserver(ref, isLastInList);\n\n  useEffect(() => {\n    const bottomMarker = bottomMarkerRef.current;\n    if (!bottomMarker || !isElementInViewport(bottomMarker)) return;\n\n    if (hasUnreadReaction) {\n      animateUnreadReaction({ messageIds: [messageId] });\n    }\n\n    let unreadMentionIds: number[] = [];\n    if (message.hasUnreadMention) {\n      unreadMentionIds = [messageId];\n    }\n\n    if (album) {\n      unreadMentionIds = album.messages.filter((msg) => msg.hasUnreadMention).map((msg) => msg.id);\n    }\n\n    if (unreadMentionIds.length) {\n      markMentionsRead({ chatId, messageIds: unreadMentionIds });\n    }\n  }, [hasUnreadReaction, album, chatId, messageId, animateUnreadReaction, message.hasUnreadMention]);\n\n  const albumLayout = useMemo(() => {\n    return isAlbum\n      ? calculateAlbumLayout(isOwn, Boolean(noAvatars), album!, isMobile)\n      : undefined;\n  }, [isAlbum, isOwn, noAvatars, album, isMobile]);\n\n  const extraPadding = asForwarded && !isCustomShape ? 28 : 0;\n\n  const sizeCalculations = useMemo(() => {\n    let calculatedWidth;\n    let contentWidth: number | undefined;\n    let noMediaCorners = false;\n    let style = '';\n    let reactionsMaxWidth;\n\n    if (!isAlbum && (photo || video || invoice?.extendedMedia)) {\n      let width: number | undefined;\n      if (photo || video) {\n        const media = (photo || video);\n        if (media && !isRoundVideo) {\n          width = calculateMediaDimensions({\n            media,\n            isOwn,\n            asForwarded,\n            noAvatars,\n            isMobile,\n          }).width;\n        }\n      } else if (invoice?.extendedMedia && (\n        invoice.extendedMedia.width && invoice.extendedMedia.height\n      )) {\n        const { width: previewWidth, height: previewHeight } = invoice.extendedMedia;\n        width = calculateDimensionsForMessageMedia({\n          width: previewWidth,\n          height: previewHeight,\n          fromOwnMessage: isOwn,\n          asForwarded,\n          noAvatars,\n          isMobile,\n        }).width;\n      }\n\n      if (width) {\n        if (width < MIN_MEDIA_WIDTH_WITH_TEXT) {\n          contentWidth = width;\n        }\n        calculatedWidth = Math.max(getMinMediaWidth(text?.text, isMediaWithCommentButton), width);\n        if (!asForwarded && invoice?.extendedMedia && calculatedWidth - width > NO_MEDIA_CORNERS_THRESHOLD) {\n          noMediaCorners = true;\n        }\n      }\n    } else if (albumLayout) {\n      calculatedWidth = Math.max(\n        getMinMediaWidth(text?.text, isMediaWithCommentButton), albumLayout.containerStyle.width,\n      );\n      if (calculatedWidth - albumLayout.containerStyle.width > NO_MEDIA_CORNERS_THRESHOLD) {\n        noMediaCorners = true;\n      }\n    }\n\n    if (calculatedWidth) {\n      style = `width: ${calculatedWidth}px`;\n      reactionsMaxWidth = calculatedWidth + EXTRA_SPACE_FOR_REACTIONS;\n    } else if (sticker && !hasSubheader) {\n      const { width } = getStickerDimensions(sticker, isMobile);\n      style = `width: ${width + extraPadding}px`;\n      reactionsMaxWidth = width + EXTRA_SPACE_FOR_REACTIONS;\n    }\n\n    return {\n      contentWidth, noMediaCorners, style, reactionsMaxWidth,\n    };\n  }, [\n    albumLayout, asForwarded, extraPadding, hasSubheader, invoice?.extendedMedia, isAlbum, isMediaWithCommentButton,\n    isMobile, isOwn, noAvatars, photo, sticker, text?.text, video, isRoundVideo,\n  ]);\n\n  const {\n    contentWidth, noMediaCorners, style, reactionsMaxWidth,\n  } = sizeCalculations;\n\n  function renderMessageText(isForAnimation?: boolean) {\n    if (!textMessage) return undefined;\n    return (\n      <MessageText\n        messageOrStory={textMessage}\n        translatedText={(requestedTranslationLanguage || hasTranslation) ? currentTranslatedText : undefined}\n        isForAnimation={isForAnimation}\n        focusedQuote={focusedQuote}\n        focusedQuoteOffset={focusedQuoteOffset}\n        emojiSize={emojiSize}\n        highlight={highlight}\n        isProtected={isProtected}\n        observeIntersectionForLoading={observeIntersectionForLoading}\n        observeIntersectionForPlaying={observeIntersectionForPlaying}\n        withTranslucentThumbs={isCustomShape}\n        isInSelectMode={isInSelectMode}\n        canBeEmpty={hasFactCheck}\n        maxTimestamp={maxTimestamp}\n        threadId={threadId}\n      />\n    );\n  }\n\n  const renderQuickReactionButton = useCallback(() => {\n    if (!defaultReaction) return undefined;\n\n    return (\n      <div\n        className={buildClassName('quick-reaction', isQuickReactionVisible && !hasActiveReactions && 'visible')}\n        onClick={handleSendQuickReaction}\n        ref={quickReactionRef}\n      >\n        <ReactionStaticEmoji\n          reaction={defaultReaction}\n          size={QUICK_REACTION_SIZE}\n          availableReactions={availableReactions}\n          observeIntersection={observeIntersectionForPlaying}\n        />\n      </div>\n    );\n  }, [\n    hasActiveReactions, availableReactions, defaultReaction, handleSendQuickReaction, isQuickReactionVisible,\n    observeIntersectionForPlaying,\n  ]);\n\n  function renderReactionsAndMeta() {\n    const meta = (\n      <MessageMeta\n        message={message}\n        isPinned={isPinned}\n        withFullDate={isChatWithSelf && !isOwn}\n        noReplies={noReplies}\n        repliesThreadInfo={repliesThreadInfo}\n        outgoingStatus={outgoingStatus}\n        signature={signature}\n        withReactionOffset={reactionsPosition === 'inside'}\n        renderQuickReactionButton={\n          withQuickReactionButton && quickReactionPosition === 'in-meta' ? renderQuickReactionButton : undefined\n        }\n        availableReactions={availableReactions}\n        isTranslated={Boolean(requestedTranslationLanguage ? currentTranslatedText : undefined)}\n        effectEmoji={effect?.emoticon}\n        onClick={handleMetaClick}\n        onEffectClick={handleEffectClick}\n        onTranslationClick={handleTranslationClick}\n        onOpenThread={handleOpenThread}\n        paidMessageStars={paidMessageStarsInMeta}\n      />\n    );\n\n    if (reactionsPosition !== 'inside') {\n      return meta;\n    }\n\n    return (\n      <Reactions\n        message={reactionMessage!}\n        threadId={threadId}\n        metaChildren={meta}\n        observeIntersection={observeIntersectionForPlaying}\n        noRecentReactors={isChannel}\n        tags={tags}\n        isCurrentUserPremium={isPremium}\n        isAccountFrozen={isAccountFrozen}\n      />\n    );\n  }\n\n  function renderContent() {\n    const className = buildClassName(\n      'content-inner',\n      asForwarded && 'forwarded-message',\n      hasForwardedCustomShape && 'forwarded-custom-shape',\n      hasSubheader && 'with-subheader',\n      noMediaCorners && 'no-media-corners',\n    );\n    const hasCustomAppendix = isLastInGroup\n      && (!hasText || (isInvertedMedia && !hasFactCheck && !hasReactions)) && !withCommentButton;\n    const textContentClass = buildClassName(\n      'text-content',\n      'clearfix',\n      metaPosition === 'in-text' && 'with-meta',\n      outgoingStatus && 'with-outgoing-icon',\n    );\n    const shouldReadMedia = !hasTtl || !isOwn || isChatWithSelf;\n\n    return (\n      <div className={className} onDoubleClick={handleContentDoubleClick} dir=\"auto\">\n        {!asForwarded && shouldRenderSenderName() && renderSenderName()}\n        {hasSubheader && (\n          <div className=\"message-subheader\">\n            {hasTopicChip && (\n              <TopicChip\n                topic={messageTopic}\n                onClick={handleTopicChipClick}\n                className=\"message-topic\"\n              />\n            )}\n            {hasForwardedCustomShape && (\n              <div className=\"forward-custom-shape-subheader\">\n                <div className=\"message-title\">\n                  {renderForwardTitle()}\n                </div>\n                {renderSenderName(true, true)}\n              </div>\n            )}\n            {hasMessageReply && (\n              <EmbeddedMessage\n                message={replyMessage}\n                replyInfo={messageReplyInfo}\n                noUserColors={noUserColors}\n                isProtected={isProtected}\n                sender={replyMessageSender}\n                senderChat={replyMessageChat}\n                forwardSender={replyMessageForwardSender}\n                chatTranslations={chatTranslations}\n                requestedChatTranslationLanguage={requestedChatTranslationLanguage}\n                observeIntersectionForLoading={observeIntersectionForLoading}\n                observeIntersectionForPlaying={observeIntersectionForPlaying}\n                onClick={handleReplyClick}\n              />\n            )}\n            {hasStoryReply && (\n              <EmbeddedStory\n                story={replyStory}\n                sender={storySender}\n                noUserColors={noUserColors}\n                isProtected={isProtected}\n                observeIntersectionForLoading={observeIntersectionForLoading}\n                onClick={handleStoryClick}\n              />\n            )}\n          </div>\n        )}\n        {sticker && observeIntersectionForLoading && observeIntersectionForPlaying && (\n          <Sticker\n            message={message}\n            observeIntersection={observeIntersectionForLoading}\n            observeIntersectionForPlaying={observeIntersectionForPlaying}\n            shouldLoop={shouldLoopStickers}\n            shouldPlayEffect={shouldPlayEffect}\n            withEffect={withAnimatedEffects}\n            onStopEffect={hideEffect}\n          />\n        )}\n        {hasAnimatedEmoji && animatedCustomEmoji && (\n          <AnimatedCustomEmoji\n            customEmojiId={animatedCustomEmoji}\n            withEffects={withAnimatedEffects && isChatWithUser && !effect}\n            isOwn={isOwn}\n            observeIntersection={observeIntersectionForLoading}\n            forceLoadPreview={isLocal}\n            messageId={messageId}\n            chatId={chatId}\n            activeEmojiInteractions={activeEmojiInteractions}\n          />\n        )}\n        {hasAnimatedEmoji && animatedEmoji && (\n          <AnimatedEmoji\n            emoji={animatedEmoji}\n            withEffects={withAnimatedEffects && isChatWithUser && !effect}\n            isOwn={isOwn}\n            observeIntersection={observeIntersectionForLoading}\n            forceLoadPreview={isLocal}\n            messageId={messageId}\n            chatId={chatId}\n            activeEmojiInteractions={activeEmojiInteractions}\n          />\n        )}\n        {withAnimatedEffects && effect && !isLocal && (\n          <MessageEffect\n            shouldPlay={shouldPlayEffect}\n            messageId={message.id}\n            isMirrored={!message.isOutgoing}\n            effect={effect}\n            observeIntersectionForLoading={observeIntersectionForLoading}\n            observeIntersectionForPlaying={observeIntersectionForPlaying}\n            onStop={hideEffect}\n          />\n        )}\n        {phoneCall && (\n          <MessagePhoneCall\n            message={message}\n            phoneCall={phoneCall}\n            chatId={chatId}\n          />\n        )}\n        {!isAlbum && isRoundVideo && !withVoiceTranscription && (\n          <RoundVideo\n            message={message}\n            observeIntersection={observeIntersectionForLoading}\n            canAutoLoad={canAutoLoadMedia}\n            isDownloading={isDownloading}\n            onReadMedia={shouldReadMedia ? handleReadMedia : undefined}\n            onHideTranscription={setTranscriptionHidden}\n            isTranscriptionError={isTranscriptionError}\n            isTranscribed={Boolean(transcribedText)}\n            canTranscribe={canTranscribeVoice && !hasTtl}\n            isTranscriptionHidden={isTranscriptionHidden}\n            isTranscribing={isTranscribing}\n          />\n        )}\n        {(audio || voice || withVoiceTranscription) && (\n          <Audio\n            theme={theme}\n            message={message}\n            origin={AudioOrigin.Inline}\n            uploadProgress={uploadProgress}\n            isSelectable={isInDocumentGroup}\n            isSelected={isSelected}\n            noAvatars={noAvatars}\n            onPlay={handleAudioPlay}\n            onReadMedia={voice && shouldReadMedia ? handleReadMedia : undefined}\n            onCancelUpload={handleCancelUpload}\n            isDownloading={isDownloading}\n            isTranscribing={isTranscribing}\n            isTranscriptionHidden={isTranscriptionHidden}\n            isTranscribed={Boolean(transcribedText)}\n            isTranscriptionError={isTranscriptionError}\n            canDownload={!isProtected}\n            onHideTranscription={setTranscriptionHidden}\n            canTranscribe={canTranscribeVoice && !hasTtl}\n          />\n        )}\n        {document && (\n          <Document\n            document={document}\n            message={message}\n            observeIntersection={observeIntersectionForLoading}\n            canAutoLoad={canAutoLoadMedia}\n            autoLoadFileMaxSizeMb={autoLoadFileMaxSizeMb}\n            uploadProgress={uploadProgress}\n            isSelectable={isInDocumentGroup}\n            isSelected={isSelected}\n            onMediaClick={handleDocumentClick}\n            onCancelUpload={handleCancelUpload}\n            isDownloading={isDownloading}\n            shouldWarnAboutSvg={shouldWarnAboutSvg}\n          />\n        )}\n        {storyData && !isStoryMention && (\n          <Story\n            message={message}\n            isProtected={isProtected}\n          />\n        )}\n        {isStoryMention && <StoryMention message={message} />}\n        {contact && (\n          <Contact contact={contact} noUserColors={isOwn} />\n        )}\n        {poll && (\n          <Poll message={message} poll={poll} onSendVote={handleVoteSend} />\n        )}\n        {(giveaway || giveawayResults) && (\n          <Giveaway message={message} />\n        )}\n        {game && (\n          <Game\n            message={message}\n            canAutoLoadMedia={canAutoLoadMedia}\n          />\n        )}\n        {invoice?.extendedMedia && (\n          <InvoiceMediaPreview\n            message={message}\n            isConnected={isConnected}\n          />\n        )}\n\n        {withVoiceTranscription && (\n          <p\n            className={buildClassName(\n              'transcription',\n              !isTranscriptionHidden && isTranscriptionError && 'transcription-error',\n            )}\n            dir=\"auto\"\n          >\n            {(isTranscriptionError ? lang('NoWordsRecognized') : (\n              isTranscribing && transcribedText ? <DotAnimation content={transcribedText} /> : transcribedText\n            ))}\n          </p>\n        )}\n\n        {isInvertedMedia && renderInvertedMediaContent(hasCustomAppendix)}\n\n        {!isInvertedMedia && (\n          <>\n            {renderInvertibleMediaContent(hasCustomAppendix)}\n            {hasText && !hasAnimatedEmoji && (\n              <div className={textContentClass} dir=\"auto\">\n                {renderMessageText()}\n                {isTranslationPending && (\n                  <div className=\"translation-animation\">\n                    <div className=\"text-loading\">\n                      {renderMessageText(true)}\n                    </div>\n                  </div>\n                )}\n                {hasFactCheck && (\n                  <FactCheck factCheck={factCheck} isToggleDisabled={isInSelectMode} />\n                )}\n                {metaPosition === 'in-text' && renderReactionsAndMeta()}\n              </div>\n            )}\n            {renderWebPage()}\n          </>\n        )}\n\n        {invoice && !invoice.extendedMedia && (\n          <Invoice\n            message={message}\n            shouldAffectAppendix={hasCustomAppendix && !hasReactions}\n            isInSelectMode={isInSelectMode}\n            isSelected={isSelected}\n            theme={theme}\n            forcedWidth={contentWidth}\n          />\n        )}\n        {location && (\n          <Location\n            message={message}\n            isInSelectMode={isInSelectMode}\n            isSelected={isSelected}\n            theme={theme}\n            peer={sender}\n          />\n        )}\n      </div>\n    );\n  }\n\n  function renderInvertedMediaContent(hasCustomAppendix: boolean) {\n    const textContentClass = buildClassName(\n      'text-content',\n      'clearfix',\n    );\n    const footerClass = buildClassName(\n      'text-content',\n      'clearfix',\n      metaPosition === 'in-text' && 'with-meta',\n      outgoingStatus && 'with-outgoing-icon',\n    );\n\n    const hasMediaAfterText = isAlbum || (!isAlbum && photo) || (!isAlbum && video && !isRoundVideo);\n    const hasContentAfterText = hasMediaAfterText || (!hasAnimatedEmoji && hasFactCheck);\n    const isMetaInText = metaPosition === 'in-text';\n\n    return (\n      <>\n        {renderWebPage()}\n        {hasText && !hasAnimatedEmoji && (\n          <div className={textContentClass} dir=\"auto\">\n            {renderMessageText()}\n            {isTranslationPending && (\n              <div className=\"translation-animation\">\n                <div className=\"text-loading\">\n                  {renderMessageText(true)}\n                </div>\n              </div>\n            )}\n            {!hasContentAfterText && isMetaInText && renderReactionsAndMeta()}\n          </div>\n        )}\n\n        {hasContentAfterText && (\n          <>\n            {renderInvertibleMediaContent(hasCustomAppendix)}\n            {!hasAnimatedEmoji && (\n              <div className={footerClass} dir=\"auto\">\n                {hasFactCheck && (\n                  <FactCheck factCheck={factCheck} isToggleDisabled={isInSelectMode} />\n                )}\n                {isMetaInText && renderReactionsAndMeta()}\n              </div>\n            )}\n          </>\n        )}\n\n      </>\n    );\n  }\n\n  function renderWebPage() {\n    return webPage && (\n      <WebPage\n        message={message}\n        observeIntersectionForLoading={observeIntersectionForLoading}\n        observeIntersectionForPlaying={observeIntersectionForPlaying}\n        noAvatars={noAvatars}\n        canAutoLoad={canAutoLoadMedia}\n        canAutoPlay={canAutoPlayMedia}\n        asForwarded={asForwarded}\n        isDownloading={isDownloading}\n        isProtected={isProtected}\n        theme={theme}\n        story={webPageStory}\n        isConnected={isConnected}\n        lastPlaybackTimestamp={lastPlaybackTimestamp}\n        backgroundEmojiId={messageColorPeer?.color?.backgroundEmojiId}\n        shouldWarnAboutSvg={shouldWarnAboutSvg}\n        autoLoadFileMaxSizeMb={autoLoadFileMaxSizeMb}\n        onAudioPlay={handleAudioPlay}\n        onMediaClick={handleMediaClick}\n        onDocumentClick={handleDocumentClick}\n        onCancelMediaTransfer={handleCancelUpload}\n      />\n    );\n  }\n\n  function renderInvertibleMediaContent(hasCustomAppendix: boolean) {\n    const content = (\n      <>\n        {isAlbum && observeIntersectionForLoading && (\n          <Album\n            album={album!}\n            albumLayout={albumLayout!}\n            observeIntersection={observeIntersectionForLoading}\n            isOwn={isOwn}\n            isProtected={isProtected}\n            hasCustomAppendix={hasCustomAppendix}\n            onMediaClick={handleAlbumMediaClick}\n          />\n        )}\n        {!isAlbum && photo && (\n          <Photo\n            messageText={text?.text}\n            photo={photo}\n            isOwn={isOwn}\n            observeIntersection={observeIntersectionForLoading}\n            noAvatars={noAvatars}\n            canAutoLoad={canAutoLoadMedia}\n            uploadProgress={uploadProgress}\n            shouldAffectAppendix={hasCustomAppendix}\n            isDownloading={isDownloading}\n            isProtected={isProtected}\n            asForwarded={asForwarded}\n            theme={theme}\n            forcedWidth={contentWidth}\n            onClick={handlePhotoMediaClick}\n            onCancelUpload={handleCancelUpload}\n          />\n        )}\n        {!isAlbum && video && !isRoundVideo && (\n          <Video\n            video={video}\n            isOwn={isOwn}\n            observeIntersectionForLoading={observeIntersectionForLoading}\n            observeIntersectionForPlaying={observeIntersectionForPlaying}\n            forcedWidth={contentWidth}\n            noAvatars={noAvatars}\n            canAutoLoad={canAutoLoadMedia}\n            canAutoPlay={canAutoPlayMedia}\n            uploadProgress={uploadProgress}\n            isDownloading={isDownloading}\n            isProtected={isProtected}\n            asForwarded={asForwarded}\n            lastPlaybackTimestamp={lastPlaybackTimestamp}\n            onClick={handleVideoMediaClick}\n            onCancelUpload={handleCancelUpload}\n          />\n        )}\n      </>\n    );\n\n    if (paidMedia) {\n      return (\n        <PaidMediaOverlay chatId={chatId} messageId={messageId} paidMedia={paidMedia} isOutgoing={isOwn}>\n          {content}\n        </PaidMediaOverlay>\n      );\n    }\n\n    return content;\n  }\n\n  function shouldRenderSenderName() {\n    const media = photo || video || location || paidMedia;\n    return !(isCustomShape && !viaBotId) && (\n      (withSenderName && (!media || hasTopicChip)) || asForwarded || viaBotId || forceSenderName\n    ) && !isInDocumentGroupNotFirst && !(hasMessageReply && isCustomShape);\n  }\n\n  function renderForwardTitle() {\n    return (\n      <span className=\"forward-title-container\">\n        {asForwarded && (\n          <Icon name={forwardInfo?.hiddenUserName ? 'forward' : 'share-filled'} />\n        )}\n        {asForwarded && (\n          <span className=\"forward-title\">\n            {lang('ForwardedFrom')}\n          </span>\n        )}\n      </span>\n    );\n  }\n\n  function renderSenderName(shouldSkipRenderForwardTitle:boolean = false, shouldSkipRenderAdminTitle: boolean = false) {\n    let senderTitle;\n    let senderColor;\n    if (senderPeer && !(isCustomShape && viaBotId)) {\n      senderTitle = getPeerFullTitle(lang, senderPeer);\n    } else if (forwardInfo?.hiddenUserName) {\n      senderTitle = forwardInfo.hiddenUserName;\n    } else if (storyData && originSender) {\n      senderTitle = getPeerFullTitle(lang, originSender!);\n    }\n    const senderEmojiStatus = senderPeer && 'emojiStatus' in senderPeer && senderPeer.emojiStatus;\n    const senderIsPremium = senderPeer && 'isPremium' in senderPeer && senderPeer.isPremium;\n\n    const shouldRenderForwardAvatar = asForwarded && senderPeer;\n    const hasBotSenderUsername = botSender?.usernames?.length;\n    return (\n      <div className=\"message-title\" dir=\"ltr\">\n        {(senderTitle || asForwarded) ? (\n          <span\n            className={buildClassName(\n              'message-title-name-container',\n              forwardInfo?.hiddenUserName ? 'sender-hidden' : 'interactive',\n              senderColor,\n            )}\n            dir=\"ltr\"\n          >\n            {!shouldSkipRenderForwardTitle && renderForwardTitle()}\n            <span className=\"message-title-name\">\n              {storyData && <Icon name=\"play-story\" />}\n              {shouldRenderForwardAvatar && (\n                <Avatar\n                  className=\"forward-avatar\"\n                  peer={senderPeer}\n                  size=\"micro\"\n                />\n              )}\n              <span\n                className=\"sender-title\"\n                onClick={handleSenderClick}\n              >\n                {senderTitle ? renderText(senderTitle) : (asForwarded ? NBSP : undefined)}\n              </span>\n              {!asForwarded && senderEmojiStatus && (\n                <CustomEmoji\n                  documentId={senderEmojiStatus.documentId}\n                  className=\"no-selection\"\n                  loopLimit={EMOJI_STATUS_LOOP_LIMIT}\n                  observeIntersectionForLoading={observeIntersectionForLoading}\n                  observeIntersectionForPlaying={observeIntersectionForPlaying}\n                />\n              )}\n              {!asForwarded && !senderEmojiStatus && senderIsPremium && <StarIcon />}\n              {senderPeer?.fakeType && <FakeIcon fakeType={senderPeer.fakeType} />}\n            </span>\n          </span>\n        ) : !botSender ? (\n          NBSP\n        ) : undefined}\n        {botSender?.usernames?.length && (\n          <span className=\"interactive\">\n            <span className=\"via\">{lang('ViaBot')}</span>\n            <span\n              className=\"sender-title\"\n              onClick={handleViaBotClick}\n            >\n              {renderText(`@${botSender.usernames[0].username}`)}\n            </span>\n          </span>\n        )}\n        <div className=\"title-spacer\" />\n        {!shouldSkipRenderAdminTitle && !hasBotSenderUsername ? (forwardInfo?.isLinkedChannelPost ? (\n          <span className=\"admin-title\" dir=\"auto\">{lang('DiscussChannel')}</span>\n        ) : message.postAuthorTitle && isGroup && !asForwarded ? (\n          <span className=\"admin-title\" dir=\"auto\">{message.postAuthorTitle}</span>\n        ) : senderAdminMember && !asForwarded && !viaBotId ? (\n          <span className=\"admin-title\" dir=\"auto\">\n            {senderAdminMember.customTitle || lang(\n              senderAdminMember.isOwner ? 'GroupInfo.LabelOwner' : 'GroupInfo.LabelAdmin',\n            )}\n          </span>\n        ) : undefined) : undefined}\n        {canShowSenderBoosts && (\n          <span className=\"sender-boosts\" aria-hidden>\n            <Icon name={senderBoosts > 1 ? 'boosts' : 'boost'} />\n            {senderBoosts > 1 ? senderBoosts : undefined}\n          </span>\n        )}\n      </div>\n    );\n  }\n\n  const forwardAuthor = isGroup && asForwarded ? message.postAuthorTitle : undefined;\n\n  return (\n    <div\n      ref={ref}\n      id={getMessageHtmlId(message.id)}\n      className={containerClassName}\n      data-message-id={messageId}\n      onCopy={isProtected ? stopEvent : undefined}\n      onMouseDown={handleMouseDown}\n      onClick={handleClick}\n      onContextMenu={handleContextMenu}\n      onDoubleClick={handleDoubleClick}\n      onMouseEnter={isInDocumentGroupNotLast ? handleDocumentGroupMouseEnter : undefined}\n      onMouseMove={withQuickReactionButton ? handleMouseMove : undefined}\n      onMouseLeave={(withQuickReactionButton || isInDocumentGroupNotLast) ? handleMouseLeave : undefined}\n    >\n      <div\n        ref={bottomMarkerRef}\n        className=\"bottom-marker\"\n        data-message-id={messageId}\n        data-last-message-id={album ? album.messages[album.messages.length - 1].id : undefined}\n        data-album-main-id={album ? album.mainMessage.id : undefined}\n        data-has-unread-mention={message.hasUnreadMention || undefined}\n        data-has-unread-reaction={hasUnreadReaction || undefined}\n        data-is-pinned={isPinned || undefined}\n        data-should-update-views={message.viewsCount !== undefined}\n      />\n      {!isInDocumentGroup && (\n        <div className=\"message-select-control no-selection\">\n          {isSelected && <Icon name=\"select\" />}\n        </div>\n      )}\n      {isLastInDocumentGroup && (\n        <div\n          className={buildClassName(\n            'message-select-control group-select no-selection', isGroupSelected && 'is-selected',\n          )}\n          onClick={handleDocumentGroupSelectAll}\n        >\n          {isGroupSelected && (\n            <Icon name=\"select\" />\n          )}\n        </div>\n      )}\n      <div\n        className={buildClassName('message-content-wrapper',\n          contentClassName.includes('text') && 'can-select-text',\n          contentClassName.includes('giveaway') && 'giveaway-result-content')}\n      >\n        <div\n          className={contentClassName}\n          style={style}\n          dir=\"auto\"\n        >\n          {asForwarded && !isInDocumentGroupNotFirst && (\n            <>\n              {shouldRenderSenderName() && renderSenderName()}\n              {forwardAuthor && <span className=\"admin-title\" dir=\"auto\">{forwardAuthor}</span>}\n            </>\n          )}\n          {renderContent()}\n          {!isInDocumentGroupNotLast && metaPosition === 'standalone' && !isStoryMention && renderReactionsAndMeta()}\n          {canShowActionButton && (\n            <div className={buildClassName(\n              'message-action-buttons',\n              isLoadingComments && 'message-action-buttons-shown',\n            )}\n            >\n              {withCommentButton && isCustomShape && (\n                <CommentButton\n                  threadInfo={repliesThreadInfo}\n                  disabled={noComments}\n                  isLoading={isLoadingComments}\n                  isCustomShape\n                  asActionButton\n                />\n              )}\n              {canForward && (\n                <Button\n                  className=\"message-action-button\"\n                  color=\"translucent-white\"\n                  round\n                  size=\"tiny\"\n                  ariaLabel={lang('lng_context_forward_msg')}\n                  onClick={isLastInDocumentGroup ? handleGroupForward : handleForward}\n                >\n                  <Icon name=\"share-filled\" />\n                </Button>\n              )}\n              {canFocus && (\n                <Button\n                  className=\"message-action-button\"\n                  color=\"translucent-white\"\n                  round\n                  size=\"tiny\"\n                  ariaLabel=\"Focus message\"\n                  onClick={isPinnedList ? handleFocus : handleFocusForwarded}\n                >\n                  <Icon name=\"arrow-right\" />\n                </Button>\n              )}\n            </div>\n          )}\n          {withCommentButton && !(canShowActionButton && isCustomShape) && (\n            <CommentButton\n              threadInfo={repliesThreadInfo}\n              disabled={noComments}\n              isLoading={isLoadingComments}\n            />\n          )}\n          {withAppendix && <MessageAppendix isOwn={isOwn} />}\n          {withQuickReactionButton && quickReactionPosition === 'in-content' && renderQuickReactionButton()}\n        </div>\n        {message.inlineButtons && (\n          <InlineButtons message={message} onClick={clickBotInlineButton} />\n        )}\n        {reactionsPosition === 'outside' && !isStoryMention && (\n          <Reactions\n            message={reactionMessage!}\n            threadId={threadId}\n            isOutside\n            isCurrentUserPremium={isPremium}\n            maxWidth={reactionsMaxWidth}\n            observeIntersection={observeIntersectionForPlaying}\n            noRecentReactors={isChannel}\n            tags={tags}\n            isAccountFrozen={isAccountFrozen}\n          />\n        )}\n        {reactionsPosition === 'outside' && !isStoryMention && (\n          <Reactions\n            message={reactionMessage!}\n            threadId={threadId}\n            isOutside\n            isCurrentUserPremium={isPremium}\n            maxWidth={reactionsMaxWidth}\n            observeIntersection={observeIntersectionForPlaying}\n            noRecentReactors={isChannel}\n            tags={tags}\n          />\n        )}\n      </div>\n      {contextMenuAnchor && (\n        <ContextMenuContainer\n          isOpen={isContextMenuOpen}\n          anchor={contextMenuAnchor}\n          targetHref={contextMenuTarget?.matches('a[href]') ? (contextMenuTarget as HTMLAnchorElement).href : undefined}\n          message={message}\n          album={album}\n          messageListType={messageListType}\n          onClose={handleContextMenuClose}\n          onCloseAnimationEnd={handleContextMenuHide}\n          repliesThreadInfo={repliesThreadInfo}\n          noReplies={noReplies}\n          detectedLanguage={detectedLanguage}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, ownProps): StateProps => {\n    const {\n      focusedMessage, forwardMessages, activeReactions, activeEmojiInteractions,\n      loadingThread,\n    } = selectTabState(global);\n    const {\n      message, album, withSenderName, withAvatar, threadId, messageListType, isLastInDocumentGroup, isFirstInGroup,\n    } = ownProps;\n    const {\n      id, chatId, viaBotId, isOutgoing, forwardInfo, transcriptionId, isPinned, viaBusinessBotId, effectId,\n      paidMessageStars,\n    } = message;\n\n    const { shouldWarnAboutSvg } = selectSharedSettings(global);\n    const isChatWithUser = isUserId(chatId);\n\n    const chat = selectChat(global, chatId);\n    const isChatWithSelf = selectIsChatWithSelf(global, chatId);\n    const isSystemBotChat = isSystemBot(chatId);\n    const isAnonymousForwards = isAnonymousForwardsChat(chatId);\n    const isChannel = chat && isChatChannel(chat);\n    const isGroup = chat && isChatGroup(chat);\n    const chatFullInfo = !isChatWithUser ? selectChatFullInfo(global, chatId) : undefined;\n    const webPageStoryData = message.content.webPage?.story;\n    const webPageStory = webPageStoryData\n      ? selectPeerStory(global, webPageStoryData.peerId, webPageStoryData.id)\n      : undefined;\n\n    const isForwarding = forwardMessages.messageIds && forwardMessages.messageIds.includes(id);\n    const forceSenderName = !isChatWithSelf && isAnonymousOwnMessage(message);\n    const canShowSender = withSenderName || withAvatar || forceSenderName;\n    const sender = selectSender(global, message);\n    const originSender = selectForwardedSender(global, message);\n    const botSender = viaBotId ? selectUser(global, viaBotId) : undefined;\n    const senderAdminMember = sender?.id && isGroup\n      ? chatFullInfo?.adminMembersById?.[sender?.id]\n      : undefined;\n\n    const isThreadTop = message.id === threadId;\n\n    const { replyToMsgId, replyToPeerId, replyFrom } = getMessageReplyInfo(message) || {};\n    const { peerId: storyReplyPeerId, storyId: storyReplyId } = getStoryReplyInfo(message) || {};\n\n    const shouldHideReply = replyToMsgId && replyToMsgId === threadId;\n    const replyMessage = selectReplyMessage(global, message);\n    const forwardHeader = forwardInfo || replyFrom;\n    const replyMessageSender = replyMessage ? selectSender(global, replyMessage)\n      : forwardHeader && !isSystemBotChat && !isAnonymousForwards\n        ? selectSenderFromHeader(global, forwardHeader) : undefined;\n    const replyMessageForwardSender = replyMessage && selectForwardedSender(global, replyMessage);\n    const replyMessageChat = replyToPeerId ? selectChat(global, replyToPeerId) : undefined;\n    const isReplyPrivate = !isSystemBotChat && !isAnonymousForwards && replyMessageChat\n      && !isChatPublic(replyMessageChat)\n      && (replyMessageChat.isNotJoined || replyMessageChat.isRestricted);\n    const isReplyToTopicStart = replyMessage?.content.action?.type === 'topicCreate';\n    const replyStory = storyReplyId && storyReplyPeerId\n      ? selectPeerStory(global, storyReplyPeerId, storyReplyId)\n      : undefined;\n    const storySender = storyReplyPeerId ? selectPeer(global, storyReplyPeerId) : undefined;\n\n    const uploadProgress = selectUploadProgress(global, message);\n    const isFocused = messageListType === 'thread' && (\n      album\n        ? album.messages.some((m) => selectIsMessageFocused(global, m, threadId))\n        : selectIsMessageFocused(global, message, threadId)\n    );\n\n    const {\n      direction: focusDirection, noHighlight: noFocusHighlight, isResizingContainer,\n      quote: focusedQuote, quoteOffset: focusedQuoteOffset, scrollTargetPosition,\n    } = (isFocused && focusedMessage) || {};\n\n    const middleSearch = selectCurrentMiddleSearch(global);\n    const highlight = middleSearch?.results?.query\n      && `${middleSearch.isHashtag ? '#' : ''}${middleSearch.results.query}`;\n\n    const singleEmoji = getMessageSingleRegularEmoji(message);\n    const animatedEmoji = singleEmoji && selectAnimatedEmoji(global, singleEmoji) ? singleEmoji : undefined;\n    const animatedCustomEmoji = getMessageSingleCustomEmoji(message);\n\n    let isSelected: boolean;\n    if (album?.messages) {\n      isSelected = album.messages.every(({ id: messageId }) => selectIsMessageSelected(global, messageId));\n    } else {\n      isSelected = selectIsMessageSelected(global, id);\n    }\n\n    const canReply = messageListType === 'thread' && selectCanReplyToMessage(global, message, threadId);\n    const activeDownloads = selectActiveDownloads(global);\n    const downloadableMedia = getMessageDownloadableMedia(message);\n    const isDownloading = downloadableMedia && getIsDownloading(activeDownloads, downloadableMedia);\n\n    const repliesThreadInfo = selectThreadInfo(global, chatId, album?.commentsMessage?.id || id);\n\n    const isInDocumentGroup = Boolean(message.groupedId) && !message.isInAlbum;\n    const documentGroupFirstMessageId = isInDocumentGroup\n      ? selectMessageIdsByGroupId(global, chatId, message.groupedId!)![0]\n      : undefined;\n    const reactionMessage = isInDocumentGroup ? (\n      isLastInDocumentGroup ? selectChatMessage(global, chatId, documentGroupFirstMessageId!) : undefined\n    ) : message;\n\n    const hasUnreadReaction = chat?.unreadReactions?.includes(message.id);\n\n    const hasTopicChip = threadId === MAIN_THREAD_ID && chat?.isForum && isFirstInGroup;\n    const messageTopic = hasTopicChip ? selectTopicFromMessage(global, message) : undefined;\n\n    const chatTranslations = selectChatTranslations(global, chatId);\n\n    const requestedTranslationLanguage = selectRequestedMessageTranslationLanguage(global, chatId, message.id);\n    const requestedChatTranslationLanguage = selectRequestedChatTranslationLanguage(global, chatId);\n\n    const areTranslationsEnabled = IS_TRANSLATION_SUPPORTED && global.settings.byKey.canTranslate\n      && !requestedChatTranslationLanguage; // Stop separate language detection if chat translation is requested\n\n    const isConnected = global.connectionState === 'connectionStateReady';\n\n    const hasActiveReactions = Boolean(reactionMessage && activeReactions[getMessageKey(reactionMessage)]?.length);\n\n    const isPremium = selectIsCurrentUserPremium(global);\n    const senderBoosts = sender && selectIsChatWithSelf(global, sender.id)\n      ? (chatFullInfo?.boostsApplied ?? message.senderBoosts) : message.senderBoosts;\n\n    const chatLevel = chat?.boostLevel || 0;\n    const transcribeMinLevel = global.appConfig?.groupTranscribeLevelMin;\n    const canTranscribeVoice = isPremium || Boolean(transcribeMinLevel && chatLevel >= transcribeMinLevel);\n\n    const viaBusinessBot = viaBusinessBotId ? selectUser(global, viaBusinessBotId) : undefined;\n\n    const effect = effectId ? global.availableEffectById[effectId] : undefined;\n\n    const poll = selectPollFromMessage(global, message);\n\n    const maxTimestamp = selectMessageTimestampableDuration(global, message);\n\n    const lastPlaybackTimestamp = selectMessageLastPlaybackTimestamp(global, chatId, message.id);\n    const hasTranslation = requestedTranslationLanguage\n      ? Boolean(selectMessageTranslations(global, message.chatId, requestedTranslationLanguage)[message.id]?.text)\n      : undefined;\n    const isAccountFrozen = selectIsCurrentUserFrozen(global);\n\n    const { autoTranslate } = global.settings.byKey;\n\n    return {\n      theme: selectTheme(global),\n      forceSenderName,\n      sender,\n      canShowSender,\n      originSender,\n      botSender,\n      shouldHideReply: shouldHideReply || isReplyToTopicStart,\n      isThreadTop,\n      replyMessage,\n      replyMessageSender,\n      replyMessageForwardSender,\n      replyMessageChat,\n      replyStory,\n      isReplyPrivate,\n      storySender,\n      isInDocumentGroup,\n      isProtected: selectIsMessageProtected(global, message),\n      isChatProtected: selectIsChatProtected(global, chatId),\n      isFocused,\n      isForwarding,\n      reactionMessage,\n      isChatWithSelf,\n      isRepliesChat: isSystemBotChat,\n      isAnonymousForwards,\n      isChannel,\n      isGroup,\n      canReply,\n      highlight,\n      animatedEmoji,\n      animatedCustomEmoji,\n      isInSelectMode: selectIsInSelectMode(global),\n      isSelected,\n      isGroupSelected: (\n        Boolean(message.groupedId)\n        && !message.isInAlbum\n        && selectIsDocumentGroupSelected(global, chatId, message.groupedId)\n      ),\n      threadId,\n      isDownloading,\n      isPinnedList: messageListType === 'pinned',\n      isPinned,\n      canAutoLoadMedia: selectCanAutoLoadMedia(global, message),\n      canAutoPlayMedia: selectCanAutoPlayMedia(global, message),\n      autoLoadFileMaxSizeMb: global.settings.byKey.autoLoadFileMaxSizeMb,\n      shouldLoopStickers: selectShouldLoopStickers(global),\n      repliesThreadInfo,\n      availableReactions: global.reactions.availableReactions,\n      defaultReaction: isMessageLocal(message) || messageListType === 'scheduled'\n        ? undefined : selectDefaultReaction(global, chatId),\n      hasActiveReactions,\n      activeEmojiInteractions,\n      hasUnreadReaction,\n      isTranscribing: transcriptionId !== undefined && global.transcriptions[transcriptionId]?.isPending,\n      transcribedText: transcriptionId !== undefined ? global.transcriptions[transcriptionId]?.text : undefined,\n      hasTranslation,\n      isPremium,\n      senderAdminMember,\n      messageTopic,\n      hasTopicChip,\n      chatTranslations,\n      areTranslationsEnabled,\n      shouldDetectChatLanguage: selectShouldDetectChatLanguage(global, chatId),\n      requestedTranslationLanguage,\n      autoTranslate,\n      requestedChatTranslationLanguage,\n      hasLinkedChat: Boolean(chatFullInfo?.linkedChatId),\n      withAnimatedEffects: selectPerformanceSettingsValue(global, 'stickerEffects'),\n      webPageStory,\n      isConnected,\n      isLoadingComments: repliesThreadInfo?.isCommentsInfo\n        && loadingThread?.loadingChatId === repliesThreadInfo?.originChannelId\n        && loadingThread?.loadingMessageId === repliesThreadInfo?.originMessageId,\n      shouldWarnAboutSvg,\n      ...(isOutgoing && { outgoingStatus: selectOutgoingStatus(global, message, messageListType === 'scheduled') }),\n      ...(typeof uploadProgress === 'number' && { uploadProgress }),\n      ...(isFocused && {\n        focusDirection,\n        noFocusHighlight,\n        isResizingContainer,\n        focusedQuote,\n        focusedQuoteOffset,\n        scrollTargetPosition,\n      }),\n      senderBoosts,\n      tags: global.savedReactionTags?.byKey,\n      canTranscribeVoice: true,\n      viaBusinessBot,\n      effect,\n      poll,\n      maxTimestamp,\n      lastPlaybackTimestamp,\n      paidMessageStars,\n      isChatWithUser,\n      isAccountFrozen,\n    };\n  },\n)(Message));\n","import { getActions } from '../../../../global';\n\nimport type {\n  ApiMessage, ApiPeer, ApiStory, ApiTopic, ApiUser,\n} from '../../../../api/types';\nimport type { OldLangFn } from '../../../../hooks/useOldLang';\nimport type { IAlbum, ThreadId } from '../../../../types';\nimport { MAIN_THREAD_ID } from '../../../../api/types';\nimport { MediaViewerOrigin } from '../../../../types';\n\nimport { getMessagePhoto, getMessageWebPagePhoto } from '../../../../global/helpers';\nimport { getMessageReplyInfo } from '../../../../global/helpers/replies';\nimport { tryParseDeepLink } from '../../../../util/deepLinkParser';\n\nimport useLastCallback from '../../../../hooks/useLastCallback';\n\nexport default function useInnerHandlers({\n  lang,\n  selectMessage,\n  message,\n  chatId,\n  threadId,\n  isInDocumentGroup,\n  asForwarded,\n  isScheduled,\n  album,\n  senderPeer,\n  botSender,\n  messageTopic,\n  isTranslatingChat,\n  story,\n  isReplyPrivate,\n  isRepliesChat,\n  isSavedMessages,\n  lastPlaybackTimestamp,\n}: {\n  lang: OldLangFn;\n  selectMessage: (e: React.MouseEvent<HTMLDivElement, MouseEvent>, groupedId?: string) => void;\n  message: ApiMessage;\n  chatId: string;\n  threadId: ThreadId;\n  isInDocumentGroup: boolean;\n  asForwarded?: boolean;\n  isScheduled?: boolean;\n  album?: IAlbum;\n  avatarPeer?: ApiPeer;\n  senderPeer?: ApiPeer;\n  botSender?: ApiUser;\n  messageTopic?: ApiTopic;\n  isTranslatingChat?: boolean;\n  story?: ApiStory;\n  isReplyPrivate?: boolean;\n  isRepliesChat?: boolean;\n  isSavedMessages?: boolean;\n  lastPlaybackTimestamp?: number;\n}) {\n  const {\n    openChat, showNotification, focusMessage, openMediaViewer, openAudioPlayer,\n    markMessagesRead, cancelUploadMedia, sendPollVote, openForwardMenu,\n    openChatLanguageModal, openThread, openStoryViewer, searchChatMediaMessages,\n  } = getActions();\n\n  const {\n    id: messageId, forwardInfo, groupedId, content: { paidMedia, video, webPage },\n  } = message;\n\n  const {\n    replyToMsgId, replyToPeerId, replyToTopId, isQuote, quoteText, quoteOffset,\n  } = getMessageReplyInfo(message) || {};\n\n  const handleSenderClick = useLastCallback(() => {\n    if (!senderPeer) {\n      showNotification({ message: lang('HidAccount') });\n\n      return;\n    }\n\n    if (asForwarded && forwardInfo?.channelPostId) {\n      focusMessage({ chatId: senderPeer.id, messageId: forwardInfo.channelPostId });\n    } else {\n      openChat({ id: senderPeer.id });\n    }\n  });\n\n  const handleViaBotClick = useLastCallback(() => {\n    if (!botSender) {\n      return;\n    }\n\n    openChat({ id: botSender.id });\n  });\n\n  const handleReplyClick = useLastCallback((): void => {\n    if (!replyToMsgId || isReplyPrivate) {\n      showNotification({\n        message: isQuote ? lang('QuotePrivate') : lang('ReplyPrivate'),\n      });\n      return;\n    }\n\n    if (isRepliesChat && replyToPeerId && replyToTopId) {\n      openThread({\n        isComments: true,\n        originChannelId: replyToPeerId,\n        originMessageId: replyToTopId,\n        focusMessageId: replyToMsgId,\n      });\n      return;\n    }\n\n    focusMessage({\n      chatId: replyToPeerId || chatId,\n      threadId: isRepliesChat ? replyToTopId : threadId, // Open comments from Replies bot, otherwise, keep current thread\n      messageId: replyToMsgId,\n      replyMessageId: replyToPeerId ? undefined : messageId,\n      noForumTopicPanel: !replyToPeerId, // Open topic panel for cross-chat replies\n      ...(isQuote && { quote: quoteText?.text, quoteOffset }),\n    });\n  });\n\n  const handleDocumentClick = useLastCallback((): void => {\n    openMediaViewer({\n      chatId,\n      threadId,\n      messageId,\n      origin: isScheduled ? MediaViewerOrigin.ScheduledInline : MediaViewerOrigin.Inline,\n    });\n  });\n\n  const openMediaViewerWithPhotoOrVideo = useLastCallback((withDynamicLoading: boolean): void => {\n    if (paidMedia && !paidMedia.isBought) return;\n    if (withDynamicLoading) {\n      searchChatMediaMessages({ chatId, threadId, currentMediaMessageId: messageId });\n    }\n\n    const parsedLink = webPage?.url && tryParseDeepLink(webPage.url);\n\n    const videoContent = video || webPage?.video;\n    const webpageTimestamp = parsedLink && 'timestamp' in parsedLink ? parsedLink.timestamp : undefined;\n\n    openMediaViewer({\n      chatId,\n      threadId,\n      messageId,\n      origin: isScheduled ? MediaViewerOrigin.ScheduledInline : MediaViewerOrigin.Inline,\n      timestamp: lastPlaybackTimestamp || videoContent?.timestamp || webpageTimestamp,\n      withDynamicLoading,\n    });\n  });\n  const handlePhotoMediaClick = useLastCallback((): void => {\n    const withDynamicLoading = !isScheduled && !paidMedia;\n    openMediaViewerWithPhotoOrVideo(withDynamicLoading);\n  });\n  const handleVideoMediaClick = useLastCallback(() => {\n    const isGif = message.content?.video?.isGif;\n    const withDynamicLoading = !isGif && !isScheduled && !paidMedia;\n    openMediaViewerWithPhotoOrVideo(withDynamicLoading);\n  });\n\n  const handleMediaClick = useLastCallback((): void => {\n    const photo = getMessagePhoto(message) || getMessageWebPagePhoto(message);\n    if (photo) {\n      handlePhotoMediaClick();\n    }\n\n    handleVideoMediaClick();\n  });\n\n  const handleAudioPlay = useLastCallback((): void => {\n    openAudioPlayer({ chatId, messageId });\n  });\n\n  const handleAlbumMediaClick = useLastCallback((albumMessageId: number, albumIndex?: number): void => {\n    if (paidMedia && !paidMedia.isBought) return;\n\n    searchChatMediaMessages({ chatId, threadId, currentMediaMessageId: messageId });\n    openMediaViewer({\n      chatId,\n      threadId,\n      messageId: albumMessageId,\n      mediaIndex: albumIndex,\n      origin: isScheduled ? MediaViewerOrigin.ScheduledAlbum : MediaViewerOrigin.Album,\n      withDynamicLoading: !paidMedia,\n    });\n  });\n\n  const handleReadMedia = useLastCallback((): void => {\n    markMessagesRead({ messageIds: [messageId] });\n  });\n\n  const handleCancelUpload = useLastCallback(() => {\n    cancelUploadMedia({ chatId, messageId });\n  });\n\n  const handleVoteSend = useLastCallback((options: string[]) => {\n    sendPollVote({ chatId, messageId, options });\n  });\n\n  const handleGroupForward = useLastCallback(() => {\n    openForwardMenu({ fromChatId: chatId, groupedId });\n  });\n\n  const handleForward = useLastCallback(() => {\n    if (album && album.messages) {\n      const messageIds = album.messages.map(({ id }) => id);\n      openForwardMenu({ fromChatId: chatId, messageIds });\n    } else {\n      openForwardMenu({ fromChatId: chatId, messageIds: [messageId] });\n    }\n  });\n\n  const handleFocus = useLastCallback(() => {\n    focusMessage({\n      chatId, threadId: MAIN_THREAD_ID, messageId,\n    });\n  });\n\n  const handleFocusForwarded = useLastCallback(() => {\n    const originalChatId = (isSavedMessages && forwardInfo!.savedFromPeerId) || forwardInfo!.fromChatId!;\n\n    if (isInDocumentGroup) {\n      focusMessage({\n        chatId: originalChatId, groupedId, groupedChatId: chatId, messageId: forwardInfo!.fromMessageId!,\n      });\n      return;\n    }\n\n    if (replyToPeerId && replyToTopId) {\n      if (isRepliesChat) {\n        openThread({\n          isComments: true,\n          originChannelId: replyToPeerId,\n          originMessageId: replyToTopId,\n          focusMessageId: forwardInfo!.fromMessageId!,\n        });\n      } else {\n        focusMessage({\n          chatId: replyToPeerId,\n          threadId: replyToTopId,\n          messageId: forwardInfo!.fromMessageId!,\n        });\n      }\n    } else {\n      focusMessage({\n        chatId: originalChatId, messageId: forwardInfo!.fromMessageId!,\n      });\n    }\n  });\n\n  const selectWithGroupedId = useLastCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n\n    selectMessage(e, groupedId);\n  });\n\n  const handleTranslationClick = useLastCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n\n    openChatLanguageModal({ chatId, messageId: !isTranslatingChat ? messageId : undefined });\n  });\n\n  const handleOpenThread = useLastCallback(() => {\n    openThread({\n      chatId: message.chatId,\n      threadId: message.id,\n    });\n  });\n\n  const handleTopicChipClick = useLastCallback(() => {\n    if (!messageTopic) return;\n    focusMessage({\n      chatId: replyToPeerId || chatId,\n      threadId: messageTopic.id,\n      messageId,\n    });\n  });\n\n  const handleStoryClick = useLastCallback(() => {\n    if (!story) return;\n    openStoryViewer({\n      peerId: story.peerId,\n      storyId: story.id,\n      isSingleStory: true,\n    });\n  });\n\n  return {\n    handleSenderClick,\n    handleViaBotClick,\n    handleReplyClick,\n    handleDocumentClick,\n    handleMediaClick,\n    handleAudioPlay,\n    handleAlbumMediaClick,\n    handlePhotoMediaClick,\n    handleVideoMediaClick,\n    handleMetaClick: selectWithGroupedId,\n    handleTranslationClick,\n    handleOpenThread,\n    handleReadMedia,\n    handleCancelUpload,\n    handleVoteSend,\n    handleGroupForward,\n    handleForward,\n    handleFocus,\n    handleFocusForwarded,\n    handleDocumentGroupSelectAll: selectWithGroupedId,\n    handleTopicChipClick,\n    handleStoryClick,\n  };\n}\n","import { useEffect, useState } from '../lib/teact/teact';\n\nimport type { Signal } from '../util/signals';\n\nimport { detectLanguage } from '../util/languageDetection';\n\nexport default function useTextLanguage(text?: string, isDisabled?: boolean, getIsReady?: Signal<boolean>) {\n  const [language, setLanguage] = useState<string | undefined>();\n\n  useEffect(() => {\n    if (isDisabled || (getIsReady && !getIsReady())) return;\n\n    if (text) {\n      detectLanguage(text).then(setLanguage);\n    } else {\n      setLanguage(undefined);\n    }\n  }, [isDisabled, text, getIsReady]);\n\n  return language;\n}\n","import type { ApiMessage, ApiPoll } from '../../../../api/types';\nimport type { IAlbum } from '../../../../types';\n\nimport { EMOJI_SIZES, MESSAGE_CONTENT_CLASS_NAME } from '../../../../config';\nimport { getMessageContent } from '../../../../global/helpers';\nimport getSingularPaidMedia from './getSingularPaidMedia';\n\nexport function buildContentClassName(\n  message: ApiMessage,\n  album?: IAlbum,\n  {\n    poll,\n    hasSubheader,\n    isCustomShape,\n    isLastInGroup,\n    asForwarded,\n    hasThread,\n    forceSenderName,\n    hasCommentCounter,\n    hasCommentButton,\n    hasActionButton,\n    hasReactions,\n    isGeoLiveActive,\n    withVoiceTranscription,\n    peerColorClass,\n    hasOutsideReactions,\n  }: {\n    poll?: ApiPoll;\n    hasSubheader?: boolean;\n    isCustomShape?: boolean | number;\n    isLastInGroup?: boolean;\n    asForwarded?: boolean;\n    hasThread?: boolean;\n    forceSenderName?: boolean;\n    hasCommentCounter?: boolean;\n    hasCommentButton?: boolean;\n    hasActionButton?: boolean;\n    hasReactions?: boolean;\n    isGeoLiveActive?: boolean;\n    withVoiceTranscription?: boolean;\n    peerColorClass?: string;\n    hasOutsideReactions?: boolean;\n  } = {},\n) {\n  const { paidMedia } = getMessageContent(message);\n  const { photo: paidMediaPhoto, video: paidMediaVideo } = getSingularPaidMedia(paidMedia);\n\n  const content = getMessageContent(message);\n  const {\n    photo = paidMediaPhoto, video = paidMediaVideo,\n    audio, voice, document, webPage, contact, location, invoice, storyData,\n    giveaway, giveawayResults,\n  } = content;\n  const text = album?.hasMultipleCaptions ? undefined : getMessageContent(album?.captionMessage || message).text;\n  const hasFactCheck = Boolean(message.factCheck?.text);\n\n  const isRoundVideo = video?.mediaType === 'video' && video.isRound;\n  const isInvertedMedia = message.isInvertedMedia;\n  const isInvertibleMedia = photo || (video && !isRoundVideo) || album || webPage;\n\n  const classNames = [MESSAGE_CONTENT_CLASS_NAME];\n  const isMedia = storyData || photo || video || location || invoice?.extendedMedia || paidMedia;\n  const hasText = text || location?.mediaType === 'venue' || isGeoLiveActive || hasFactCheck;\n  const isMediaWithNoText = isMedia && !hasText;\n  const hasInlineKeyboard = Boolean(message.inlineButtons);\n  const isViaBot = Boolean(message.viaBotId);\n\n  const hasFooter = (() => {\n    if (isInvertedMedia && isInvertibleMedia) {\n      if (hasReactions && !hasOutsideReactions) return true;\n      if (hasFactCheck) return true;\n      if (webPage && hasText) return true;\n      return false;\n    }\n    return hasText;\n  })();\n\n  if (peerColorClass) {\n    classNames.push(peerColorClass);\n  }\n\n  if (!isMedia && message.emojiOnlyCount) {\n    classNames.push('emoji-only');\n    if (message.emojiOnlyCount <= EMOJI_SIZES) {\n      classNames.push(`emoji-only-${message.emojiOnlyCount}`);\n    }\n  } else if (hasText) {\n    classNames.push('text');\n  } else {\n    classNames.push('no-text');\n  }\n\n  if (!Object.keys(content).length) {\n    classNames.push('unsupported');\n  }\n\n  if (hasActionButton) {\n    classNames.push('has-action-button');\n  }\n\n  if (isCustomShape) {\n    classNames.push('custom-shape');\n\n    if (isRoundVideo) {\n      classNames.push('round');\n    }\n\n    if (hasCommentCounter) {\n      classNames.push('has-comment-counter');\n    }\n  }\n  if (isMedia && !withVoiceTranscription) {\n    classNames.push('media');\n  } else if (video) {\n    classNames.push('video');\n  } else if (audio) {\n    classNames.push('audio');\n  } else if (voice) {\n    classNames.push('voice');\n    if (withVoiceTranscription) {\n      classNames.push('with-voice-transcription');\n    }\n  } else if (document) {\n    classNames.push('document');\n  } else if (contact) {\n    classNames.push('contact');\n  } else if (poll) {\n    classNames.push('poll');\n  } else if (giveaway || giveawayResults) {\n    classNames.push('giveaway');\n  } else if (webPage) {\n    classNames.push('web-page');\n\n    if (webPage.photo || webPage.video) {\n      classNames.push('media');\n    }\n\n    if (webPage.document) {\n      classNames.push('document');\n    }\n\n    if (webPage.gift) {\n      classNames.push('gift');\n    }\n  }\n\n  if (invoice && !invoice.extendedMedia) {\n    classNames.push('invoice');\n  }\n\n  if (invoice && invoice.photo) {\n    classNames.push('has-photo');\n  }\n\n  if (storyData) {\n    classNames.push('story');\n  }\n\n  if (asForwarded) {\n    classNames.push('is-forwarded');\n  }\n\n  if (hasSubheader) {\n    classNames.push('has-subheader');\n  }\n\n  if (hasThread) {\n    classNames.push('has-replies');\n  }\n\n  if (hasReactions) {\n    classNames.push('has-reactions');\n  }\n\n  if (hasOutsideReactions) {\n    classNames.push('has-outside-reactions');\n  }\n\n  if (isViaBot) {\n    classNames.push('is-via-bot');\n  }\n\n  if (forceSenderName) {\n    classNames.push('force-sender-name');\n  }\n\n  if (!isCustomShape) {\n    classNames.push('has-shadow');\n\n    if (isMedia && hasThread) {\n      classNames.push('has-background');\n    }\n\n    if (hasSubheader || asForwarded || isViaBot || !isMediaWithNoText\n      || forceSenderName || hasFactCheck || withVoiceTranscription) {\n      classNames.push('has-solid-background');\n    }\n\n    if (hasFactCheck) {\n      classNames.push('has-fact-check');\n    }\n\n    if (isLastInGroup && !hasInlineKeyboard && (photo || !isMediaWithNoText || hasCommentButton)) {\n      classNames.push('has-appendix');\n    }\n  }\n\n  if (isInvertibleMedia && isInvertedMedia) {\n    classNames.push('is-inverted-media');\n  }\n\n  if (hasFooter) {\n    classNames.push('has-footer');\n  } else {\n    classNames.push('no-footer');\n  }\n\n  return classNames.join(' ');\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"name\":\"BDZrSTO_\",\"root\":\"QOz6fQFU\",\"avatar\":\"dXSy0i2c\",\"avatarHidden\":\"n0vJEdNW\",\"ghost\":\"E1IeDpeb\",\"ghostAnimateName\":\"HMp3KTKQ\",\"ghostRevealName\":\"unYkDic1\",\"ghostLast\":\"dZJGfaXC\"};","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useEffect, useMemo } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type {\n  ApiChatMember, ApiTypingStatus, ApiUser, ApiUserStatus,\n} from '../../api/types';\nimport type { CustomPeer, StoryViewerOrigin } from '../../types';\nimport type { IconName } from '../../types/icons';\nimport { MediaViewerOrigin } from '../../types';\n\nimport {\n  getMainUsername, getUserStatus, isSystemBot, isUserOnline,\n} from '../../global/helpers';\nimport { selectChatMessages, selectUser, selectUserStatus } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport renderText from './helpers/renderText';\n\nimport useIntervalForceUpdate from '../../hooks/schedulers/useIntervalForceUpdate';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport RippleEffect from '../ui/RippleEffect';\nimport Avatar from './Avatar';\nimport DotAnimation from './DotAnimation';\nimport FullNameTitle from './FullNameTitle';\nimport Icon from './icons/Icon';\nimport TypingStatus from './TypingStatus';\n\ntype OwnProps = {\n  userId?: string;\n  customPeer?: CustomPeer;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'tiny' | 'small' | 'medium' | 'large' | 'jumbo';\n  forceShowSelf?: boolean;\n  status?: string;\n  statusIcon?: IconName;\n  ripple?: boolean;\n  withDots?: boolean;\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withStory?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  storyViewerOrigin?: StoryViewerOrigin;\n  noEmojiStatus?: boolean;\n  noFake?: boolean;\n  noVerified?: boolean;\n  emojiStatusSize?: number;\n  noStatusOrTyping?: boolean;\n  noRtl?: boolean;\n  adminMember?: ApiChatMember;\n  isSavedDialog?: boolean;\n  className?: string;\n  onEmojiStatusClick?: NoneToVoidFunction;\n  iconElement?: React.ReactNode;\n  rightElement?: React.ReactNode;\n};\n\ntype StateProps =\n  {\n    user?: ApiUser;\n    userStatus?: ApiUserStatus;\n    self?: ApiUser;\n    isSavedMessages?: boolean;\n    areMessagesLoaded: boolean;\n    isSynced?: boolean;\n  };\n\nconst UPDATE_INTERVAL = 1000 * 60; // 1 min\n\nconst PrivateChatInfo: FC<OwnProps & StateProps> = ({\n  customPeer,\n  typingStatus,\n  avatarSize = 'medium',\n  status,\n  statusIcon,\n  withDots,\n  withMediaViewer,\n  withUsername,\n  withStory,\n  withFullInfo,\n  withUpdatingStatus,\n  emojiStatusSize,\n  noStatusOrTyping,\n  noEmojiStatus,\n  noFake,\n  noVerified,\n  noRtl,\n  user,\n  userStatus,\n  self,\n  isSavedMessages,\n  isSavedDialog,\n  areMessagesLoaded,\n  adminMember,\n  ripple,\n  className,\n  storyViewerOrigin,\n  isSynced,\n  onEmojiStatusClick,\n  iconElement,\n  rightElement,\n}) => {\n  const {\n    loadFullUser,\n    openMediaViewer,\n    loadMoreProfilePhotos,\n  } = getActions();\n\n  const lang = useOldLang();\n\n  const { id: userId } = user || {};\n\n  const hasAvatarMediaViewer = withMediaViewer && !isSavedMessages;\n\n  useEffect(() => {\n    if (userId) {\n      if (withFullInfo && isSynced) loadFullUser({ userId });\n      if (withMediaViewer) loadMoreProfilePhotos({ peerId: userId, isPreload: true });\n    }\n  }, [userId, withFullInfo, withMediaViewer, isSynced]);\n\n  useIntervalForceUpdate(UPDATE_INTERVAL);\n\n  const handleAvatarViewerOpen = useLastCallback(\n    (e: React.MouseEvent<HTMLDivElement, MouseEvent>, hasMedia: boolean) => {\n      if (user && hasMedia) {\n        e.stopPropagation();\n        openMediaViewer({\n          isAvatarView: true,\n          chatId: user.id,\n          mediaIndex: 0,\n          origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n        });\n      }\n    },\n  );\n\n  const mainUsername = useMemo(() => user && withUsername && getMainUsername(user), [user, withUsername]);\n\n  if (!user && !customPeer) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (status) {\n      return withDots ? (\n        <DotAnimation className=\"status\" content={status} />\n      ) : (\n        <span className=\"status\" dir=\"auto\">\n          {statusIcon && <Icon className=\"status-icon\" name={statusIcon} />}\n          {renderText(status)}\n        </span>\n      );\n    }\n\n    if (withUpdatingStatus && !areMessagesLoaded) {\n      return (\n        <DotAnimation className=\"status\" content={lang('Updating')} />\n      );\n    }\n\n    if (customPeer?.subtitleKey) {\n      return (\n        <span className=\"status\" dir=\"auto\">\n          <span className=\"user-status\" dir=\"auto\">{lang(customPeer.subtitleKey)}</span>\n        </span>\n      );\n    }\n\n    if (!user) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (isSystemBot(user.id)) {\n      return undefined;\n    }\n\n    const translatedStatus = getUserStatus(lang, user, userStatus);\n    const mainUserNameClassName = buildClassName('handle', translatedStatus && 'withStatus');\n    return (\n      <span className={buildClassName('status', isUserOnline(user, userStatus, true) && 'online')}>\n        {mainUsername && <span className={mainUserNameClassName}>{mainUsername}</span>}\n        {translatedStatus && <span className=\"user-status\" dir=\"auto\">{translatedStatus}</span>}\n      </span>\n    );\n  }\n\n  const customTitle = adminMember\n    ? adminMember.customTitle || lang(adminMember.isOwner ? 'GroupInfo.LabelOwner' : 'GroupInfo.LabelAdmin')\n    : undefined;\n\n  function renderNameTitle() {\n    if (customTitle) {\n      return (\n        <div className=\"info-name-title\">\n          <FullNameTitle\n            peer={user!}\n            withEmojiStatus={!noEmojiStatus}\n            emojiStatusSize={emojiStatusSize}\n            isSavedMessages={isSavedMessages}\n            isSavedDialog={isSavedDialog}\n            onEmojiStatusClick={onEmojiStatusClick}\n          />\n          {customTitle && <span className=\"custom-title\">{customTitle}</span>}\n        </div>\n      );\n    }\n\n    return (\n      <FullNameTitle\n        peer={customPeer || user!}\n        noFake={noFake}\n        noVerified={noVerified}\n        withEmojiStatus={!noEmojiStatus}\n        emojiStatusSize={emojiStatusSize}\n        isSavedMessages={isSavedMessages}\n        isSavedDialog={isSavedDialog}\n        onEmojiStatusClick={onEmojiStatusClick}\n        iconElement={iconElement}\n      />\n    );\n  }\n\n  return (\n    <div className={buildClassName('ChatInfo', className)} dir={!noRtl && lang.isRtl ? 'rtl' : undefined}>\n      {isSavedDialog && self && (\n        <Avatar\n          key=\"saved-messages\"\n          size={avatarSize}\n          peer={self}\n          isSavedMessages\n          className=\"saved-dialog-avatar\"\n        />\n      )}\n      <Avatar\n        key={user?.id}\n        size={avatarSize}\n        peer={customPeer || user}\n        className={buildClassName(isSavedDialog && 'overlay-avatar')}\n        isSavedMessages={isSavedMessages}\n        isSavedDialog={isSavedDialog}\n        withStory={withStory}\n        storyViewerOrigin={storyViewerOrigin}\n        storyViewerMode=\"single-peer\"\n        onClick={hasAvatarMediaViewer ? handleAvatarViewerOpen : undefined}\n      />\n      <div className=\"info\">\n        {renderNameTitle()}\n        {(status || (!isSavedMessages && !noStatusOrTyping)) && renderStatusOrTyping()}\n      </div>\n      {ripple && <RippleEffect />}\n      {rightElement}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { userId, forceShowSelf }): StateProps => {\n    const { isSynced } = global;\n    const user = userId ? selectUser(global, userId) : undefined;\n    const userStatus = userId ? selectUserStatus(global, userId) : undefined;\n    const isSavedMessages = !forceShowSelf && user && user.isSelf;\n    const self = isSavedMessages ? user : selectUser(global, global.currentUserId!);\n    const areMessagesLoaded = Boolean(userId && selectChatMessages(global, userId));\n\n    return {\n      user,\n      userStatus,\n      isSavedMessages,\n      areMessagesLoaded,\n      self,\n      isSynced,\n    };\n  },\n)(PrivateChatInfo));\n","const RE_BR = /(<br>|<br\\s?\\/>)/g;\nconst RE_SPACE = /(&nbsp;|\\u00A0)/g;\nconst RE_CLEAN_HTML = /(<div>|<\\/div>)/gi;\nconst RE_EXTRA_NEW_LINE = /\\n$/i;\n\nexport function prepareForRegExp(html: string) {\n  return html\n    .replace(RE_SPACE, ' ')\n    .replace(RE_BR, '\\n')\n    .replace(RE_CLEAN_HTML, '')\n    .replace(RE_EXTRA_NEW_LINE, '');\n}\n","import { useEffect, useRef, useState } from '../../../../lib/teact/teact';\nimport { getActions, getGlobal } from '../../../../global';\n\nimport { PAID_MESSAGES_PURPOSE } from '../../../../config';\n\nimport useLastCallback from '../../../../hooks/useLastCallback';\n\nexport default function usePaidMessageConfirmation(\n  starsForAllMessages: number,\n  isStarsBalanceModeOpen: boolean,\n  starsBalance: number,\n) {\n  const {\n    shouldPaidMessageAutoApprove,\n  } = getGlobal().settings.byKey;\n\n  const [shouldAutoApprove,\n    setAutoApprove] = useState(Boolean(shouldPaidMessageAutoApprove));\n  const [isWaitingStarsTopup, setIsWaitingStarsTopup] = useState(false);\n  const confirmPaymentHandlerRef = useRef<NoneToVoidFunction | undefined>(undefined);\n\n  const closeConfirmDialog = useLastCallback(() => {\n    getActions().closePaymentMessageConfirmDialogOpen();\n  });\n\n  useEffect(() => {\n    if (isWaitingStarsTopup && !isStarsBalanceModeOpen) {\n      setIsWaitingStarsTopup(false);\n\n      if (starsBalance > starsForAllMessages) {\n        confirmPaymentHandlerRef?.current?.();\n      }\n    }\n  }, [isWaitingStarsTopup, isStarsBalanceModeOpen, starsBalance, starsForAllMessages]);\n\n  const handleStarsTopup = useLastCallback(() => {\n    getActions().openStarsBalanceModal({\n      topup: {\n        balanceNeeded: starsForAllMessages,\n        purpose: PAID_MESSAGES_PURPOSE,\n      },\n    });\n    setIsWaitingStarsTopup(true);\n  });\n\n  const dialogHandler = useLastCallback(() => {\n    if (starsForAllMessages > starsBalance) {\n      handleStarsTopup();\n    } else {\n      confirmPaymentHandlerRef?.current?.();\n    }\n    getActions().closePaymentMessageConfirmDialogOpen();\n    if (shouldAutoApprove) getActions().setPaidMessageAutoApprove();\n  });\n\n  const handleWithConfirmation = <T extends (...args: any[]) => void>(\n    handler: T,\n    ...args: Parameters<T>\n  ) => {\n    if (starsForAllMessages) {\n      confirmPaymentHandlerRef.current = () => handler(...args);\n      if (!shouldPaidMessageAutoApprove) {\n        getActions().openPaymentMessageConfirmDialogOpen();\n        return;\n      }\n\n      if (starsForAllMessages > starsBalance) {\n        handleStarsTopup();\n        return;\n      }\n    }\n\n    handler(...args);\n  };\n\n  return {\n    closeConfirmDialog,\n    handleWithConfirmation,\n    dialogHandler,\n    shouldAutoApprove,\n    setAutoApprove,\n  };\n}\n","import { useEffect, useMemo } from '../lib/teact/teact';\nimport { getActions } from '../global';\n\nimport type { ApiTypeStory } from '../api/types';\n\nimport { throttle } from '../util/schedulers';\n\nconst THROTTLE_THRESHOLD_MS = 200;\n\nfunction useEnsureStory(\n  peerId?: string,\n  storyId?: number,\n  story?: ApiTypeStory,\n) {\n  const { loadPeerStoriesByIds } = getActions();\n\n  const loadStoryThrottled = useMemo(() => {\n    const throttled = throttle(loadPeerStoriesByIds, THROTTLE_THRESHOLD_MS, true);\n    return () => {\n      throttled({ peerId: peerId!, storyIds: [storyId!] });\n    };\n  }, [storyId, peerId]);\n\n  useEffect(() => {\n    const shouldLoadStory = !story || !('content' in story || 'isDeleted' in story);\n    if (peerId && storyId && shouldLoadStory) {\n      loadStoryThrottled();\n    }\n  }, [loadStoryThrottled, story, storyId, peerId]);\n}\n\nexport default useEnsureStory;\n","/* eslint-disable max-len */\nimport type { CoreAssistantMessage, CoreToolMessage, Message } from 'ai';\nimport { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\nexport function formatTimestamp(timestamp: number): string {\n  const date = new Date(timestamp);\n  const now = new Date();\n\n  const isSameDay = date.toDateString() === now.toDateString();\n  const isSameYear = date.getFullYear() === now.getFullYear();\n\n  const hours = String(date.getHours()).padStart(2, '0');\n  const minutes = String(date.getMinutes()).padStart(2, '0');\n  const timePart = `${hours}:${minutes}`;\n\n  const monthNames = [\n    'January', 'February', 'March', 'April', 'May', 'June',\n    'July', 'August', 'September', 'October', 'November', 'December',\n  ];\n  const month = monthNames[date.getMonth()];\n  const day = date.getDate();\n\n  if (isSameDay) {\n    return timePart;\n  } else if (isSameYear) {\n    return `${month} ${day} / ${timePart}`;\n  } else {\n    return `${date.getFullYear()}/${month} ${day} / ${timePart}`;\n  }\n}\n\n/**\n * \n * @param {number} start /\n * @param {number} end /\n * @returns {string} \n */\nexport function formatTimestampRange(start:number | undefined, end:number | undefined) {\n  // /\n  const normalizeTimestamp = (ts:number) => {\n    if (ts.toString().length <= 10) return ts * 1000; // \n    return ts; // \n  };\n\n  const startDate = start ? new Date(normalizeTimestamp(start)) : undefined;\n  const endDate = end ? new Date(normalizeTimestamp(end)) : undefined;\n  const now = new Date();\n\n  // \n  const isSameDay = (d1:Date, d2:Date) => d1.getFullYear() === d2.getFullYear()\n    && d1.getMonth() === d2.getMonth()\n    && d1.getDate() === d2.getDate();\n\n  const isToday = (date:Date) => isSameDay(date, now);\n\n  // \n  const formatTime = (date:Date) => {\n    const pad = (n:number) => String(n).padStart(2, '0');\n    return `${pad(date.getHours())}:${pad(date.getMinutes())}`;\n  };\n\n  const formatDate = (date:Date) => {\n    const monthNames = [\n      'January', 'February', 'March', 'April', 'May', 'June',\n      'July', 'August', 'September', 'October', 'November', 'December',\n    ];\n    const month = monthNames[date.getMonth()];\n    const pad = (n:number) => String(n).padStart(2, '0');\n    return `${month} ${pad(date.getDate())} / ${formatTime(date)}`;\n  };\n\n  if (!startDate && !endDate) {\n    return '';\n  }\n  if (!startDate && endDate) {\n    return `${formatDate(endDate)}`;\n  }\n  if (startDate && !endDate) {\n    return `${formatDate(startDate)}`;\n  }\n  if (startDate && endDate) {\n    // \n    if (isToday(startDate) && isToday(startDate)) {\n      return `${formatTime(startDate)} - ${formatTime(endDate)}`;\n    } else {\n      return `${formatDate(startDate)} - ${formatDate(endDate)}`;\n    }\n  }\n  return '';\n}\nexport function validateAndFixJsonStructure(jsonString:string) {\n  // \n  let braceCount = 0;\n  let bracketCount = 0;\n\n  // \n  let fixedJsonString = jsonString;\n\n  //  JSON \n  for (let i = 0; i < jsonString.length; i++) {\n    const char = jsonString[i];\n    if (char === '{') {\n      braceCount++;\n    } else if (char === '}') {\n      braceCount--;\n    } else if (char === '[') {\n      bracketCount++;\n    } else if (char === ']') {\n      bracketCount--;\n    }\n  }\n\n  // \n  while (braceCount > 0) {\n    fixedJsonString += '}'; // \n    braceCount--;\n  }\n\n  while (braceCount < 0) {\n    fixedJsonString = `{${fixedJsonString}`; // \n    braceCount++;\n  }\n\n  // \n  while (bracketCount > 0) {\n    fixedJsonString += ']'; // \n    bracketCount--;\n  }\n\n  while (bracketCount < 0) {\n    fixedJsonString = `[${fixedJsonString}`; // \n    bracketCount++;\n  }\n\n  //  JSON\n  try {\n    const parsed = JSON.parse(fixedJsonString);\n    return { valid: true, parsed, fixedJson: fixedJsonString };\n  } catch (error) {\n    return { valid: false, error };\n  }\n}\n\ntype ResponseMessageWithoutId = CoreToolMessage | CoreAssistantMessage;\ntype ResponseMessage = ResponseMessageWithoutId & { id: string };\n\nexport function sanitizeResponseMessages({\n  messages,\n  reasoning,\n}: {\n  messages: Array<ResponseMessage>;\n  reasoning: string | undefined;\n}) {\n  const toolResultIds: Array<string> = [];\n\n  for (const message of messages) {\n    if (message.role === 'tool') {\n      for (const content of message.content) {\n        if (content.type === 'tool-result') {\n          toolResultIds.push(content.toolCallId);\n        }\n      }\n    }\n  }\n\n  const messagesBySanitizedContent = messages.map((message) => {\n    if (message.role !== 'assistant') return message;\n\n    if (typeof message.content === 'string') return message;\n\n    const sanitizedContent = message.content.filter((content) => (content.type === 'tool-call'\n      ? toolResultIds.includes(content.toolCallId)\n      : content.type === 'text'\n        ? content.text.length > 0\n        : true));\n\n    if (reasoning) {\n      // @ts-expect-error: reasoning message parts in sdk is wip\n      sanitizedContent.push({ type: 'reasoning', reasoning });\n    }\n\n    return {\n      ...message,\n      content: sanitizedContent,\n    };\n  });\n\n  return messagesBySanitizedContent.filter(\n    (message) => message.content.length > 0,\n  );\n}\n\nexport function sanitizeUIMessages(messages: Array<Message>): Array<Message> {\n  const messagesBySanitizedToolInvocations = messages.map((message) => {\n    if (message.role !== 'assistant') return message;\n\n    if (!message.toolInvocations) return message;\n\n    const toolResultIds: Array<string> = [];\n\n    for (const toolInvocation of message.toolInvocations) {\n      if (toolInvocation.state === 'result') {\n        toolResultIds.push(toolInvocation.toolCallId);\n      }\n    }\n\n    const sanitizedToolInvocations = message.toolInvocations.filter(\n      (toolInvocation) => toolInvocation.state === 'result'\n        || toolResultIds.includes(toolInvocation.toolCallId),\n    );\n\n    return {\n      ...message,\n      toolInvocations: sanitizedToolInvocations,\n    };\n  });\n\n  return messagesBySanitizedToolInvocations.filter(\n    (message) => message.content.length > 0\n      || (message.toolInvocations && message.toolInvocations.length > 0),\n  );\n}\n","import { useEffect, useMemo } from '../../lib/teact/teact';\nimport { getActions, getGlobal } from '../../global';\n\nimport type { ApiChat, ApiUser } from '../../api/types';\n\nimport { isChatChannel, isUserBot, isUserId } from '../../global/helpers';\nimport { selectPeer, selectUserStatus } from '../../global/selectors';\nimport { throttle } from '../../util/schedulers';\n\nconst POLLING_INTERVAL = 60 * 60 * 1000;\nconst PEER_LAST_POLLING_TIME = new Map<string, number>();\nlet PEER_ID_QUEUE = new Set<string>();\nconst LIMIT_PER_REQUEST = 100;\nconst REQUEST_THROTTLE = 500;\n\nconst loadFromQueue = throttle(() => {\n  const queue = Array.from(PEER_ID_QUEUE);\n  const queueToLoad = queue.slice(0, LIMIT_PER_REQUEST);\n  const otherQueue = queue.slice(LIMIT_PER_REQUEST + 1);\n\n  getActions().loadStoriesMaxIds({\n    peerIds: queueToLoad,\n  });\n\n  queueToLoad.forEach((id) => PEER_LAST_POLLING_TIME.set(id, Date.now()));\n\n  PEER_ID_QUEUE = new Set(otherQueue);\n\n  // Schedule next load\n  if (PEER_ID_QUEUE.size) {\n    loadFromQueue();\n  }\n}, REQUEST_THROTTLE);\n\nexport default function usePeerStoriesPolling(ids?: string[]) {\n  const peers = useMemo(() => {\n    const global = getGlobal();\n    return ids?.map((id) => selectPeer(global, id)).filter(Boolean);\n  }, [ids]);\n\n  const pollablePeerIds = useMemo(() => {\n    const global = getGlobal();\n    return peers?.filter((peer) => {\n      const lastPollingTime = PEER_LAST_POLLING_TIME.get(peer.id) || 0;\n      if (Date.now() - lastPollingTime < POLLING_INTERVAL) {\n        return false;\n      }\n\n      if (isUserId(peer.id)) {\n        const user = peer as ApiUser;\n        const status = selectUserStatus(global, user.id);\n        const isStatusAvailable = status && status.type !== 'userStatusEmpty';\n        return !user.isContact && !user.isSelf && !isUserBot(user) && !peer.isSupport && isStatusAvailable;\n      } else {\n        const chat = peer as ApiChat;\n        return isChatChannel(chat) && !chat.isRestricted;\n      }\n    }).map((user) => user.id);\n  }, [peers]);\n\n  useEffect(() => {\n    if (pollablePeerIds?.length) {\n      pollablePeerIds.forEach((id) => PEER_ID_QUEUE.add(id));\n      loadFromQueue();\n    }\n  }, [pollablePeerIds]);\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport useForceUpdate from './useForceUpdate';\nimport usePreviousDeprecated from './usePreviousDeprecated';\nimport useSyncEffect from './useSyncEffect';\n\nexport default function usePrevDuringAnimation<T>(current: T, duration?: number): T {\n  const prev = usePreviousDeprecated(current, true);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n  // eslint-disable-next-line no-null/no-null\n  const isCurrentPresent = current !== undefined && current !== null;\n  // eslint-disable-next-line no-null/no-null\n  const isPrevPresent = prev !== undefined && prev !== null;\n\n  if (isCurrentPresent && timeoutRef.current) {\n    clearTimeout(timeoutRef.current);\n    timeoutRef.current = undefined;\n  }\n\n  useSyncEffect(() => {\n    // When `current` becomes empty\n    if (duration && !isCurrentPresent && isPrevPresent && !timeoutRef.current) {\n      timeoutRef.current = window.setTimeout(() => {\n        timeoutRef.current = undefined;\n        forceUpdate();\n      }, duration);\n    }\n  }, [duration, forceUpdate, isCurrentPresent, isPrevPresent]);\n\n  return (!timeoutRef.current || !duration || isCurrentPresent ? current : prev)!;\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiChat, ApiTopic } from '../../../api/types';\nimport type { Signal } from '../../../util/signals';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { getServerTime } from '../../../util/serverTime';\nimport { isSignal } from '../../../util/signals';\nimport { formatIntegerCompact } from '../../../util/textFormat';\nimport { extractCurrentThemeParams } from '../../../util/themeStyle';\n\nimport useDerivedState from '../../../hooks/useDerivedState';\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport AnimatedCounter from '../../common/AnimatedCounter';\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\nimport ShowTransition from '../../ui/ShowTransition';\n\nimport './ChatBadge.scss';\n\ntype OwnProps = {\n  chat: ApiChat;\n  topic?: ApiTopic;\n  wasTopicOpened?: boolean;\n  isPinned?: boolean;\n  isMuted?: boolean;\n  isSavedDialog?: boolean;\n  shouldShowOnlyMostImportant?: boolean;\n  hasMiniApp?: boolean;\n  forceHidden?: boolean | Signal<boolean>;\n  topics?: Record<number, ApiTopic>;\n  isSelected?: boolean;\n};\n\nconst ChatBadge: FC<OwnProps> = ({\n  topic,\n  topics,\n  chat,\n  isPinned,\n  isMuted,\n  shouldShowOnlyMostImportant,\n  wasTopicOpened,\n  forceHidden,\n  isSavedDialog,\n  hasMiniApp,\n  isSelected,\n}) => {\n  const { requestMainWebView } = getActions();\n\n  const oldLang = useOldLang();\n  const lang = useLang();\n\n  const {\n    unreadMentionsCount = 0, unreadReactionsCount = 0,\n  } = !chat.isForum ? chat : {}; // TODO[forums] Unread mentions and reactions temporarily disabled for forums\n\n  const isTopicUnopened = !isPinned && topic && !wasTopicOpened;\n  const isForum = chat.isForum && !topic;\n  const topicsWithUnread = useMemo(() => (\n    isForum && topics ? Object.values(topics).filter(({ unreadCount }) => unreadCount) : undefined\n  ), [topics, isForum]);\n\n  const unreadCount = useMemo(() => {\n    if (!isForum) {\n      return (topic || chat).unreadCount;\n    }\n\n    return topicsWithUnread?.length;\n  }, [chat, topic, topicsWithUnread, isForum]);\n\n  const shouldBeUnMuted = useMemo(() => {\n    if (!isForum) {\n      return !isMuted || topic?.notifySettings.mutedUntil === 0;\n    }\n\n    if (isMuted) {\n      return topicsWithUnread?.some((acc) => acc.notifySettings.mutedUntil === 0);\n    }\n\n    const isEveryUnreadMuted = topicsWithUnread?.every((acc) => (\n      acc.notifySettings.mutedUntil && acc.notifySettings.mutedUntil > getServerTime()\n    ));\n\n    return !isEveryUnreadMuted;\n  }, [isForum, isMuted, topicsWithUnread, topic?.notifySettings.mutedUntil]);\n\n  const hasUnreadMark = topic ? false : chat.hasUnreadMark;\n\n  const resolvedForceHidden = useDerivedState(\n    () => (isSignal(forceHidden) ? forceHidden() : forceHidden),\n    [forceHidden],\n  );\n  const isShown = !resolvedForceHidden && Boolean(\n    unreadCount || unreadMentionsCount || hasUnreadMark || isPinned || unreadReactionsCount\n    || isTopicUnopened || hasMiniApp,\n  );\n\n  const isUnread = Boolean((unreadCount || hasUnreadMark) && !isSavedDialog);\n  const className = buildClassName(\n    'ChatBadge',\n    !shouldBeUnMuted && 'muted',\n    !isUnread && isPinned && 'pinned',\n    isUnread && 'unread',\n  );\n\n  const handleOpenApp = useLastCallback((e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    e.stopPropagation();\n\n    const theme = extractCurrentThemeParams();\n    requestMainWebView({\n      botId: chat.id,\n      peerId: chat.id,\n      theme,\n    });\n  });\n\n  function renderContent() {\n    const unreadReactionsElement = unreadReactionsCount && (\n      <div className={buildClassName('ChatBadge reaction', !shouldBeUnMuted && 'muted')}>\n        <Icon name=\"heart\" />\n      </div>\n    );\n\n    const unreadMentionsElement = unreadMentionsCount && (\n      <div className=\"ChatBadge mention\">\n        <Icon name=\"mention\" />\n      </div>\n    );\n\n    const unopenedTopicElement = isTopicUnopened && (\n      <div className={buildClassName('ChatBadge unopened', !shouldBeUnMuted && 'muted')} />\n    );\n\n    const unreadCountElement = (hasUnreadMark || unreadCount) ? (\n      <div className={className}>\n        {!hasUnreadMark && <AnimatedCounter text={formatIntegerCompact(lang, unreadCount!)} />}\n      </div>\n    ) : undefined;\n\n    const pinnedElement = isPinned && (\n      <div className={className}>\n        <Icon name=\"pinned-chat\" />\n      </div>\n    );\n\n    const miniAppButton = hasMiniApp && (\n      <Button\n        color={isSelected ? 'secondary' : 'primary'}\n        className=\"ChatBadge miniapp\"\n        pill\n        size=\"tiny\"\n        onClick={handleOpenApp}\n      >\n        {oldLang('BotOpen')}\n      </Button>\n    );\n\n    const visiblePinnedElement = !unreadCountElement && !unreadMentionsElement && !unreadReactionsElement\n      && pinnedElement;\n\n    const elements = [\n      unopenedTopicElement, unreadReactionsElement, unreadMentionsElement, unreadCountElement, visiblePinnedElement,\n    ].filter(Boolean);\n\n    if (isSavedDialog) return pinnedElement;\n\n    // Show only if empty or have pinned icon\n    if (hasMiniApp && (elements.length === 0 || visiblePinnedElement)) return miniAppButton;\n\n    if (elements.length === 0) return undefined;\n\n    if (elements.length === 1) return elements[0];\n\n    if (shouldShowOnlyMostImportant) {\n      const importanceOrderedElements = [\n        unreadMentionsElement, unreadCountElement, unreadReactionsElement, pinnedElement,\n      ].filter(Boolean);\n      return importanceOrderedElements[0];\n    }\n\n    return (\n      <div className=\"ChatBadge-wrapper\">\n        {elements}\n      </div>\n    );\n  }\n\n  return (\n    <ShowTransition isCustom className=\"ChatBadge-transition\" isOpen={isShown}>\n      {renderContent()}\n    </ShowTransition>\n  );\n};\n\nexport default memo(ChatBadge);\n","import { TME_LINK_PREFIX } from '../../../config';\n\nexport default function formatUsername(username: string, asAbsoluteLink?: boolean) {\n  return asAbsoluteLink ? `${TME_LINK_PREFIX}${username}` : `@${username}`;\n}\n","import { useRef } from '../../../../lib/teact/teact';\n\nimport useForceUpdate from '../../../../hooks/useForceUpdate';\nimport usePreviousDeprecated from '../../../../hooks/usePreviousDeprecated';\n\nexport default function useLeftHeaderButtonRtlForumTransition(shouldHideSearch?: boolean) {\n  const forceUpdate = useForceUpdate();\n  const shouldDisableDropdownMenuTransitionRef = useRef(shouldHideSearch);\n  const prevShouldHideSearch = usePreviousDeprecated(shouldHideSearch);\n\n  function handleDropdownMenuTransitionEnd() {\n    shouldDisableDropdownMenuTransitionRef.current = Boolean(shouldHideSearch);\n    forceUpdate();\n  }\n\n  if (shouldHideSearch === false && prevShouldHideSearch !== shouldHideSearch) {\n    shouldDisableDropdownMenuTransitionRef.current = false;\n  }\n\n  return { shouldDisableDropdownMenuTransitionRef, handleDropdownMenuTransitionEnd };\n}\n","import React, { useEffect, useRef, useState } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMediaExtendedPreview, ApiVideo } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { IMediaDimensions } from './helpers/calculateAlbumLayout';\n\nimport {\n  getMediaFormat, getMediaThumbUri, getMediaTransferState, getVideoMediaHash,\n} from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatMediaDuration } from '../../../util/dates/dateFormat';\nimport * as mediaLoader from '../../../util/mediaLoader';\nimport { calculateExtendedPreviewDimensions, calculateVideoDimensions } from '../../common/helpers/mediaDimensions';\nimport { MIN_MEDIA_HEIGHT } from './helpers/mediaDimensions';\n\nimport useUnsupportedMedia from '../../../hooks/media/useUnsupportedMedia';\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useFlag from '../../../hooks/useFlag';\nimport { useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useMediaTransition from '../../../hooks/useMediaTransition';\nimport useMediaWithLoadProgress from '../../../hooks/useMediaWithLoadProgress';\nimport usePreviousDeprecated from '../../../hooks/usePreviousDeprecated';\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport useBlurredMediaThumbRef from './hooks/useBlurredMediaThumbRef';\n\nimport Icon from '../../common/icons/Icon';\nimport MediaSpoiler from '../../common/MediaSpoiler';\nimport OptimizedVideo from '../../ui/OptimizedVideo';\nimport ProgressSpinner from '../../ui/ProgressSpinner';\n\nexport type OwnProps<T> = {\n  id?: string;\n  video: ApiVideo | ApiMediaExtendedPreview;\n  lastPlaybackTimestamp?: number;\n  isOwn?: boolean;\n  isInWebPage?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  noAvatars?: boolean;\n  canAutoLoad?: boolean;\n  canAutoPlay?: boolean;\n  uploadProgress?: number;\n  forcedWidth?: number;\n  dimensions?: IMediaDimensions;\n  asForwarded?: boolean;\n  isDownloading?: boolean;\n  isProtected?: boolean;\n  className?: string;\n  clickArg?: T;\n  onClick?: (arg: T, e: React.MouseEvent<HTMLElement>) => void;\n  onCancelUpload?: (arg: T) => void;\n};\n\n// eslint-disable-next-line @typescript-eslint/comma-dangle\nconst Video = <T,>({\n  id,\n  video,\n  isOwn,\n  isInWebPage,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  noAvatars,\n  canAutoLoad,\n  canAutoPlay,\n  uploadProgress,\n  forcedWidth,\n  dimensions,\n  asForwarded,\n  isDownloading,\n  isProtected,\n  className,\n  lastPlaybackTimestamp,\n  clickArg,\n  onClick,\n  onCancelUpload,\n}: OwnProps<T>) => {\n  const { cancelMediaDownload } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const videoRef = useRef<HTMLVideoElement>(null);\n\n  const isPaidPreview = video.mediaType === 'extendedMediaPreview';\n\n  const localBlobUrl = !isPaidPreview ? video.blobUrl : undefined;\n\n  const [isSpoilerShown, showSpoiler, hideSpoiler] = useFlag(isPaidPreview || video.isSpoiler);\n\n  useEffect(() => {\n    if (isPaidPreview || video.isSpoiler) {\n      showSpoiler();\n    } else {\n      hideSpoiler();\n    }\n  }, [isPaidPreview, video]);\n\n  const isIntersectingForLoading = useIsIntersecting(ref, observeIntersectionForLoading);\n  const isIntersectingForPlaying = (\n    useIsIntersecting(ref, observeIntersectionForPlaying)\n    && isIntersectingForLoading\n  );\n  const wasIntersectedRef = useRef(isIntersectingForLoading);\n  if (isIntersectingForPlaying && !wasIntersectedRef.current) {\n    wasIntersectedRef.current = true;\n  }\n\n  const { isMobile } = useAppLayout();\n  const [isLoadAllowed, setIsLoadAllowed] = useState(canAutoLoad);\n  const shouldLoad = Boolean(isLoadAllowed && isIntersectingForLoading && !isPaidPreview);\n  const [isPlayAllowed, setIsPlayAllowed] = useState(Boolean(canAutoPlay && !isSpoilerShown));\n\n  const fullMediaHash = !isPaidPreview ? getVideoMediaHash(video, 'inline') : undefined;\n  const [isFullMediaPreloaded] = useState(Boolean(fullMediaHash && mediaLoader.getFromMemory(fullMediaHash)));\n  const { mediaData, loadProgress } = useMediaWithLoadProgress(\n    fullMediaHash,\n    !shouldLoad,\n    !isPaidPreview ? getMediaFormat(video, 'inline') : undefined,\n  );\n  const fullMediaData = localBlobUrl || mediaData;\n  const [isPlayerReady, markPlayerReady] = useFlag();\n\n  const thumbDataUri = getMediaThumbUri(video);\n  const hasThumb = Boolean(thumbDataUri);\n  const withBlurredBackground = Boolean(forcedWidth);\n\n  const isInline = fullMediaData && wasIntersectedRef.current;\n\n  const isUnsupported = useUnsupportedMedia(videoRef, true, !isInline);\n\n  const previewMediaHash = !isPaidPreview ? getVideoMediaHash(video, 'preview') : undefined;\n  const [isPreviewPreloaded] = useState(Boolean(previewMediaHash && mediaLoader.getFromMemory(previewMediaHash)));\n  const canLoadPreview = isIntersectingForLoading;\n  const previewBlobUrl = useMedia(previewMediaHash, !canLoadPreview);\n  const shouldHidePreview = isPlayerReady && !isUnsupported;\n  const previewRef = useMediaTransition<HTMLImageElement>((hasThumb || previewBlobUrl) && !shouldHidePreview);\n\n  const noThumb = Boolean(!hasThumb || previewBlobUrl || isPlayerReady);\n  const thumbRef = useBlurredMediaThumbRef(video, noThumb);\n  useMediaTransition(!noThumb, { ref: thumbRef });\n  const blurredBackgroundRef = useBlurredMediaThumbRef(video, !withBlurredBackground);\n\n  const { loadProgress: downloadProgress } = useMediaWithLoadProgress(\n    !isPaidPreview ? getVideoMediaHash(video, 'download') : undefined,\n    !isDownloading,\n    !isPaidPreview ? getMediaFormat(video, 'download') : undefined,\n  );\n\n  const { isUploading, isTransferring, transferProgress } = getMediaTransferState(\n    uploadProgress || (isDownloading ? downloadProgress : loadProgress),\n    (shouldLoad && !isPlayerReady && !isFullMediaPreloaded) || isDownloading,\n    uploadProgress !== undefined,\n  );\n\n  const wasLoadDisabled = usePreviousDeprecated(isLoadAllowed) === false;\n  const {\n    ref: spinnerRef,\n    shouldRender: shouldRenderSpinner,\n  } = useShowTransition({\n    isOpen: isTransferring && !isUnsupported,\n    noMountTransition: wasLoadDisabled,\n    withShouldRender: true,\n  });\n  const {\n    ref: playButtonRef,\n  } = useShowTransition({\n    isOpen: Boolean((isLoadAllowed || fullMediaData) && !isPlayAllowed && !shouldRenderSpinner),\n  });\n\n  const [playProgress, setPlayProgress] = useState<number>(0);\n  const handleTimeUpdate = useLastCallback((e: React.SyntheticEvent<HTMLVideoElement>) => {\n    setPlayProgress(Math.max(0, e.currentTarget.currentTime - 1));\n  });\n\n  const duration = (Number.isFinite(videoRef.current?.duration) && !isUnsupported\n    ? videoRef.current?.duration : video.duration) || 0;\n\n  const {\n    width, height,\n  } = dimensions || (\n    isPaidPreview\n      ? calculateExtendedPreviewDimensions(video, Boolean(isOwn), asForwarded, isInWebPage, noAvatars, isMobile)\n      : calculateVideoDimensions(video, Boolean(isOwn), asForwarded, isInWebPage, noAvatars, isMobile)\n  );\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLElement, MouseEvent>, isFromSpinner?: boolean) => {\n    if (isUploading) {\n      onCancelUpload?.(clickArg!);\n      return;\n    }\n\n    if (!isPaidPreview && isDownloading) {\n      cancelMediaDownload({ media: video });\n      return;\n    }\n\n    if (!fullMediaData) {\n      setIsLoadAllowed((isAllowed) => !isAllowed);\n      return;\n    }\n\n    if (fullMediaData && !isPlayAllowed) {\n      setIsPlayAllowed(true);\n    }\n\n    if (isSpoilerShown) {\n      hideSpoiler();\n      return;\n    }\n\n    if (isFromSpinner && shouldLoad && !isPlayerReady && !isFullMediaPreloaded) {\n      setIsLoadAllowed(false);\n      e.stopPropagation();\n      return;\n    }\n\n    onClick?.(clickArg!, e);\n  });\n\n  const handleClickOnSpinner = useLastCallback(\n    (e: React.MouseEvent<HTMLElement, MouseEvent>) => {\n      handleClick(e, true);\n    },\n  );\n\n  const componentClassName = buildClassName(\n    'media-inner dark',\n    !isUploading && 'interactive',\n    height < MIN_MEDIA_HEIGHT && 'fix-min-height',\n    className,\n  );\n\n  const dimensionsStyle = dimensions ? ` width: ${width}px; left: ${dimensions.x}px; top: ${dimensions.y}px;` : '';\n  const style = `height: ${height}px;${dimensionsStyle}`;\n\n  return (\n    <div\n      ref={ref}\n      id={id}\n      className={componentClassName}\n      style={style}\n      onClick={isUploading ? undefined : (e) => handleClick(e)}\n    >\n      {withBlurredBackground && (\n        <canvas ref={blurredBackgroundRef} className=\"thumbnail blurred-bg\" />\n      )}\n      {isInline && (\n        <OptimizedVideo\n          ref={videoRef}\n          src={fullMediaData}\n          className={buildClassName('full-media', withBlurredBackground && 'with-blurred-bg')}\n          canPlay={isPlayAllowed && isIntersectingForPlaying && !isUnsupported}\n          defaultMuted\n          muted\n          loop\n          playsInline\n          disablePictureInPicture\n          draggable={!isProtected}\n          onTimeUpdate={handleTimeUpdate}\n          onReady={markPlayerReady}\n          style={forcedWidth ? `width: ${forcedWidth}px` : undefined}\n        />\n      )}\n      <img\n        ref={previewRef}\n        src={previewBlobUrl}\n        className={buildClassName('thumbnail', withBlurredBackground && 'with-blurred-bg')}\n        alt=\"\"\n        style={forcedWidth ? `width: ${forcedWidth}px;` : undefined}\n        draggable={!isProtected}\n      />\n      {hasThumb && !isPreviewPreloaded && (\n        <canvas ref={thumbRef} className=\"thumbnail\" />\n      )}\n      {isProtected && <span className=\"protector\" />}\n      <Icon ref={playButtonRef} name=\"large-play\" />\n      <MediaSpoiler\n        isVisible={isSpoilerShown}\n        withAnimation\n        thumbDataUri={thumbDataUri}\n        width={width}\n        height={height}\n        className=\"media-spoiler\"\n      />\n      {shouldRenderSpinner && (\n        <div ref={spinnerRef} className=\"media-loading\">\n          <ProgressSpinner\n            progress={transferProgress}\n            onClick={handleClickOnSpinner}\n          />\n        </div>\n      )}\n      {!isLoadAllowed && !fullMediaData && (\n        <Icon name=\"download\" />\n      )}\n      {isTransferring && (!isUnsupported || isDownloading) ? (\n        <span className=\"message-transfer-progress\">\n          {(isUploading || isDownloading) ? `${Math.round(transferProgress * 100)}%` : '...'}\n        </span>\n      ) : (\n        <div className=\"message-media-duration\">\n          {!isPaidPreview && video.isGif ? 'GIF' : formatMediaDuration(Math.max(duration - playProgress, 0))}\n          {isUnsupported && <Icon name=\"message-failed\" className=\"playback-failed\" />}\n        </div>\n      )}\n      {Boolean(lastPlaybackTimestamp) && (\n        <div\n          className=\"message-media-last-progress\"\n          style={`--_progress: ${Math.floor((lastPlaybackTimestamp / duration) * 100)}%`}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default Video;\n","import { useEffect, useState } from '../../../../lib/teact/teact';\nimport { getGlobal } from '../../../../global';\n\nimport type { ApiSticker } from '../../../../api/types';\nimport type { EmojiData, EmojiModule, EmojiRawData } from '../../../../util/emoji/emoji';\nimport type { Signal } from '../../../../util/signals';\n\nimport { EDITABLE_INPUT_CSS_SELECTOR, EDITABLE_INPUT_ID } from '../../../../config';\nimport { requestNextMutation } from '../../../../lib/fasterdom/fasterdom';\nimport { selectCustomEmojiForEmojis } from '../../../../global/selectors';\nimport { uncompressEmoji } from '../../../../util/emoji/emoji';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport {\n  buildCollectionByKey, mapValues, pickTruthy, unique, uniqueByField,\n} from '../../../../util/iteratees';\nimport { MEMO_EMPTY_ARRAY } from '../../../../util/memo';\nimport memoized from '../../../../util/memoized';\nimport renderText from '../../../common/helpers/renderText';\nimport { buildCustomEmojiHtml } from '../helpers/customEmoji';\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\n\nimport { useThrottledResolver } from '../../../../hooks/useAsyncResolvers';\nimport useDerivedSignal from '../../../../hooks/useDerivedSignal';\nimport useFlag from '../../../../hooks/useFlag';\nimport useLastCallback from '../../../../hooks/useLastCallback';\n\ninterface Library {\n  keywords: string[];\n  byKeyword: Record<string, Emoji[]>;\n  names: string[];\n  byName: Record<string, Emoji[]>;\n  maxKeyLength: number;\n}\n\nlet emojiDataPromise: Promise<EmojiModule>;\nlet emojiRawData: EmojiRawData;\nlet emojiData: EmojiData;\n\nlet RE_EMOJI_SEARCH: RegExp;\nlet RE_LOWERCASE_TEST: RegExp;\nconst EMOJIS_LIMIT = 36;\nconst FILTER_MIN_LENGTH = 2;\n\nconst THROTTLE = 300;\n\nconst prepareRecentEmojisMemo = memoized(prepareRecentEmojis);\nconst prepareLibraryMemo = memoized(prepareLibrary);\nconst searchInLibraryMemo = memoized(searchInLibrary);\n\ntry {\n  RE_EMOJI_SEARCH = /(^|\\s):(?!\\s)[-+_:'\\s\\p{L}\\p{N}]*$/gui;\n  RE_LOWERCASE_TEST = /\\p{Ll}/u;\n} catch (e) {\n  // Support for older versions of firefox\n  RE_EMOJI_SEARCH = /(^|\\s):(?!\\s)[-+_:'\\s\\d\\w-]*$/gi;\n  RE_LOWERCASE_TEST = /[a-z]/;\n}\n\nexport default function useEmojiTooltip(\n  isEnabled: boolean,\n  getHtml: Signal<string>,\n  setHtml: (html: string) => void,\n  inputId = EDITABLE_INPUT_ID,\n  recentEmojiIds: string[],\n  baseEmojiKeywords?: Record<string, string[]>,\n  emojiKeywords?: Record<string, string[]>,\n) {\n  const [isManuallyClosed, markManuallyClosed, unmarkManuallyClosed] = useFlag(false);\n\n  const [byId, setById] = useState<Record<string, Emoji> | undefined>();\n  const [filteredEmojis, setFilteredEmojis] = useState<Emoji[]>(MEMO_EMPTY_ARRAY);\n  const [filteredCustomEmojis, setFilteredCustomEmojis] = useState<ApiSticker[]>(MEMO_EMPTY_ARRAY);\n\n  // Initialize data on first render\n  useEffect(() => {\n    if (!isEnabled) return;\n\n    function exec() {\n      setById(emojiData.emojis);\n    }\n\n    if (emojiData) {\n      exec();\n    } else {\n      ensureEmojiData().then(exec);\n    }\n  }, [isEnabled]);\n\n  const detectEmojiCodeThrottled = useThrottledResolver(() => {\n    const html = getHtml();\n    return isEnabled && html.includes(':') ? prepareForRegExp(html).match(RE_EMOJI_SEARCH)?.[0].trim() : undefined;\n  }, [getHtml, isEnabled], THROTTLE);\n\n  const getEmojiCode = useDerivedSignal(\n    detectEmojiCodeThrottled, [detectEmojiCodeThrottled, getHtml], true,\n  );\n\n  const updateFiltered = useLastCallback((emojis: Emoji[]) => {\n    setFilteredEmojis(emojis);\n\n    if (emojis === MEMO_EMPTY_ARRAY) {\n      setFilteredCustomEmojis(MEMO_EMPTY_ARRAY);\n      return;\n    }\n\n    const nativeEmojis = emojis.map((emoji) => emoji.native);\n    const customEmojis = uniqueByField(\n      selectCustomEmojiForEmojis(getGlobal(), nativeEmojis),\n      'id',\n    );\n    setFilteredCustomEmojis(customEmojis);\n  });\n\n  const insertEmoji = useLastCallback((emoji: string | ApiSticker, isForce = false) => {\n    const html = getHtml();\n    if (!html) return;\n\n    const atIndex = html.lastIndexOf(':', isForce ? html.lastIndexOf(':') - 1 : undefined);\n\n    if (atIndex !== -1) {\n      const emojiHtml = typeof emoji === 'string' ? renderText(emoji, ['emoji_html']) : buildCustomEmojiHtml(emoji);\n      setHtml(`${html.substring(0, atIndex)}${emojiHtml}`);\n\n      const messageInput = inputId === EDITABLE_INPUT_ID\n        ? document.querySelector<HTMLDivElement>(EDITABLE_INPUT_CSS_SELECTOR)!\n        : document.getElementById(inputId) as HTMLDivElement;\n\n      requestNextMutation(() => {\n        focusEditableElement(messageInput, true, true);\n      });\n    }\n\n    updateFiltered(MEMO_EMPTY_ARRAY);\n  });\n\n  useEffect(() => {\n    const emojiCode = getEmojiCode();\n    if (!emojiCode || !byId) {\n      updateFiltered(MEMO_EMPTY_ARRAY);\n      return;\n    }\n\n    const newShouldAutoInsert = emojiCode.length > 2 && emojiCode.endsWith(':');\n\n    const filter = emojiCode.substring(1, newShouldAutoInsert ? 1 + emojiCode.length - 2 : undefined);\n    let matched: Emoji[] = MEMO_EMPTY_ARRAY;\n\n    if (!filter) {\n      matched = prepareRecentEmojisMemo(byId, recentEmojiIds, EMOJIS_LIMIT);\n    } else if ((filter.length === 1 && RE_LOWERCASE_TEST.test(filter)) || filter.length >= FILTER_MIN_LENGTH) {\n      const library = prepareLibraryMemo(byId, baseEmojiKeywords, emojiKeywords);\n      matched = searchInLibraryMemo(library, filter.toLowerCase(), EMOJIS_LIMIT);\n    }\n\n    if (!matched.length) {\n      updateFiltered(MEMO_EMPTY_ARRAY);\n      return;\n    }\n\n    if (newShouldAutoInsert) {\n      insertEmoji(matched[0].native, true);\n    } else {\n      updateFiltered(matched);\n    }\n  }, [\n    baseEmojiKeywords, byId, getEmojiCode, emojiKeywords, insertEmoji, recentEmojiIds, updateFiltered,\n  ]);\n\n  useEffect(unmarkManuallyClosed, [unmarkManuallyClosed, getHtml]);\n\n  return {\n    isEmojiTooltipOpen: Boolean(filteredEmojis.length || filteredCustomEmojis.length) && !isManuallyClosed,\n    closeEmojiTooltip: markManuallyClosed,\n    filteredEmojis,\n    filteredCustomEmojis,\n    insertEmoji,\n  };\n}\n\nasync function ensureEmojiData() {\n  if (!emojiDataPromise) {\n    emojiDataPromise = import('emoji-data-ios/emoji-data.json');\n    emojiRawData = (await emojiDataPromise).default;\n\n    emojiData = uncompressEmoji(emojiRawData);\n  }\n\n  return emojiDataPromise;\n}\n\nfunction prepareRecentEmojis(byId: Record<string, Emoji>, recentEmojiIds: string[], limit: number) {\n  if (!byId || !recentEmojiIds.length) {\n    return MEMO_EMPTY_ARRAY;\n  }\n\n  return Object.values(pickTruthy(byId, recentEmojiIds)).slice(0, limit);\n}\n\nfunction prepareLibrary(\n  byId: Record<string, Emoji>,\n  baseEmojiKeywords?: Record<string, string[]>,\n  emojiKeywords?: Record<string, string[]>,\n): Library {\n  const emojis = Object.values(byId);\n\n  const byNative = buildCollectionByKey<Emoji>(emojis, 'native');\n  const baseEmojisByKeyword = baseEmojiKeywords\n    ? mapValues(baseEmojiKeywords, (natives) => {\n      return Object.values(pickTruthy(byNative, natives));\n    })\n    : {};\n  const emojisByKeyword = emojiKeywords\n    ? mapValues(emojiKeywords, (natives) => {\n      return Object.values(pickTruthy(byNative, natives));\n    })\n    : {};\n\n  const byKeyword = { ...baseEmojisByKeyword, ...emojisByKeyword };\n  const keywords = ([] as string[]).concat(Object.keys(baseEmojisByKeyword), Object.keys(emojisByKeyword));\n\n  const byName = emojis.reduce((result, emoji) => {\n    emoji.names.forEach((name) => {\n      if (!result[name]) {\n        result[name] = [];\n      }\n\n      result[name].push(emoji);\n    });\n\n    return result;\n  }, {} as Record<string, Emoji[]>);\n\n  const names = Object.keys(byName);\n  const maxKeyLength = keywords.reduce((max, keyword) => Math.max(max, keyword.length), 0);\n\n  return {\n    byKeyword,\n    keywords,\n    byName,\n    names,\n    maxKeyLength,\n  };\n}\n\nfunction searchInLibrary(library: Library, filter: string, limit: number) {\n  const {\n    byKeyword, keywords, byName, names, maxKeyLength,\n  } = library;\n\n  let matched: Emoji[] = [];\n\n  if (filter.length > maxKeyLength) {\n    return MEMO_EMPTY_ARRAY;\n  }\n\n  const matchedKeywords = keywords.filter((keyword) => keyword.startsWith(filter)).sort();\n  matched = matched.concat(Object.values(pickTruthy(byKeyword!, matchedKeywords)).flat());\n\n  // Also search by names, which is useful for non-English languages\n  const matchedNames = names.filter((name) => name.startsWith(filter));\n  matched = matched.concat(Object.values(pickTruthy(byName, matchedNames)).flat());\n\n  matched = unique(matched);\n\n  if (!matched.length) {\n    return MEMO_EMPTY_ARRAY;\n  }\n\n  return matched.slice(0, limit);\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './CustomEmojiTooltip';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst CustomEmojiTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const CustomEmojiTooltip = useModuleLoader(Bundles.Extra, 'CustomEmojiTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return CustomEmojiTooltip ? <CustomEmojiTooltip {...props} /> : undefined;\n};\n\nexport default CustomEmojiTooltipAsync;\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './SymbolMenu';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst SymbolMenuAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const SymbolMenu = useModuleLoader(Bundles.Extra, 'SymbolMenu', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return SymbolMenu ? <SymbolMenu {...props} /> : undefined;\n};\n\nexport default SymbolMenuAsync;\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useRef, useState } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiSticker, ApiVideo } from '../../../api/types';\nimport type { IAnchorPosition, ThreadId } from '../../../types';\n\nimport { EDITABLE_INPUT_CSS_SELECTOR, EDITABLE_INPUT_MODAL_CSS_SELECTOR } from '../../../config';\nimport buildClassName from '../../../util/buildClassName';\n\nimport useFlag from '../../../hooks/useFlag';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\nimport ResponsiveHoverButton from '../../ui/ResponsiveHoverButton';\nimport Spinner from '../../ui/Spinner';\nimport SymbolMenu from './SymbolMenu.async';\n\nconst MOBILE_KEYBOARD_HIDE_DELAY_MS = 100;\n\ntype OwnProps = {\n  chatId: string;\n  threadId?: ThreadId;\n  isMobile?: boolean;\n  isReady?: boolean;\n  isSymbolMenuOpen?: boolean;\n  canSendGifs?: boolean;\n  canSendStickers?: boolean;\n  isMessageComposer?: boolean;\n  idPrefix: string;\n  forceDarkTheme?: boolean;\n  openSymbolMenu: VoidFunction;\n  closeSymbolMenu: VoidFunction;\n  onCustomEmojiSelect: (emoji: ApiSticker) => void;\n  onStickerSelect?: (\n    sticker: ApiSticker,\n    isSilent?: boolean,\n    shouldSchedule?: boolean,\n    shouldPreserveInput?: boolean,\n    canUpdateStickerSetsOrder?: boolean,\n  ) => void;\n  onGifSelect?: (gif: ApiVideo, isSilent?: boolean, shouldSchedule?: boolean) => void;\n  onRemoveSymbol: VoidFunction;\n  onEmojiSelect: (emoji: string) => void;\n  closeBotCommandMenu?: VoidFunction;\n  closeSendAsMenu?: VoidFunction;\n  isSymbolMenuForced?: boolean;\n  isAttachmentModal?: boolean;\n  canSendPlainText?: boolean;\n  className?: string;\n  inputCssSelector?: string;\n};\n\nconst SymbolMenuButton: FC<OwnProps> = ({\n  chatId,\n  threadId,\n  isMobile,\n  canSendGifs,\n  canSendStickers,\n  isMessageComposer,\n  isReady,\n  isSymbolMenuOpen,\n  idPrefix,\n  isAttachmentModal,\n  canSendPlainText,\n  isSymbolMenuForced,\n  className,\n  forceDarkTheme,\n  inputCssSelector = EDITABLE_INPUT_CSS_SELECTOR,\n  openSymbolMenu,\n  closeSymbolMenu,\n  onCustomEmojiSelect,\n  onStickerSelect,\n  onGifSelect,\n  onRemoveSymbol,\n  onEmojiSelect,\n  closeBotCommandMenu,\n  closeSendAsMenu,\n}) => {\n  const {\n    setStickerSearchQuery,\n    setGifSearchQuery,\n    addRecentEmoji,\n    addRecentCustomEmoji,\n  } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const triggerRef = useRef<HTMLDivElement>(null);\n\n  const [isSymbolMenuLoaded, onSymbolMenuLoadingComplete] = useFlag();\n  const [contextMenuAnchor, setContextMenuAnchor] = useState<IAnchorPosition | undefined>(undefined);\n\n  const symbolMenuButtonClassName = buildClassName(\n    'composer-action-button mobile-symbol-menu-button',\n    !isReady && 'not-ready',\n    isSymbolMenuLoaded\n      ? (isSymbolMenuOpen && 'menu-opened')\n      : (isSymbolMenuOpen && 'is-loading'),\n  );\n\n  const handleActivateSymbolMenu = useLastCallback(() => {\n    closeBotCommandMenu?.();\n    closeSendAsMenu?.();\n    openSymbolMenu();\n    const triggerEl = triggerRef.current;\n    if (!triggerEl) return;\n    const { x, y } = triggerEl.getBoundingClientRect();\n    setContextMenuAnchor({ x, y });\n  });\n\n  const handleSearchOpen = useLastCallback((type: 'stickers' | 'gifs') => {\n    if (type === 'stickers') {\n      setStickerSearchQuery({ query: '' });\n      setGifSearchQuery({ query: undefined });\n    } else {\n      setGifSearchQuery({ query: '' });\n      setStickerSearchQuery({ query: undefined });\n    }\n  });\n\n  const handleSymbolMenuOpen = useLastCallback(() => {\n    const messageInput = document.querySelector<HTMLDivElement>(\n      isAttachmentModal ? EDITABLE_INPUT_MODAL_CSS_SELECTOR : inputCssSelector,\n    );\n\n    if (!isMobile || messageInput !== document.activeElement) {\n      openSymbolMenu();\n      return;\n    }\n\n    messageInput?.blur();\n    setTimeout(() => {\n      closeBotCommandMenu?.();\n      openSymbolMenu();\n    }, MOBILE_KEYBOARD_HIDE_DELAY_MS);\n  });\n\n  const getTriggerElement = useLastCallback(() => triggerRef.current);\n  const getRootElement = useLastCallback(() => triggerRef.current?.closest('.custom-scroll, .no-scrollbar'));\n  const getMenuElement = useLastCallback(() => document.querySelector('#portals .SymbolMenu .bubble'));\n  const getLayout = useLastCallback(() => ({ withPortal: true }));\n\n  return (\n    <>\n      {isMobile ? (\n        <Button\n          className={symbolMenuButtonClassName}\n          round\n          color=\"translucent\"\n          onClick={isSymbolMenuOpen ? closeSymbolMenu : handleSymbolMenuOpen}\n          ariaLabel=\"Choose emoji, sticker or GIF\"\n        >\n          <Icon name=\"smile\" />\n          <Icon name=\"keyboard\" />\n          {isSymbolMenuOpen && !isSymbolMenuLoaded && <Spinner color=\"gray\" />}\n        </Button>\n      ) : (\n        <ResponsiveHoverButton\n          className={buildClassName('composer-action-button symbol-menu-button', isSymbolMenuOpen && 'activated')}\n          round\n          color=\"translucent\"\n          onActivate={handleActivateSymbolMenu}\n          ariaLabel=\"Choose emoji, sticker or GIF\"\n        >\n          <div ref={triggerRef} className=\"symbol-menu-trigger\" />\n          <Icon name=\"smile\" />\n        </ResponsiveHoverButton>\n      )}\n\n      <SymbolMenu\n        chatId={chatId}\n        threadId={threadId}\n        isOpen={isSymbolMenuOpen || Boolean(isSymbolMenuForced)}\n        canSendGifs={canSendGifs}\n        canSendStickers={canSendStickers}\n        isMessageComposer={isMessageComposer}\n        idPrefix={idPrefix}\n        onLoad={onSymbolMenuLoadingComplete}\n        onClose={closeSymbolMenu}\n        onEmojiSelect={onEmojiSelect}\n        onStickerSelect={onStickerSelect}\n        onCustomEmojiSelect={onCustomEmojiSelect}\n        onGifSelect={onGifSelect}\n        onRemoveSymbol={onRemoveSymbol}\n        onSearchOpen={handleSearchOpen}\n        addRecentEmoji={addRecentEmoji}\n        addRecentCustomEmoji={addRecentCustomEmoji}\n        isAttachmentModal={isAttachmentModal}\n        canSendPlainText={canSendPlainText}\n        className={buildClassName(className, forceDarkTheme && 'component-theme-dark')}\n        anchor={isAttachmentModal ? contextMenuAnchor : undefined}\n        getTriggerElement={isAttachmentModal ? getTriggerElement : undefined}\n        getRootElement={isAttachmentModal ? getRootElement : undefined}\n        getMenuElement={isAttachmentModal ? getMenuElement : undefined}\n        getLayout={isAttachmentModal ? getLayout : undefined}\n      />\n    </>\n  );\n};\n\nexport default memo(SymbolMenuButton);\n","import type { AriaRole } from 'react';\nimport React from 'react';\n\nimport type { IconName } from '../../../types/icons';\n\nimport buildClassName from '../../../util/buildClassName';\n\ntype OwnProps = {\n  name: IconName;\n  className?: string;\n  style?: string;\n  role?: AriaRole;\n  ariaLabel?: string;\n  character?: string;\n  ref?: React.RefObject<HTMLElement>;\n  onClick?: (e: React.MouseEvent<HTMLDivElement>) => void;\n};\n\nconst Icon = ({\n  name,\n  ref,\n  className,\n  style,\n  role,\n  ariaLabel,\n  character,\n  onClick,\n}: OwnProps) => {\n  return (\n    <i\n      ref={ref}\n      className={buildClassName(`icon icon-${name}`, className)}\n      style={style}\n      aria-hidden={!ariaLabel}\n      aria-label={ariaLabel}\n      data-char={character}\n      role={role}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default Icon;\n","import * as langProvider from '../../../util/oldLangProvider';\nimport useEffectOnce from './useEffectOnce';\nimport useForceUpdate from './useForceUpdate';\n\nexport type OldLangFn = langProvider.LangFn;\n/**\n * @deprecated\n */\nconst useOldLang = (): OldLangFn => {\n  const forceUpdate = useForceUpdate();\n\n  useEffectOnce(() => {\n    return langProvider.addCallback(forceUpdate);\n  });\n\n  return langProvider.getTranslationFn();\n};\n\nexport default useOldLang;\n","import { useEffect } from 'react';\n\nfunction useEffectOnce(effect: React.EffectCallback) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useEffect(effect, []);\n}\n\nexport default useEffectOnce;\n","export enum ElectronEvent {\n  FULLSCREEN_CHANGE = 'fullscreen-change',\n  UPDATE_ERROR = 'update-error',\n  UPDATE_AVAILABLE = 'update-available',\n  DEEPLINK = 'deeplink',\n}\n\nexport enum ElectronAction {\n  GET_IS_FULLSCREEN = 'get-is-fullscreen',\n  INSTALL_UPDATE = 'install-update',\n  HANDLE_DOUBLE_CLICK = 'handle-double-click',\n  OPEN_NEW_WINDOW = 'open-new-window',\n  SET_WINDOW_TITLE = 'set-window-title',\n  SET_TRAFFIC_LIGHT_POSITION = 'set-traffic-light-position',\n  SET_IS_AUTO_UPDATE_ENABLED = 'set-is-auto-update-enabled',\n  GET_IS_AUTO_UPDATE_ENABLED = 'get-is-auto-update-enabled',\n  SET_IS_TRAY_ICON_ENABLED = 'set-is-tray-icon-enabled',\n  GET_IS_TRAY_ICON_ENABLED = 'get-is-tray-icon-enabled',\n  RESTORE_LOCAL_STORAGE = 'restore-local-storage',\n}\n\nexport type TrafficLightPosition = 'standard' | 'lowered';\n\nexport interface ElectronApi {\n  isFullscreen: () => Promise<boolean>;\n  installUpdate: () => Promise<void>;\n  handleDoubleClick: () => Promise<void>;\n  openNewWindow: (url: string, title?: string) => Promise<void>;\n  setWindowTitle: (title?: string) => Promise<void>;\n  setTrafficLightPosition: (position: TrafficLightPosition) => Promise<void>;\n  setIsAutoUpdateEnabled: (value: boolean) => Promise<void>;\n  getIsAutoUpdateEnabled: () => Promise<boolean>;\n  setIsTrayIconEnabled: (value: boolean) => Promise<void>;\n  getIsTrayIconEnabled: () => Promise<boolean>;\n  restoreLocalStorage: () => Promise<void>;\n  on: (eventName: ElectronEvent, callback: any) => VoidFunction;\n}\n\ndeclare global {\n  interface Window {\n    electron?: ElectronApi;\n  }\n}\n","import { getGlobal } from '../../global';\n\nimport type { ApiChatFolder } from '../../api/types';\nimport type { IconName } from '../../types/icons';\nimport type { Dispatch, StateReducer } from '../useReducer';\n\nimport { selectChat } from '../../global/selectors';\nimport { omit, pick } from '../../util/iteratees';\nimport useReducer from '../useReducer';\n\nexport type FolderChatType = {\n  icon: IconName;\n  title: string;\n  key: keyof Pick<ApiChatFolder, (\n    'contacts' | 'nonContacts' | 'groups' | 'channels' | 'bots' |\n    'excludeMuted' | 'excludeArchived' | 'excludeRead'\n  )>;\n};\n\nconst INCLUDE_FILTER_FIELDS: Array<keyof FolderIncludeFilters> = [\n  'includedChatIds', 'bots', 'channels', 'groups', 'contacts', 'nonContacts',\n];\nconst EXCLUDE_FILTER_FIELDS: Array<keyof FolderExcludeFilters> = [\n  'excludedChatIds', 'excludeArchived', 'excludeMuted', 'excludeRead',\n];\n\nexport function selectChatFilters(state: FoldersState, mode: 'included' | 'excluded', selectTemp?: boolean) {\n  let selectedChatIds: string[] = [];\n  let selectedChatTypes: FolderChatType['key'][] = [];\n\n  if (mode === 'included') {\n    const {\n      includedChatIds,\n      ...includeFilters\n    } = selectTemp\n      ? state.includeFilters || {}\n      : pick(\n        state.folder,\n        INCLUDE_FILTER_FIELDS,\n      );\n\n    selectedChatIds = includedChatIds || [];\n    selectedChatTypes = (Object.keys(includeFilters) as Array<keyof typeof includeFilters>)\n      .filter((key) => Boolean(includeFilters[key]));\n  } else {\n    const {\n      excludedChatIds,\n      ...excludeFilters\n    } = selectTemp\n      ? state.excludeFilters || {}\n      : pick(\n        state.folder,\n        EXCLUDE_FILTER_FIELDS,\n      );\n\n    selectedChatIds = excludedChatIds || [];\n    selectedChatTypes = (Object.keys(excludeFilters) as Array<keyof typeof excludeFilters>)\n      .filter((key) => Boolean(excludeFilters[key]));\n  }\n\n  const global = getGlobal();\n  const existingSelectedChatIds = selectedChatIds.filter((id) => selectChat(global, id));\n\n  return {\n    selectedChatIds: existingSelectedChatIds,\n    selectedChatTypes,\n  };\n}\n\nfunction getSuggestedFolderName(includeFilters?: FolderIncludeFilters) {\n  if (includeFilters) {\n    const {\n      includedChatIds,\n      ...filters\n    } = includeFilters;\n\n    if (\n      Object.values(filters).filter(Boolean).length > 1\n      || (includedChatIds?.length)\n    ) {\n      return '';\n    }\n\n    if (filters.bots) {\n      return 'Bots';\n    } else if (filters.groups) {\n      return 'Groups';\n    } else if (filters.channels) {\n      return 'Channels';\n    } else if (filters.contacts) {\n      return 'Contacts';\n    } else if (filters.nonContacts) {\n      return 'Non-Contacts';\n    }\n  }\n\n  return '';\n}\n\ntype FolderIncludeFilters = Pick<ApiChatFolder, (\n  'includedChatIds' | 'bots' | 'channels' | 'groups' | 'contacts' | 'nonContacts'\n)>;\ntype FolderExcludeFilters = Pick<ApiChatFolder, 'excludedChatIds' | 'excludeArchived' | 'excludeMuted' | 'excludeRead'>;\n\nexport type FoldersState = {\n  mode: 'create' | 'edit';\n  isLoading?: boolean;\n  isTouched?: boolean;\n  error?: string;\n  folderId?: number;\n  chatFilter: string;\n  folder: Omit<ApiChatFolder, 'id' | 'description' | 'emoticon'>;\n  includeFilters?: FolderIncludeFilters;\n  excludeFilters?: FolderExcludeFilters;\n};\nexport type FoldersActions = (\n  'setTitle' | 'saveFilters' | 'editFolder' | 'reset' | 'setChatFilter' | 'setIsLoading' | 'setError' |\n  'editIncludeFilters' | 'editExcludeFilters' | 'setIncludeFilters' | 'setExcludeFilters' | 'setIsTouched' |\n  'setFolderId' | 'setIsChatlist'\n  );\nexport type FolderEditDispatch = Dispatch<FoldersState, FoldersActions>;\n\nconst INITIAL_STATE: FoldersState = {\n  mode: 'create',\n  chatFilter: '',\n  folder: {\n    title: { text: '' },\n    includedChatIds: [],\n    excludedChatIds: [],\n  },\n};\n\nconst foldersReducer: StateReducer<FoldersState, FoldersActions> = (\n  state,\n  action,\n): FoldersState => {\n  switch (action.type) {\n    case 'setTitle':\n      return {\n        ...state,\n        folder: {\n          ...state.folder,\n          title: { text: action.payload },\n        },\n        isTouched: true,\n      };\n    case 'setFolderId':\n      return {\n        ...state,\n        folderId: action.payload,\n        mode: 'edit',\n      };\n    case 'editIncludeFilters':\n      return {\n        ...state,\n        includeFilters: pick(\n          state.folder,\n          INCLUDE_FILTER_FIELDS,\n        ),\n      };\n    case 'editExcludeFilters':\n      return {\n        ...state,\n        excludeFilters: pick(\n          state.folder,\n          EXCLUDE_FILTER_FIELDS,\n        ),\n      };\n    case 'setIncludeFilters':\n      return {\n        ...state,\n        includeFilters: action.payload,\n        chatFilter: '',\n      };\n    case 'setExcludeFilters':\n      return {\n        ...state,\n        excludeFilters: action.payload,\n        chatFilter: '',\n      };\n    case 'saveFilters':\n      if (state.includeFilters) {\n        return {\n          ...state,\n          folder: {\n            ...omit(state.folder, INCLUDE_FILTER_FIELDS),\n            title: state.folder.title ? state.folder.title : { text: getSuggestedFolderName(state.includeFilters) },\n            ...state.includeFilters,\n          },\n          includeFilters: undefined,\n          chatFilter: '',\n          isTouched: true,\n        };\n      } else if (state.excludeFilters) {\n        return {\n          ...state,\n          folder: {\n            ...omit(state.folder, EXCLUDE_FILTER_FIELDS),\n            ...state.excludeFilters,\n          },\n          excludeFilters: undefined,\n          chatFilter: '',\n          isTouched: true,\n        };\n      } else {\n        return state;\n      }\n    case 'editFolder': {\n      const { id: folderId, description, ...folder } = action.payload;\n\n      return {\n        mode: 'edit',\n        folderId,\n        folder,\n        chatFilter: '',\n      };\n    }\n    case 'setChatFilter': {\n      return {\n        ...state,\n        chatFilter: action.payload,\n      };\n    }\n    case 'setIsTouched': {\n      return {\n        ...state,\n        isTouched: action.payload,\n      };\n    }\n    case 'setIsLoading': {\n      return {\n        ...state,\n        isLoading: action.payload,\n      };\n    }\n    case 'setError': {\n      return {\n        ...state,\n        isLoading: false,\n        error: action.payload,\n      };\n    }\n    case 'setIsChatlist':\n      return {\n        ...state,\n        folder: {\n          ...state.folder,\n          isChatList: action.payload,\n        },\n      };\n    case 'reset':\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n\nconst useFoldersReducer = () => {\n  return useReducer(foldersReducer, INITIAL_STATE);\n};\n\nexport default useFoldersReducer;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"byPckqUT\",\"indicator\":\"nl36F75B\",\"indicatorInner\":\"AA5s1Pu4\",\"selected\":\"qy2i51dM\",\"active\":\"IsUWP16T\",\"bar-animation-transform-2\":\"p_1Kbke9\",\"barAnimationTransform2\":\"p_1Kbke9\",\"bar-animation-transform-1\":\"gOCprMbJ\",\"barAnimationTransform1\":\"gOCprMbJ\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\n\nimport buildClassName from '../../../util/buildClassName';\n\nimport styles from './ChatCallStatus.module.scss';\n\ntype OwnProps = {\n  isSelected?: boolean;\n  isActive?: boolean;\n  isMobile?: boolean;\n};\n\nconst ChatCallStatus: FC<OwnProps> = ({\n  isSelected,\n  isActive,\n  isMobile,\n}) => {\n  return (\n    <div className={buildClassName(\n      styles.root,\n      isActive && styles.active,\n      isSelected && !isMobile && styles.selected,\n    )}\n    >\n      <div className={styles.indicator}>\n        <div className={styles.indicatorInner} />\n        <div className={styles.indicatorInner} />\n        <div className={styles.indicatorInner} />\n      </div>\n    </div>\n  );\n};\n\nexport default memo(ChatCallStatus);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useEffect, useMemo } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type {\n  ApiChat,\n  ApiDraft,\n  ApiMessage,\n  ApiMessageOutgoingStatus,\n  ApiPeer,\n  ApiTopic,\n  ApiTypeStory,\n  ApiTypingStatus,\n  ApiUser,\n  ApiUserStatus,\n} from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { ChatAnimationTypes } from './hooks';\nimport { MAIN_THREAD_ID } from '../../../api/types';\nimport { StoryViewerOrigin } from '../../../types';\n\nimport {\n  groupStatefulContent,\n  isUserId,\n  isUserOnline,\n} from '../../../global/helpers';\nimport { getIsChatMuted } from '../../../global/helpers/notifications';\nimport {\n  selectCanAnimateInterface,\n  selectChat,\n  selectChatLastMessage,\n  selectChatLastMessageId,\n  selectChatMessage,\n  selectCurrentMessageList,\n  selectDraft,\n  selectIsCurrentUserFrozen,\n  selectIsForumPanelClosed,\n  selectIsForumPanelOpen,\n  selectNotifyDefaults,\n  selectNotifyException,\n  selectOutgoingStatus,\n  selectPeer,\n  selectPeerStory,\n  selectSender,\n  selectTabState,\n  selectThreadParam,\n  selectTopicFromMessage,\n  selectTopicsInfo,\n  selectUser,\n  selectUserStatus,\n} from '../../../global/selectors';\nimport { IS_OPEN_IN_NEW_TAB_SUPPORTED } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { createLocationHash } from '../../../util/routing';\n\nimport useSelectorSignal from '../../../hooks/data/useSelectorSignal';\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useChatContextActions from '../../../hooks/useChatContextActions';\nimport useEnsureMessage from '../../../hooks/useEnsureMessage';\nimport useFlag from '../../../hooks/useFlag';\nimport { useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useShowTransitionDeprecated from '../../../hooks/useShowTransitionDeprecated';\nimport useChatListEntry from './hooks/useChatListEntry';\n\nimport Avatar from '../../common/Avatar';\nimport DeleteChatModal from '../../common/DeleteChatModal';\nimport FullNameTitle from '../../common/FullNameTitle';\nimport Icon from '../../common/icons/Icon';\nimport StarIcon from '../../common/icons/StarIcon';\nimport LastMessageMeta from '../../common/LastMessageMeta';\nimport ListItem from '../../ui/ListItem';\nimport ChatFolderModal from '../ChatFolderModal.async';\nimport MuteChatModal from '../MuteChatModal.async';\nimport ChatBadge from './ChatBadge';\nimport ChatCallStatus from './ChatCallStatus';\n\nimport './Chat.scss';\n\ntype OwnProps = {\n  chatId: string;\n  folderId?: number;\n  orderDiff: number;\n  animationType: ChatAnimationTypes;\n  isPinned?: boolean;\n  offsetTop?: number;\n  isSavedDialog?: boolean;\n  isPreview?: boolean;\n  previewMessageId?: number;\n  className?: string;\n  observeIntersection?: ObserveFn;\n  onDragEnter?: (chatId: string) => void;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  lastMessageStory?: ApiTypeStory;\n  listedTopicIds?: number[];\n  topics?: Record<number, ApiTopic>;\n  isMuted?: boolean;\n  user?: ApiUser;\n  userStatus?: ApiUserStatus;\n  lastMessageSender?: ApiPeer;\n  lastMessageOutgoingStatus?: ApiMessageOutgoingStatus;\n  draft?: ApiDraft;\n  isSelected?: boolean;\n  isSelectedForum?: boolean;\n  isForumPanelOpen?: boolean;\n  canScrollDown?: boolean;\n  canChangeFolder?: boolean;\n  lastMessageTopic?: ApiTopic;\n  typingStatus?: ApiTypingStatus;\n  withInterfaceAnimations?: boolean;\n  lastMessageId?: number;\n  lastMessage?: ApiMessage;\n  currentUserId: string;\n  isSynced?: boolean;\n  isAccountFrozen?: boolean;\n};\n\nconst Chat: FC<OwnProps & StateProps> = ({\n  chatId,\n  folderId,\n  orderDiff,\n  animationType,\n  isPinned,\n  listedTopicIds,\n  topics,\n  observeIntersection,\n  chat,\n  lastMessageStory,\n  isMuted,\n  user,\n  userStatus,\n  lastMessageSender,\n  lastMessageOutgoingStatus,\n  offsetTop,\n  draft,\n  withInterfaceAnimations,\n  isSelected,\n  isSelectedForum,\n  isForumPanelOpen,\n  canScrollDown,\n  canChangeFolder,\n  lastMessageTopic,\n  typingStatus,\n  lastMessageId,\n  lastMessage,\n  isSavedDialog,\n  currentUserId,\n  isPreview,\n  previewMessageId,\n  className,\n  isSynced,\n  onDragEnter,\n  isAccountFrozen,\n}) => {\n  const {\n    openChat,\n    openSavedDialog,\n    toggleChatInfo,\n    focusLastMessage,\n    focusMessage,\n    loadTopics,\n    openForumPanel,\n    closeForumPanel,\n    setShouldCloseRightColumn,\n    reportMessages,\n    openFrozenAccountModal,\n  } = getActions();\n\n  const { isMobile } = useAppLayout();\n  const [isDeleteModalOpen, openDeleteModal, closeDeleteModal] = useFlag();\n  const [isMuteModalOpen, openMuteModal, closeMuteModal] = useFlag();\n  const [isChatFolderModalOpen, openChatFolderModal, closeChatFolderModal] = useFlag();\n  const [shouldRenderDeleteModal, markRenderDeleteModal, unmarkRenderDeleteModal] = useFlag();\n  const [shouldRenderMuteModal, markRenderMuteModal, unmarkRenderMuteModal] = useFlag();\n  const [shouldRenderChatFolderModal, markRenderChatFolderModal, unmarkRenderChatFolderModal] = useFlag();\n\n  const { isForum, isForumAsMessages } = chat || {};\n\n  useEnsureMessage(isSavedDialog ? currentUserId : chatId, lastMessageId, lastMessage);\n\n  const { renderSubtitle, ref } = useChatListEntry({\n    chat,\n    chatId,\n    lastMessage,\n    typingStatus,\n    draft,\n    statefulMediaContent: groupStatefulContent({ story: lastMessageStory }),\n    lastMessageTopic,\n    lastMessageSender,\n    observeIntersection,\n    animationType,\n    withInterfaceAnimations,\n    orderDiff,\n    isSavedDialog,\n    isPreview,\n    topics,\n  });\n\n  const getIsForumPanelClosed = useSelectorSignal(selectIsForumPanelClosed);\n\n  const handleClick = useLastCallback(() => {\n    const noForumTopicPanel = isMobile && isForumAsMessages;\n    if (isMobile) {\n      setShouldCloseRightColumn({ value: true });\n    }\n\n    if (isPreview) {\n      focusMessage({\n        chatId,\n        messageId: previewMessageId!,\n      });\n      return;\n    }\n\n    if (isSavedDialog) {\n      openSavedDialog({ chatId, noForumTopicPanel: true }, { forceOnHeavyAnimation: true });\n\n      if (isMobile) {\n        toggleChatInfo({ force: false });\n      }\n      return;\n    }\n\n    if (isForum) {\n      if (isForumPanelOpen) {\n        closeForumPanel(undefined, { forceOnHeavyAnimation: true });\n\n        return;\n      } else {\n        if (!noForumTopicPanel) {\n          openForumPanel({ chatId }, { forceOnHeavyAnimation: true });\n        }\n\n        if (!isForumAsMessages) return;\n      }\n    }\n\n    openChat({ id: chatId, noForumTopicPanel, shouldReplaceHistory: true }, { forceOnHeavyAnimation: true });\n\n    if (isSelected && canScrollDown) {\n      focusLastMessage();\n    }\n  });\n\n  const handleDragEnter = useLastCallback((e) => {\n    e.preventDefault();\n    onDragEnter?.(chatId);\n  });\n\n  const handleDelete = useLastCallback(() => {\n    if (isAccountFrozen) {\n      openFrozenAccountModal();\n      return;\n    }\n\n    markRenderDeleteModal();\n    openDeleteModal();\n  });\n\n  const handleMute = useLastCallback(() => {\n    if (isAccountFrozen) {\n      openFrozenAccountModal();\n      return;\n    }\n\n    markRenderMuteModal();\n    openMuteModal();\n  });\n\n  const handleChatFolderChange = useLastCallback(() => {\n    markRenderChatFolderModal();\n    openChatFolderModal();\n  });\n\n  const handleReport = useLastCallback(() => {\n    if (isAccountFrozen) {\n      openFrozenAccountModal();\n      return;\n    }\n\n    if (!chat) return;\n    reportMessages({ chatId: chat.id, messageIds: [] });\n  });\n\n  const contextActions = useChatContextActions({\n    chat,\n    user,\n    handleDelete,\n    handleMute,\n    handleChatFolderChange,\n    handleReport,\n    folderId,\n    isPinned,\n    isMuted,\n    canChangeFolder,\n    isSavedDialog,\n    currentUserId,\n    isPreview,\n    topics,\n  });\n\n  const isIntersecting = useIsIntersecting(ref, chat ? observeIntersection : undefined);\n\n  // Load the forum topics to display unread count badge\n  useEffect(() => {\n    if (isIntersecting && isForum && isSynced && listedTopicIds === undefined) {\n      loadTopics({ chatId });\n    }\n  }, [chatId, listedTopicIds, isSynced, isForum, isIntersecting]);\n\n  const isOnline = user && userStatus && isUserOnline(user, userStatus);\n  const { hasShownClass: isAvatarOnlineShown } = useShowTransitionDeprecated(isOnline);\n\n  const href = useMemo(() => {\n    if (!IS_OPEN_IN_NEW_TAB_SUPPORTED) return undefined;\n\n    if (isSavedDialog) {\n      return `#${createLocationHash(currentUserId, 'thread', chatId)}`;\n    }\n\n    return `#${createLocationHash(chatId, 'thread', MAIN_THREAD_ID)}`;\n  }, [chatId, currentUserId, isSavedDialog]);\n\n  if (!chat) {\n    return undefined;\n  }\n\n  const peer = user || chat;\n\n  const chatClassName = buildClassName(\n    'Chat chat-item-clickable',\n    isUserId(chatId) ? 'private' : 'group',\n    isForum && 'forum',\n    isSelected && 'selected',\n    isSelectedForum && 'selected-forum',\n    isPreview && 'standalone',\n    className,\n  );\n\n  return (\n    <ListItem\n      ref={ref}\n      className={chatClassName}\n      href={href}\n      style={`top: ${offsetTop}px`}\n      ripple={!isForum && !isMobile}\n      contextActions={contextActions}\n      onClick={handleClick}\n      onDragEnter={handleDragEnter}\n      withPortalForMenu\n    >\n      <div className={buildClassName('status', 'status-clickable')}>\n        <Avatar\n          peer={peer}\n          isSavedMessages={user?.isSelf}\n          isSavedDialog={isSavedDialog}\n          size={isPreview ? 'medium' : 'large'}\n          withStory={!user?.isSelf}\n          withStoryGap={isAvatarOnlineShown || Boolean(chat.subscriptionUntil)}\n          storyViewerOrigin={StoryViewerOrigin.ChatList}\n          storyViewerMode=\"single-peer\"\n        />\n        <div className=\"avatar-badge-wrapper\">\n          <div\n            className={buildClassName('avatar-online', 'avatar-badge', isAvatarOnlineShown && 'avatar-online-shown')}\n          />\n          {!isAvatarOnlineShown && Boolean(chat.subscriptionUntil) && (\n            <StarIcon type=\"gold\" className=\"avatar-badge avatar-subscription\" size=\"adaptive\" />\n          )}\n          <ChatBadge\n            chat={chat}\n            isMuted={isMuted}\n            shouldShowOnlyMostImportant\n            forceHidden={getIsForumPanelClosed}\n            topics={topics}\n            isSelected={isSelected}\n          />\n        </div>\n        {chat.isCallActive && chat.isCallNotEmpty && (\n          <ChatCallStatus isMobile={isMobile} isSelected={isSelected} isActive={withInterfaceAnimations} />\n        )}\n      </div>\n      <div className=\"info\">\n        <div className=\"info-row\">\n          <FullNameTitle\n            peer={peer}\n            withEmojiStatus\n            isSavedMessages={chatId === user?.id && user?.isSelf}\n            isSavedDialog={isSavedDialog}\n            observeIntersection={observeIntersection}\n          />\n          {isMuted && !isSavedDialog && <Icon name=\"muted\" />}\n          <div className=\"separator\" />\n          {lastMessage && (\n            <LastMessageMeta\n              message={lastMessage}\n              outgoingStatus={!isSavedDialog ? lastMessageOutgoingStatus : undefined}\n              draftDate={draft?.date}\n            />\n          )}\n        </div>\n        <div className=\"subtitle\">\n          {renderSubtitle()}\n          {!isPreview && (\n            <ChatBadge\n              chat={chat}\n              isPinned={isPinned}\n              isMuted={isMuted}\n              isSavedDialog={isSavedDialog}\n              hasMiniApp={user?.hasMainMiniApp}\n              topics={topics}\n              isSelected={isSelected}\n            />\n          )}\n        </div>\n      </div>\n      {shouldRenderDeleteModal && (\n        <DeleteChatModal\n          isOpen={isDeleteModalOpen}\n          onClose={closeDeleteModal}\n          onCloseAnimationEnd={unmarkRenderDeleteModal}\n          chat={chat}\n          isSavedDialog={isSavedDialog}\n        />\n      )}\n      {shouldRenderMuteModal && (\n        <MuteChatModal\n          isOpen={isMuteModalOpen}\n          onClose={closeMuteModal}\n          onCloseAnimationEnd={unmarkRenderMuteModal}\n          chatId={chatId}\n        />\n      )}\n      {shouldRenderChatFolderModal && (\n        <ChatFolderModal\n          isOpen={isChatFolderModalOpen}\n          onClose={closeChatFolderModal}\n          onCloseAnimationEnd={unmarkRenderChatFolderModal}\n          chatId={chatId}\n        />\n      )}\n    </ListItem>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, {\n    chatId, isSavedDialog, isPreview, previewMessageId,\n  }): StateProps => {\n    const chat = selectChat(global, chatId);\n    const user = selectUser(global, chatId);\n    if (!chat) {\n      return {\n        currentUserId: global.currentUserId!,\n      };\n    }\n\n    const lastMessageId = previewMessageId || selectChatLastMessageId(global, chatId, isSavedDialog ? 'saved' : 'all');\n    const lastMessage = previewMessageId\n      ? selectChatMessage(global, chatId, previewMessageId)\n      : selectChatLastMessage(global, chatId, isSavedDialog ? 'saved' : 'all');\n    const { isOutgoing, forwardInfo } = lastMessage || {};\n    const savedDialogSender = isSavedDialog && forwardInfo?.fromId ? selectPeer(global, forwardInfo.fromId) : undefined;\n    const messageSender = lastMessage ? selectSender(global, lastMessage) : undefined;\n    const lastMessageSender = savedDialogSender || messageSender;\n\n    const {\n      chatId: currentChatId,\n      threadId: currentThreadId,\n      type: messageListType,\n    } = selectCurrentMessageList(global) || {};\n    const isSelected = !isPreview && chatId === currentChatId && (isSavedDialog\n      ? chatId === currentThreadId : currentThreadId === MAIN_THREAD_ID);\n    const isSelectedForum = (chat.isForum && chatId === currentChatId)\n      || chatId === selectTabState(global).forumPanelChatId;\n\n    const userStatus = selectUserStatus(global, chatId);\n    const lastMessageTopic = lastMessage && selectTopicFromMessage(global, lastMessage);\n\n    const typingStatus = selectThreadParam(global, chatId, MAIN_THREAD_ID, 'typingStatus');\n\n    const topicsInfo = selectTopicsInfo(global, chatId);\n\n    const storyData = lastMessage?.content.storyData;\n    const lastMessageStory = storyData && selectPeerStory(global, storyData.peerId, storyData.id);\n    const isAccountFrozen = selectIsCurrentUserFrozen(global);\n\n    return {\n      chat,\n      isMuted: getIsChatMuted(chat, selectNotifyDefaults(global), selectNotifyException(global, chat.id)),\n      lastMessageSender,\n      draft: selectDraft(global, chatId, MAIN_THREAD_ID),\n      isSelected,\n      isSelectedForum,\n      isForumPanelOpen: selectIsForumPanelOpen(global),\n      canScrollDown: isSelected && messageListType === 'thread',\n      canChangeFolder: (global.chatFolders.orderedIds?.length || 0) > 1,\n      ...(isOutgoing && lastMessage && {\n        lastMessageOutgoingStatus: selectOutgoingStatus(global, lastMessage),\n      }),\n      user,\n      userStatus,\n      lastMessageTopic,\n      typingStatus,\n      withInterfaceAnimations: selectCanAnimateInterface(global),\n      lastMessage,\n      lastMessageId,\n      currentUserId: global.currentUserId!,\n      listedTopicIds: topicsInfo?.listedTopicIds,\n      topics: topicsInfo?.topicsById,\n      isSynced: global.isSynced,\n      lastMessageStory,\n      isAccountFrozen,\n    };\n  },\n)(Chat));\n","import { ANIMATION_END_DELAY } from '../../../config';\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { applyStyles } from '../../../util/animation';\nimport stopEvent from '../../../util/stopEvent';\nimport { REM } from '../../common/helpers/mediaDimensions';\n\nimport ribbonStyles from '../StoryRibbon.module.scss';\nimport togglerStyles from '../StoryToggler.module.scss';\n\nexport const ANIMATION_DURATION = 250;\nconst RIBBON_OFFSET = 0.25 * REM;\nconst RIBBON_Z_INDEX = 11;\nconst STROKE_OFFSET = 0.1875 * REM;\nconst CANVAS_OFFSET = 0.125 * REM;\n\nconst callbacks: Set<NoneToVoidFunction> = new Set();\n\nexport function animateOpening(isArchived?: boolean) {\n  cancelDelayedCallbacks();\n\n  const {\n    container, toggler, leftMainHeader, ribbonPeers, toggleAvatars,\n  } = getHTMLElements(isArchived);\n\n  if (!toggler || !toggleAvatars || !ribbonPeers || !container || !leftMainHeader) {\n    return;\n  }\n\n  const { bottom: headerBottom, right: headerRight } = leftMainHeader.getBoundingClientRect();\n  const toTop = headerBottom + RIBBON_OFFSET;\n\n  // Toggle avatars are in the reverse order\n  const lastToggleAvatar = toggleAvatars[0];\n  const firstToggleAvatar = toggleAvatars[toggleAvatars.length - 1];\n  const lastId = getPeerId(lastToggleAvatar);\n\n  Array.from(ribbonPeers).reverse().forEach((peer, index, { length }) => {\n    const id = getPeerId(peer);\n    if (!id) return;\n    const isLast = id === lastId;\n    let toggleAvatar = selectByPeerId(toggler, id);\n    let zIndex = RIBBON_Z_INDEX + index + 1;\n    if (!toggleAvatar) {\n      const isSelf = index === length - 1;\n\n      // Self story should appear from the first toggle avatar\n      toggleAvatar = isSelf ? firstToggleAvatar : lastToggleAvatar;\n      zIndex = RIBBON_Z_INDEX;\n    }\n\n    if (!toggleAvatar) return;\n\n    let {\n      // eslint-disable-next-line prefer-const\n      top: fromTop,\n      left: fromLeft,\n      width: fromWidth,\n    } = toggleAvatar.getBoundingClientRect();\n\n    const {\n      left: toLeft,\n      width: toWidth,\n    } = peer.getBoundingClientRect();\n\n    if (toLeft > headerRight) {\n      return;\n    }\n\n    fromLeft -= STROKE_OFFSET;\n    fromWidth += 2 * STROKE_OFFSET;\n\n    const fromTranslateX = fromLeft - toLeft;\n    const fromTranslateY = fromTop - toTop;\n    const fromScale = fromWidth / toWidth;\n\n    fromTop -= STROKE_OFFSET;\n\n    const toTranslateX = toLeft - fromLeft + 2 * STROKE_OFFSET;\n    const toTranslateY = toTop - fromTop + STROKE_OFFSET;\n    const toScale = toWidth / (fromWidth + 2 * STROKE_OFFSET);\n\n    requestMutation(() => {\n      if (!toggleAvatar) return;\n      const ghost = createGhost(peer);\n\n      let ghost2: HTMLElement | undefined;\n\n      // If this is a toogle avatar we create a second ghost and do crossfade animation\n      if (zIndex > RIBBON_Z_INDEX) {\n        ghost2 = createGhost(toggleAvatar!);\n        if (isLast) {\n          ghost2.classList.add(togglerStyles.ghostLast);\n        }\n      } else {\n        // Else we animate only name\n        ghost.classList.add(togglerStyles.ghostAnimateName);\n      }\n\n      applyStyles(ghost, {\n        top: `${toTop}px`,\n        left: `${toLeft}px`,\n        zIndex: `${zIndex}`,\n        opacity: ghost2 ? '0' : '',\n        transform: `translate3d(${fromTranslateX}px, ${fromTranslateY}px, 0) scale(${fromScale})`,\n      });\n\n      if (ghost2) {\n        applyStyles(ghost2, {\n          top: `${fromTop}px`,\n          left: `${fromLeft}px`,\n          zIndex: `${zIndex}`,\n        });\n      }\n\n      container.appendChild(ghost);\n      if (ghost2) {\n        container.appendChild(ghost2);\n      }\n      toggleAvatar.classList.add('animating');\n      peer.classList.add('animating');\n\n      requestMutation(() => {\n        applyStyles(ghost, {\n          opacity: '',\n          transform: '',\n        });\n\n        if (ghost2) {\n          applyStyles(ghost2, {\n            opacity: '0',\n            transform: `translate3d(${toTranslateX}px, ${toTranslateY}px, 0) scale(${toScale})`,\n          });\n        } else {\n          ghost.classList.add(togglerStyles.ghostRevealName);\n        }\n\n        const cb = createDelayedCallback(() => {\n          requestMutation(() => {\n            if (container.contains(ghost)) {\n              container.removeChild(ghost);\n            }\n            if (ghost2 && container.contains(ghost2)) {\n              container.removeChild(ghost2);\n            }\n            toggleAvatar?.classList.remove('animating');\n            peer.classList.remove('animating');\n\n            callbacks.delete(cb);\n          });\n        }, ANIMATION_DURATION + ANIMATION_END_DELAY);\n\n        callbacks.add(cb);\n      });\n    });\n  });\n}\n\nexport function animateClosing(isArchived?: boolean) {\n  cancelDelayedCallbacks();\n\n  const {\n    container,\n    toggler,\n    toggleAvatars,\n    ribbonPeers,\n    leftMainHeader,\n  } = getHTMLElements(isArchived);\n\n  if (!toggler || !toggleAvatars || !ribbonPeers || !container || !leftMainHeader) {\n    return;\n  }\n  const { right: headerRight } = leftMainHeader.getBoundingClientRect();\n\n  // Toggle avatars are in the reverse order\n  const lastToggleAvatar = toggleAvatars[0];\n  const firstToggleAvatar = toggleAvatars[toggleAvatars.length - 1];\n  const lastId = getPeerId(lastToggleAvatar);\n\n  Array.from(ribbonPeers).reverse().forEach((peer, index, { length }) => {\n    const id = getPeerId(peer);\n    if (!id) return;\n    const isLast = id === lastId;\n    let toggleAvatar = selectByPeerId(toggler, id);\n    let zIndex = RIBBON_Z_INDEX + index + 1;\n    if (!toggleAvatar) {\n      const isSelf = index === length - 1;\n\n      // Self story should appear from the first toggle avatar\n      toggleAvatar = isSelf ? firstToggleAvatar : lastToggleAvatar;\n      zIndex = RIBBON_Z_INDEX;\n    }\n\n    if (!toggleAvatar) return;\n\n    const {\n      top: fromTop,\n      left: fromLeft,\n      width: fromWidth,\n    } = peer.getBoundingClientRect();\n\n    let {\n      left: toLeft,\n      width: toWidth,\n      top: toTop,\n    } = toggleAvatar.getBoundingClientRect();\n\n    if (fromLeft > headerRight) {\n      return;\n    }\n\n    toLeft -= STROKE_OFFSET;\n    toWidth += 2 * STROKE_OFFSET;\n\n    const toTranslateX = toLeft - fromLeft;\n    const toTranslateY = toTop - fromTop - CANVAS_OFFSET;\n    const toScale = toWidth / fromWidth;\n\n    toTop -= STROKE_OFFSET;\n\n    const fromTranslateX = fromLeft - toLeft + 2 * STROKE_OFFSET;\n    const fromTranslateY = fromTop - toTop + STROKE_OFFSET;\n    const fromScale = fromWidth / (toWidth + 2 * STROKE_OFFSET);\n\n    requestMutation(() => {\n      const ghost = createGhost(peer);\n      let ghost2: HTMLElement | undefined;\n\n      if (zIndex > RIBBON_Z_INDEX) {\n        ghost2 = createGhost(toggleAvatar!);\n        if (isLast) {\n          ghost2.classList.add(togglerStyles.ghostLast);\n        }\n      } else {\n        ghost.classList.add(togglerStyles.ghostAnimateName, togglerStyles.ghostRevealName);\n      }\n\n      applyStyles(ghost, {\n        top: `${fromTop}px`,\n        left: `${fromLeft}px`,\n        width: `${fromWidth}px`,\n        zIndex: `${zIndex}`,\n      });\n\n      if (ghost2) {\n        applyStyles(ghost2, {\n          top: `${toTop}px`,\n          left: `${toLeft}px`,\n          zIndex: `${zIndex}`,\n          opacity: '0',\n          transform: `translate3d(${fromTranslateX}px, ${fromTranslateY}px, 0) scale(${fromScale})`,\n        });\n      }\n\n      peer.classList.add('animating');\n      toggleAvatar!.classList.add('animating');\n\n      container.appendChild(ghost);\n      if (ghost2) {\n        container.appendChild(ghost2);\n      }\n\n      requestMutation(() => {\n        applyStyles(ghost, {\n          opacity: ghost2 ? '0' : '',\n          transform: `translate3d(${toTranslateX}px, ${toTranslateY}px, 0) scale(${toScale})`,\n        });\n\n        if (ghost2) {\n          applyStyles(ghost2!, {\n            opacity: '',\n            transform: '',\n          });\n        } else {\n          ghost.classList.remove(togglerStyles.ghostRevealName);\n        }\n\n        const cb = createDelayedCallback(() => {\n          requestMutation(() => {\n            if (container.contains(ghost)) {\n              container.removeChild(ghost);\n            }\n            if (ghost2 && container.contains(ghost2)) {\n              container.removeChild(ghost2);\n            }\n            peer.classList.remove('animating');\n            toggleAvatar!.classList.remove('animating');\n          });\n\n          callbacks.delete(cb);\n        }, ANIMATION_DURATION + ANIMATION_END_DELAY);\n\n        callbacks.add(cb);\n      });\n    });\n  });\n}\n\nfunction getHTMLElements(isArchived?: boolean) {\n  let container = document.getElementById('LeftColumn');\n  if (container && isArchived) {\n    container = container.querySelector<HTMLElement>('.ArchivedChats');\n  }\n  if (!container) return {};\n  const toggler = container.querySelector<HTMLElement>('#StoryToggler');\n  const ribbon = container.querySelector<HTMLElement>('#StoryRibbon');\n  const leftMainHeader = container.querySelector<HTMLElement>('.left-header');\n  const ribbonPeers = ribbon?.querySelectorAll<HTMLElement>(`.${ribbonStyles.peer}`);\n  const toggleAvatars = toggler?.querySelectorAll<HTMLElement>('.Avatar');\n\n  return {\n    container,\n    toggler,\n    leftMainHeader,\n    ribbonPeers,\n    toggleAvatars,\n  };\n}\n\nfunction createGhost(sourceEl: HTMLElement) {\n  const ghost = sourceEl.cloneNode(true) as HTMLElement;\n  ghost.classList.add(togglerStyles.ghost);\n\n  // Avoid source animating class being copied to the ghost\n  ghost.classList.remove('animating');\n\n  ghost.draggable = false;\n  ghost.oncontextmenu = stopEvent;\n\n  const sourceCanvas = sourceEl.querySelector('canvas');\n  if (sourceCanvas) {\n    const canvas = ghost.querySelector('canvas');\n    canvas?.getContext('2d')?.drawImage(sourceCanvas, 0, 0);\n  }\n\n  return ghost;\n}\n\nfunction getPeerId(el: HTMLElement) {\n  return el?.getAttribute('data-peer-id');\n}\n\nfunction selectByPeerId(el: HTMLElement, id: string) {\n  return el?.querySelector<HTMLElement>(`[data-peer-id=\"${id}\"]`);\n}\n\nfunction createDelayedCallback(callback: NoneToVoidFunction, ms: number) {\n  const timeout = setTimeout(callback, ms);\n\n  return () => {\n    clearTimeout(timeout);\n    callback();\n  };\n}\n\nfunction cancelDelayedCallbacks() {\n  callbacks.forEach((cb) => cb());\n  callbacks.clear();\n}\n","import type { ApiMediaExtendedPreview, ApiPhoto, ApiVideo } from '../../../../api/types';\n\nimport {\n  calculateExtendedPreviewDimensions,\n  calculateInlineImageDimensions,\n  calculateVideoDimensions,\n  REM,\n} from '../../../common/helpers/mediaDimensions';\n\nconst SMALL_IMAGE_THRESHOLD = 12;\nconst MIN_MESSAGE_LENGTH_FOR_BLUR = 40;\nexport const MIN_MEDIA_WIDTH_WITH_TEXT = 20 * REM;\nconst MIN_MEDIA_WIDTH = SMALL_IMAGE_THRESHOLD * REM;\nexport const MIN_MEDIA_HEIGHT = 5 * REM;\n\nexport function getMinMediaWidth(text?: string, hasCommentButton?: boolean) {\n  return (text?.length ?? 0) > MIN_MESSAGE_LENGTH_FOR_BLUR || hasCommentButton\n    ? MIN_MEDIA_WIDTH_WITH_TEXT\n    : MIN_MEDIA_WIDTH;\n}\n\nexport function calculateMediaDimensions({\n  media,\n  messageText,\n  isOwn,\n  isInWebPage,\n  asForwarded,\n  noAvatars,\n  isMobile,\n} : {\n  media: ApiPhoto | ApiVideo | ApiMediaExtendedPreview;\n  messageText?: string;\n  isOwn?: boolean;\n  isInWebPage?: boolean;\n  asForwarded?: boolean;\n  noAvatars?: boolean;\n  isMobile?: boolean;\n}) {\n  const isPhoto = media.mediaType === 'photo';\n  const isVideo = media.mediaType === 'video';\n  const isWebPagePhoto = isPhoto && isInWebPage;\n  const isWebPageVideo = isVideo && isInWebPage;\n  const { width, height } = isPhoto\n    ? calculateInlineImageDimensions(media, isOwn, asForwarded, isWebPagePhoto, noAvatars, isMobile)\n    : isVideo ? calculateVideoDimensions(media, isOwn, asForwarded, isWebPageVideo, noAvatars, isMobile)\n      : calculateExtendedPreviewDimensions(media, isOwn, asForwarded, isInWebPage, noAvatars, isMobile);\n\n  const minMediaWidth = getMinMediaWidth(messageText);\n\n  let stretchFactor = 1;\n  if (width < minMediaWidth && minMediaWidth - width < SMALL_IMAGE_THRESHOLD) {\n    stretchFactor = minMediaWidth / width;\n  }\n  if (height * stretchFactor < MIN_MEDIA_HEIGHT && MIN_MEDIA_HEIGHT - height * stretchFactor < SMALL_IMAGE_THRESHOLD) {\n    stretchFactor = MIN_MEDIA_HEIGHT / height;\n  }\n\n  const finalWidth = Math.round(width * stretchFactor);\n  const finalHeight = Math.round(height * stretchFactor);\n\n  return {\n    width: finalWidth,\n    height: finalHeight,\n    isSmall: finalWidth < minMediaWidth || finalHeight < MIN_MEDIA_HEIGHT,\n  };\n}\n","import { IS_TOUCH_ENV } from './browser/windowEnvironment';\n\nexport default function focusEditableElement(element: HTMLElement, force?: boolean, forcePlaceCaretAtEnd?: boolean) {\n  if (!force && element === document.activeElement) {\n    return;\n  }\n\n  const selection = window.getSelection()!;\n  const range = document.createRange();\n  const lastChild = element.lastChild || element;\n\n  if (!IS_TOUCH_ENV && !forcePlaceCaretAtEnd && (!lastChild || !lastChild.nodeValue)) {\n    element.focus();\n    return;\n  }\n\n  range.selectNodeContents(forcePlaceCaretAtEnd ? element : lastChild);\n  // `false` means collapse to the end rather than the start\n  range.collapse(false);\n  selection.removeAllRanges();\n  selection.addRange(range);\n}\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nimport { IS_TOUCH_ENV } from '../util/browser/windowEnvironment';\nimport useLastCallback from './useLastCallback';\n\nconst MENU_CLOSE_TIMEOUT = 250;\nlet closeTimeout: number | undefined;\n\nexport default function useMouseInside(\n  isOpen: boolean, onClose: NoneToVoidFunction, menuCloseTimeout = MENU_CLOSE_TIMEOUT, isDisabled = false,\n) {\n  const isMouseInside = useRef(false);\n\n  const markMouseInside = useLastCallback(() => {\n    isMouseInside.current = true;\n  });\n\n  useEffect(() => {\n    if (closeTimeout) {\n      clearTimeout(closeTimeout);\n      closeTimeout = undefined;\n    }\n\n    if (isOpen && !IS_TOUCH_ENV && !isDisabled) {\n      closeTimeout = window.setTimeout(() => {\n        if (!isMouseInside.current) {\n          onClose();\n        }\n      }, menuCloseTimeout * 2);\n    }\n  }, [isDisabled, isOpen, menuCloseTimeout, onClose]);\n\n  const handleMouseEnter = useLastCallback(() => {\n    isMouseInside.current = true;\n  });\n\n  const handleMouseLeave = useLastCallback(() => {\n    isMouseInside.current = false;\n\n    if (closeTimeout) {\n      clearTimeout(closeTimeout);\n      closeTimeout = undefined;\n    }\n\n    closeTimeout = window.setTimeout(() => {\n      if (!isMouseInside.current) {\n        onClose();\n      }\n    }, menuCloseTimeout);\n  });\n\n  return [handleMouseEnter, handleMouseLeave, markMouseInside];\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport type { ApiMessage, ApiWebPage } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport type { TextPart } from '../../types';\n\nimport {\n  getFirstLinkInMessage, getMessageText,\n  getMessageWebPage,\n} from '../../global/helpers';\nimport buildClassName from '../../util/buildClassName';\nimport { formatPastTimeShort } from '../../util/dates/dateFormat';\nimport trimText from '../../util/trimText';\nimport { renderMessageSummary } from './helpers/renderMessageText';\nimport renderText from './helpers/renderText';\n\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Link from '../ui/Link';\nimport Media from './Media';\nimport SafeLink from './SafeLink';\n\nimport './WebLink.scss';\n\nconst MAX_TEXT_LENGTH = 170; // symbols\n\ntype OwnProps = {\n  message: ApiMessage;\n  senderTitle?: string;\n  isProtected?: boolean;\n  observeIntersection?: ObserveFn;\n  onMessageClick: (message: ApiMessage) => void;\n};\n\ntype ApiWebPageWithFormatted =\n  ApiWebPage\n  & { formattedDescription?: TextPart[] };\n\nconst WebLink: FC<OwnProps> = ({\n  message, senderTitle, isProtected, observeIntersection, onMessageClick,\n}) => {\n  const lang = useOldLang();\n\n  let linkData: ApiWebPageWithFormatted | undefined = getMessageWebPage(message);\n\n  if (!linkData) {\n    const link = getFirstLinkInMessage(message);\n    if (link) {\n      const { url, domain } = link;\n\n      linkData = {\n        siteName: domain.replace(/^www./, ''),\n        url: url.includes('://') ? url : url.includes('@') ? `mailto:${url}` : `http://${url}`,\n        formattedDescription: getMessageText(message)?.text !== url\n          ? renderMessageSummary(lang, message, undefined, undefined, MAX_TEXT_LENGTH)\n          : undefined,\n      } as ApiWebPageWithFormatted;\n    }\n  }\n\n  const handleMessageClick = useLastCallback(() => {\n    onMessageClick(message);\n  });\n\n  if (!linkData) {\n    return undefined;\n  }\n\n  const {\n    siteName,\n    url,\n    displayUrl,\n    title,\n    description,\n    formattedDescription,\n    photo,\n    video,\n  } = linkData;\n\n  const truncatedDescription = !senderTitle && description && trimText(description, MAX_TEXT_LENGTH);\n\n  const className = buildClassName(\n    'WebLink scroll-item',\n    (!photo && !video) && 'without-media',\n  );\n\n  const safeLinkContent = url.replace('mailto:', '') || displayUrl;\n\n  return (\n    <div\n      className={className}\n      data-initial={(siteName || displayUrl)[0]}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {photo && (\n        <Media message={message} isProtected={isProtected} observeIntersection={observeIntersection} />\n      )}\n      <div className=\"content\">\n        <Link isRtl={lang.isRtl} className=\"site-title\" onClick={handleMessageClick}>\n          {renderText(title || siteName || displayUrl)}\n        </Link>\n        {(truncatedDescription || formattedDescription) && (\n          <Link isRtl={lang.isRtl} className=\"site-description\" onClick={handleMessageClick}>\n            {formattedDescription || (truncatedDescription && renderText(truncatedDescription))}\n          </Link>\n        )}\n        <SafeLink\n          url={url}\n          className=\"site-name\"\n          text={safeLinkContent}\n          isRtl={lang.isRtl}\n        />\n        {senderTitle && <div className=\"sender-name\">{renderText(senderTitle)}</div>}\n      </div>\n      {senderTitle && (\n        <div className=\"message-date\">\n          <Link\n            className=\"date\"\n            onClick={handleMessageClick}\n            isRtl={lang.isRtl}\n          >\n            {formatPastTimeShort(lang, message.date * 1000)}\n          </Link>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(WebLink);\n","import { areSortedArraysEqual } from './iteratees';\n\nconst cache = new WeakMap<AnyFunction, {\n  lastArgs: any[];\n  lastResult: any;\n}>();\n\nexport default function memoized<T extends AnyFunction>(fn: T) {\n  return (...args: Parameters<T>): ReturnType<T> => {\n    const cached = cache.get(fn);\n    if (cached && areSortedArraysEqual(cached.lastArgs, args)) {\n      return cached.lastResult;\n    }\n\n    const result = fn(...args);\n    cache.set(fn, { lastArgs: args, lastResult: result });\n    return result;\n  };\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport type { ApiTopic } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport CustomEmoji from './CustomEmoji';\nimport TopicDefaultIcon from './TopicDefaultIcon';\n\ntype OwnProps = {\n  topic: Pick<ApiTopic, 'iconEmojiId' | 'iconColor' | 'title' | 'id'>;\n  className?: string;\n  letterClassName?: string;\n  size?: number;\n  noLoopLimit?: true;\n  observeIntersection?: ObserveFn;\n  onClick?: NoneToVoidFunction;\n};\n\nconst LOOP_LIMIT = 2;\nconst DEFAULT_ICON_ID = '0';\n\nconst TopicIcon: FC<OwnProps> = ({\n  topic,\n  className,\n  letterClassName,\n  size,\n  noLoopLimit,\n  observeIntersection,\n  onClick,\n}) => {\n  if (topic.iconEmojiId && topic.iconEmojiId !== DEFAULT_ICON_ID) {\n    return (\n      <CustomEmoji\n        documentId={topic.iconEmojiId}\n        className={className}\n        size={size}\n        observeIntersectionForPlaying={observeIntersection}\n        loopLimit={!noLoopLimit ? LOOP_LIMIT : undefined}\n        onClick={onClick}\n      />\n    );\n  }\n\n  return (\n    <TopicDefaultIcon\n      iconColor={topic.iconColor}\n      title={topic.title}\n      topicId={topic.id}\n      className={className}\n      letterClassName={letterClassName}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default memo(TopicIcon);\n","import { useCallback, useRef, useUnmountCleanup } from '../lib/teact/teact';\n\nconst DEFAULT_THRESHOLD = 250;\n\nfunction useLongPress({\n  onClick, onStart, onEnd, threshold = DEFAULT_THRESHOLD,\n}: {\n  onStart?: NoneToVoidFunction;\n  onClick?: (event: React.MouseEvent | React.TouchEvent) => void;\n  onEnd?: NoneToVoidFunction;\n  threshold?: number;\n}) {\n  const isLongPressActive = useRef(false);\n  const isPressed = useRef(false);\n  const timerId = useRef<number | undefined>(undefined);\n\n  const start = useCallback((e: React.MouseEvent | React.TouchEvent) => {\n    const canProcessEvent = ('button' in e && e.button === 0) || ('touches' in e && e.touches.length > 0);\n    if (isPressed.current || !canProcessEvent) {\n      return;\n    }\n\n    isPressed.current = true;\n    timerId.current = window.setTimeout(() => {\n      onStart?.();\n      isLongPressActive.current = true;\n    }, threshold);\n  }, [onStart, threshold]);\n\n  const cancel = useCallback((e: React.MouseEvent | React.TouchEvent) => {\n    if (!isPressed.current) return;\n\n    if (isLongPressActive.current) {\n      onEnd?.();\n    } else {\n      onClick?.(e);\n    }\n\n    isLongPressActive.current = false;\n    isPressed.current = false;\n    window.clearTimeout(timerId.current);\n  }, [onEnd, onClick]);\n\n  useUnmountCleanup(() => {\n    window.clearTimeout(timerId.current);\n  });\n\n  return {\n    onMouseDown: start,\n    onMouseUp: cancel,\n    onMouseLeave: cancel,\n    onTouchStart: start,\n    onTouchEnd: cancel,\n  };\n}\n\nexport default useLongPress;\n","const extractorEl = document.createElement('div');\n\nexport function insertHtmlInSelection(html: string) {\n  const selection = window.getSelection();\n\n  if (selection?.getRangeAt && selection.rangeCount) {\n    const range = selection.getRangeAt(0);\n    range.deleteContents();\n\n    const fragment = range.createContextualFragment(html);\n    const lastInsertedNode = fragment.lastChild;\n    range.insertNode(fragment);\n    if (lastInsertedNode) {\n      range.setStartAfter(lastInsertedNode);\n      range.setEndAfter(lastInsertedNode);\n    } else {\n      range.collapse(false);\n    }\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n}\n\nexport function getHtmlBeforeSelection(container?: HTMLElement, useCommonAncestor?: boolean) {\n  if (!container) {\n    return '';\n  }\n\n  const sel = window.getSelection();\n  if (!sel || !sel.rangeCount) {\n    return container.innerHTML;\n  }\n\n  const range = sel.getRangeAt(0).cloneRange();\n  if (!range.intersectsNode(container)) {\n    return container.innerHTML;\n  }\n\n  if (!useCommonAncestor && !container.contains(range.commonAncestorContainer)) {\n    return '';\n  }\n\n  range.collapse(true);\n  range.setStart(container, 0);\n\n  extractorEl.innerHTML = '';\n  extractorEl.appendChild(range.cloneContents());\n\n  return extractorEl.innerHTML;\n}\n\n// https://stackoverflow.com/a/3976125\nexport function getCaretPosition(element: HTMLElement) {\n  let caretPosition = 0;\n  const selection = window.getSelection();\n  if (!selection || selection.rangeCount === 0) {\n    return caretPosition;\n  }\n\n  const range = selection.getRangeAt(0);\n  const caretRange = range.cloneRange();\n  caretRange.selectNodeContents(element);\n  caretRange.setEnd(range.endContainer, range.endOffset);\n  caretPosition = caretRange.toString().length;\n\n  return caretPosition;\n}\n\n// https://stackoverflow.com/a/36953852\nexport function setCaretPosition(element: Node, position: number) {\n  for (const node of element.childNodes) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      if ((node as Text).length >= position) {\n        const range = document.createRange();\n        const selection = window.getSelection()!;\n        range.setStart(node, position);\n        range.collapse(true);\n        selection.removeAllRanges();\n        selection.addRange(range);\n\n        return -1;\n      } else {\n        position -= 'length' in node ? node.length as number : 0;\n      }\n    } else {\n      position = setCaretPosition(node, position);\n      if (position === -1) {\n        return -1;\n      }\n    }\n  }\n\n  return position;\n}\n\nexport function removeAllSelections() {\n  const selection = window.getSelection();\n  selection?.removeAllRanges();\n}\n","import React, {\n  beginHeavyAnimation, memo, useEffect, useMemo,\n} from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiChat, ApiUser } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\n\nimport { ANIMATION_END_DELAY, PREVIEW_AVATAR_COUNT } from '../../config';\nimport { selectIsForumPanelOpen, selectPerformanceSettingsValue, selectTabState } from '../../global/selectors';\nimport { animateClosing, animateOpening, ANIMATION_DURATION } from './helpers/ribbonAnimation';\n\nimport useOldLang from '../../hooks/useOldLang';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useStoryPreloader from './hooks/useStoryPreloader';\n\nimport Avatar from '../common/Avatar';\n\nimport styles from './StoryToggler.module.scss';\n\ninterface OwnProps {\n  isArchived?: boolean;\n  canShow?: boolean;\n}\n\ninterface StateProps {\n  currentUserId: string;\n  orderedPeerIds: string[];\n  isShown: boolean;\n  isForumPanelOpen?: boolean;\n  withAnimation?: boolean;\n  usersById: Record<string, ApiUser>;\n  chatsById: Record<string, ApiChat>;\n  peerStories: GlobalState['stories']['byPeerId'];\n}\n\nconst PRELOAD_PEERS = 5;\n\nfunction StoryToggler({\n  currentUserId,\n  orderedPeerIds,\n  usersById,\n  chatsById,\n  canShow,\n  isShown,\n  isForumPanelOpen,\n  isArchived,\n  withAnimation,\n  peerStories,\n}: OwnProps & StateProps) {\n  const { toggleStoryRibbon } = getActions();\n\n  const lang = useOldLang();\n\n  const peers = useMemo(() => {\n    if (orderedPeerIds.length === 1) {\n      return [usersById[orderedPeerIds[0]] || chatsById[orderedPeerIds[0]]];\n    }\n\n    return orderedPeerIds\n      .map((id) => usersById[id] || chatsById[id])\n      .filter((peer) => peer && peer.id !== currentUserId)\n      .slice(0, PREVIEW_AVATAR_COUNT)\n      .reverse();\n  }, [currentUserId, orderedPeerIds, usersById, chatsById]);\n\n  const closeFriends = useMemo(() => {\n    if (!peers?.length) return {};\n    return peers.reduce((acc, peer) => {\n      const stories = peerStories[peer.id];\n      if (!stories) return acc;\n\n      const isCloseFriend = stories.orderedIds.some((id) => {\n        const story = stories.byId[id];\n        if (!story || !('isForCloseFriends' in story)) return false;\n        const isRead = stories.lastReadId && story.id <= stories.lastReadId;\n        return story.isForCloseFriends && !isRead;\n      });\n\n      acc[peer.id] = isCloseFriend;\n      return acc;\n    }, {} as Record<string, boolean>);\n  }, [peerStories, peers]);\n\n  const preloadPeerIds = useMemo(() => {\n    return orderedPeerIds.slice(0, PRELOAD_PEERS);\n  }, [orderedPeerIds]);\n\n  useStoryPreloader(preloadPeerIds);\n\n  const isVisible = canShow && isShown;\n  // For some reason, setting 'slow' here also fixes scroll freezes on iOS when collapsing Story Ribbon\n  const { ref, shouldRender } = useShowTransition<HTMLButtonElement>({\n    isOpen: isVisible,\n    className: 'slow',\n    withShouldRender: true,\n  });\n\n  useEffect(() => {\n    if (!withAnimation || isForumPanelOpen) return;\n    if (isVisible) {\n      beginHeavyAnimation(ANIMATION_DURATION + ANIMATION_END_DELAY);\n      animateClosing(isArchived);\n    } else {\n      beginHeavyAnimation(ANIMATION_DURATION + ANIMATION_END_DELAY);\n      animateOpening(isArchived);\n    }\n  }, [isArchived, isVisible, withAnimation, isForumPanelOpen]);\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  return (\n    <button\n      ref={ref}\n      type=\"button\"\n      id=\"StoryToggler\"\n      className={styles.root}\n      aria-label={lang('Chat.Context.Peer.OpenStory')}\n      onClick={() => toggleStoryRibbon({ isShown: true, isArchived })}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {peers.map((peer) => (\n        <Avatar\n          key={peer.id}\n          peer={peer}\n          size=\"tiny\"\n          className={styles.avatar}\n          withStorySolid\n          forceFriendStorySolid={closeFriends[peer.id]}\n        />\n      ))}\n    </button>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>((global, { isArchived }): StateProps => {\n  const { orderedPeerIds: { archived, active }, byPeerId } = global.stories;\n  const { storyViewer: { isRibbonShown, isArchivedRibbonShown } } = selectTabState(global);\n  const isForumPanelOpen = selectIsForumPanelOpen(global);\n  const withAnimation = selectPerformanceSettingsValue(global, 'storyRibbonAnimations');\n\n  return {\n    currentUserId: global.currentUserId!,\n    orderedPeerIds: isArchived ? archived : active,\n    isShown: isArchived ? !isArchivedRibbonShown : !isRibbonShown,\n    isForumPanelOpen,\n    withAnimation,\n    usersById: global.users.byId,\n    chatsById: global.chats.byId,\n    peerStories: byPeerId,\n  };\n})(StoryToggler));\n","/* eslint-disable no-null/no-null */\n/* eslint-disable react/jsx-props-no-spreading */\n// @ts-nocheck\nimport React from 'react';\nimport { createRoot } from 'react-dom/client';\n\nexport function injectComponent<T extends {}>(Component: React.ComponentType<T>) {\n  return (domRoot: HTMLElement, props?: T): ReturnType<RefObject<React.Component<T>>> | null => {\n    if (!domRoot) return null;\n\n    if (!domRoot.$aiRoot) {\n      const root = createRoot(domRoot);\n      domRoot.$aiRoot = root;\n    }\n    const ref = React.createRef<any>();\n\n    domRoot.$aiRoot.render(<Component {...(props as T)} ref={ref} />);\n\n    return {\n      ref,\n      unmount: () => {\n        domRoot.$aiRoot?.unmount();\n        domRoot.$aiRoot = null;\n      },\n    };\n    // const ref = React.createRef<R>();\n    // return new Promise((resolve) => {\n    //   domRoot.$aiRoot.render(<Component {...(props as T)} ref={ref} />);\n    //   setTimeout(() => {\n    //     resolve(ref.current);\n    //   }, 0);\n    // });\n  };\n}\n","import type { ThemeKey } from '../../../../types';\n\nimport { MAX_WORKERS, requestMediaWorker } from '../../../../util/launchMediaWorkers';\n\nconst SELECTED_APPENDIX_COLORS = {\n  dark: {\n    outgoing: 'rgb(135,116,225)',\n    incoming: 'rgb(33,33,33)',\n  },\n  light: {\n    outgoing: 'rgb(238,255,222)',\n    incoming: 'rgb(255,255,255)',\n  },\n};\n\nexport default function getCustomAppendixBg(\n  src: string, isOwn: boolean, id: number, isSelected?: boolean, theme?: ThemeKey,\n) {\n  if (isSelected) {\n    return Promise.resolve(SELECTED_APPENDIX_COLORS[theme || 'light'][isOwn ? 'outgoing' : 'incoming']);\n  }\n\n  return requestMediaWorker({\n    name: 'offscreen-canvas:getAppendixColorFromImage',\n    args: [src, isOwn],\n  }, Math.round(id) % MAX_WORKERS);\n}\n","import type { MediaWorkerApi } from '../lib/mediaWorker/index.worker';\nimport type { Connector } from './PostMessageConnector';\n\nimport { IS_TEST } from '../config';\n\nimport { createConnector } from './PostMessageConnector';\n\nexport const MAX_WORKERS = Math.min(navigator.hardwareConcurrency || 4, 4);\n\nlet instances: {\n  worker: Worker;\n  connector: Connector<MediaWorkerApi>;\n}[] | undefined;\n\nexport default function launchMediaWorkers() {\n  if (IS_TEST) return [];\n  if (!instances) {\n    instances = new Array(MAX_WORKERS).fill(undefined).map(\n      () => {\n        const worker = new Worker(new URL('../lib/mediaWorker/index.worker.ts', import.meta.url));\n        const connector = createConnector<MediaWorkerApi>(worker, undefined, 'media');\n        return { worker, connector };\n      },\n    );\n  }\n\n  return instances;\n}\n\nexport function requestMediaWorker(payload: Parameters<Connector<MediaWorkerApi>['request']>[0], index: number) {\n  return launchMediaWorkers()[index].connector.request(payload);\n}\n","import { useEffect, useSignal } from '../lib/teact/teact';\n\nexport default function useGetSelectionRange(inputSelector: string) {\n  const [getRange, setRange] = useSignal<Range | undefined>();\n\n  useEffect(() => {\n    function onSelectionChange() {\n      const selection = window.getSelection();\n      if (!selection?.rangeCount) return;\n\n      const range = selection.getRangeAt(0);\n      if (!range) {\n        return;\n      }\n\n      const inputEl = document.querySelector(inputSelector);\n      if (!inputEl) {\n        return;\n      }\n\n      const { commonAncestorContainer } = range;\n      const element = commonAncestorContainer instanceof Element\n        ? commonAncestorContainer\n        : commonAncestorContainer.parentElement!;\n      if (element.closest(inputSelector)) {\n        setRange(range);\n      }\n    }\n\n    document.addEventListener('selectionchange', onSelectionChange);\n\n    return () => document.removeEventListener('selectionchange', onSelectionChange);\n  }, [inputSelector, setRange]);\n\n  return getRange;\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useRef } from '../../../lib/teact/teact';\n\nimport buildClassName from '../../../util/buildClassName';\n\nimport useEffectOnce from '../../../hooks/useEffectOnce';\nimport useFlag from '../../../hooks/useFlag';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useResizeObserver from '../../../hooks/useResizeObserver';\n\nimport Icon from '../../common/icons/Icon';\n\nimport './DropTarget.scss';\n\nexport type OwnProps = {\n  isQuick?: boolean;\n  isGeneric?: boolean;\n  onFileSelect: (e: React.DragEvent<HTMLDivElement>) => void;\n};\n\nconst DropTarget: FC<OwnProps> = ({ isQuick, isGeneric, onFileSelect }) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const svgRef = useRef<SVGSVGElement>(null);\n\n  const [isHovered, markHovered, unmarkHovered] = useFlag();\n\n  const handleDragLeave = useLastCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const { relatedTarget: toTarget } = e;\n\n    if (toTarget) {\n      e.stopPropagation();\n    }\n\n    unmarkHovered();\n  });\n\n  const handleResize = useLastCallback(() => {\n    const svg = svgRef.current;\n    if (!svg) {\n      return;\n    }\n\n    const { width, height } = svg.getBoundingClientRect();\n    svg.viewBox.baseVal.width = width;\n    svg.viewBox.baseVal.height = height;\n  });\n\n  // Can't listen for SVG resize\n  useResizeObserver(ref, handleResize);\n\n  useEffectOnce(handleResize);\n\n  const className = buildClassName(\n    'DropTarget',\n    isHovered && 'hovered',\n  );\n\n  return (\n    <div\n      className={className}\n      ref={ref}\n      onDrop={onFileSelect}\n      onDragEnter={markHovered}\n      onDragLeave={handleDragLeave}\n      data-dropzone\n    >\n      <svg className=\"target-outline-container\">\n        <rect className=\"target-outline\" x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" rx=\"8\" />\n      </svg>\n      <div className=\"target-content\">\n        <Icon name={isQuick ? 'photo' : 'document'} />\n        <div className=\"title\">Drop files here to send them</div>\n        {!isGeneric && <div className=\"description\">{isQuick ? 'in a quick way' : 'without compression'}</div>}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(DropTarget);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useEffect, useRef } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMessage } from '../../../api/types';\n\nimport { canReplaceMessageMedia } from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport buildAttachment from './helpers/buildAttachment';\nimport getFilesFromDataTransferItems from './helpers/getFilesFromDataTransferItems';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\nimport usePreviousDeprecated from '../../../hooks/usePreviousDeprecated';\nimport useShowTransitionDeprecated from '../../../hooks/useShowTransitionDeprecated';\n\nimport Portal from '../../ui/Portal';\nimport DropTarget from './DropTarget';\n\nimport './DropArea.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  withQuick?: boolean;\n  onHide: NoneToVoidFunction;\n  onFileSelect: (files: File[], suggestCompression?: boolean) => void;\n  editingMessage?: ApiMessage | undefined;\n};\n\nexport enum DropAreaState {\n  None = 'none',\n  Document = 'document',\n  QuickFile = 'quick_file',\n}\n\nconst DROP_LEAVE_TIMEOUT_MS = 150;\n\nconst DropArea: FC<OwnProps> = ({\n  isOpen, withQuick, onHide, onFileSelect, editingMessage,\n}) => {\n  const lang = useOldLang();\n  const { showNotification } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const hideTimeoutRef = useRef<number>(null);\n  const prevWithQuick = usePreviousDeprecated(withQuick);\n  const { shouldRender, transitionClassNames } = useShowTransitionDeprecated(isOpen);\n  const isInAlbum = editingMessage && editingMessage?.groupedId;\n\n  useEffect(() => (isOpen ? captureEscKeyListener(onHide) : undefined), [isOpen, onHide]);\n\n  const handleFilesDrop = useLastCallback(async (e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n    let files: File[] = [];\n\n    if (dt.files && dt.files.length > 0 && (!dt.items || !dt.items.length)) {\n      files = files.concat(Array.from(dt.files));\n    } else if (dt.items && dt.items.length > 0) {\n      const folderFiles = await getFilesFromDataTransferItems(dt.items);\n      const newAttachment = folderFiles && await buildAttachment(folderFiles[0].name, folderFiles[0]);\n      const canReplace = editingMessage && newAttachment && canReplaceMessageMedia(editingMessage, newAttachment);\n\n      if (canReplace) {\n        showNotification({ message: lang(isInAlbum ? 'lng_edit_media_album_error' : 'lng_edit_media_invalid_file') });\n        return;\n      }\n      if (folderFiles?.length) {\n        files = files.concat(folderFiles);\n      }\n    }\n\n    onHide();\n    onFileSelect(files, withQuick ? false : undefined);\n  });\n\n  const handleQuickFilesDrop = useLastCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n\n    if (dt.files && dt.files.length > 0) {\n      onHide();\n      onFileSelect(Array.from(dt.files), true);\n    }\n  });\n\n  const handleDragLeave = useLastCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n\n    const { target: fromTarget, relatedTarget: toTarget } = e;\n\n    // Esc button pressed during drag event\n    if (\n      (fromTarget as HTMLDivElement).matches('.DropTarget, .DropArea') && (\n        !toTarget || !(toTarget as HTMLDivElement)!.matches('.DropTarget, .DropArea')\n      )\n    ) {\n      hideTimeoutRef.current = window.setTimeout(() => {\n        onHide();\n      }, DROP_LEAVE_TIMEOUT_MS);\n    }\n  });\n\n  const handleDragOver = () => {\n    if (hideTimeoutRef.current) {\n      window.clearTimeout(hideTimeoutRef.current);\n    }\n  };\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const shouldRenderQuick = withQuick || prevWithQuick;\n\n  const className = buildClassName(\n    'DropArea',\n    transitionClassNames,\n  );\n\n  return (\n    <Portal containerSelector=\"#middle-column-portals\">\n      <div\n        className={className}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={onHide}\n        onClick={onHide}\n      >\n        <DropTarget onFileSelect={handleFilesDrop} isGeneric={!shouldRenderQuick} />\n        {shouldRenderQuick && <DropTarget onFileSelect={handleQuickFilesDrop} isQuick />}\n      </div>\n    </Portal>\n  );\n};\n\nexport default memo(DropArea);\n","import { useCallback, useRef } from '../lib/teact/teact';\n\nimport useForceUpdate from './useForceUpdate';\n\nexport type ReducerAction<Actions> = { type: Actions; payload?: any };\nexport type StateReducer<State, Actions> = (state: State, action: ReducerAction<Actions>) => State;\nexport type Dispatch<State, Actions> = (action: ReducerAction<Actions>) => State;\n\nexport default function useReducer<State, Actions>(\n  reducer: StateReducer<State, Actions>,\n  initialState: State,\n) {\n  const forceUpdate = useForceUpdate();\n  const reducerRef = useRef(reducer);\n  const state = useRef(initialState);\n\n  const dispatch = useCallback((action: ReducerAction<Actions>) => {\n    state.current = reducerRef.current(state.current, action);\n    forceUpdate();\n    return state.current;\n  }, []);\n\n  return [\n    state.current,\n    dispatch,\n  ] as [State, Dispatch<State, Actions>];\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport renderText from './helpers/renderText';\n\nimport useOldLang from '../../hooks/useOldLang';\nimport useShowTransitionDeprecated from '../../hooks/useShowTransitionDeprecated';\n\nimport './NothingFound.scss';\n\ninterface OwnProps {\n  text?: string;\n  description?: string;\n}\n\nconst DEFAULT_TEXT = 'Nothing found.';\n\nconst NothingFound: FC<OwnProps> = ({ text = DEFAULT_TEXT, description }) => {\n  const lang = useOldLang();\n  const { transitionClassNames } = useShowTransitionDeprecated(true);\n\n  return (\n    <div className={buildClassName('NothingFound', transitionClassNames, description && 'with-description')}>\n      {text}\n      {description && <p className=\"description\">{renderText(lang(description), ['br'])}</p>}\n    </div>\n  );\n};\n\nexport default memo(NothingFound);\n","// useDrawerStore.ts\nimport { create } from 'zustand';\n\nexport enum DrawerKey {\n  PersonalizeSettings = 'PersonalizeSettings',\n  OriginalMessages = 'OriginalMessages',\n  CustomizationPrompt = 'CustomizationPrompt',\n  ChatPicker = 'ChatPicker',\n  AddTopicPanel = 'AddTopicPanel',\n}\n\ntype DrawerState = {\n  isOpen: boolean;\n  drawerKey?: DrawerKey;\n  drawerParams?: any;\n  openDrawer: (drawerKey?: DrawerKey, drawerParams?: any) => void;\n  closeDrawer: () => void;\n};\n\nexport const useDrawerStore = create<DrawerState>((set) => ({\n  isOpen: false,\n  drawerKey: undefined,\n  drawerParams: undefined,\n\n  openDrawer: (drawerKey, drawerParams) => set(() => ({\n    isOpen: true,\n    drawerKey,\n    drawerParams,\n  })),\n\n  closeDrawer: () => set(() => ({\n    isOpen: false,\n    drawerKey: undefined,\n    drawerParams: undefined,\n  })),\n}));\n","import React, {\n  memo, useEffect, useRef, useState,\n} from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiDocument, ApiMessage } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport {\n  getDocumentMediaHash,\n  getMediaFormat,\n  getMediaThumbUri,\n  getMediaTransferState,\n  isDocumentVideo,\n} from '../../global/helpers';\nimport { getDocumentExtension, getDocumentHasPreview } from './helpers/documentInfo';\n\nimport useFlag from '../../hooks/useFlag';\nimport { useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaWithLoadProgress from '../../hooks/useMediaWithLoadProgress';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Checkbox from '../ui/Checkbox';\nimport ConfirmDialog from '../ui/ConfirmDialog';\nimport File from './File';\n\ntype OwnProps = {\n  document: ApiDocument;\n  observeIntersection?: ObserveFn;\n  smaller?: boolean;\n  isSelected?: boolean;\n  isSelectable?: boolean;\n  canAutoLoad?: boolean;\n  uploadProgress?: number;\n  withDate?: boolean;\n  datetime?: number;\n  className?: string;\n  sender?: string;\n  autoLoadFileMaxSizeMb?: number;\n  isDownloading?: boolean;\n  shouldWarnAboutSvg?: boolean;\n  onCancelUpload?: () => void;\n  onMediaClick?: () => void;\n} & ({\n  message: ApiMessage;\n  onDateClick: (arg: ApiMessage) => void;\n} | {\n  message?: ApiMessage;\n  onDateClick?: never;\n});\n\nconst BYTES_PER_MB = 1024 * 1024;\nconst SVG_EXTENSIONS = new Set(['svg', 'svgz']);\n\nconst Document = ({\n  document,\n  observeIntersection,\n  smaller,\n  canAutoLoad,\n  autoLoadFileMaxSizeMb,\n  uploadProgress,\n  withDate,\n  datetime,\n  className,\n  sender,\n  isSelected,\n  isSelectable,\n  shouldWarnAboutSvg,\n  isDownloading,\n  message,\n  onCancelUpload,\n  onMediaClick,\n  onDateClick,\n}: OwnProps) => {\n  const { cancelMediaDownload, downloadMedia, setSharedSettingOption } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const lang = useOldLang();\n  const [isSvgDialogOpen, openSvgDialog, closeSvgDialog] = useFlag();\n  const [shouldNotWarnAboutSvg, setShouldNotWarnAboutSvg] = useState(false);\n\n  const { fileName, size, timestamp } = document;\n  const extension = getDocumentExtension(document) || '';\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n  const [wasIntersected, markIntersected] = useFlag();\n  useEffect(() => {\n    if (isIntersecting) {\n      markIntersected();\n    }\n  }, [isIntersecting, markIntersected]);\n\n  // Auto-loading does not use global download manager because requires additional click to save files locally\n  const [isLoadAllowed, setIsLoadAllowed] = useState(\n    canAutoLoad && (!autoLoadFileMaxSizeMb || size <= autoLoadFileMaxSizeMb * BYTES_PER_MB),\n  );\n\n  const shouldDownload = Boolean(isDownloading || (isLoadAllowed && wasIntersected));\n\n  const documentHash = getDocumentMediaHash(document, 'download');\n  const { loadProgress: downloadProgress, mediaData } = useMediaWithLoadProgress(\n    documentHash, !shouldDownload, getMediaFormat(document, 'download'), undefined, true,\n  );\n  const isLoaded = Boolean(mediaData);\n\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(\n    uploadProgress || downloadProgress,\n    shouldDownload && !isLoaded,\n    uploadProgress !== undefined,\n  );\n\n  const hasPreview = getDocumentHasPreview(document);\n  const thumbDataUri = hasPreview ? getMediaThumbUri(document) : undefined;\n  const localBlobUrl = hasPreview ? document.previewBlobUrl : undefined;\n  const previewData = useMedia(getDocumentMediaHash(document, 'pictogram'), !isIntersecting);\n\n  const withMediaViewer = onMediaClick && document.innerMediaType;\n\n  const handleDownload = useLastCallback(() => {\n    downloadMedia({ media: document, originMessage: message });\n  });\n\n  const handleClick = useLastCallback(() => {\n    if (isUploading) {\n      if (onCancelUpload) {\n        onCancelUpload();\n      }\n      return;\n    }\n\n    if (isDownloading) {\n      cancelMediaDownload({ media: document });\n      return;\n    }\n\n    if (isTransferring) {\n      setIsLoadAllowed(false);\n      return;\n    }\n\n    if (withMediaViewer) {\n      onMediaClick!();\n      return;\n    }\n\n    if (SVG_EXTENSIONS.has(extension) && shouldWarnAboutSvg) {\n      openSvgDialog();\n      return;\n    }\n\n    handleDownload();\n  });\n\n  const handleSvgConfirm = useLastCallback(() => {\n    setSharedSettingOption({ shouldWarnAboutSvg: !shouldNotWarnAboutSvg });\n    closeSvgDialog();\n    handleDownload();\n  });\n\n  const handleDateClick = useLastCallback(() => {\n    onDateClick?.(message);\n  });\n\n  return (\n    <>\n      <File\n        ref={ref}\n        name={fileName}\n        extension={extension}\n        size={size}\n        timestamp={withDate ? datetime || timestamp : undefined}\n        thumbnailDataUri={thumbDataUri}\n        previewData={localBlobUrl || previewData}\n        smaller={smaller}\n        isTransferring={isTransferring}\n        isUploading={isUploading}\n        transferProgress={transferProgress}\n        className={className}\n        sender={sender}\n        isSelectable={isSelectable}\n        isSelected={isSelected}\n        actionIcon={withMediaViewer ? (isDocumentVideo(document) ? 'play' : 'eye') : 'download'}\n        onClick={handleClick}\n        onDateClick={onDateClick ? handleDateClick : undefined}\n      />\n      <ConfirmDialog\n        isOpen={isSvgDialogOpen}\n        onClose={closeSvgDialog}\n        confirmHandler={handleSvgConfirm}\n      >\n        {lang('lng_launch_svg_warning')}\n        <Checkbox\n          className=\"dialog-checkbox\"\n          checked={shouldNotWarnAboutSvg}\n          label={lang('lng_launch_exe_dont_ask')}\n          onCheck={setShouldNotWarnAboutSvg}\n        />\n      </ConfirmDialog>\n    </>\n  );\n};\n\nexport default memo(Document);\n","import type { ApiBusinessTimetableSegment } from '../../api/types';\n\nconst DAY_MINUTES = 1440;\nconst WEEK_MINUTES = 10080;\n\n/**\n * @returns Monday 00:00 of the current week for the local timezone\n */\nexport function getWeekStart(): number {\n  const now = new Date();\n  now.setHours(0, 0, 0, 0);\n  const day = now.getDay();\n  const diff = now.getDate() - day + (day === 0 ? -6 : 1);\n  return new Date(now.setDate(diff)).getTime();\n}\n\n/**\n * @returns UTC offset in seconds\n */\nexport function getUtcOffset() {\n  return new Date().getTimezoneOffset() * -60;\n}\n\nexport function shiftTimeRanges(ranges: ApiBusinessTimetableSegment[], shift: number): ApiBusinessTimetableSegment[] {\n  if (shift === 0) return ranges;\n\n  const shiftedRanges: ApiBusinessTimetableSegment[] = [];\n\n  for (const range of ranges) {\n    let start = (range.startMinute + shift) % WEEK_MINUTES;\n    let end = (range.endMinute + shift) % WEEK_MINUTES;\n\n    if (start < 0) start += WEEK_MINUTES;\n    if (end <= 0) end += WEEK_MINUTES;\n\n    if (start > end) {\n      shiftedRanges.push({ startMinute: start, endMinute: WEEK_MINUTES - 1 });\n      shiftedRanges.push({ startMinute: 0, endMinute: end });\n    } else {\n      shiftedRanges.push({ startMinute: start, endMinute: end });\n    }\n  }\n\n  shiftedRanges.sort((a, b) => a.startMinute - b.startMinute);\n\n  // Combine overlapping ranges\n  return shiftedRanges.reduce<ApiBusinessTimetableSegment[]>((acc, range) => {\n    const last = acc[acc.length - 1];\n    if (last && last.endMinute >= range.startMinute) {\n      last.endMinute = Math.max(last.endMinute, range.endMinute);\n    } else {\n      acc.push(range);\n    }\n    return acc;\n  }, []);\n}\n\nexport function splitDays(ranges: ApiBusinessTimetableSegment[]): Record<number, ApiBusinessTimetableSegment[]> {\n  const days: Record<number, ApiBusinessTimetableSegment[]> = {};\n\n  for (const range of ranges) {\n    const start = range.startMinute;\n    const end = range.endMinute;\n\n    const dayStart = Math.floor(start / DAY_MINUTES);\n    const dayEnd = Math.floor((end - 1) / DAY_MINUTES); // 00:00 is counted as same day\n\n    for (let day = dayStart; day <= dayEnd; day++) {\n      if (!days[day]) {\n        days[day] = [];\n      }\n\n      days[day].push({\n        startMinute: Math.max(0, start - day * DAY_MINUTES),\n        endMinute: Math.min(DAY_MINUTES, end - day * DAY_MINUTES),\n      });\n    }\n  }\n\n  return days;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"Ef_0p5Qm\",\"top\":\"nHSmCUNs\",\"icon\":\"rlM4Mbnn\",\"left\":\"JTZ8UnnP\",\"bottom\":\"lp9VIV1o\",\"status\":\"JVL7ZnnJ\",\"status-open\":\"segAfYXs\",\"statusOpen\":\"segAfYXs\",\"arrow\":\"dYxw2cFn\",\"offset-trigger\":\"gVwflFhz\",\"offsetTrigger\":\"gVwflFhz\",\"transition\":\"WKgL_XiP\",\"timetable\":\"MPBKHdZL\",\"schedule\":\"Rs0VPgpq\",\"weekday\":\"cmxPqAof\",\"current-day\":\"YZVvP_56\",\"currentDay\":\"YZVvP_56\"};","import React, {\n  memo, useEffect, useMemo, useRef,\n} from '../../../lib/teact/teact';\n\nimport type { ApiBusinessWorkHours } from '../../../api/types';\n\nimport { requestMeasure, requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { IS_TOUCH_ENV } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatTime, formatWeekday } from '../../../util/dates/dateFormat';\nimport {\n  getUtcOffset, getWeekStart, shiftTimeRanges, splitDays,\n} from '../../../util/dates/workHours';\n\nimport useSelectorSignal from '../../../hooks/data/useSelectorSignal';\nimport useInterval from '../../../hooks/schedulers/useInterval';\nimport useDerivedState from '../../../hooks/useDerivedState';\nimport useFlag from '../../../hooks/useFlag';\nimport useForceUpdate from '../../../hooks/useForceUpdate';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport ListItem from '../../ui/ListItem';\nimport Transition, { ACTIVE_SLIDE_CLASS_NAME, TO_SLIDE_CLASS_NAME } from '../../ui/Transition';\nimport Icon from '../icons/Icon';\n\nimport styles from './BusinessHours.module.scss';\n\nconst DAYS = Array.from({ length: 7 }, (_, i) => i);\n\ntype OwnProps = {\n  businessHours: ApiBusinessWorkHours;\n};\n\nconst BusinessHours = ({\n  businessHours,\n}: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  const transitionRef = useRef<HTMLDivElement>(null);\n  const [isExpanded, expand, collapse] = useFlag(false);\n  const [isMyTime, showInMyTime, showInLocalTime] = useFlag(false);\n  const lang = useOldLang();\n  const forceUpdate = useForceUpdate();\n\n  useInterval(forceUpdate, 60 * 1000);\n\n  const timezoneSignal = useSelectorSignal((global) => global.timezones?.byId);\n  const timezones = useDerivedState(timezoneSignal, [timezoneSignal]);\n  const timezoneMinuteDifference = useMemo(() => {\n    if (!timezones) return 0;\n    const timezone = timezones[businessHours.timezoneId];\n    const myOffset = getUtcOffset();\n    return (myOffset - timezone.utcOffset) / 60;\n  }, [businessHours.timezoneId, timezones]);\n\n  const workHours = useMemo(() => {\n    const weekStart = getWeekStart();\n    const shiftedHours = shiftTimeRanges(businessHours.workHours, isMyTime ? timezoneMinuteDifference : 0);\n    const days = splitDays(shiftedHours);\n    const result: Record<number, string[]> = {};\n\n    DAYS.forEach((day) => {\n      const segments = days[day];\n      if (!segments) {\n        result[day] = [lang('BusinessHoursDayClosed')];\n        return;\n      }\n\n      result[day] = segments.map(({ startMinute, endMinute }) => {\n        if (endMinute - startMinute === 24 * 60) return lang('BusinessHoursDayFullOpened');\n        const start = formatTime(lang, weekStart + startMinute * 60 * 1000);\n        const end = formatTime(lang, weekStart + endMinute * 60 * 1000);\n        return `${start}  ${end}`;\n      });\n    });\n\n    return result;\n  }, [businessHours.workHours, isMyTime, lang, timezoneMinuteDifference]);\n\n  const isBusinessOpen = useMemo(() => {\n    const localTimeHours = shiftTimeRanges(businessHours.workHours, timezoneMinuteDifference);\n\n    const weekStart = getWeekStart();\n    const now = new Date().getTime();\n    const minutesSinceWeekStart = (now - weekStart) / 1000 / 60;\n\n    return localTimeHours.some(({ startMinute, endMinute }) => (\n      startMinute <= minutesSinceWeekStart && minutesSinceWeekStart <= endMinute\n    ));\n  }, [businessHours.workHours, timezoneMinuteDifference]);\n\n  const currentDay = useMemo(() => {\n    const now = new Date(Date.now() - (isMyTime ? 0 : timezoneMinuteDifference * 60 * 1000));\n    return (now.getDay() + 6) % 7;\n  }, [isMyTime, timezoneMinuteDifference]);\n\n  const handleClick = useLastCallback(() => {\n    if (isExpanded) {\n      collapse();\n    } else {\n      expand();\n    }\n  });\n\n  const handleTriggerOffset = useLastCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    if (isMyTime) {\n      showInLocalTime();\n    } else {\n      showInMyTime();\n    }\n  });\n\n  useEffect(() => {\n    if (!isExpanded) return;\n    const slide = document.querySelector<HTMLElement>(`.${ACTIVE_SLIDE_CLASS_NAME} > .${styles.timetable}`);\n    if (!slide) return;\n\n    const height = slide.offsetHeight;\n    requestMutation(() => {\n      transitionRef.current!.style.height = `${height}px`;\n    });\n  }, [isExpanded]);\n\n  const handleAnimationStart = useLastCallback(() => {\n    const slide = document.querySelector<HTMLElement>(`.${TO_SLIDE_CLASS_NAME} > .${styles.timetable}`)!;\n\n    requestMeasure(() => {\n      const height = slide.offsetHeight;\n      requestMutation(() => {\n        transitionRef.current!.style.height = `${height}px`;\n      });\n    });\n  });\n\n  return (\n    <ListItem\n      icon=\"clock\"\n      iconClassName={styles.icon}\n      multiline\n      className={styles.root}\n      isStatic={isExpanded}\n      ripple\n      narrow\n      withColorTransition\n      onClick={handleClick}\n    >\n      <div className={styles.top}>\n        <div className={styles.left}>\n          <div>{lang('BusinessHoursProfile')}</div>\n          <div className={buildClassName(styles.status, isBusinessOpen && styles.statusOpen)}>\n            {isBusinessOpen ? lang('BusinessHoursProfileNowOpen') : lang('BusinessHoursProfileNowClosed')}\n          </div>\n        </div>\n        <Icon className={styles.arrow} name={isExpanded ? 'up' : 'down'} />\n      </div>\n      {isExpanded && (\n        <div className={styles.bottom}>\n          {Boolean(timezoneMinuteDifference) && (\n            <div\n              className={styles.offsetTrigger}\n              role=\"button\"\n              tabIndex={0}\n              onMouseDown={!IS_TOUCH_ENV ? handleTriggerOffset : undefined}\n              onClick={IS_TOUCH_ENV ? handleTriggerOffset : undefined}\n            >\n              {lang(isMyTime ? 'BusinessHoursProfileSwitchMy' : 'BusinessHoursProfileSwitchLocal')}\n            </div>\n          )}\n          <Transition\n            className={styles.transition}\n            ref={transitionRef}\n            name=\"fade\"\n            activeKey={Number(isMyTime)}\n            onStart={handleAnimationStart}\n          >\n            <dl className={styles.timetable}>\n              {DAYS.map((day) => (\n                <>\n                  <dt className={buildClassName(styles.weekday, day === currentDay && styles.currentDay)}>\n                    {formatWeekday(lang, day === 6 ? 0 : day + 1)}\n                  </dt>\n                  <dd className={styles.schedule}>\n                    {workHours[day].map((segment) => (\n                      <div>{segment}</div>\n                    ))}\n                  </dd>\n                </>\n              ))}\n            </dl>\n          </Transition>\n        </div>\n      )}\n    </ListItem>\n  );\n};\n\nexport default memo(BusinessHours);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"wCp6TBYF\",\"number\":\"lQeU96Fj\",\"float\":\"nKt3QDc_\",\"show-up\":\"ZaSLCV2k\",\"showUp\":\"ZaSLCV2k\",\"dissapear\":\"jA50ot3v\",\"shiftOrigin\":\"e1ezfWJb\",\"effect\":\"cFEXGUih\",\"giftIcon\":\"c4HDQNGJ\"};","import React, {\n  memo, useEffect, useMemo, useRef,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport {\n  type ApiBirthday, ApiMediaFormat, type ApiStickerSet, type ApiUser,\n} from '../../../api/types';\n\nimport { requestMeasure } from '../../../lib/fasterdom/fasterdom';\nimport { getStickerMediaHash } from '../../../global/helpers';\nimport { selectIsPremiumPurchaseBlocked } from '../../../global/selectors';\nimport { IS_OFFSET_PATH_SUPPORTED } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatDateToString } from '../../../util/dates/dateFormat';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport * as mediaLoader from '../../../util/mediaLoader';\nimport renderText from '../helpers/renderText';\n\nimport useTimeout from '../../../hooks/schedulers/useTimeout';\nimport useFlag from '../../../hooks/useFlag';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport ListItem from '../../ui/ListItem';\nimport StickerView from '../StickerView';\n\nimport styles from './UserBirthday.module.scss';\n\nconst NUMBER_EMOJI_SUFFIX = '\\uFE0F\\u20E3';\nconst NUMBER_STICKER_SIZE = 128;\nconst EFFECT_EMOJIS = ['', '', ''];\nconst EFFECT_SIZE = 288;\nconst ANIMATION_DURATION = 3000;\n\ntype OwnProps = {\n  user: ApiUser;\n  birthday: ApiBirthday;\n  isInSettings?: boolean;\n};\n\ntype StateProps = {\n  isPremiumPurchaseBlocked?: boolean;\n  birthdayNumbers?: ApiStickerSet;\n  animatedEmojiEffects?: ApiStickerSet;\n};\n\nconst UserBirthday = ({\n  user,\n  birthday,\n  isPremiumPurchaseBlocked,\n  birthdayNumbers,\n  animatedEmojiEffects,\n  isInSettings,\n}: OwnProps & StateProps) => {\n  const { openGiftModal, requestConfetti } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const animationPlayedRef = useRef(false);\n  const [isPlayingAnimation, playAnimation, stopAnimation] = useFlag();\n\n  const lang = useOldLang();\n\n  const {\n    formattedDate,\n    isToday,\n    age,\n  } = useMemo(() => {\n    const today = new Date();\n    const date = new Date();\n    if (birthday.year) {\n      date.setFullYear(birthday.year);\n    }\n    date.setMonth(birthday.month - 1);\n    date.setDate(birthday.day);\n    date.setHours(0, 0, 0, 0);\n\n    const formatted = formatDateToString(date, lang.code, true, 'long');\n    const isBirthdayToday = date.getDate() === today.getDate() && date.getMonth() === today.getMonth();\n    return {\n      formattedDate: formatted,\n      isToday: isBirthdayToday,\n      age: birthday.year && getAge(date),\n    };\n  }, [birthday, lang]);\n\n  const numbersForAge = useMemo(() => {\n    if (!age || !isToday) return undefined;\n    const numbers = birthdayNumbers?.stickers?.filter(({ emoji }) => emoji?.endsWith(NUMBER_EMOJI_SUFFIX));\n    if (!numbers) return undefined;\n    const byEmoji = buildCollectionByKey(numbers, 'emoji');\n\n    const ageDigits = age.toString().split('');\n    return ageDigits.map((digit) => byEmoji[digit + NUMBER_EMOJI_SUFFIX]);\n  }, [age, birthdayNumbers?.stickers, isToday]);\n\n  const effectSticker = useMemo(() => {\n    if (!isToday) return undefined;\n    const randomEffect = EFFECT_EMOJIS[Math.floor(Math.random() * EFFECT_EMOJIS.length)];\n    return animatedEmojiEffects?.stickers?.find(({ emoji }) => emoji === randomEffect);\n  }, [animatedEmojiEffects?.stickers, isToday]);\n\n  // Preload stickers\n  useEffect(() => {\n    if (!isToday || !numbersForAge) return;\n\n    numbersForAge.forEach((sticker) => {\n      const hash = getStickerMediaHash(sticker, 'preview');\n      mediaLoader.fetch(hash, ApiMediaFormat.BlobUrl);\n    });\n\n    if (effectSticker) {\n      const effectHash = getStickerMediaHash(effectSticker, 'preview');\n      mediaLoader.fetch(effectHash, ApiMediaFormat.BlobUrl);\n    }\n  }, [effectSticker, isToday, numbersForAge]);\n\n  useTimeout(stopAnimation, isPlayingAnimation ? ANIMATION_DURATION : undefined);\n\n  useEffect(() => {\n    if (isPlayingAnimation) {\n      animationPlayedRef.current = true;\n\n      const column = document.getElementById(isInSettings ? 'LeftColumn' : 'RightColumn');\n      if (!column) return;\n\n      requestMeasure(() => {\n        const {\n          top, left, width, height,\n        } = column.getBoundingClientRect();\n\n        requestConfetti({\n          top,\n          left,\n          width,\n          height,\n          style: 'top-down',\n        });\n      });\n    }\n  }, [isInSettings, isPlayingAnimation]);\n\n  const valueKey = `ProfileBirthday${isToday ? 'Today' : ''}Value${age ? 'Year' : ''}`;\n\n  const canGiftPremium = isToday && !user.isPremium && !user.isSelf && !isPremiumPurchaseBlocked;\n\n  const handleOpenGiftModal = useLastCallback(() => {\n    openGiftModal({ forUserId: user.id });\n  });\n\n  const handleClick = useLastCallback(() => {\n    if (!isToday) return;\n\n    if (canGiftPremium && animationPlayedRef.current) {\n      handleOpenGiftModal();\n      return;\n    }\n\n    playAnimation();\n  });\n\n  const isStatic = !isToday && !canGiftPremium;\n\n  return (\n    <div className={styles.root}>\n      <ListItem\n        icon=\"calendar\"\n        secondaryIcon={canGiftPremium ? 'gift' : undefined}\n        secondaryIconClassName={styles.giftIcon}\n        multiline\n        narrow\n        ref={ref}\n        ripple={!isStatic}\n        onClick={handleClick}\n        isStatic={isStatic}\n        onSecondaryIconClick={handleOpenGiftModal}\n      >\n        <div className=\"title\" dir={lang.isRtl ? 'rtl' : undefined}>\n          {renderText(lang(valueKey, [formattedDate, age], undefined, age))}\n        </div>\n        <span className=\"subtitle\">{lang(isToday ? 'ProfileBirthdayToday' : 'ProfileBirthday')}</span>\n      </ListItem>\n      {isPlayingAnimation && IS_OFFSET_PATH_SUPPORTED && numbersForAge?.map((sticker, index) => (\n        <div\n          className={buildClassName(styles.number, index > 0 && styles.shiftOrigin)}\n          style={`--digit-offset: ${index}`}\n        >\n          <StickerView\n            containerRef={ref}\n            sticker={sticker}\n            size={NUMBER_STICKER_SIZE}\n            forceAlways\n          />\n        </div>\n      ))}\n      {isPlayingAnimation && effectSticker && (\n        <div className={styles.effect}>\n          <StickerView\n            containerRef={ref}\n            sticker={effectSticker}\n            size={EFFECT_SIZE}\n            shouldLoop\n            forceAlways\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global): StateProps => {\n    const { birthdayNumbers, animatedEmojiEffects } = global;\n    return {\n      birthdayNumbers,\n      animatedEmojiEffects,\n      isPremiumPurchaseBlocked: selectIsPremiumPurchaseBlocked(global),\n    };\n  },\n)(UserBirthday));\n\n// https://stackoverflow.com/a/7091965\nfunction getAge(birthdate: Date) {\n  const today = new Date();\n  let age = today.getFullYear() - birthdate.getFullYear();\n  const m = today.getMonth() - birthdate.getMonth();\n  if (m < 0 || (m === 0 && today.getDate() < birthdate.getDate())) {\n    age--;\n  }\n\n  return age;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"businessLocation\":\"UZbkeFDB\",\"personalChannel\":\"HP5EJx7s\",\"personalChannelTitle\":\"cHyTGri2\",\"botVerificationSection\":\"RWFu5ENh\",\"sectionInfo\":\"IrqRJFxm\",\"botVerificationIcon\":\"b32hsSPS\",\"personalChannelSubscribers\":\"kYd2GrmU\",\"personalChannelItem\":\"qOJwhXMC\",\"openAppButton\":\"x925YeS3\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useMemo,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type {\n  ApiBotVerification,\n  ApiChat,\n  ApiCountryCode,\n  ApiUser,\n  ApiUserFullInfo,\n  ApiUsername,\n} from '../../../api/types';\nimport type { BotAppPermissions } from '../../../types';\nimport { MAIN_THREAD_ID } from '../../../api/types';\n\nimport { FRAGMENT_PHONE_CODE, FRAGMENT_PHONE_LENGTH } from '../../../config';\nimport {\n  buildStaticMapHash,\n  getChatLink,\n  getHasAdminRight,\n  isChatChannel,\n  isUserRightBanned,\n} from '../../../global/helpers';\nimport { getIsChatMuted } from '../../../global/helpers/notifications';\nimport {\n  selectBotAppPermissions,\n  selectChat,\n  selectChatFullInfo,\n  selectCurrentMessageList,\n  selectNotifyDefaults,\n  selectNotifyException,\n  selectTopicLink,\n  selectUser,\n  selectUserFullInfo,\n} from '../../../global/selectors';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { formatPhoneNumberWithCode } from '../../../util/phoneNumber';\nimport stopEvent from '../../../util/stopEvent';\nimport { extractCurrentThemeParams } from '../../../util/themeStyle';\nimport { ChatAnimationTypes } from '../../left/main/hooks';\nimport formatUsername from '../helpers/formatUsername';\nimport renderText from '../helpers/renderText';\n\nimport useEffectWithPrevDeps from '../../../hooks/useEffectWithPrevDeps';\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useDevicePixelRatio from '../../../hooks/window/useDevicePixelRatio';\n\nimport Chat from '../../left/main/Chat';\nimport Button from '../../ui/Button';\nimport ListItem from '../../ui/ListItem';\nimport Skeleton from '../../ui/placeholder/Skeleton';\nimport Switcher from '../../ui/Switcher';\nimport CustomEmoji from '../CustomEmoji';\nimport SafeLink from '../SafeLink';\nimport BusinessHours from './BusinessHours';\nimport UserBirthday from './UserBirthday';\n\nimport styles from './ChatExtra.module.scss';\n\ntype OwnProps = {\n  chatOrUserId: string;\n  isSavedDialog?: boolean;\n  isInSettings?: boolean;\n};\n\ntype StateProps = {\n  user?: ApiUser;\n  chat?: ApiChat;\n  userFullInfo?: ApiUserFullInfo;\n  canInviteUsers?: boolean;\n  isMuted?: boolean;\n  phoneCodeList: ApiCountryCode[];\n  topicId?: number;\n  description?: string;\n  chatInviteLink?: string;\n  topicLink?: string;\n  hasSavedMessages?: boolean;\n  personalChannel?: ApiChat;\n  hasMainMiniApp?: boolean;\n  isBotCanManageEmojiStatus?: boolean;\n  botAppPermissions?: BotAppPermissions;\n  botVerification?: ApiBotVerification;\n};\n\nconst DEFAULT_MAP_CONFIG = {\n  width: 64,\n  height: 64,\n  zoom: 15,\n};\n\nconst BOT_VERIFICATION_ICON_SIZE = 16;\n\nconst ChatExtra: FC<OwnProps & StateProps> = ({\n  chatOrUserId,\n  user,\n  chat,\n  userFullInfo,\n  isInSettings,\n  canInviteUsers,\n  isMuted,\n  phoneCodeList,\n  topicId,\n  description,\n  chatInviteLink,\n  topicLink,\n  hasSavedMessages,\n  personalChannel,\n  hasMainMiniApp,\n  isBotCanManageEmojiStatus,\n  botAppPermissions,\n  botVerification,\n}) => {\n  const {\n    showNotification,\n    updateChatMutedState,\n    updateTopicMutedState,\n    loadPeerStories,\n    openSavedDialog,\n    openMapModal,\n    requestCollectibleInfo,\n    requestMainWebView,\n    toggleUserEmojiStatusPermission,\n    toggleUserLocationPermission,\n  } = getActions();\n\n  const {\n    id: userId,\n    usernames,\n    phoneNumber,\n    isSelf,\n  } = user || {};\n  const { id: chatId, usernames: chatUsernames } = chat || {};\n  const peerId = userId || chatId;\n  const {\n    businessLocation,\n    businessWorkHours,\n    personalChannelMessageId,\n    birthday,\n  } = userFullInfo || {};\n  const oldLang = useOldLang();\n  const lang = useLang();\n\n  useEffectWithPrevDeps(([prevPeerId]) => {\n    if (!peerId || prevPeerId === peerId) return;\n    if (user || (chat && isChatChannel(chat))) {\n      loadPeerStories({ peerId });\n    }\n  }, [peerId, chat, user]);\n\n  const { width, height, zoom } = DEFAULT_MAP_CONFIG;\n  const dpr = useDevicePixelRatio();\n  const locationMediaHash = businessLocation?.geo\n    && buildStaticMapHash(businessLocation.geo, width, height, zoom, dpr);\n  const locationBlobUrl = useMedia(locationMediaHash);\n\n  const locationRightComponent = useMemo(() => {\n    if (!businessLocation?.geo) return undefined;\n    if (locationBlobUrl) {\n      return <img src={locationBlobUrl} alt=\"\" className={styles.businessLocation} />;\n    }\n\n    return <Skeleton className={styles.businessLocation} />;\n  }, [businessLocation, locationBlobUrl]);\n\n  const isTopicInfo = Boolean(topicId && topicId !== MAIN_THREAD_ID);\n  const shouldRenderAllLinks = (chat && isChatChannel(chat)) || user?.isPremium;\n\n  const activeUsernames = useMemo(() => {\n    const result = usernames?.filter((u) => u.isActive);\n\n    return result?.length ? result : undefined;\n  }, [usernames]);\n\n  const activeChatUsernames = useMemo(() => {\n    const result = !user ? chatUsernames?.filter((u) => u.isActive) : undefined;\n\n    return result?.length ? result : undefined;\n  }, [chatUsernames, user]);\n\n  const link = useMemo(() => {\n    if (!chat) {\n      return undefined;\n    }\n\n    return isTopicInfo ? topicLink! : getChatLink(chat) || chatInviteLink;\n  }, [chat, isTopicInfo, topicLink, chatInviteLink]);\n\n  const handleClickLocation = useLastCallback(() => {\n    const { address, geo } = businessLocation!;\n    if (!geo) {\n      copyTextToClipboard(address);\n      showNotification({ message: oldLang('BusinessLocationCopied') });\n      return;\n    }\n\n    openMapModal({ geoPoint: geo, zoom });\n  });\n\n  const handleNotificationChange = useLastCallback(() => {\n    if (isTopicInfo) {\n      updateTopicMutedState({\n        chatId: chatId!,\n        topicId: topicId!,\n        isMuted: !isMuted,\n      });\n    } else {\n      updateChatMutedState({ chatId: chatId!, isMuted: !isMuted });\n    }\n  });\n\n  const manageEmojiStatusChange = useLastCallback(() => {\n    if (!user) return;\n    toggleUserEmojiStatusPermission({ botId: user.id, isEnabled: !isBotCanManageEmojiStatus });\n  });\n\n  const handleLocationPermissionChange = useLastCallback(() => {\n    if (!user) return;\n    toggleUserLocationPermission({ botId: user.id, isAccessGranted: !botAppPermissions?.geolocation });\n  });\n\n  const handleOpenSavedDialog = useLastCallback(() => {\n    openSavedDialog({ chatId: chatOrUserId });\n  });\n\n  function copy(text: string, entity: string) {\n    copyTextToClipboard(text);\n    showNotification({ message: `${entity} was copied` });\n  }\n\n  const formattedNumber = phoneNumber && formatPhoneNumberWithCode(phoneCodeList, phoneNumber);\n\n  const handlePhoneClick = useLastCallback(() => {\n    if (phoneNumber?.length === FRAGMENT_PHONE_LENGTH && phoneNumber.startsWith(FRAGMENT_PHONE_CODE)) {\n      requestCollectibleInfo({ collectible: phoneNumber, peerId: peerId!, type: 'phone' });\n      return;\n    }\n    copy(formattedNumber!, oldLang('Phone'));\n  });\n\n  const handleUsernameClick = useLastCallback((username: ApiUsername, isChat?: boolean) => {\n    if (!username.isEditable) {\n      requestCollectibleInfo({ collectible: username.username, peerId: peerId!, type: 'username' });\n      return;\n    }\n    copy(formatUsername(username.username, isChat), oldLang(isChat ? 'Link' : 'Username'));\n  });\n\n  const handleOpenApp = useLastCallback(() => {\n    const botId = user?.id;\n    if (!botId) {\n      return;\n    }\n    const theme = extractCurrentThemeParams();\n    requestMainWebView({\n      botId,\n      peerId: botId,\n      theme,\n      shouldMarkBotTrusted: true,\n    });\n  });\n\n  const appTermsInfo = lang('ProfileOpenAppAbout', {\n    terms: (\n      <SafeLink\n        text={lang('ProfileOpenAppTerms')}\n        url={lang('ProfileBotOpenAppInfoLink')}\n      />\n    ),\n  }, { withNodes: true });\n\n  if (chat?.isRestricted || (isSelf && !isInSettings)) {\n    return undefined;\n  }\n\n  function renderUsernames(usernameList: ApiUsername[], isChat?: boolean) {\n    const [mainUsername, ...otherUsernames] = usernameList;\n\n    const usernameLinks = otherUsernames.length\n      ? (oldLang('UsernameAlso', '%USERNAMES%') as string)\n        .split('%')\n        .map((s) => {\n          return (s === 'USERNAMES' ? (\n            <>\n              {otherUsernames.map((username, idx) => {\n                return (\n                  <>\n                    {idx > 0 ? ', ' : ''}\n                    <a\n                      key={username.username}\n                      href={formatUsername(username.username, true)}\n                      onMouseDown={stopEvent}\n                      onClick={(e) => {\n                        stopEvent(e);\n                        handleUsernameClick(username, isChat);\n                      }}\n                      className=\"text-entity-link username-link\"\n                    >\n                      {formatUsername(username.username)}\n                    </a>\n                  </>\n                );\n              })}\n            </>\n          ) : s);\n        })\n      : undefined;\n\n    return (\n      <ListItem\n        icon={isChat ? 'link' : 'mention'}\n        multiline\n        narrow\n        ripple\n        // eslint-disable-next-line react/jsx-no-bind\n        onClick={() => {\n          handleUsernameClick(mainUsername, isChat);\n        }}\n      >\n        <span className=\"title\" dir={lang.isRtl ? 'rtl' : undefined}>\n          {formatUsername(mainUsername.username, isChat)}\n        </span>\n        <span className=\"subtitle\">\n          {usernameLinks && <span className=\"other-usernames\">{usernameLinks}</span>}\n          {oldLang(isChat ? 'Link' : 'Username')}\n        </span>\n      </ListItem>\n    );\n  }\n\n  return (\n    <div className=\"ChatExtra\">\n      {personalChannel && (\n        <div className={styles.personalChannel}>\n          <h3 className={styles.personalChannelTitle}>{oldLang('ProfileChannel')}</h3>\n          <span className={styles.personalChannelSubscribers}>\n            {oldLang('Subscribers', personalChannel.membersCount, 'i')}\n          </span>\n          <Chat\n            chatId={personalChannel.id}\n            orderDiff={0}\n            animationType={ChatAnimationTypes.None}\n            isPreview\n            previewMessageId={personalChannelMessageId}\n            className={styles.personalChannelItem}\n          />\n        </div>\n      )}\n      {Boolean(formattedNumber?.length) && (\n        // eslint-disable-next-line react/jsx-no-bind\n        <ListItem icon=\"phone\" multiline narrow ripple onClick={handlePhoneClick}>\n          <span className=\"title\" dir={lang.isRtl ? 'rtl' : undefined}>{formattedNumber}</span>\n          <span className=\"subtitle\">{oldLang('Phone')}</span>\n        </ListItem>\n      )}\n      {activeUsernames && renderUsernames(activeUsernames)}\n      {description && Boolean(description.length) && (\n        <ListItem\n          icon=\"info\"\n          multiline\n          narrow\n          isStatic\n          allowSelection\n        >\n          <span className=\"title word-break allow-selection\" dir={lang.isRtl ? 'rtl' : undefined}>\n            {\n              renderText(description, [\n                'br',\n                shouldRenderAllLinks ? 'links' : 'tg_links',\n                'emoji',\n              ])\n            }\n          </span>\n          <span className=\"subtitle\">{oldLang(userId ? 'UserBio' : 'Info')}</span>\n        </ListItem>\n      )}\n      {activeChatUsernames && !isTopicInfo && renderUsernames(activeChatUsernames, true)}\n      {((!activeChatUsernames && canInviteUsers) || isTopicInfo) && link && (\n        <ListItem\n          icon=\"link\"\n          multiline\n          narrow\n          ripple\n          // eslint-disable-next-line react/jsx-no-bind\n          onClick={() => copy(link, oldLang('SetUrlPlaceholder'))}\n        >\n          <div className=\"title\">{link}</div>\n          <span className=\"subtitle\">{oldLang('SetUrlPlaceholder')}</span>\n        </ListItem>\n      )}\n      {birthday && (\n        <UserBirthday key={peerId} birthday={birthday} user={user!} isInSettings={isInSettings} />\n      )}\n      { hasMainMiniApp && (\n        <ListItem\n          multiline\n          isStatic\n          narrow\n        >\n          <Button\n            className={styles.openAppButton}\n            size=\"smaller\"\n            onClick={handleOpenApp}\n          >\n            {oldLang('ProfileBotOpenApp')}\n          </Button>\n          <div className={styles.sectionInfo}>\n            {appTermsInfo}\n          </div>\n        </ListItem>\n      )}\n      {!isInSettings && (\n        <ListItem icon=\"unmute\" narrow ripple onClick={handleNotificationChange}>\n          <span>{oldLang('Notifications')}</span>\n          <Switcher\n            id=\"group-notifications\"\n            label={userId ? 'Toggle User Notifications' : 'Toggle Chat Notifications'}\n            checked={!isMuted}\n            inactive\n          />\n        </ListItem>\n      )}\n      {businessWorkHours && (\n        <BusinessHours businessHours={businessWorkHours} />\n      )}\n      {businessLocation && (\n        <ListItem\n          icon=\"location\"\n          ripple\n          multiline\n          narrow\n          rightElement={locationRightComponent}\n          onClick={handleClickLocation}\n        >\n          <div className=\"title\">{businessLocation.address}</div>\n          <span className=\"subtitle\">{oldLang('BusinessProfileLocation')}</span>\n        </ListItem>\n      )}\n      {hasSavedMessages && !isInSettings && (\n        <ListItem icon=\"saved-messages\" narrow ripple onClick={handleOpenSavedDialog}>\n          <span>{oldLang('SavedMessagesTab')}</span>\n        </ListItem>\n      )}\n      {userFullInfo && 'isBotAccessEmojiGranted' in userFullInfo && (\n        <ListItem icon=\"user\" narrow ripple onClick={manageEmojiStatusChange}>\n          <span>{oldLang('BotProfilePermissionEmojiStatus')}</span>\n          <Switcher\n            label={oldLang('BotProfilePermissionEmojiStatus')}\n            checked={isBotCanManageEmojiStatus}\n            inactive\n          />\n        </ListItem>\n      )}\n      {botAppPermissions?.geolocation !== undefined && (\n        <ListItem icon=\"location\" narrow ripple onClick={handleLocationPermissionChange}>\n          <span>{oldLang('BotProfilePermissionLocation')}</span>\n          <Switcher\n            label={oldLang('BotProfilePermissionLocation')}\n            checked={botAppPermissions?.geolocation}\n            inactive\n          />\n        </ListItem>\n      )}\n      {botVerification && (\n        <div className={styles.botVerificationSection}>\n          <CustomEmoji\n            className={styles.botVerificationIcon}\n            documentId={botVerification.iconId}\n            size={BOT_VERIFICATION_ICON_SIZE}\n          />\n          {botVerification.description}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatOrUserId, isSavedDialog }): StateProps => {\n    const { countryList: { phoneCodes: phoneCodeList } } = global;\n\n    const chat = chatOrUserId ? selectChat(global, chatOrUserId) : undefined;\n    const user = chatOrUserId ? selectUser(global, chatOrUserId) : undefined;\n    const botAppPermissions = chatOrUserId ? selectBotAppPermissions(global, chatOrUserId) : undefined;\n    const isForum = chat?.isForum;\n    const isMuted = chat && getIsChatMuted(chat, selectNotifyDefaults(global), selectNotifyException(global, chat.id));\n    const { threadId } = selectCurrentMessageList(global) || {};\n    const topicId = isForum && threadId ? Number(threadId) : undefined;\n\n    const chatFullInfo = chat && selectChatFullInfo(global, chat.id);\n    const userFullInfo = user && selectUserFullInfo(global, user.id);\n\n    const botVerification = userFullInfo?.botVerification || chatFullInfo?.botVerification;\n\n    const chatInviteLink = chatFullInfo?.inviteLink;\n    const description = userFullInfo?.bio || chatFullInfo?.about;\n\n    const canInviteUsers = chat && !user && (\n      (!isChatChannel(chat) && !isUserRightBanned(chat, 'inviteUsers'))\n      || getHasAdminRight(chat, 'inviteUsers')\n    );\n\n    const topicLink = topicId ? selectTopicLink(global, chatOrUserId, topicId) : undefined;\n\n    const hasSavedMessages = !isSavedDialog && global.chats.listIds.saved?.includes(chatOrUserId);\n\n    const personalChannel = userFullInfo?.personalChannelId\n      ? selectChat(global, userFullInfo.personalChannelId)\n      : undefined;\n\n    const hasMainMiniApp = user?.hasMainMiniApp;\n\n    return {\n      phoneCodeList,\n      chat,\n      user,\n      userFullInfo,\n      canInviteUsers,\n      botAppPermissions,\n      isMuted,\n      topicId,\n      chatInviteLink,\n      description,\n      topicLink,\n      hasSavedMessages,\n      personalChannel,\n      hasMainMiniApp,\n      isBotCanManageEmojiStatus: userFullInfo?.isBotCanManageEmojiStatus,\n      botVerification,\n    };\n  },\n)(ChatExtra));\n","import { validateFiles } from '../../../../util/files';\n\nexport default async function getFilesFromDataTransferItems(dataTransferItems: DataTransferItemList) {\n  const files: File[] = [];\n\n  function traverseFileTreePromise(entry: FileSystemEntry | File, item: DataTransferItem) {\n    return new Promise((resolve) => {\n      if (entry instanceof File) {\n        files.push(entry);\n        resolve(entry);\n      } else if (entry.isFile) {\n        const itemFile = item.getAsFile();\n        (entry as FileSystemFileEntry).file((file) => {\n          files.push(file);\n          resolve(file);\n        }, () => {\n          // iOS Safari throws an error \"NotFoundError: Path does not exist\" for files from the clipboard\n          // https://stackoverflow.com/a/50059309\n          if (itemFile) {\n            files.push(itemFile);\n          }\n          resolve(itemFile);\n        });\n      } else if (entry.isDirectory) {\n        const dirReader = (entry as FileSystemDirectoryEntry).createReader();\n        dirReader.readEntries((entries) => {\n          const entriesPromises = [];\n          for (let i = 0; i < entries.length; i++) {\n            entriesPromises.push(traverseFileTreePromise(entries[i], item));\n          }\n          resolve(Promise.all(entriesPromises));\n        });\n      }\n    });\n  }\n\n  const entriesPromises = [];\n  for (let i = 0; i < dataTransferItems.length; i++) {\n    const item = dataTransferItems[i];\n    if (item.kind === 'file') {\n      const entry = item.webkitGetAsEntry() || item.getAsFile();\n      if (entry) {\n        entriesPromises.push(traverseFileTreePromise(entry, item));\n      }\n    }\n  }\n\n  await Promise.all(entriesPromises);\n\n  return validateFiles(files);\n}\n","export const PRIMARY_VIDEO_MIME = 'video/mp4; codecs=hvc1.1.6.L63.00';\nexport const SECONDARY_VIDEO_MIME = 'video/mp4; codecs=avc1.64001E';\n","// extracted by mini-css-extract-plugin\nexport default {\"primaryLink\":\"xNjJHI7j\",\"input\":\"Ag6k_p7b\",\"moreMenu\":\"p7t3macG\",\"copy\":\"obuPXobw\",\"title\":\"vCMpiQTJ\",\"share\":\"Sbagy_Tm\"};","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport buildClassName from '../../util/buildClassName';\nimport { copyTextToClipboard } from '../../util/clipboard';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Button from '../ui/Button';\nimport DropdownMenu from '../ui/DropdownMenu';\nimport MenuItem from '../ui/MenuItem';\nimport Icon from './icons/Icon';\n\nimport styles from './LinkField.module.scss';\n\ntype OwnProps = {\n  title?: string;\n  link: string;\n  isDisabled?: boolean;\n  className?: string;\n  withShare?: boolean;\n  onRevoke?: VoidFunction;\n};\n\nconst InviteLink: FC<OwnProps> = ({\n  title,\n  link,\n  isDisabled,\n  className,\n  withShare,\n  onRevoke,\n}) => {\n  const lang = useOldLang();\n  const { showNotification, openChatWithDraft } = getActions();\n\n  const { isMobile } = useAppLayout();\n\n  const isOnlyCopy = !onRevoke;\n\n  const copyLink = useLastCallback(() => {\n    copyTextToClipboard(link);\n    showNotification({\n      message: {\n        key: 'LinkCopied',\n      },\n    });\n  });\n\n  const handleCopyClick = useLastCallback(() => {\n    if (isDisabled) return;\n    copyLink();\n  });\n\n  const handleShare = useLastCallback(() => {\n    openChatWithDraft({ text: { text: link } });\n  });\n\n  const PrimaryLinkMenuButton: FC<{ onTrigger: () => void; isOpen?: boolean }> = useMemo(() => {\n    return ({ onTrigger, isOpen }) => (\n      <Button\n        round\n        ripple={!isMobile}\n        size=\"smaller\"\n        color=\"translucent\"\n        className={isOpen ? 'active' : ''}\n        onClick={onTrigger}\n        ariaLabel={lang('AccDescrOpenMenu2')}\n      >\n        <Icon name=\"more\" />\n      </Button>\n    );\n  }, [isMobile, lang]);\n\n  return (\n    <div className={className}>\n      <p className={styles.title}>\n        {lang(title || 'InviteLink.InviteLink')}\n      </p>\n      <div className={styles.primaryLink}>\n        <input\n          className={buildClassName('form-control', styles.input)}\n          value={link}\n          readOnly\n          onClick={handleCopyClick}\n        />\n        {isOnlyCopy ? (\n          <Button\n            color=\"translucent\"\n            className={styles.copy}\n            size=\"smaller\"\n            round\n            disabled={isDisabled}\n            onClick={handleCopyClick}\n          >\n            <Icon name=\"copy\" />\n          </Button>\n        ) : (\n          <DropdownMenu\n            className={styles.moreMenu}\n            trigger={PrimaryLinkMenuButton}\n            positionX=\"right\"\n          >\n            <MenuItem icon=\"copy\" onClick={handleCopyClick} disabled={isDisabled}>{lang('Copy')}</MenuItem>\n            {onRevoke && (\n              <MenuItem icon=\"delete\" onClick={onRevoke} destructive>{lang('RevokeButton')}</MenuItem>\n            )}\n          </DropdownMenu>\n        )}\n      </div>\n      {withShare && (\n        <Button\n          size=\"smaller\"\n          disabled={isDisabled}\n          onClick={handleShare}\n          className={styles.share}\n        >\n          {lang('FolderLinkScreen.LinkActionShare')}\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(InviteLink);\n","import { useMemo } from '../lib/teact/teact';\nimport { getActions } from '../global';\n\nimport type { ApiChat, ApiTopic, ApiUser } from '../api/types';\nimport type { MenuItemContextAction } from '../components/ui/ListItem';\n\nimport { SERVICE_NOTIFICATIONS_USER_ID } from '../config';\nimport {\n  getCanDeleteChat, isChatArchived, isChatChannel, isChatGroup,\n  isUserId,\n} from '../global/helpers';\nimport { IS_ELECTRON, IS_OPEN_IN_NEW_TAB_SUPPORTED } from '../util/browser/windowEnvironment';\nimport { compact } from '../util/iteratees';\nimport useLang from './useLang';\n\nconst useChatContextActions = ({\n  chat,\n  user,\n  folderId,\n  isPinned,\n  isMuted,\n  canChangeFolder,\n  isSavedDialog,\n  currentUserId,\n  isPreview,\n  topics,\n  handleDelete,\n  handleMute,\n  handleChatFolderChange,\n  handleReport,\n}: {\n  chat: ApiChat | undefined;\n  user: ApiUser | undefined;\n  folderId?: number;\n  isPinned?: boolean;\n  isMuted?: boolean;\n  canChangeFolder?: boolean;\n  isSavedDialog?: boolean;\n  currentUserId?: string;\n  isPreview?: boolean;\n  topics?: Record<number, ApiTopic>;\n  handleDelete?: NoneToVoidFunction;\n  handleMute?: NoneToVoidFunction;\n  handleChatFolderChange: NoneToVoidFunction;\n  handleReport?: NoneToVoidFunction;\n}, isInSearch = false) => {\n  const lang = useLang();\n\n  const { isSelf } = user || {};\n  const isServiceNotifications = user?.id === SERVICE_NOTIFICATIONS_USER_ID;\n\n  const deleteTitle = useMemo(() => {\n    if (!chat) return undefined;\n\n    if (isSavedDialog) {\n      return lang('Delete');\n    }\n\n    if (isUserId(chat.id)) {\n      return lang('DeleteChat');\n    }\n\n    if (getCanDeleteChat(chat)) {\n      return lang('DeleteChat');\n    }\n\n    if (isChatChannel(chat)) {\n      return lang('ChannelLeave');\n    }\n\n    return lang('GroupLeaveGroup');\n  }, [chat, isSavedDialog, lang]);\n\n  return useMemo(() => {\n    if (!chat || isPreview) {\n      return undefined;\n    }\n\n    const {\n      toggleChatPinned,\n      toggleSavedDialogPinned,\n      updateChatMutedState,\n      toggleChatArchived,\n      markChatMessagesRead,\n      markChatUnread,\n      openChatInNewTab,\n    } = getActions();\n\n    const actionOpenInNewTab = IS_OPEN_IN_NEW_TAB_SUPPORTED && {\n      title: IS_ELECTRON ? lang('ChatListOpenInNewWindow') : lang('ChatListOpenInNewTab'),\n      icon: 'open-in-new-tab',\n      handler: () => {\n        if (isSavedDialog) {\n          openChatInNewTab({ chatId: currentUserId!, threadId: chat.id });\n        } else {\n          openChatInNewTab({ chatId: chat.id });\n        }\n      },\n    };\n\n    const togglePinned = () => {\n      if (isSavedDialog) {\n        toggleSavedDialogPinned({ id: chat.id });\n      } else {\n        toggleChatPinned({ id: chat.id, folderId: folderId! });\n      }\n    };\n\n    const actionPin = isPinned\n      ? {\n        title: lang('ChatListUnpinFromTop'),\n        icon: 'unpin',\n        handler: togglePinned,\n      }\n      : {\n        title: lang('ChatListPinToTop'),\n        icon: 'pin',\n        handler: togglePinned,\n      };\n\n    const actionDelete = {\n      title: deleteTitle,\n      icon: 'delete',\n      destructive: true,\n      handler: handleDelete,\n    };\n\n    if (isSavedDialog) {\n      return compact([actionOpenInNewTab, actionPin, actionDelete]) as MenuItemContextAction[];\n    }\n\n    const actionAddToFolder = canChangeFolder ? {\n      title: lang('ChatListContextAddToFolder'),\n      icon: 'folder',\n      handler: handleChatFolderChange,\n    } : undefined;\n\n    const actionMute = isMuted\n      ? {\n        title: lang('ChatsUnmute'),\n        icon: 'unmute',\n        handler: () => updateChatMutedState({ chatId: chat.id, isMuted: false }),\n      }\n      : {\n        title: `${lang('ChatsMute')}...`,\n        icon: 'mute',\n        handler: handleMute,\n      };\n\n    if (isInSearch) {\n      return compact([actionOpenInNewTab, actionPin, actionAddToFolder, actionMute]) as MenuItemContextAction[];\n    }\n\n    const actionMaskAsRead = (\n      chat.unreadCount || chat.hasUnreadMark || Object.values(topics || {}).some(({ unreadCount }) => unreadCount)\n    ) ? {\n        title: lang('ChatListContextMaskAsRead'),\n        icon: 'readchats',\n        handler: () => markChatMessagesRead({ id: chat.id }),\n      } : undefined;\n    const actionMarkAsUnread = !(chat.unreadCount || chat.hasUnreadMark) && !chat.isForum\n      ? { title: lang('ChatListContextMaskAsUnread'), icon: 'unread', handler: () => markChatUnread({ id: chat.id }) }\n      : undefined;\n\n    const actionArchive = isChatArchived(chat)\n      ? { title: lang('Unarchive'), icon: 'unarchive', handler: () => toggleChatArchived({ id: chat.id }) }\n      : { title: lang('Archive'), icon: 'archive', handler: () => toggleChatArchived({ id: chat.id }) };\n\n    const canReport = handleReport && !user && (isChatChannel(chat) || isChatGroup(chat));\n    const actionReport = canReport\n      ? { title: lang('ReportPeerReport'), icon: 'flag', handler: handleReport }\n      : undefined;\n\n    const isInFolder = folderId !== undefined;\n\n    return compact([\n      actionOpenInNewTab,\n      actionAddToFolder,\n      actionMaskAsRead,\n      actionMarkAsUnread,\n      actionPin,\n      !isSelf && actionMute,\n      !isSelf && !isServiceNotifications && !isInFolder && actionArchive,\n      actionReport,\n      actionDelete,\n    ]) as MenuItemContextAction[];\n  }, [\n    chat, user, canChangeFolder, lang, handleChatFolderChange, isPinned, isInSearch, isMuted, currentUserId,\n    handleDelete, handleMute, handleReport, folderId, isSelf, isServiceNotifications, isSavedDialog, deleteTitle,\n    isPreview, topics,\n  ]);\n};\n\nexport default useChatContextActions;\n","import type { ApiGeoPoint } from '../api/types';\n\nconst PROVIDERS = {\n  google: 'https://maps.google.com/maps',\n  bing: 'https://bing.com/maps/default.aspx',\n  osm: 'https://www.openstreetmap.org',\n  apple: 'https://maps.apple.com',\n};\n\n// https://github.com/TelegramMessenger/Telegram-iOS/blob/2a32c871882c4e1b1ccdecd34fccd301723b30d9/submodules/LocationResources/Sources/VenueIconResources.swift#L82\nconst VENUE_COLORS = new Map(Object.entries({\n  'building/medical': '#43b3f4',\n  'building/gym': '#43b3f4',\n  'education/cafeteria': '#f7943f',\n  'travel/bedandbreakfast': '#9987ff',\n  'travel/hotel': '#9987ff',\n  'travel/hostel': '#9987ff',\n  'travel/resort': '#9987ff',\n  'travel/hotel_bar': '#e56dd6',\n  arts_entertainment: '#e56dd6',\n  building: '#6e81b2',\n  education: '#a57348',\n  event: '#959595',\n  food: '#f7943f',\n  home: '#00aeef',\n  nightlife: '#e56dd6',\n  parks_outdoors: '#6cc039',\n  shops: '#ffb300',\n  travel: '#1c9fff',\n  work: '#ad7854',\n}));\n\nconst RANDOM_COLORS = [\n  '#e56cd5', '#f89440', '#9986ff', '#44b3f5', '#6dc139', '#ff5d5a', '#f87aad', '#6e82b3', '#f5ba21',\n];\n\nexport function prepareMapUrl(provider: keyof typeof PROVIDERS, point: Omit<ApiGeoPoint, 'accessHash'>, zoom = 15) {\n  const { lat, long } = point;\n  const providerUrl = PROVIDERS[provider];\n  switch (provider) {\n    case 'google':\n      return `${providerUrl}/place/${lat}+${long}/@${lat},${long},${zoom}z`;\n    case 'bing':\n      return `${providerUrl}?cp=${lat}~${long}&lvl=${zoom}&sp=point.${lat}_${long}`;\n    case 'apple':\n      return `${providerUrl}?q=${lat},${long}`;\n    case 'osm':\n    default:\n      return `${providerUrl}/?mlat=${lat}&mlon=${long}&zoom=${zoom}`;\n  }\n}\n\nexport function getMetersPerPixel(lat: number, zoom: number) {\n  // https://groups.google.com/g/google-maps-js-api-v3/c/hDRO4oHVSeM/m/osOYQYXg2oUJ\n  return (156543.03392 * Math.cos(lat * (Math.PI / 180))) / 2 ** zoom;\n}\n\nexport function getVenueIconUrl(type?: string) {\n  if (!type) return '';\n  return `https://ss3.4sqi.net/img/categories_v2/${type}_88.png`;\n}\n\n// https://github.com/TelegramMessenger/Telegram-iOS/blob/2a32c871882c4e1b1ccdecd34fccd301723b30d9/submodules/LocationResources/Sources/VenueIconResources.swift#L104\nexport function getVenueColor(type?: string) {\n  if (!type) return '#008df2';\n  return VENUE_COLORS.get(type)\n    || VENUE_COLORS.get(type.split('/')[0])\n    || RANDOM_COLORS[stringToNumber(type) % RANDOM_COLORS.length];\n}\n\nfunction stringToNumber(str: string) {\n  return str.split('').reduce((prevHash, currVal) => (\n    // eslint-disable-next-line no-bitwise\n    (((prevHash << 5) - prevHash) + currVal.charCodeAt(0)) | 0), 0);\n}\n","import { useCallback, useState } from 'react';\n\nconst useForceUpdate = () => {\n  const [, setTrigger] = useState<boolean>(false);\n\n  return useCallback(() => {\n    setTrigger((trigger) => !trigger);\n  }, []);\n};\n\nexport default useForceUpdate;\n","// extracted by mini-css-extract-plugin\nexport default {\"checkBox\":\"eScpikxM\"};","import type { FC, StateHookSetter } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport { formatStarsAsText } from '../../util/localization/format';\n\nimport useLang from '../../hooks/useLang';\n\nimport Checkbox from '../ui/Checkbox';\nimport ConfirmDialog from '../ui/ConfirmDialog';\n\nimport styles from './PaymentMessageConfirmDialog.module.scss';\n\ntype OwnProps = {\n  isOpen: boolean;\n  onClose: NoneToVoidFunction;\n  userName?: string;\n  messagePriceInStars: number;\n  messagesCount: number;\n  shouldAutoApprove: boolean;\n  setAutoApprove: StateHookSetter<boolean>;\n  confirmHandler: NoneToVoidFunction;\n};\n\nconst PaymentMessageConfirmDialog: FC<OwnProps> = ({\n  isOpen,\n  onClose,\n  userName,\n  messagePriceInStars,\n  messagesCount,\n  shouldAutoApprove: shouldPaidMessageAutoApprove,\n  setAutoApprove: setShouldPaidMessageAutoApprove,\n  confirmHandler,\n}) => {\n  const lang = useLang();\n\n  const confirmPaymentMessage = lang('ConfirmationModalPaymentForMessage', {\n    user: userName,\n    amount: formatStarsAsText(lang, messagePriceInStars),\n    totalAmount: formatStarsAsText(lang, messagePriceInStars * messagesCount),\n    count: messagesCount,\n  }, {\n    withMarkdown: true,\n    withNodes: true,\n    pluralValue: messagesCount,\n  });\n\n  const confirmLabel = lang('PayForMessage', { count: messagesCount }, {\n    withNodes: true,\n    pluralValue: messagesCount,\n  });\n\n  return (\n    <ConfirmDialog\n      title={lang('TitleConfirmPayment')}\n      confirmLabel={confirmLabel}\n      isOpen={isOpen}\n      onClose={onClose}\n      confirmHandler={confirmHandler}\n    >\n      {confirmPaymentMessage}\n      <Checkbox\n        className={styles.checkBox}\n        label={lang('DoNotAskAgain')}\n        checked={shouldPaidMessageAutoApprove}\n        onCheck={setShouldPaidMessageAutoApprove}\n      />\n    </ConfirmDialog>\n  );\n};\n\nexport default memo(PaymentMessageConfirmDialog);\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport type { OwnProps } from './HeaderMenuContainer';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst HeaderMenuContainerAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const HeaderMenuContainer = useModuleLoader(Bundles.Extra, 'HeaderMenuContainer', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return HeaderMenuContainer ? <HeaderMenuContainer {...props} /> : undefined;\n};\n\nexport default HeaderMenuContainerAsync;\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { IAnchorPosition, MessageListType, ThreadId } from '../../types';\nimport { MAIN_THREAD_ID } from '../../api/types';\nimport { ManagementScreens } from '../../types';\n\nimport { requestMeasure, requestNextMutation } from '../../lib/fasterdom/fasterdom';\nimport {\n  getHasAdminRight,\n  getIsSavedDialog,\n  isAnonymousForwardsChat,\n  isChatBasicGroup, isChatChannel, isChatSuperGroup, isUserId,\n} from '../../global/helpers';\nimport {\n  selectBot,\n  selectCanAnimateInterface,\n  selectCanTranslateChat,\n  selectChat,\n  selectChatFullInfo,\n  selectIsChatBotNotStarted,\n  selectIsChatWithSelf,\n  selectIsCurrentUserFrozen,\n  selectIsInSelectMode,\n  selectIsRightColumnShown,\n  selectIsUserBlocked,\n  selectLanguageCode,\n  selectRequestedChatTranslationLanguage,\n  selectTranslationLanguage,\n  selectUserFullInfo,\n} from '../../global/selectors';\nimport { ARE_CALLS_SUPPORTED, IS_APP } from '../../util/browser/windowEnvironment';\n\nimport { useHotkeys } from '../../hooks/useHotkeys';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Icon from '../common/icons/Icon';\nimport Button from '../ui/Button';\n// import DropdownMenu from '../ui/DropdownMenu';\n// import MenuItem from '../ui/MenuItem';\n// import MenuSeparator from '../ui/MenuSeparator';\nimport HeaderMenuContainer from './HeaderMenuContainer.async';\n\ninterface OwnProps {\n  chatId: string;\n  threadId: ThreadId;\n  messageListType: MessageListType;\n  canExpandActions: boolean;\n  isForForum?: boolean;\n  isMobile?: boolean;\n  onTopicSearch?: NoneToVoidFunction;\n}\n\ninterface StateProps {\n  noMenu?: boolean;\n  isChannel?: boolean;\n  isRightColumnShown?: boolean;\n  canStartBot?: boolean;\n  canRestartBot?: boolean;\n  canUnblock?: boolean;\n  canSubscribe?: boolean;\n  canSearch?: boolean;\n  canCall?: boolean;\n  canMute?: boolean;\n  canViewStatistics?: boolean;\n  canViewMonetization?: boolean;\n  canViewBoosts?: boolean;\n  canShowBoostModal?: boolean;\n  canLeave?: boolean;\n  canEnterVoiceChat?: boolean;\n  canCreateVoiceChat?: boolean;\n  pendingJoinRequests?: number;\n  shouldJoinToSend?: boolean;\n  shouldSendJoinRequest?: boolean;\n  noAnimation?: boolean;\n  canTranslate?: boolean;\n  isTranslating?: boolean;\n  translationLanguage: string;\n  language: string;\n  detectedChatLanguage?: string;\n  doNotTranslate: string[];\n  isAccountFrozen?: boolean;\n}\n\n// Chrome breaks layout when focusing input during transition\nconst SEARCH_FOCUS_DELAY_MS = 320;\n\nconst HeaderActions: FC<OwnProps & StateProps> = ({\n  chatId,\n  threadId,\n  noMenu,\n  isMobile,\n  isChannel,\n  canStartBot,\n  canRestartBot,\n  canUnblock,\n  canSubscribe,\n  canSearch,\n  canCall,\n  canMute,\n  canViewStatistics,\n  canViewMonetization,\n  canViewBoosts,\n  canShowBoostModal,\n  canLeave,\n  canEnterVoiceChat,\n  canCreateVoiceChat,\n  pendingJoinRequests,\n  isRightColumnShown,\n  isForForum,\n  canExpandActions,\n  shouldJoinToSend,\n  shouldSendJoinRequest,\n  noAnimation,\n  // canTranslate,\n  // isTranslating,\n  // translationLanguage,\n  // language,\n  // detectedChatLanguage,\n  // doNotTranslate,\n  onTopicSearch,\n  isAccountFrozen,\n}) => {\n  const {\n    joinChannel,\n    sendBotCommand,\n    openMiddleSearch,\n    restartBot,\n    requestMasterAndRequestCall,\n    requestNextManagementScreen,\n    showNotification,\n    openChat,\n    // requestChatTranslation,\n    // togglePeerTranslations,\n    // openChatLanguageModal,\n    // setSettingOption,\n    unblockUser,\n    setViewForumAsMessages,\n    // openFrozenAccountModal,\n  } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const menuButtonRef = useRef<HTMLButtonElement>(null);\n  const lang = useOldLang();\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const [menuAnchor, setMenuAnchor] = useState<IAnchorPosition | undefined>(undefined);\n\n  const handleHeaderMenuOpen = useLastCallback(() => {\n    setIsMenuOpen(true);\n    const rect = menuButtonRef.current!.getBoundingClientRect();\n    setMenuAnchor({ x: rect.right, y: rect.bottom });\n  });\n\n  const handleHeaderMenuClose = useLastCallback(() => {\n    setIsMenuOpen(false);\n  });\n\n  const handleHeaderMenuHide = useLastCallback(() => {\n    setMenuAnchor(undefined);\n  });\n\n  const handleSubscribeClick = useLastCallback(() => {\n    joinChannel({ chatId });\n    if (shouldSendJoinRequest) {\n      showNotification({\n        message: isChannel ? lang('RequestToJoinChannelSentDescription') : lang('RequestToJoinGroupSentDescription'),\n      });\n    }\n  });\n\n  const handleStartBot = useLastCallback(() => {\n    sendBotCommand({ command: '/start' });\n  });\n\n  const handleRestartBot = useLastCallback(() => {\n    restartBot({ chatId });\n  });\n\n  const handleUnblock = useLastCallback(() => {\n    unblockUser({ userId: chatId });\n  });\n\n  // const handleTranslateClick = useLastCallback(() => {\n  //   if (isTranslating) {\n  //     requestChatTranslation({ chatId, toLanguageCode: undefined });\n  //     return;\n  //   }\n\n  //   requestChatTranslation({ chatId, toLanguageCode: translationLanguage });\n  // });\n\n  const handleJoinRequestsClick = useLastCallback(() => {\n    requestNextManagementScreen({ screen: ManagementScreens.JoinRequests });\n  });\n\n  const handleSearchClick = useLastCallback(() => {\n    if (isForForum) {\n      onTopicSearch?.();\n      return;\n    }\n\n    openMiddleSearch();\n\n    if (isMobile) {\n      // iOS requires synchronous focus on user event.\n      setFocusInSearchInput();\n    } else if (noAnimation) {\n      // The second RAF is necessary because Teact must update the state and render the async component\n      requestMeasure(() => {\n        requestNextMutation(setFocusInSearchInput);\n      });\n    } else {\n      setTimeout(setFocusInSearchInput, SEARCH_FOCUS_DELAY_MS);\n    }\n  });\n\n  const handleAsMessagesClick = useLastCallback(() => {\n    openChat({ id: chatId });\n    setViewForumAsMessages({ chatId, isEnabled: true });\n  });\n\n  const handleRequestCall = useLastCallback(() => {\n    if (isAccountFrozen) {\n      // openFrozenAccountModal();\n      return;\n    }\n    requestMasterAndRequestCall({ userId: chatId });\n  });\n\n  const handleHotkeySearchClick = useLastCallback((e: KeyboardEvent) => {\n    if (!canSearch || !IS_APP || e.shiftKey) {\n      return;\n    }\n\n    e.preventDefault();\n    handleSearchClick();\n  });\n\n  // const getTextWithLanguage = useLastCallback((langKey: string, langCode: string) => {\n  //   const simplified = langCode.split('-')[0];\n  //   const translationKey = `TranslateLanguage${simplified.toUpperCase()}`;\n  //   const name = lang(translationKey);\n  //   if (name !== translationKey) {\n  //     return lang(langKey, name);\n  //   }\n\n  //   const translatedNames = new Intl.DisplayNames([language], { type: 'language' });\n  //   const translatedName = translatedNames.of(langCode)!;\n  //   return lang(`${langKey}Other`, translatedName);\n  // });\n\n  // const buttonText = useMemo(() => {\n  //   if (isTranslating) return lang('ShowOriginalButton');\n\n  //   return getTextWithLanguage('TranslateToButton', translationLanguage);\n  // }, [translationLanguage, getTextWithLanguage, isTranslating, lang]);\n\n  // const doNotTranslateText = useMemo(() => {\n  //   if (!detectedChatLanguage) return undefined;\n\n  //   return getTextWithLanguage('DoNotTranslateLanguage', detectedChatLanguage);\n  // }, [getTextWithLanguage, detectedChatLanguage]);\n\n  // const handleHide = useLastCallback(() => {\n  //   togglePeerTranslations({ chatId, isEnabled: false });\n  //   requestChatTranslation({ chatId, toLanguageCode: undefined });\n  // });\n\n  // const handleChangeLanguage = useLastCallback(() => {\n  //   openChatLanguageModal({ chatId });\n  // });\n\n  // const handleDoNotTranslate = useLastCallback(() => {\n  //   if (!detectedChatLanguage) return;\n\n  //   setSettingOption({\n  //     doNotTranslate: [...doNotTranslate, detectedChatLanguage],\n  //   });\n  //   requestChatTranslation({ chatId, toLanguageCode: undefined });\n\n  //   showNotification({ message: getTextWithLanguage('AddedToDoNotTranslate', detectedChatLanguage) });\n  // });\n\n  useHotkeys(useMemo(() => ({\n    'Mod+F': handleHotkeySearchClick,\n  }), []));\n\n  // const MoreMenuButton: FC<{ onTrigger: () => void; isOpen?: boolean }> = useMemo(() => {\n  //   return ({ onTrigger, isOpen }) => (\n  //     <Button\n  //       round\n  //       ripple={isRightColumnShown}\n  //       color=\"translucent\"\n  //       size=\"smaller\"\n  //       className={isOpen ? 'active' : ''}\n  //       onClick={onTrigger}\n  //       ariaLabel={lang('TranslateMessage')}\n  //     >\n  //       <Icon name=\"language\" />\n  //     </Button>\n  //   );\n  // }, [isRightColumnShown, lang]);\n\n  return (\n    <div className=\"HeaderActions\">\n      {/* {!isForForum && canTranslate && (\n        <DropdownMenu\n          className=\"stickers-more-menu with-menu-transitions\"\n          trigger={MoreMenuButton}\n          positionX=\"right\"\n        >\n          <MenuItem icon=\"language\" onClick={handleTranslateClick}>\n            {buttonText}\n          </MenuItem>\n          <MenuItem icon=\"replace\" onClick={handleChangeLanguage}>\n            {lang('Chat.Translate.Menu.To')}\n          </MenuItem>\n          <MenuSeparator />\n          {detectedChatLanguage\n            && <MenuItem icon=\"hand-stop\" onClick={handleDoNotTranslate}>{doNotTranslateText}</MenuItem>}\n          <MenuItem icon=\"close-circle\" onClick={handleHide}>{lang('Hide')}</MenuItem>\n        </DropdownMenu>\n      )} */}\n      {!isMobile && (\n        <>\n          {canExpandActions && !shouldSendJoinRequest && (canSubscribe || shouldJoinToSend) && (\n            <Button\n              size=\"tiny\"\n              ripple\n              fluid\n              onClick={handleSubscribeClick}\n            >\n              {lang(isChannel ? 'ProfileJoinChannel' : 'ProfileJoinGroup')}\n            </Button>\n          )}\n          {canExpandActions && shouldSendJoinRequest && (\n            <Button\n              size=\"tiny\"\n              ripple\n              fluid\n              onClick={handleSubscribeClick}\n            >\n              {lang('ChannelJoinRequest')}\n            </Button>\n          )}\n          {canExpandActions && canStartBot && (\n            <Button\n              size=\"tiny\"\n              ripple\n              fluid\n              onClick={handleStartBot}\n            >\n              {lang('BotStart')}\n            </Button>\n          )}\n          {canExpandActions && canRestartBot && (\n            <Button\n              size=\"tiny\"\n              ripple\n              fluid\n              onClick={handleRestartBot}\n            >\n              {lang('BotRestart')}\n            </Button>\n          )}\n          {canExpandActions && canUnblock && (\n            <Button\n              size=\"tiny\"\n              ripple\n              fluid\n              onClick={handleUnblock}\n            >\n              {lang('Unblock')}\n            </Button>\n          )}\n          {canSearch && (\n            <Button\n              round\n              ripple={isRightColumnShown}\n              color=\"translucent\"\n              size=\"smaller\"\n              onClick={handleSearchClick}\n              ariaLabel={lang('Conversation.SearchPlaceholder')}\n            >\n              <Icon name=\"search\" />\n            </Button>\n          )}\n          {canCall && (\n            <Button\n              round\n              color=\"translucent\"\n              size=\"smaller\"\n              onClick={handleRequestCall}\n              ariaLabel=\"Call\"\n            >\n              <Icon name=\"phone\" />\n            </Button>\n          )}\n        </>\n      )}\n      {!isForForum && Boolean(pendingJoinRequests) && (\n        <Button\n          round\n          className=\"badge-button\"\n          ripple={isRightColumnShown}\n          color=\"translucent\"\n          size=\"smaller\"\n          onClick={handleJoinRequestsClick}\n          ariaLabel={isChannel ? lang('SubscribeRequests') : lang('MemberRequests')}\n        >\n          <Icon name=\"user\" />\n          <div className=\"badge\">{pendingJoinRequests}</div>\n        </Button>\n      )}\n      <Button\n        ref={menuButtonRef}\n        className={isMenuOpen ? 'active' : ''}\n        round\n        ripple={!isMobile}\n        size=\"smaller\"\n        color=\"translucent\"\n        disabled={noMenu}\n        ariaLabel=\"More actions\"\n        onClick={handleHeaderMenuOpen}\n      >\n        <Icon name=\"more\" />\n      </Button>\n      {menuAnchor && (\n        <HeaderMenuContainer\n          chatId={chatId}\n          threadId={threadId}\n          isOpen={isMenuOpen}\n          anchor={menuAnchor}\n          withExtraActions={isMobile || !canExpandActions}\n          isChannel={isChannel}\n          canStartBot={canStartBot}\n          canSubscribe={canSubscribe}\n          canSearch={canSearch}\n          canCall={canCall}\n          canMute={canMute}\n          canViewStatistics={canViewStatistics}\n          canViewBoosts={canViewBoosts}\n          canViewMonetization={canViewMonetization}\n          canShowBoostModal={canShowBoostModal}\n          canLeave={canLeave}\n          canEnterVoiceChat={canEnterVoiceChat}\n          canCreateVoiceChat={canCreateVoiceChat}\n          pendingJoinRequests={pendingJoinRequests}\n          onJoinRequestsClick={handleJoinRequestsClick}\n          withForumActions={isForForum}\n          onSubscribeChannel={handleSubscribeClick}\n          onSearchClick={handleSearchClick}\n          onAsMessagesClick={handleAsMessagesClick}\n          onClose={handleHeaderMenuClose}\n          onCloseAnimationEnd={handleHeaderMenuHide}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, {\n    chatId, threadId, messageListType, isMobile,\n  }): StateProps => {\n    const chat = selectChat(global, chatId);\n    const isChannel = Boolean(chat && isChatChannel(chat));\n    const isSuperGroup = Boolean(chat && isChatSuperGroup(chat));\n    const language = selectLanguageCode(global);\n    const translationLanguage = selectTranslationLanguage(global);\n    const isPrivate = isUserId(chatId);\n    const { doNotTranslate } = global.settings.byKey;\n\n    if (!chat || chat.isRestricted || selectIsInSelectMode(global)) {\n      return {\n        noMenu: true,\n        language,\n        translationLanguage,\n        doNotTranslate,\n      };\n    }\n\n    const bot = selectBot(global, chatId);\n    const chatFullInfo = !isPrivate ? selectChatFullInfo(global, chatId) : undefined;\n    const userFullInfo = isPrivate ? selectUserFullInfo(global, chatId) : undefined;\n    const fullInfo = chatFullInfo || userFullInfo;\n    const isChatWithSelf = selectIsChatWithSelf(global, chatId);\n    const isMainThread = messageListType === 'thread' && threadId === MAIN_THREAD_ID;\n    const isDiscussionThread = messageListType === 'thread' && threadId !== MAIN_THREAD_ID;\n    const isRightColumnShown = selectIsRightColumnShown(global, isMobile);\n\n    const isSavedDialog = getIsSavedDialog(chatId, threadId, global.currentUserId);\n\n    const isUserBlocked = isPrivate ? selectIsUserBlocked(global, chatId) : false;\n    const canRestartBot = Boolean(bot && isUserBlocked);\n    const canStartBot = !canRestartBot && Boolean(selectIsChatBotNotStarted(global, chatId));\n    const canUnblock = isUserBlocked && !bot;\n    const canSubscribe = Boolean(\n      (isMainThread || chat.isForum) && (isChannel || isSuperGroup) && chat.isNotJoined,\n    );\n    const canSearch = isMainThread || isDiscussionThread;\n    const canCall = ARE_CALLS_SUPPORTED && isUserId(chat.id) && !isChatWithSelf && !bot && !chat.isSupport\n      && !isAnonymousForwardsChat(chat.id);\n    const canMute = isMainThread && !isChatWithSelf && !canSubscribe;\n    const canLeave = isSavedDialog || (isMainThread && !canSubscribe);\n    const canEnterVoiceChat = ARE_CALLS_SUPPORTED && isMainThread && chat.isCallActive;\n    const canCreateVoiceChat = ARE_CALLS_SUPPORTED && isMainThread && !chat.isCallActive\n      && (chat.adminRights?.manageCall || (chat.isCreator && isChatBasicGroup(chat)));\n    const canViewStatistics = isMainThread && chatFullInfo?.canViewStatistics;\n    const canViewMonetization = isMainThread && chatFullInfo?.canViewMonetization;\n    const canViewBoosts = isMainThread\n      && (isSuperGroup || isChannel) && (canViewStatistics || getHasAdminRight(chat, 'postStories'));\n    const canShowBoostModal = !canViewBoosts && (isSuperGroup || isChannel);\n    const pendingJoinRequests = isMainThread ? chatFullInfo?.requestsPending : undefined;\n    const shouldJoinToSend = Boolean(chat?.isNotJoined && chat.isJoinToSend);\n    const shouldSendJoinRequest = Boolean(chat?.isNotJoined && chat.isJoinRequest);\n    const noAnimation = !selectCanAnimateInterface(global);\n\n    const isAccountFrozen = selectIsCurrentUserFrozen(global);\n\n    const isTranslating = Boolean(selectRequestedChatTranslationLanguage(global, chatId));\n    const canTranslate = selectCanTranslateChat(global, chatId) && !fullInfo?.isTranslationDisabled;\n    return {\n      noMenu: false,\n      isChannel,\n      isRightColumnShown,\n      canStartBot,\n      canRestartBot,\n      canSubscribe,\n      canSearch,\n      canCall,\n      canMute,\n      canViewStatistics,\n      canViewMonetization,\n      canViewBoosts,\n      canShowBoostModal,\n      canLeave,\n      canEnterVoiceChat,\n      canCreateVoiceChat,\n      pendingJoinRequests,\n      shouldJoinToSend,\n      shouldSendJoinRequest,\n      noAnimation,\n      canTranslate,\n      isTranslating,\n      translationLanguage,\n      language,\n      doNotTranslate,\n      detectedChatLanguage: chat.detectedLanguage,\n      canUnblock,\n      isAccountFrozen,\n    };\n  },\n)(HeaderActions));\n\nfunction setFocusInSearchInput() {\n  const searchInput = document.querySelector<HTMLInputElement>('#MiddleSearch input');\n  searchInput?.focus();\n}\n","import {\n  type RefObject,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n  useUnmountCleanup,\n} from '../../../lib/teact/teact';\nimport { setExtraStyles } from '../../../lib/teact/teact-dom';\n\nimport { requestForcedReflow, requestNextMutation } from '../../../lib/fasterdom/fasterdom';\n\nimport useTimeout from '../../../hooks/schedulers/useTimeout';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useResizeObserver from '../../../hooks/useResizeObserver';\nimport useThrottledCallback from '../../../hooks/useThrottledCallback';\n\nexport interface PaneState {\n  element?: HTMLElement;\n  height: number;\n  isOpen?: boolean;\n}\n\n// Max slide transition duration\nconst CLOSE_DURATION = 450;\nconst RESIZE_THROTTLE = 100;\n\nexport default function useHeaderPane<RefType extends HTMLElement = HTMLDivElement>({\n  ref: providedRef,\n  isOpen,\n  isDisabled,\n  withResizeObserver,\n  onStateChange,\n} : {\n  ref?: RefObject<RefType | null>;\n  isOpen?: boolean;\n  isDisabled?: boolean;\n  withResizeObserver?: boolean;\n  onStateChange?: (state: PaneState) => void;\n}) {\n  const [shouldRender, setShouldRender] = useState(isOpen);\n  // eslint-disable-next-line no-null/no-null\n  const localRef = useRef<RefType>(null);\n  const ref = providedRef || localRef;\n\n  const lastHeightRef = useRef(0);\n\n  const reset = useLastCallback(() => {\n    setShouldRender(true);\n    onStateChange?.({\n      element: undefined,\n      height: 0,\n      isOpen: false,\n    });\n  });\n\n  useEffect(() => {\n    if (isDisabled) {\n      reset();\n    }\n  }, [isDisabled]);\n\n  useEffect(() => {\n    if (isOpen) {\n      setShouldRender(true);\n    }\n  }, [isOpen]);\n\n  useUnmountCleanup(reset);\n\n  useTimeout(() => {\n    setShouldRender(false);\n    onStateChange?.({\n      height: 0,\n      isOpen: false,\n    });\n  }, !isOpen ? CLOSE_DURATION : undefined);\n\n  // Should be `useCallback` to trigger effect on deps change\n  const handleUpdate = useCallback(() => {\n    const element = ref.current;\n    if (isDisabled || !element || !shouldRender) return;\n\n    if (!isOpen) {\n      onStateChange?.({\n        element,\n        height: 0,\n        isOpen: false,\n      });\n      return;\n    }\n\n    requestForcedReflow(() => {\n      const currentHeight = element.offsetHeight;\n      lastHeightRef.current = currentHeight;\n      return () => {\n        onStateChange?.({\n          element,\n          height: currentHeight,\n          isOpen,\n        });\n      };\n    });\n  }, [isOpen, shouldRender, isDisabled, ref, onStateChange]);\n\n  const handleResize = useThrottledCallback(() => {\n    const element = ref.current;\n    if (!element) return;\n\n    const newHeight = element.offsetHeight;\n    if (newHeight === lastHeightRef.current) {\n      return;\n    }\n\n    handleUpdate();\n  }, [handleUpdate, ref], RESIZE_THROTTLE, true);\n\n  useLayoutEffect(handleUpdate, [handleUpdate]);\n\n  useResizeObserver(ref, handleResize, !withResizeObserver || !shouldRender);\n\n  return {\n    shouldRender,\n    ref,\n  };\n}\n\nexport function applyAnimationState(list: PaneState[], noTransition = false) {\n  let cumulativeHeight = 0;\n  for (let i = 0; i < list.length; i++) {\n    const state = list[i];\n    const element = state.element;\n    if (!element) {\n      continue;\n    }\n\n    const shiftPx = `${cumulativeHeight}px`;\n\n    const apply = () => {\n      setExtraStyles(element, {\n        transform: `translateY(${state.isOpen ? shiftPx : `calc(${shiftPx} - 100%)`})`,\n        zIndex: String(-i),\n        transition: noTransition ? 'none' : '',\n      });\n    };\n\n    if (!element.dataset.isPanelOpen && state.isOpen && !noTransition) {\n      // Start animation right above its final position\n      setExtraStyles(element, {\n        transform: `translateY(calc(${shiftPx} - 100%))`,\n        zIndex: String(-i),\n        transition: 'none',\n      });\n      element.dataset.isPanelOpen = 'true';\n      requestNextMutation(apply);\n    } else {\n      apply();\n    }\n\n    cumulativeHeight += state.height;\n  }\n}\n","import React from '../../../lib/teact/teact';\n\ninterface OwnProps {\n  isOwn?: boolean;\n}\n\nfunction MessageAppendix({ isOwn } : OwnProps) {\n  const path = isOwn\n    ? 'M6 17H0V0c.193 2.84.876 5.767 2.05 8.782.904 2.325 2.446 4.485 4.625 6.48A1 1 0 016 17z'\n    : 'M3 17h6V0c-.193 2.84-.876 5.767-2.05 8.782-.904 2.325-2.446 4.485-4.625 6.48A1 1 0 003 17z';\n  return (\n    <svg width=\"9\" height=\"20\" className=\"svg-appendix\">\n      <defs>\n        <filter x=\"-50%\" y=\"-14.7%\" width=\"200%\" height=\"141.2%\" filterUnits=\"objectBoundingBox\" id=\"messageAppendix\">\n          <feOffset dy=\"1\" in=\"SourceAlpha\" result=\"shadowOffsetOuter1\" />\n          <feGaussianBlur stdDeviation=\"1\" in=\"shadowOffsetOuter1\" result=\"shadowBlurOuter1\" />\n          <feColorMatrix\n            values=\"0 0 0 0 0.0621962482 0 0 0 0 0.138574144 0 0 0 0 0.185037364 0 0 0 0.15 0\"\n            in=\"shadowBlurOuter1\"\n          />\n        </filter>\n      </defs>\n      <g fill=\"none\" fill-rule=\"evenodd\">\n        <path d={path} fill=\"#000\" filter=\"url(#messageAppendix)\" />\n        <path d={path} fill={isOwn ? '#EEFFDE' : 'FFF'} className=\"corner\" />\n      </g>\n    </svg>\n  );\n}\n\nexport default MessageAppendix;\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './EmojiTooltip';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst EmojiTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const EmojiTooltip = useModuleLoader(Bundles.Extra, 'EmojiTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return EmojiTooltip ? <EmojiTooltip {...props} /> : undefined;\n};\n\nexport default EmojiTooltipAsync;\n","export type MediaSessionHandlers = {\n  play?: () => void;\n  pause?: () => void;\n  stop?: () => void;\n\n  previoustrack?: () => void;\n  nexttrack?: () => void;\n\n  togglemicrophone?: () => void;\n  togglecamera?: () => void;\n  hangup?: () => void;\n\n  seekbackward?: (details: MediaSessionActionDetails) => void;\n  seekforward?: (details: MediaSessionActionDetails) => void;\n  seekTo?: ((details: MediaSessionActionDetails) => void);\n};\n\ninterface MediaMetadataParameters {\n  title?: string;\n  artist?: string;\n  album?: string;\n  artwork?: MediaImage[];\n}\n\nconst DEFAULT_HANDLERS = {\n  play: undefined,\n  pause: undefined,\n  seekbackward: undefined,\n  seekforward: undefined,\n  previoustrack: undefined,\n  nexttrack: undefined,\n  stop: undefined,\n  seekTo: undefined,\n};\n\nexport function registerMediaSession(metadata?: MediaMetadata, handlers?: MediaSessionHandlers) {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    if (metadata) updateMetadata(metadata);\n    if (handlers) setMediaSessionHandlers(handlers);\n  } else {\n    // eslint-disable-next-line no-console\n    console.warn('MediaSession API not supported in this browser');\n  }\n}\n\nexport function updateMetadata(metadata?: MediaMetadata) {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    // eslint-disable-next-line no-null/no-null\n    mediaSession.metadata = metadata ?? null;\n  }\n}\n\nexport function setMediaSessionHandlers(handlers: MediaSessionHandlers) {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    Object.entries({ ...DEFAULT_HANDLERS, ...handlers }).forEach(([key, handler]) => {\n      try {\n        // @ts-ignore API not standardized yet\n        mediaSession.setActionHandler(key, handler);\n      } catch (err) {\n        // Handler not supported, ignoring\n      }\n    });\n  }\n}\n\nexport function clearMediaSession() {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    // eslint-disable-next-line no-null/no-null\n    mediaSession.metadata = null;\n    setMediaSessionHandlers(DEFAULT_HANDLERS);\n    if (mediaSession.playbackState) mediaSession.playbackState = 'none';\n    mediaSession.setPositionState?.();\n  }\n}\n\nexport function setPlaybackState(state: 'none' | 'paused' | 'playing' = 'none') {\n  const { mediaSession } = window.navigator;\n  if (mediaSession && mediaSession.playbackState) {\n    mediaSession.playbackState = state;\n  }\n}\n\nexport function setPositionState(state?: MediaPositionState) {\n  if (!state || state.position === undefined || state.duration === undefined) return;\n  state.position = Math.min(state.position, state.duration);\n\n  const { mediaSession } = window.navigator;\n  mediaSession?.setPositionState?.(state);\n}\n\nexport function buildMediaMetadata({\n  title, artist, album, artwork,\n}: MediaMetadataParameters) {\n  if ('MediaMetadata' in window) {\n    return new window.MediaMetadata({\n      title,\n      artist,\n      album,\n      artwork,\n    });\n  }\n  return undefined;\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useEffect, useMemo } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type {\n  ApiChat, ApiThreadInfo, ApiTopic, ApiTypingStatus, ApiUser,\n} from '../../api/types';\nimport type { IconName } from '../../types/icons';\nimport { MediaViewerOrigin, type StoryViewerOrigin, type ThreadId } from '../../types';\n\nimport {\n  getChatTypeString,\n  getGroupStatus,\n  getMainUsername,\n  isChatSuperGroup,\n} from '../../global/helpers';\nimport {\n  selectChat,\n  selectChatMessages,\n  selectChatOnlineCount,\n  selectThreadInfo,\n  selectThreadMessagesCount,\n  selectTopic,\n  selectUser,\n} from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport { REM } from './helpers/mediaDimensions';\nimport renderText from './helpers/renderText';\n\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Transition from '../ui/Transition';\nimport Avatar from './Avatar';\nimport DotAnimation from './DotAnimation';\nimport FullNameTitle from './FullNameTitle';\nimport Icon from './icons/Icon';\nimport TopicIcon from './TopicIcon';\nimport TypingStatus from './TypingStatus';\n\nconst TOPIC_ICON_SIZE = 2.5 * REM;\n\ntype OwnProps = {\n  chatId: string;\n  threadId?: ThreadId;\n  className?: string;\n  statusIcon?: IconName;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'tiny' | 'small' | 'medium' | 'large' | 'jumbo';\n  status?: string;\n  withDots?: boolean;\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  withChatType?: boolean;\n  noEmojiStatus?: boolean;\n  emojiStatusSize?: number;\n  noRtl?: boolean;\n  noAvatar?: boolean;\n  noStatusOrTyping?: boolean;\n  withStory?: boolean;\n  storyViewerOrigin?: StoryViewerOrigin;\n  isSavedDialog?: boolean;\n  onClick?: VoidFunction;\n  onEmojiStatusClick?: NoneToVoidFunction;\n};\n\ntype StateProps =\n  {\n    chat?: ApiChat;\n    threadInfo?: ApiThreadInfo;\n    topic?: ApiTopic;\n    onlineCount?: number;\n    areMessagesLoaded: boolean;\n    messagesCount?: number;\n    self?: ApiUser;\n  };\n\nconst GroupChatInfo: FC<OwnProps & StateProps> = ({\n  typingStatus,\n  className,\n  statusIcon,\n  avatarSize = 'medium',\n  noAvatar,\n  status,\n  withDots,\n  withMediaViewer,\n  withUsername,\n  withFullInfo,\n  withUpdatingStatus,\n  withChatType,\n  threadInfo,\n  noRtl,\n  chat,\n  onlineCount,\n  areMessagesLoaded,\n  topic,\n  messagesCount,\n  noStatusOrTyping,\n  withStory,\n  storyViewerOrigin,\n  noEmojiStatus,\n  emojiStatusSize,\n  isSavedDialog,\n  self,\n  onClick,\n  onEmojiStatusClick,\n}) => {\n  const {\n    loadFullChat,\n    openMediaViewer,\n    loadMoreProfilePhotos,\n  } = getActions();\n\n  const lang = useOldLang();\n\n  const isSuperGroup = chat && isChatSuperGroup(chat);\n  const isTopic = Boolean(chat?.isForum && threadInfo && topic);\n  const { id: chatId, isMin, isRestricted } = chat || {};\n\n  useEffect(() => {\n    if (chatId && !isMin) {\n      if (withFullInfo) loadFullChat({ chatId });\n      if (withMediaViewer) loadMoreProfilePhotos({ peerId: chatId, isPreload: true });\n    }\n  }, [chatId, isMin, withFullInfo, isSuperGroup, withMediaViewer]);\n\n  const handleAvatarViewerOpen = useLastCallback(\n    (e: React.MouseEvent<HTMLDivElement, MouseEvent>, hasMedia: boolean) => {\n      if (chat && hasMedia) {\n        e.stopPropagation();\n        openMediaViewer({\n          isAvatarView: true,\n          chatId: chat.id,\n          mediaIndex: 0,\n          origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n        });\n      }\n    },\n  );\n\n  const mainUsername = useMemo(() => chat && withUsername && getMainUsername(chat), [chat, withUsername]);\n\n  if (!chat) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (status) {\n      return withDots ? (\n        <DotAnimation className=\"status\" content={status} />\n      ) : (\n        <span className=\"status\" dir=\"auto\">\n          {statusIcon && <Icon className=\"status-icon\" name={statusIcon} />}\n          {renderText(status)}\n        </span>\n      );\n    }\n\n    if (withUpdatingStatus && !areMessagesLoaded && !isRestricted) {\n      return (\n        <DotAnimation className=\"status\" content={lang('Updating')} />\n      );\n    }\n\n    if (!chat) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (isTopic) {\n      return (\n        <span className=\"status\" dir=\"auto\">\n          <Transition\n            name=\"fade\"\n            shouldRestoreHeight\n            activeKey={messagesCount !== undefined ? 1 : 2}\n            className=\"message-count-transition\"\n          >\n            {messagesCount !== undefined && lang('messages', messagesCount, 'i')}\n          </Transition>\n        </span>\n      );\n    }\n\n    if (withChatType) {\n      return (\n        <span className=\"status\" dir=\"auto\">{lang(getChatTypeString(chat))}</span>\n      );\n    }\n\n    const groupStatus = getGroupStatus(lang, chat);\n    const onlineStatus = onlineCount ? `, ${lang('OnlineCount', onlineCount, 'i')}` : undefined;\n\n    return (\n      <span className=\"status\">\n        {mainUsername && <span className=\"handle withStatus\">{mainUsername}</span>}\n        <span className=\"group-status\">{groupStatus}</span>\n        {onlineStatus && <span className=\"online-status\">{onlineStatus}</span>}\n      </span>\n    );\n  }\n\n  return (\n    <div\n      className={\n        buildClassName('ChatInfo', className)\n      }\n      dir={!noRtl && lang.isRtl ? 'rtl' : undefined}\n      onClick={onClick}\n    >\n      {!noAvatar && !isTopic && (\n        <>\n          {isSavedDialog && self && (\n            <Avatar\n              key=\"saved-messages\"\n              size={avatarSize}\n              peer={self}\n              isSavedMessages\n              className=\"saved-dialog-avatar\"\n            />\n          )}\n          <Avatar\n            key={chat.id}\n            className={buildClassName(isSavedDialog && 'overlay-avatar')}\n            size={avatarSize}\n            peer={chat}\n            withStory={withStory}\n            storyViewerOrigin={storyViewerOrigin}\n            storyViewerMode=\"single-peer\"\n            isSavedDialog={isSavedDialog}\n            onClick={withMediaViewer ? handleAvatarViewerOpen : undefined}\n          />\n        </>\n      )}\n      {isTopic && (\n        <TopicIcon\n          topic={topic!}\n          className=\"topic-header-icon\"\n          size={TOPIC_ICON_SIZE}\n        />\n      )}\n      <div className=\"info\">\n        {topic\n          ? <h3 dir=\"auto\" className=\"fullName\">{renderText(topic.title)}</h3>\n          : (\n            <FullNameTitle\n              peer={chat}\n              emojiStatusSize={emojiStatusSize}\n              withEmojiStatus={!noEmojiStatus}\n              isSavedDialog={isSavedDialog}\n              onEmojiStatusClick={onEmojiStatusClick}\n            />\n          )}\n        {!noStatusOrTyping && renderStatusOrTyping()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId, threadId }): StateProps => {\n    const chat = selectChat(global, chatId);\n    const threadInfo = threadId ? selectThreadInfo(global, chatId, threadId) : undefined;\n    const onlineCount = chat ? selectChatOnlineCount(global, chat) : undefined;\n    const areMessagesLoaded = Boolean(selectChatMessages(global, chatId));\n    const topic = threadId ? selectTopic(global, chatId, threadId) : undefined;\n    const messagesCount = topic && selectThreadMessagesCount(global, chatId, threadId!);\n    const self = selectUser(global, global.currentUserId!);\n\n    return {\n      chat,\n      threadInfo,\n      onlineCount,\n      topic,\n      areMessagesLoaded,\n      messagesCount,\n      self,\n    };\n  },\n)(GroupChatInfo));\n","import React, { useEffect, useRef, useState } from '../../../lib/teact/teact';\n\nimport type { ApiMediaExtendedPreview, ApiPhoto } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { ThemeKey } from '../../../types';\nimport type { IMediaDimensions } from './helpers/calculateAlbumLayout';\n\nimport { CUSTOM_APPENDIX_ATTRIBUTE, MESSAGE_CONTENT_SELECTOR } from '../../../config';\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport {\n  getMediaFormat, getMediaThumbUri, getMediaTransferState, getPhotoMediaHash,\n} from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\nimport getCustomAppendixBg from './helpers/getCustomAppendixBg';\nimport { calculateMediaDimensions, MIN_MEDIA_HEIGHT } from './helpers/mediaDimensions';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useFlag from '../../../hooks/useFlag';\nimport { useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useLayoutEffectWithPrevDeps from '../../../hooks/useLayoutEffectWithPrevDeps';\nimport useMediaTransition from '../../../hooks/useMediaTransition';\nimport useMediaWithLoadProgress from '../../../hooks/useMediaWithLoadProgress';\nimport usePreviousDeprecated from '../../../hooks/usePreviousDeprecated';\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport useBlurredMediaThumbRef from './hooks/useBlurredMediaThumbRef';\n\nimport Icon from '../../common/icons/Icon';\nimport MediaSpoiler from '../../common/MediaSpoiler';\nimport ProgressSpinner from '../../ui/ProgressSpinner';\n\nexport type OwnProps<T> = {\n  id?: string;\n  photo: ApiPhoto | ApiMediaExtendedPreview;\n  isInWebPage?: boolean;\n  messageText?: string;\n  isOwn?: boolean;\n  observeIntersection?: ObserveFn;\n  noAvatars?: boolean;\n  canAutoLoad?: boolean;\n  isInSelectMode?: boolean;\n  isSelected?: boolean;\n  uploadProgress?: number;\n  forcedWidth?: number;\n  size?: 'inline' | 'pictogram';\n  shouldAffectAppendix?: boolean;\n  dimensions?: IMediaDimensions & { isSmall?: boolean };\n  asForwarded?: boolean;\n  nonInteractive?: boolean;\n  isDownloading?: boolean;\n  isProtected?: boolean;\n  theme: ThemeKey;\n  className?: string;\n  clickArg?: T;\n  onClick?: (arg: T, e: React.MouseEvent<HTMLElement>) => void;\n  onCancelUpload?: (arg: T) => void;\n};\n\n// eslint-disable-next-line @typescript-eslint/comma-dangle\nconst Photo = <T,>({\n  id,\n  photo,\n  messageText,\n  isOwn,\n  observeIntersection,\n  noAvatars,\n  canAutoLoad,\n  isInSelectMode,\n  isSelected,\n  uploadProgress,\n  forcedWidth,\n  size = 'inline',\n  dimensions,\n  asForwarded,\n  nonInteractive,\n  shouldAffectAppendix,\n  isDownloading,\n  isProtected,\n  theme,\n  isInWebPage,\n  clickArg,\n  className,\n  onClick,\n  onCancelUpload,\n}: OwnProps<T>) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const isPaidPreview = photo.mediaType === 'extendedMediaPreview';\n\n  const localBlobUrl = !isPaidPreview ? photo.blobUrl : undefined;\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const { isMobile } = useAppLayout();\n  const [isLoadAllowed, setIsLoadAllowed] = useState(canAutoLoad);\n  const shouldLoad = isLoadAllowed && isIntersecting && !isPaidPreview;\n  const {\n    mediaData, loadProgress,\n  } = useMediaWithLoadProgress(!isPaidPreview ? getPhotoMediaHash(photo, size) : undefined, !shouldLoad);\n  const fullMediaData = localBlobUrl || mediaData;\n\n  const withBlurredBackground = Boolean(forcedWidth);\n  const [withThumb] = useState(!fullMediaData);\n  const noThumb = Boolean(fullMediaData);\n  const thumbRef = useBlurredMediaThumbRef(photo, noThumb);\n  useMediaTransition(!noThumb, { ref: thumbRef });\n  const blurredBackgroundRef = useBlurredMediaThumbRef(photo, !withBlurredBackground);\n  const thumbDataUri = getMediaThumbUri(photo);\n\n  const [isSpoilerShown, showSpoiler, hideSpoiler] = useFlag(isPaidPreview || photo.isSpoiler);\n\n  useEffect(() => {\n    if (isPaidPreview || photo.isSpoiler) {\n      showSpoiler();\n    } else {\n      hideSpoiler();\n    }\n  }, [isPaidPreview, photo]);\n\n  const {\n    loadProgress: downloadProgress,\n  } = useMediaWithLoadProgress(\n    !isPaidPreview ? getPhotoMediaHash(photo, 'download') : undefined,\n    !isDownloading,\n    !isPaidPreview ? getMediaFormat(photo, 'download') : undefined,\n  );\n\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(\n    uploadProgress || (isDownloading ? downloadProgress : loadProgress),\n    shouldLoad && !fullMediaData,\n    uploadProgress !== undefined,\n  );\n  const wasLoadDisabled = usePreviousDeprecated(isLoadAllowed) === false;\n\n  const {\n    ref: spinnerRef,\n    shouldRender: shouldRenderSpinner,\n  } = useShowTransition({\n    isOpen: isTransferring,\n    noMountTransition: wasLoadDisabled,\n    className: 'slow',\n    withShouldRender: true,\n  });\n  const {\n    ref: downloadButtonRef,\n    shouldRender: shouldRenderDownloadButton,\n  } = useShowTransition({\n    isOpen: !fullMediaData && !isLoadAllowed,\n    withShouldRender: true,\n  });\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLElement>) => {\n    if (isUploading) {\n      onCancelUpload?.(clickArg!);\n      return;\n    }\n\n    if (!fullMediaData) {\n      setIsLoadAllowed((isAllowed) => !isAllowed);\n      return;\n    }\n\n    if (isSpoilerShown) {\n      hideSpoiler();\n      return;\n    }\n\n    onClick?.(clickArg!, e);\n  });\n\n  useLayoutEffectWithPrevDeps(([prevShouldAffectAppendix]) => {\n    if (!shouldAffectAppendix) {\n      if (prevShouldAffectAppendix) {\n        ref.current!.closest<HTMLDivElement>(MESSAGE_CONTENT_SELECTOR)!.removeAttribute(CUSTOM_APPENDIX_ATTRIBUTE);\n      }\n      return;\n    }\n\n    const contentEl = ref.current!.closest<HTMLDivElement>(MESSAGE_CONTENT_SELECTOR)!;\n    if (fullMediaData) {\n      const messageId = Number(contentEl.closest<HTMLDivElement>('.Message')!.dataset.messageId);\n      getCustomAppendixBg(fullMediaData, Boolean(isOwn), messageId, isSelected, theme).then((appendixBg) => {\n        requestMutation(() => {\n          contentEl.style.setProperty('--appendix-bg', appendixBg);\n          contentEl.setAttribute(CUSTOM_APPENDIX_ATTRIBUTE, '');\n        });\n      });\n    } else {\n      contentEl.classList.add('has-appendix-thumb');\n    }\n  }, [shouldAffectAppendix, fullMediaData, isOwn, isInSelectMode, isSelected, theme]);\n\n  const { width, height, isSmall } = dimensions || calculateMediaDimensions({\n    media: photo,\n    isOwn,\n    asForwarded,\n    noAvatars,\n    isMobile,\n    messageText,\n    isInWebPage,\n  });\n\n  const componentClassName = buildClassName(\n    'media-inner',\n    !isUploading && !nonInteractive && 'interactive',\n    isSmall && 'small-image',\n    (width === height || size === 'pictogram') && 'square-image',\n    height < MIN_MEDIA_HEIGHT && 'fix-min-height',\n    className,\n  );\n\n  const dimensionsStyle = dimensions ? ` width: ${width}px; left: ${dimensions.x}px; top: ${dimensions.y}px;` : '';\n  const style = size === 'inline' ? `height: ${height}px;${dimensionsStyle}` : undefined;\n\n  return (\n    <div\n      id={id}\n      ref={ref}\n      className={componentClassName}\n      style={style}\n      onClick={isUploading ? undefined : handleClick}\n    >\n      {withBlurredBackground && (\n        <canvas ref={blurredBackgroundRef} className=\"thumbnail blurred-bg\" />\n      )}\n      {fullMediaData && (\n        <img\n          src={fullMediaData}\n          className={buildClassName('full-media', withBlurredBackground && 'with-blurred-bg')}\n          alt=\"\"\n          style={forcedWidth ? `width: ${forcedWidth}px` : undefined}\n          draggable={!isProtected}\n        />\n      )}\n      {withThumb && (\n        <canvas ref={thumbRef} className=\"thumbnail\" />\n      )}\n      {isProtected && <span className=\"protector\" />}\n      {shouldRenderSpinner && !shouldRenderDownloadButton && (\n        <div ref={spinnerRef} className=\"media-loading\">\n          <ProgressSpinner progress={transferProgress} onClick={isUploading ? handleClick : undefined} />\n        </div>\n      )}\n      {shouldRenderDownloadButton && <Icon ref={downloadButtonRef} name=\"download\" />}\n      <MediaSpoiler\n        isVisible={isSpoilerShown}\n        withAnimation\n        thumbDataUri={thumbDataUri}\n        width={width}\n        height={height}\n        className=\"media-spoiler\"\n      />\n      {isTransferring && (\n        <span className=\"message-transfer-progress\">{Math.round(transferProgress * 100)}%</span>\n      )}\n    </div>\n  );\n};\n\nexport default Photo;\n","let fileSelector: HTMLInputElement;\n\nexport function openSystemFilesDialog(accept = '*', callback: (e: Event) => void, noMultiple = false) {\n  if (!fileSelector) {\n    fileSelector = document.createElement('input');\n    fileSelector.setAttribute('type', 'file');\n  }\n\n  fileSelector.setAttribute('accept', accept);\n\n  if (noMultiple) {\n    fileSelector.removeAttribute('multiple');\n  } else {\n    fileSelector.setAttribute('multiple', 'multiple');\n  }\n\n  // eslint-disable-next-line no-null/no-null\n  fileSelector.onchange = null;\n  fileSelector.value = '';\n  fileSelector.onchange = callback;\n\n  fileSelector.click();\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport type { IconName } from '../../types/icons';\n\nimport { IS_CANVAS_FILTER_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport buildClassName from '../../util/buildClassName';\nimport { formatMediaDateTime, formatPastTimeShort } from '../../util/dates/dateFormat';\nimport { getColorFromExtension, getFileSizeString } from './helpers/documentInfo';\nimport { getDocumentThumbnailDimensions } from './helpers/mediaDimensions';\nimport renderText from './helpers/renderText';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useCanvasBlur from '../../hooks/useCanvasBlur';\nimport useMediaTransitionDeprecated from '../../hooks/useMediaTransitionDeprecated';\nimport useOldLang from '../../hooks/useOldLang';\nimport useShowTransitionDeprecated from '../../hooks/useShowTransitionDeprecated';\n\nimport Link from '../ui/Link';\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport Icon from './icons/Icon';\n\nimport './File.scss';\n\ntype OwnProps = {\n  ref?: React.RefObject<HTMLDivElement>;\n  name: string;\n  extension?: string;\n  size: number;\n  timestamp?: number;\n  sender?: string;\n  thumbnailDataUri?: string;\n  previewData?: string;\n  className?: string;\n  smaller?: boolean;\n  isTransferring?: boolean;\n  isUploading?: boolean;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  transferProgress?: number;\n  actionIcon?: IconName;\n  onClick?: () => void;\n  onDateClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n};\n\nconst File: FC<OwnProps> = ({\n  ref,\n  name,\n  size,\n  extension = '',\n  timestamp,\n  sender,\n  thumbnailDataUri,\n  previewData,\n  className,\n  smaller,\n  isTransferring,\n  isUploading,\n  isSelectable,\n  isSelected,\n  transferProgress,\n  actionIcon,\n  onClick,\n  onDateClick,\n}) => {\n  const lang = useOldLang();\n  // eslint-disable-next-line no-null/no-null\n  let elementRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    elementRef = ref;\n  }\n\n  const { isMobile } = useAppLayout();\n  const [withThumb] = useState(!previewData);\n  const noThumb = Boolean(previewData);\n  const thumbRef = useCanvasBlur(thumbnailDataUri, noThumb, isMobile && !IS_CANVAS_FILTER_SUPPORTED);\n  const thumbClassNames = useMediaTransitionDeprecated(!noThumb);\n\n  const {\n    shouldRender: shouldSpinnerRender,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransitionDeprecated(isTransferring, undefined, true);\n\n  const color = getColorFromExtension(extension);\n  const sizeString = getFileSizeString(size);\n  const subtitle = useMemo(() => {\n    if (!isTransferring || !transferProgress) return sizeString;\n    return `${getFileSizeString(size * transferProgress)} / ${sizeString}`;\n  }, [isTransferring, size, sizeString, transferProgress]);\n\n  const { width, height } = getDocumentThumbnailDimensions(smaller);\n\n  const fullClassName = buildClassName(\n    'File',\n    className,\n    smaller && 'smaller',\n    onClick && !isUploading && 'interactive',\n    isSelected && 'file-is-selected',\n  );\n\n  return (\n    <div ref={elementRef} className={fullClassName} dir={lang.isRtl ? 'rtl' : undefined}>\n      {isSelectable && (\n        <div className=\"message-select-control no-selection\">\n          {isSelected && <Icon name=\"select\" />}\n        </div>\n      )}\n      <div className=\"file-icon-container\" onClick={isUploading ? undefined : onClick}>\n        {thumbnailDataUri || previewData ? (\n          <div className=\"file-preview media-inner\">\n            <img\n              src={previewData}\n              className=\"full-media\"\n              width={width}\n              height={height}\n              draggable={false}\n              alt=\"\"\n            />\n            {withThumb && (\n              <canvas\n                ref={thumbRef}\n                className={buildClassName('thumbnail', thumbClassNames)}\n              />\n            )}\n          </div>\n        ) : (\n          <div className={`file-icon ${color}`}>\n            {extension.length <= 4 && (\n              <span className=\"file-ext\" dir=\"auto\">{extension}</span>\n            )}\n          </div>\n        )}\n        {shouldSpinnerRender && (\n          <div className={buildClassName('file-progress', color, spinnerClassNames)}>\n            <ProgressSpinner\n              progress={transferProgress}\n              size={smaller ? 's' : 'm'}\n              onClick={isUploading ? onClick : undefined}\n            />\n          </div>\n        )}\n        {onClick && (\n          <Icon\n            name={actionIcon || 'download'}\n            className={buildClassName('action-icon', shouldSpinnerRender && 'hidden')}\n          />\n        )}\n      </div>\n      <div className=\"file-info\">\n        <div className=\"file-title\" dir=\"auto\" title={name}>{renderText(name)}</div>\n        <div className=\"file-subtitle\" dir=\"auto\">\n          <span>\n            {subtitle}\n          </span>\n          {sender && <span className=\"file-sender\">{renderText(sender)}</span>}\n          {!sender && Boolean(timestamp) && (\n            <>\n              <span className=\"bullet\" />\n              <Link onClick={onDateClick}>{formatMediaDateTime(lang, timestamp * 1000, true)}</Link>\n            </>\n          )}\n        </div>\n      </div>\n      {sender && Boolean(timestamp) && (\n        <Link onClick={onDateClick}>{formatPastTimeShort(lang, timestamp * 1000)}</Link>\n      )}\n    </div>\n  );\n};\n\nexport default memo(File);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"Ow6Ij9O5\",\"title-row\":\"CBda1UmC\",\"titleRow\":\"CBda1UmC\",\"loading\":\"L4Zk0yMN\",\"other-column\":\"d0hTIVJn\",\"otherColumn\":\"d0hTIVJn\",\"main-column\":\"lEbV6HrI\",\"mainColumn\":\"lEbV6HrI\",\"unread\":\"BhS75ocD\",\"last-message\":\"KJ16dBus\",\"lastMessage\":\"KJ16dBus\",\"after-wrapper\":\"uWo2dhui\",\"afterWrapper\":\"uWo2dhui\",\"after\":\"g3XnC73g\",\"title\":\"k3Ch25ZQ\",\"otherColumnIcon\":\"oknhG11L\",\"other-column-title\":\"ZUj3xAjs\",\"otherColumnTitle\":\"ZUj3xAjs\",\"other-columns\":\"IkuCBmvA\",\"otherColumns\":\"IkuCBmvA\",\"ellipsis\":\"_m_2xcPW\",\"reverse-corner\":\"U_yhhC0w\",\"reverseCorner\":\"U_yhhC0w\",\"overwritten-width\":\"HV0wCR4O\",\"overwrittenWidth\":\"HV0wCR4O\"};","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiChat, ApiTopic } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport { getOrderedTopics } from '../../global/helpers';\nimport buildClassName from '../../util/buildClassName';\nimport { REM } from './helpers/mediaDimensions';\nimport renderText from './helpers/renderText';\n\nimport { getIsMobile } from '../../hooks/useAppLayout';\nimport { useFastClick } from '../../hooks/useFastClick';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport TopicIcon from './TopicIcon';\n\nimport styles from './ChatForumLastMessage.module.scss';\n\ntype OwnProps = {\n  chat: ApiChat;\n  topics?: Record<number, ApiTopic>;\n  renderLastMessage: () => React.ReactNode;\n  observeIntersection?: ObserveFn;\n};\n\nconst NO_CORNER_THRESHOLD = Number(REM);\nconst MAX_TOPICS = 3;\n\nconst ChatForumLastMessage: FC<OwnProps> = ({\n  chat,\n  topics,\n  renderLastMessage,\n  observeIntersection,\n}) => {\n  const { openThread } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const lastMessageRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const mainColumnRef = useRef<HTMLDivElement>(null);\n\n  const lang = useOldLang();\n\n  const [lastActiveTopic, ...otherTopics] = useMemo(() => {\n    if (!topics) {\n      return [];\n    }\n\n    return getOrderedTopics(Object.values(topics), undefined, true).slice(0, MAX_TOPICS);\n  }, [topics]);\n\n  const [isReversedCorner, setIsReversedCorner] = useState(false);\n  const [overwrittenWidth, setOverwrittenWidth] = useState<number | undefined>(undefined);\n\n  const {\n    handleClick: handleOpenTopicClick,\n    handleMouseDown: handleOpenTopicMouseDown,\n  } = useFastClick((e: React.MouseEvent<HTMLDivElement>) => {\n    if (lastActiveTopic.unreadCount === 0 || chat.isForumAsMessages) return;\n\n    e.stopPropagation();\n    e.preventDefault();\n\n    openThread({\n      chatId: chat.id,\n      threadId: lastActiveTopic.id,\n      shouldReplaceHistory: true,\n      noForumTopicPanel: getIsMobile(),\n    });\n  });\n\n  useEffect(() => {\n    const lastMessageElement = lastMessageRef.current;\n    const mainColumnElement = mainColumnRef.current;\n    if (!lastMessageElement || !mainColumnElement) return;\n\n    const lastMessageWidth = lastMessageElement.offsetWidth;\n    const mainColumnWidth = mainColumnElement.offsetWidth;\n\n    if (Math.abs(lastMessageWidth - mainColumnWidth) < NO_CORNER_THRESHOLD) {\n      setOverwrittenWidth(Math.max(lastMessageWidth, mainColumnWidth));\n    } else {\n      setOverwrittenWidth(undefined);\n    }\n    setIsReversedCorner(lastMessageWidth > mainColumnWidth);\n  }, [lastActiveTopic, renderLastMessage]);\n\n  return (\n    <div\n      className={buildClassName(\n        styles.root,\n        isReversedCorner && styles.reverseCorner,\n        overwrittenWidth && styles.overwrittenWidth,\n      )}\n      dir={lang.isRtl ? 'rtl' : undefined}\n      style={overwrittenWidth ? `--overwritten-width: ${overwrittenWidth}px` : undefined}\n    >\n      {lastActiveTopic && (\n        <div className={styles.titleRow}>\n          <div\n            className={buildClassName(\n              styles.mainColumn,\n              lastActiveTopic.unreadCount && styles.unread,\n            )}\n            ref={mainColumnRef}\n            onClick={handleOpenTopicClick}\n            onMouseDown={handleOpenTopicMouseDown}\n          >\n            <TopicIcon\n              topic={lastActiveTopic}\n              observeIntersection={observeIntersection}\n            />\n            <div className={styles.title}>{renderText(lastActiveTopic.title)}</div>\n            {!overwrittenWidth && isReversedCorner && (\n              <div className={styles.afterWrapper}>\n                <div className={styles.after} />\n              </div>\n            )}\n          </div>\n\n          <div className={styles.otherColumns}>\n            {otherTopics.map((topic) => (\n              <div\n                className={buildClassName(\n                  styles.otherColumn, topic.unreadCount && styles.unread,\n                )}\n                key={topic.id}\n              >\n                <TopicIcon\n                  topic={topic}\n                  className={styles.otherColumnIcon}\n                  observeIntersection={observeIntersection}\n                />\n                <span className={styles.otherColumnTitle}>{renderText(topic.title)}</span>\n              </div>\n            ))}\n          </div>\n\n          <div className={styles.ellipsis} />\n        </div>\n      )}\n      {!lastActiveTopic && <div className={buildClassName(styles.titleRow, styles.loading)}>{lang('Loading')}</div>}\n      <div\n        className={buildClassName(styles.lastMessage, lastActiveTopic?.unreadCount && styles.unread)}\n        ref={lastMessageRef}\n        onClick={handleOpenTopicClick}\n        onMouseDown={handleOpenTopicMouseDown}\n      >\n        {renderLastMessage()}\n        {!overwrittenWidth && !isReversedCorner && (\n          <div className={styles.afterWrapper}>\n            <div className={styles.after} />\n          </div>\n        )}\n      </div>\n\n    </div>\n  );\n};\n\nexport default memo(ChatForumLastMessage);\n","import React, {\n  useCallback, useLayoutEffect, useRef,\n} from '../../../../lib/teact/teact';\n\nimport type {\n  ApiChat, ApiDraft, ApiMessage, ApiPeer, ApiTopic, ApiTypingStatus,\n  StatefulMediaContent,\n} from '../../../../api/types';\nimport type { ObserveFn } from '../../../../hooks/useIntersectionObserver';\n\nimport { ANIMATION_END_DELAY, CHAT_HEIGHT_PX } from '../../../../config';\nimport { requestMutation } from '../../../../lib/fasterdom/fasterdom';\nimport {\n  getMessageIsSpoiler,\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  getMessageRoundVideo,\n  getMessageSticker,\n  getMessageVideo,\n} from '../../../../global/helpers';\nimport { getMessageSenderName } from '../../../../global/helpers/peers';\nimport buildClassName from '../../../../util/buildClassName';\nimport renderText from '../../../common/helpers/renderText';\nimport { renderTextWithEntities } from '../../../common/helpers/renderTextWithEntities';\nimport { ChatAnimationTypes } from './useChatAnimationType';\n\nimport useEnsureStory from '../../../../hooks/useEnsureStory';\nimport useMedia from '../../../../hooks/useMedia';\nimport useOldLang from '../../../../hooks/useOldLang';\n\nimport ChatForumLastMessage from '../../../common/ChatForumLastMessage';\nimport Icon from '../../../common/icons/Icon';\nimport MessageSummary from '../../../common/MessageSummary';\nimport TypingStatus from '../../../common/TypingStatus';\n\nconst ANIMATION_DURATION = 200;\n\nexport default function useChatListEntry({\n  chat,\n  topics,\n  lastMessage,\n  statefulMediaContent,\n  chatId,\n  typingStatus,\n  draft,\n  lastMessageTopic,\n  lastMessageSender,\n  observeIntersection,\n  animationType,\n  orderDiff,\n  withInterfaceAnimations,\n  isTopic,\n  isSavedDialog,\n  isPreview,\n}: {\n  chat?: ApiChat;\n  topics?: Record<number, ApiTopic>;\n  lastMessage?: ApiMessage;\n  statefulMediaContent: StatefulMediaContent | undefined;\n  chatId: string;\n  typingStatus?: ApiTypingStatus;\n  draft?: ApiDraft;\n  lastMessageTopic?: ApiTopic;\n  lastMessageSender?: ApiPeer;\n  observeIntersection?: ObserveFn;\n  isTopic?: boolean;\n  isSavedDialog?: boolean;\n  isPreview?: boolean;\n\n  animationType: ChatAnimationTypes;\n  orderDiff: number;\n  withInterfaceAnimations?: boolean;\n}) {\n  const oldLang = useOldLang();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const storyData = lastMessage?.content.storyData;\n  const shouldTryLoadingStory = statefulMediaContent && !statefulMediaContent.story;\n\n  useEnsureStory(shouldTryLoadingStory ? storyData?.peerId : undefined, storyData?.id, statefulMediaContent?.story);\n\n  const mediaContent = statefulMediaContent?.story || lastMessage;\n  const mediaHasPreview = mediaContent && !getMessageSticker(mediaContent);\n\n  const mediaThumbnail = mediaHasPreview ? getMessageMediaThumbDataUri(mediaContent) : undefined;\n  const mediaBlobUrl = useMedia(mediaHasPreview ? getMessageMediaHash(mediaContent, 'micro') : undefined);\n  const isRoundVideo = Boolean(lastMessage && getMessageRoundVideo(lastMessage));\n\n  const renderLastMessageOrTyping = useCallback(() => {\n    if (!isSavedDialog && !isPreview\n        && typingStatus && lastMessage && typingStatus.timestamp > lastMessage.date * 1000) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    const isDraftReplyToTopic = draft && draft.replyInfo?.replyToMsgId === lastMessageTopic?.id;\n    const isEmptyLocalReply = draft?.replyInfo && !draft.text && draft.isLocal;\n\n    const canDisplayDraft = !chat?.isForum && !isSavedDialog && !isPreview && draft && !isEmptyLocalReply\n      && (!isTopic || !isDraftReplyToTopic);\n\n    if (canDisplayDraft) {\n      return (\n        <p className=\"last-message\" dir={oldLang.isRtl ? 'auto' : 'ltr'}>\n          <span className=\"draft\">{oldLang('Draft')}</span>\n          {renderTextWithEntities({\n            text: draft.text?.text || '',\n            entities: draft.text?.entities,\n            asPreview: true,\n            withTranslucentThumbs: true,\n          })}\n        </p>\n      );\n    }\n\n    if (!lastMessage) {\n      return undefined;\n    }\n\n    const senderName = getMessageSenderName(oldLang, chatId, lastMessageSender);\n\n    return (\n      <p className=\"last-message shared-canvas-container\" dir={oldLang.isRtl ? 'auto' : 'ltr'}>\n        {senderName && (\n          <>\n            <span className=\"sender-name\">{renderText(senderName)}</span>\n            <span className=\"colon\">:</span>\n          </>\n        )}\n        {!isSavedDialog && lastMessage.forwardInfo && (<Icon name=\"share-filled\" className=\"chat-prefix-icon\" />)}\n        {lastMessage.replyInfo?.type === 'story' && (<Icon name=\"story-reply\" className=\"chat-prefix-icon\" />)}\n        {renderSummary(lastMessage, observeIntersection, mediaBlobUrl || mediaThumbnail, isRoundVideo)}\n      </p>\n    );\n  }, [\n    chat, chatId, draft, isRoundVideo, isTopic, oldLang, lastMessage, lastMessageSender, lastMessageTopic,\n    mediaBlobUrl, mediaThumbnail, observeIntersection, typingStatus, isSavedDialog, isPreview,\n  ]);\n\n  function renderSubtitle() {\n    if (chat?.isForum && !isTopic) {\n      return (\n        <ChatForumLastMessage\n          chat={chat}\n          renderLastMessage={renderLastMessageOrTyping}\n          observeIntersection={observeIntersection}\n          topics={topics}\n        />\n      );\n    }\n\n    return renderLastMessageOrTyping();\n  }\n\n  // Sets animation excess values when `orderDiff` changes and then resets excess values to animate\n  useLayoutEffect(() => {\n    const element = ref.current;\n\n    if (!withInterfaceAnimations || !element) {\n      return;\n    }\n\n    // TODO Refactor animation: create `useListAnimation` that owns `orderDiff` and `animationType`\n    if (animationType === ChatAnimationTypes.Opacity) {\n      element.style.opacity = '0';\n\n      requestMutation(() => {\n        element.classList.add('animate-opacity');\n        element.style.opacity = '1';\n      });\n    } else if (animationType === ChatAnimationTypes.Move) {\n      element.style.transform = `translate3d(0, ${-orderDiff * CHAT_HEIGHT_PX}px, 0)`;\n\n      requestMutation(() => {\n        element.classList.add('animate-transform');\n        element.style.transform = '';\n      });\n    } else {\n      return;\n    }\n\n    setTimeout(() => {\n      requestMutation(() => {\n        element.classList.remove('animate-opacity', 'animate-transform');\n        element.style.opacity = '';\n        element.style.transform = '';\n      });\n    }, ANIMATION_DURATION + ANIMATION_END_DELAY);\n  }, [withInterfaceAnimations, orderDiff, animationType]);\n\n  return {\n    renderSubtitle,\n    ref,\n  };\n}\n\nfunction renderSummary(\n  message: ApiMessage, observeIntersection?: ObserveFn, blobUrl?: string, isRoundVideo?: boolean,\n) {\n  const messageSummary = (\n    <MessageSummary\n      message={message}\n      noEmoji={Boolean(blobUrl)}\n      observeIntersectionForLoading={observeIntersection}\n      inChatList\n    />\n  );\n\n  if (!blobUrl) {\n    return messageSummary;\n  }\n\n  const isSpoiler = getMessageIsSpoiler(message);\n\n  return (\n    <span className=\"media-preview\">\n      <img\n        src={blobUrl}\n        alt=\"\"\n        className={\n          buildClassName('media-preview--image', isRoundVideo && 'round', isSpoiler && 'media-preview-spoiler')\n        }\n        draggable={false}\n      />\n      {getMessageVideo(message) && <Icon name=\"play\" />}\n      {messageSummary}\n    </span>\n  );\n}\n","import { getActions, getGlobal } from '../global';\n\nimport type { ApiMessage } from '../api/types';\nimport type { MessageKey } from './keys/messageKey';\nimport { AudioOrigin, GlobalSearchContent } from '../types';\n\nimport { requestNextMutation } from '../lib/fasterdom/fasterdom';\nimport { selectCurrentMessageList, selectTabState } from '../global/selectors';\nimport { IS_SAFARI } from './browser/windowEnvironment';\nimport { getMessageServerKey, parseMessageKey } from './keys/messageKey';\nimport { isSafariPatchInProgress, patchSafariProgressiveAudio } from './patchSafariProgressiveAudio';\nimport safePlay from './safePlay';\n\ntype Handler = (eventName: string, e: Event) => void;\nexport type TrackId = `${MessageKey}-${number}`;\n\nexport interface Track {\n  audio: HTMLAudioElement;\n  proxy: HTMLAudioElement;\n  type: 'voice' | 'audio' | 'oneTimeVoice';\n  handlers: Handler[];\n  onForcePlay?: NoneToVoidFunction;\n  onTrackChange?: NoneToVoidFunction;\n}\n\nconst tracks = new Map<TrackId, Track>();\n\nlet voiceQueue: TrackId[] = [];\nlet musicQueue: TrackId[] = [];\n\nlet currentTrackId: TrackId | undefined;\n\nfunction createAudio(\n  trackId: TrackId,\n  type: Track['type'],\n  onForcePlay?: NoneToVoidFunction,\n  onTrackChange?: NoneToVoidFunction,\n): Track {\n  const audio = new Audio();\n\n  function handleEvent(eventName: string) {\n    return (e: Event) => {\n      if (!tracks.has(trackId)) {\n        return;\n      }\n\n      if (isSafariPatchInProgress(audio)) {\n        return;\n      }\n\n      tracks.get(trackId)!.handlers.forEach((handler) => {\n        handler(eventName, e);\n      });\n    };\n  }\n\n  audio.addEventListener('timeupdate', handleEvent('onTimeUpdate'));\n  audio.addEventListener('play', handleEvent('onPlay'));\n  audio.addEventListener('pause', handleEvent('onPause'));\n  audio.addEventListener('loadstart', handleEvent('onLoadStart'));\n  audio.addEventListener('loadeddata', handleEvent('onLoadedData'));\n  audio.addEventListener('playing', handleEvent('onPlaying'));\n  audio.addEventListener('ended', () => {\n    if (!tracks.has(trackId)) {\n      return;\n    }\n\n    if (isSafariPatchInProgress(audio)) {\n      return;\n    }\n\n    playNext(trackId);\n  });\n\n  return {\n    audio,\n    type,\n    proxy: new Proxy(audio, {\n      get: (target, key: keyof HTMLAudioElement) => target[key],\n    }),\n    handlers: [],\n    onForcePlay,\n    onTrackChange,\n  };\n}\n\nfunction playNext(trackId: TrackId, isReverseOrder?: boolean) {\n  const currentTrack = currentTrackId && tracks.get(currentTrackId);\n  if (currentTrack) {\n    currentTrack.audio.pause();\n    currentTrack.audio.currentTime = 0;\n    if (currentTrack.onTrackChange) currentTrack.onTrackChange();\n  }\n\n  const origin = selectTabState(getGlobal()).audioPlayer.origin || AudioOrigin.Inline;\n\n  const nextTrackId = findNextInQueue(trackId, origin, isReverseOrder);\n  if (!nextTrackId) {\n    return;\n  }\n\n  if (!tracks.has(nextTrackId)) {\n    // A bit hacky way to continue playlist when switching chat\n    getActions().openAudioPlayer(parseMessageKey(splitTrackId(nextTrackId).messageKey));\n\n    return;\n  }\n\n  const nextTrack = tracks.get(nextTrackId)!;\n\n  if (nextTrack.onForcePlay) {\n    nextTrack.onForcePlay();\n  }\n\n  currentTrackId = nextTrackId;\n\n  if (nextTrack.audio.src) {\n    safePlay(nextTrack.audio);\n  }\n}\n\nexport function stopCurrentAudio() {\n  const currentTrack = currentTrackId && tracks.get(currentTrackId);\n  if (currentTrack) {\n    currentTrack.audio.pause();\n  }\n}\n\nexport function register(\n  trackId: TrackId,\n  trackType: Track['type'],\n  handler: Handler,\n  onForcePlay?: NoneToVoidFunction,\n  onTrackChange?: NoneToVoidFunction,\n) {\n  if (!tracks.has(trackId)) {\n    const track = createAudio(trackId, trackType, onForcePlay, onTrackChange);\n    tracks.set(trackId, track);\n    addTrackToQueue(track, trackId);\n  }\n  const { audio, proxy, handlers } = tracks.get(trackId)!;\n\n  handlers.push(handler);\n\n  return {\n    play(src: string) {\n      if (!audio.paused) return;\n      const currentTrack = currentTrackId && tracks.get(currentTrackId);\n      if (currentTrack && currentTrackId !== trackId) {\n        currentTrack.audio.pause();\n        currentTrack.audio.currentTime = 0;\n        if (isSafariPatchInProgress(currentTrack.audio)) {\n          currentTrack.audio.dataset.preventPlayAfterPatch = 'true';\n        }\n        if (currentTrack.onTrackChange) currentTrack.onTrackChange();\n      }\n\n      currentTrackId = trackId;\n\n      if (!audio.src) {\n        audio.src = src;\n        audio.preload = 'auto';\n\n        if (src.includes('/progressive/') && IS_SAFARI) {\n          delete audio.dataset.preventPlayAfterPatch;\n          patchSafariProgressiveAudio(audio);\n        }\n      }\n\n      safePlay(audio);\n      cleanUpQueue(trackType, trackId);\n    },\n\n    pause() {\n      if (currentTrackId === trackId) {\n        audio.pause();\n      }\n    },\n\n    stop() {\n      if (currentTrackId === trackId) {\n        // Hack, reset `src` to remove default media session notification\n        const prevSrc = audio.src;\n        audio.pause();\n        // `onPause` not called otherwise, but required to sync UI\n        requestNextMutation(() => {\n          audio.src = '';\n          audio.src = prevSrc;\n        });\n      }\n    },\n\n    setCurrentTime(time: number) {\n      if (currentTrackId === trackId) {\n        if (audio.fastSeek) {\n          audio.fastSeek(time);\n        } else {\n          audio.currentTime = time;\n        }\n      }\n    },\n\n    setVolume(volume: number) {\n      if (currentTrackId === trackId) {\n        audio.volume = volume;\n        audio.muted = false;\n      }\n    },\n\n    setPlaybackRate(rate: number) {\n      if (currentTrackId === trackId) {\n        audio.playbackRate = rate;\n      }\n    },\n\n    toggleMuted(muted?: boolean) {\n      if (muted === undefined) {\n        audio.muted = !audio.muted;\n      } else {\n        audio.muted = muted;\n      }\n    },\n\n    proxy,\n\n    requestNextTrack() {\n      playNext(trackId);\n    },\n\n    isLast() {\n      return !findNextInQueue(trackId, selectTabState(getGlobal()).audioPlayer.origin);\n    },\n\n    isFirst() {\n      return !findNextInQueue(trackId, selectTabState(getGlobal()).audioPlayer.origin, true);\n    },\n\n    requestPreviousTrack() {\n      playNext(trackId, true);\n    },\n\n    destroy(shouldRemoveFromQueue = false) {\n      const track = tracks.get(trackId);\n      if (!track) {\n        return;\n      }\n\n      track.handlers = track.handlers.filter((h) => h !== handler);\n\n      if (!track.handlers.length) {\n        track.audio.pause();\n        tracks.delete(trackId);\n\n        if (shouldRemoveFromQueue) {\n          removeFromQueue(track, trackId);\n        }\n\n        if (trackId === currentTrackId) {\n          currentTrackId = undefined;\n        }\n      }\n    },\n  };\n}\n\nfunction getTrackQueue(track: Track) {\n  switch (track.type) {\n    case 'audio': return musicQueue;\n    case 'voice': return voiceQueue;\n    default: return undefined;\n  }\n}\n\nfunction addTrackToQueue(track: Track, trackId: TrackId) {\n  if (track.type === 'audio' && !musicQueue.includes(trackId)) {\n    musicQueue.push(trackId);\n    musicQueue.sort(trackIdComparator);\n  }\n\n  if (track.type === 'voice' && !voiceQueue.includes(trackId)) {\n    voiceQueue.push(trackId);\n    voiceQueue.sort(trackIdComparator);\n  }\n}\n\nfunction removeFromQueue(track: Track, trackId: TrackId) {\n  const trackIdFilter = (el: TrackId) => el !== trackId;\n  if (track.type === 'audio') {\n    musicQueue = musicQueue.filter(trackIdFilter);\n  }\n\n  if (track.type === 'voice') {\n    voiceQueue = voiceQueue.filter(trackIdFilter);\n  }\n}\n\nfunction cleanUpQueue(type: Track['type'], trackId: TrackId) {\n  if (selectTabState(getGlobal()).globalSearch.currentContent === GlobalSearchContent.Music) return;\n  const { chatId } = parseMessageKey(splitTrackId(trackId).messageKey);\n  const openedChatId = selectCurrentMessageList(getGlobal())?.chatId;\n  const queueFilter = (id: string) => (\n    id.startsWith(`msg${chatId}`) || (openedChatId && id.startsWith(`msg${openedChatId}`))\n  );\n\n  if (type === 'audio') {\n    musicQueue = musicQueue.filter(queueFilter);\n  }\n\n  if (type === 'voice') {\n    voiceQueue = voiceQueue.filter(queueFilter);\n  }\n}\n\nfunction findNextInQueue(currentId: TrackId, origin = AudioOrigin.Inline, isReverseOrder?: boolean) {\n  const track = tracks.get(currentId)!;\n  const queue = getTrackQueue(track);\n  if (!queue) return undefined;\n\n  if (origin === AudioOrigin.Search) {\n    const index = queue.indexOf(currentId);\n    if (index < 0) return undefined;\n    const direction = isReverseOrder ? -1 : 1;\n    return queue[index + direction];\n  }\n\n  const { chatId } = parseMessageKey(splitTrackId(currentId).messageKey);\n  const chatAudio = queue.filter((id) => id.startsWith(`msg${chatId}`));\n  const index = chatAudio.indexOf(currentId);\n  if (index < 0) return undefined;\n  let direction = origin === AudioOrigin.Inline ? -1 : 1;\n  if (isReverseOrder) direction *= -1;\n  return chatAudio[index + direction];\n}\n\nexport function makeTrackId(message: ApiMessage): TrackId | undefined {\n  const key = getMessageServerKey(message);\n  if (!key) {\n    return undefined;\n  }\n  return `${key}-${message.date}`;\n}\n\nfunction splitTrackId(trackId: TrackId) {\n  const messageKey = trackId.match(/^msg(-?\\d+)-(\\d+)/)![0] as MessageKey;\n  const date = Number(trackId.split('-').pop());\n  return {\n    messageKey,\n    date,\n  };\n}\n\n// Descending order by date\nfunction trackIdComparator(one?: TrackId, two?: TrackId) {\n  if (!one || !two) return 0;\n  const { date: dateOne, messageKey: keyOne } = splitTrackId(one);\n  const { date: dateTwo, messageKey: keyTwo } = splitTrackId(two);\n  const diff = dateTwo - dateOne;\n  return diff === 0 ? keyTwo.localeCompare(keyOne) : diff;\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useCallback } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiChat } from '../../api/types';\n\nimport {\n  getChatTitle,\n  getPrivateChatUserId,\n  getUserFirstOrLastName,\n  isChatBasicGroup,\n  isChatChannel,\n  isChatSuperGroup,\n  isUserBot,\n  isUserId,\n} from '../../global/helpers';\nimport { selectIsChatWithSelf, selectUser } from '../../global/selectors';\nimport renderText from './helpers/renderText';\n\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Button from '../ui/Button';\nimport Modal from '../ui/Modal';\nimport Avatar from './Avatar';\n\nimport './DeleteChatModal.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  chat: ApiChat;\n  isSavedDialog?: boolean;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n};\n\ntype StateProps = {\n  isChannel: boolean;\n  isChatWithSelf?: boolean;\n  isBot?: boolean;\n  isPrivateChat: boolean;\n  isBasicGroup: boolean;\n  isSuperGroup: boolean;\n  currentUserId: string | undefined;\n  canDeleteForAll?: boolean;\n  contactName?: string;\n};\n\nconst DeleteChatModal: FC<OwnProps & StateProps> = ({\n  isOpen,\n  chat,\n  isSavedDialog,\n  isChannel,\n  isPrivateChat,\n  isChatWithSelf,\n  isBot,\n  isBasicGroup,\n  isSuperGroup,\n  currentUserId,\n  canDeleteForAll,\n  contactName,\n  onClose,\n  onCloseAnimationEnd,\n}) => {\n  const {\n    leaveChannel,\n    deleteHistory,\n    deleteSavedHistory,\n    deleteChannel,\n    deleteChatUser,\n    blockUser,\n  } = getActions();\n\n  const lang = useOldLang();\n  const chatTitle = getChatTitle(lang, chat);\n\n  const handleDeleteForAll = useCallback(() => {\n    deleteHistory({ chatId: chat.id, shouldDeleteForAll: true });\n\n    onClose();\n  }, [chat.id, onClose]);\n\n  const handleDeleteAndStop = useCallback(() => {\n    deleteHistory({ chatId: chat.id, shouldDeleteForAll: true });\n    blockUser({ userId: chat.id });\n\n    onClose();\n  }, [chat.id, onClose]);\n\n  const handleDeleteChat = useCallback(() => {\n    if (isSavedDialog) {\n      deleteSavedHistory({ chatId: chat.id });\n    } else if (isPrivateChat) {\n      deleteHistory({ chatId: chat.id, shouldDeleteForAll: false });\n    } else if (isBasicGroup) {\n      deleteChatUser({ chatId: chat.id, userId: currentUserId! });\n      deleteHistory({ chatId: chat.id, shouldDeleteForAll: false });\n    } else if ((isChannel || isSuperGroup) && !chat.isCreator) {\n      leaveChannel({ chatId: chat.id });\n    } else if ((isChannel || isSuperGroup) && chat.isCreator) {\n      deleteChannel({ chatId: chat.id });\n    }\n    onClose();\n  }, [\n    isPrivateChat,\n    isBasicGroup,\n    isChannel,\n    isSuperGroup,\n    currentUserId,\n    chat.isCreator,\n    chat.id,\n    isSavedDialog,\n    onClose,\n  ]);\n\n  const handleLeaveChat = useCallback(() => {\n    if (isChannel || isSuperGroup) {\n      leaveChannel({ chatId: chat.id });\n      onClose();\n    } else {\n      handleDeleteChat();\n    }\n  }, [chat.id, handleDeleteChat, isChannel, isSuperGroup, leaveChannel, onClose]);\n\n  function renderHeader() {\n    return (\n      <div className=\"modal-header\" dir={lang.isRtl ? 'rtl' : undefined}>\n        <Avatar\n          size=\"tiny\"\n          peer={chat}\n          isSavedMessages={isChatWithSelf}\n        />\n        <h3 className=\"modal-title\">{lang(renderTitle())}</h3>\n      </div>\n    );\n  }\n\n  function renderTitle() {\n    if (isSavedDialog) {\n      return isChatWithSelf ? 'ClearHistoryMyNotesTitle' : 'ClearHistoryTitleSingle2';\n    }\n\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n\n    if (isChannel && chat.isCreator) {\n      return 'ChannelDelete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return 'DeleteChatUser';\n  }\n\n  function renderContent() {\n    if (isSavedDialog) {\n      return (\n        <p>\n          {renderText(\n            isChatWithSelf ? lang('ClearHistoryMyNotesMessage') : lang('ClearHistoryMessageSingle', chatTitle),\n            ['simple_markdown', 'emoji'],\n          )}\n        </p>\n      );\n    }\n    if (isChannel && chat.isCreator) {\n      return (\n        <p>\n          {renderText(lang('ChatList.DeleteAndLeaveGroupConfirmation', chatTitle), ['simple_markdown', 'emoji'])}\n        </p>\n      );\n    }\n\n    if ((isChannel && !chat.isCreator) || isBasicGroup || isSuperGroup) {\n      return <p>{renderText(lang('ChannelLeaveAlertWithName', chatTitle), ['simple_markdown', 'emoji'])}</p>;\n    }\n\n    return <p>{renderText(lang('ChatList.DeleteChatConfirmation', contactName), ['simple_markdown', 'emoji'])}</p>;\n  }\n\n  function renderActionText() {\n    if (isSavedDialog) {\n      return 'Delete';\n    }\n\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n    if (isChannel && chat.isCreator) {\n      return 'Chat.Input.Delete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return canDeleteForAll ? 'ChatList.DeleteForCurrentUser' : 'Delete';\n  }\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      className=\"DeleteChatModal\"\n      header={renderHeader()}\n      onClose={onClose}\n      onCloseAnimationEnd={onCloseAnimationEnd}\n    >\n      {renderContent()}\n      <div className=\"dialog-buttons-column\">\n        {isBot && !isSavedDialog && (\n          <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteAndStop}>\n            {lang('DeleteAndStop')}\n          </Button>\n        )}\n        {canDeleteForAll && (\n          <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteForAll}>\n            {contactName ? renderText(lang('ChatList.DeleteForEveryone', contactName)) : lang('DeleteForAll')}\n          </Button>\n        )}\n        {!isPrivateChat && chat.isCreator && !isSavedDialog && (\n          <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteChat}>\n            {lang('DeleteForAll')}\n          </Button>\n        )}\n        <Button\n          color=\"danger\"\n          className=\"confirm-dialog-button\"\n          isText\n          onClick={(isPrivateChat || isSavedDialog) ? handleDeleteChat : handleLeaveChat}\n        >\n          {lang(renderActionText())}\n        </Button>\n        <Button className=\"confirm-dialog-button\" isText onClick={onClose}>{lang('Cancel')}</Button>\n      </div>\n    </Modal>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chat, isSavedDialog }): StateProps => {\n    const isPrivateChat = isUserId(chat.id);\n    const isChatWithSelf = selectIsChatWithSelf(global, chat.id);\n    const user = isPrivateChat && selectUser(global, getPrivateChatUserId(chat)!);\n    const isBot = user && isUserBot(user) && !chat.isSupport;\n    const canDeleteForAll = (isPrivateChat && !isChatWithSelf && !isBot && !isSavedDialog);\n    const contactName = isPrivateChat\n      ? getUserFirstOrLastName(selectUser(global, getPrivateChatUserId(chat)!))\n      : undefined;\n\n    return {\n      isPrivateChat,\n      isChatWithSelf,\n      isBot,\n      isChannel: isChatChannel(chat),\n      isBasicGroup: isChatBasicGroup(chat),\n      isSuperGroup: isChatSuperGroup(chat),\n      currentUserId: global.currentUserId,\n      canDeleteForAll,\n      contactName,\n    };\n  },\n)(DeleteChatModal));\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"mklnEg0s\",\"compact\":\"VGmPJoga\",\"image\":\"tT8KQwg0\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../../lib/teact/teact';\n\nimport type { ApiDocument } from '../../../api/types';\nimport type { ThemeKey } from '../../../types';\nimport { ApiMediaFormat } from '../../../api/types';\n\nimport { getDocumentMediaHash } from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useMedia from '../../../hooks/useMedia';\n\nimport styles from './AttachBotIcon.module.scss';\n\ntype OwnProps = {\n  icon: ApiDocument;\n  theme: ThemeKey;\n};\n\nconst ADDITIONAL_STROKE_WIDTH = '0.5px';\nconst DARK_THEME_COLOR = 'rgb(170, 170, 170)';\nconst LIGHT_THEME_COLOR = 'rgb(112, 117, 121)';\nconst COLOR_REPLACE_PATTERN = /#fff/gi;\n\nconst AttachBotIcon: FC<OwnProps> = ({\n  icon, theme,\n}) => {\n  const { isTouchScreen } = useAppLayout();\n  const mediaData = useMedia(getDocumentMediaHash(icon, 'full'), false, ApiMediaFormat.Text);\n\n  const iconSvg = useMemo(() => {\n    if (!mediaData) return '';\n    const color = theme === 'dark' ? DARK_THEME_COLOR : LIGHT_THEME_COLOR;\n\n    const mediaDataWithReplacedColors = mediaData.replace(COLOR_REPLACE_PATTERN, color);\n    const doc = new DOMParser().parseFromString(mediaDataWithReplacedColors, 'image/svg+xml');\n    doc.querySelectorAll('path').forEach((path) => {\n      path.style.stroke = color;\n      path.style.strokeWidth = ADDITIONAL_STROKE_WIDTH;\n    });\n\n    return `data:image/svg+xml;utf8,${doc.documentElement.outerHTML}`;\n  }, [mediaData, theme]);\n\n  return (\n    <i className={buildClassName(styles.root, 'icon', !isTouchScreen && styles.compact)}>\n      <img\n        src={iconSvg}\n        alt=\"\"\n        className={buildClassName(styles.image, !isTouchScreen && styles.compact)}\n        draggable={false}\n      />\n    </i>\n  );\n};\n\nexport default memo(AttachBotIcon);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useMemo, useState,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiAttachBot } from '../../../api/types';\nimport type { IAnchorPosition, ThemeKey, ThreadId } from '../../../types';\n\nimport useFlag from '../../../hooks/useFlag';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Menu from '../../ui/Menu';\nimport MenuItem from '../../ui/MenuItem';\nimport AttachBotIcon from './AttachBotIcon';\n\ntype OwnProps = {\n  bot: ApiAttachBot;\n  theme: ThemeKey;\n  isInSideMenu?: true;\n  chatId?: string;\n  threadId?: ThreadId;\n  canShowNew?: boolean;\n  onMenuOpened: VoidFunction;\n  onMenuClosed: VoidFunction;\n};\n\nconst AttachBotItem: FC<OwnProps> = ({\n  bot,\n  theme,\n  chatId,\n  threadId,\n  isInSideMenu,\n  canShowNew,\n  onMenuOpened,\n  onMenuClosed,\n}) => {\n  const { callAttachBot, toggleAttachBot } = getActions();\n\n  const lang = useOldLang();\n\n  const icon = useMemo(() => {\n    return bot.icons.find(({ name }) => name === 'default_static')?.document;\n  }, [bot.icons]);\n\n  const [isMenuOpen, openMenu, closeMenu] = useFlag();\n  const [menuPosition, setMenuPosition] = useState<IAnchorPosition | undefined>(undefined);\n\n  const handleContextMenu = useLastCallback((e: React.UIEvent) => {\n    e.preventDefault();\n    const rect = e.currentTarget.getBoundingClientRect();\n    setMenuPosition({ x: rect.right, y: rect.bottom });\n    onMenuOpened();\n    openMenu();\n  });\n\n  const handleClick = useLastCallback(() => {\n    if (isInSideMenu) {\n      callAttachBot({\n        bot,\n        isFromSideMenu: true,\n      });\n    } else {\n      callAttachBot({\n        bot,\n        chatId: chatId!,\n        threadId,\n      });\n    }\n  });\n\n  const handleCloseMenu = useLastCallback(() => {\n    closeMenu();\n    onMenuClosed();\n  });\n\n  const handleCloseAnimationEnd = useLastCallback(() => {\n    setMenuPosition(undefined);\n  });\n\n  const handleRemoveBot = useLastCallback(() => {\n    toggleAttachBot({\n      botId: bot.id,\n      isEnabled: false,\n    });\n  });\n\n  return (\n    <MenuItem\n      key={bot.id}\n      customIcon={icon && <AttachBotIcon icon={icon} theme={theme} />}\n      icon={!icon ? 'bots' : undefined}\n      onClick={handleClick}\n      onContextMenu={handleContextMenu}\n    >\n      {bot.shortName}\n      {canShowNew && bot.isDisclaimerNeeded && <span className=\"menu-item-badge\">{lang('New')}</span>}\n      {menuPosition && (\n        <Menu\n          isOpen={isMenuOpen}\n          positionX=\"right\"\n          style={`left: ${menuPosition.x}px;top: ${menuPosition.y}px;`}\n          className=\"bot-attach-context-menu\"\n          autoClose\n          withPortal\n          onClose={handleCloseMenu}\n          onCloseAnimationEnd={handleCloseAnimationEnd}\n        >\n          <MenuItem icon=\"stop\" destructive onClick={handleRemoveBot}>{lang('WebApp.RemoveBot')}</MenuItem>\n        </Menu>\n      )}\n\n    </MenuItem>\n  );\n};\n\nexport default memo(AttachBotItem);\n","import useForceUpdate from '../useForceUpdate';\nimport useInterval from './useInterval';\n\nexport default function useIntervalForceUpdate(interval?: number) {\n  const forceUpdate = useForceUpdate();\n\n  useInterval(forceUpdate, interval, true);\n}\n","import type { ApiAttachment } from '../../../../api/types';\n\nimport {\n  GIF_MIME_TYPE,\n  SUPPORTED_AUDIO_CONTENT_TYPES,\n  SUPPORTED_PHOTO_CONTENT_TYPES,\n  SUPPORTED_VIDEO_CONTENT_TYPES,\n} from '../../../../config';\nimport { parseAudioMetadata } from '../../../../util/audio';\nimport {\n  createPosterForVideo,\n  preloadImage,\n  preloadVideo,\n} from '../../../../util/files';\nimport { scaleImage } from '../../../../util/imageResize';\n\nconst MAX_QUICK_IMG_SIZE = 1280; // px\nconst MAX_THUMB_IMG_SIZE = 40; // px\nconst MAX_ASPECT_RATIO = 20;\nconst FILE_EXT_REGEX = /\\.[^/.]+$/;\n\nexport default async function buildAttachment(\n  filename: string, blob: Blob, options?: Partial<ApiAttachment>,\n): Promise<ApiAttachment> {\n  const blobUrl = URL.createObjectURL(blob);\n  const { type: mimeType, size } = blob;\n  let quick;\n  let audio;\n  let previewBlobUrl;\n  let shouldSendAsFile;\n\n  if (SUPPORTED_PHOTO_CONTENT_TYPES.has(mimeType)) {\n    const img = await preloadImage(blobUrl);\n    const { width, height } = img;\n    shouldSendAsFile = !validateAspectRatio(width, height);\n\n    const shouldShrink = Math.max(width, height) > MAX_QUICK_IMG_SIZE;\n    const isGif = mimeType === GIF_MIME_TYPE;\n\n    if (!shouldSendAsFile) {\n      if (!options?.compressedBlobUrl && !isGif && (shouldShrink || mimeType !== 'image/jpeg')) {\n        const resizedUrl = await scaleImage(\n          blobUrl, shouldShrink ? MAX_QUICK_IMG_SIZE / Math.max(width, height) : 1, 'image/jpeg',\n        );\n        URL.revokeObjectURL(blobUrl);\n        return buildAttachment(filename, blob, {\n          compressedBlobUrl: resizedUrl,\n        });\n      }\n\n      if (mimeType === 'image/jpeg') {\n        filename = filename.replace(FILE_EXT_REGEX, '.jpg');\n      }\n\n      quick = { width, height };\n    }\n\n    const shouldShrinkPreview = Math.max(width, height) > MAX_THUMB_IMG_SIZE;\n    if (shouldShrinkPreview) {\n      previewBlobUrl = await scaleImage(\n        blobUrl, MAX_THUMB_IMG_SIZE / Math.max(width, height), 'image/jpeg',\n      );\n    } else {\n      previewBlobUrl = blobUrl;\n    }\n  } else if (SUPPORTED_VIDEO_CONTENT_TYPES.has(mimeType)) {\n    try {\n      const { videoWidth: width, videoHeight: height, duration } = await preloadVideo(blobUrl);\n      shouldSendAsFile = !validateAspectRatio(width, height);\n      if (!shouldSendAsFile) {\n        quick = { width: width!, height: height!, duration: duration! };\n      }\n    } catch (err) {\n      shouldSendAsFile = true;\n    }\n\n    previewBlobUrl = await createPosterForVideo(blobUrl);\n  } else if (SUPPORTED_AUDIO_CONTENT_TYPES.has(mimeType)) {\n    const {\n      duration, title, performer, coverUrl,\n    } = await parseAudioMetadata(blobUrl);\n    audio = {\n      duration: duration || 0,\n      title,\n      performer,\n    };\n    previewBlobUrl = coverUrl;\n  }\n\n  return {\n    blobUrl,\n    filename,\n    mimeType,\n    size,\n    quick,\n    audio,\n    previewBlobUrl,\n    shouldSendAsFile: shouldSendAsFile || undefined,\n    uniqueId: `${Date.now()}-${Math.random()}`,\n    ...options,\n  };\n}\n\nexport function prepareAttachmentsToSend(\n  attachments: ApiAttachment[], shouldSendCompressed?: boolean,\n): ApiAttachment[] {\n  return attachments.map((attach) => {\n    if (shouldSendCompressed) {\n      if (attach.compressedBlobUrl) {\n        return {\n          ...attach,\n          blobUrl: attach.compressedBlobUrl,\n        };\n      }\n      return attach;\n    }\n\n    return {\n      ...attach,\n      shouldSendAsFile: !(attach.voice || attach.audio) || undefined,\n      shouldSendAsSpoiler: undefined,\n    };\n  });\n}\n\nfunction validateAspectRatio(width: number, height: number) {\n  const maxAspectRatio = Math.max(width, height) / Math.min(width, height);\n  return maxAspectRatio <= MAX_ASPECT_RATIO;\n}\n","type AudioMetadata = {\n  title?: string;\n  performer?: string;\n  duration?: number;\n  coverUrl?: string;\n};\n\nexport async function parseAudioMetadata(url: string): Promise<AudioMetadata> {\n  const { fetchFromUrl, selectCover } = await import('../lib/music-metadata-browser');\n  const metadata = await fetchFromUrl(url);\n  const { common: { title, artist, picture }, format: { duration } } = metadata;\n\n  const cover = selectCover(picture);\n  const coverBlob = cover ? new Blob([cover.data], { type: cover.format }) : undefined;\n  const coverUrl = coverBlob ? URL.createObjectURL(coverBlob) : undefined;\n\n  return {\n    title,\n    performer: artist,\n    duration,\n    coverUrl,\n  };\n}\n","import type { ApiBoostsStatus } from '../../../api/types';\n\nexport function getBoostProgressInfo(boostInfo: ApiBoostsStatus, freezeOnLevelUp?: boolean) {\n  const {\n    level, boosts, currentLevelBoosts, nextLevelBoosts, hasMyBoost, prepaidGiveaways,\n  } = boostInfo;\n\n  const isJustUpgraded = freezeOnLevelUp && boosts === currentLevelBoosts && hasMyBoost;\n\n  const currentLevel = isJustUpgraded ? level - 1 : level;\n  const hasNextLevel = Boolean(nextLevelBoosts);\n\n  const levelProgress = (!nextLevelBoosts || isJustUpgraded) ? 1\n    : (boosts - currentLevelBoosts) / (nextLevelBoosts - currentLevelBoosts);\n  const remainingBoosts = nextLevelBoosts ? nextLevelBoosts - boosts : 0;\n\n  const isMaxLevel = nextLevelBoosts === undefined;\n\n  return {\n    currentLevel,\n    hasNextLevel,\n    boosts,\n    levelProgress,\n    remainingBoosts,\n    isMaxLevel,\n    prepaidGiveaways,\n  };\n}\n","import type { ApiChat, ApiMessage, ApiUser } from '../../../../api/types';\nimport type { OldLangFn } from '../../../../hooks/useOldLang';\n\nimport {\n  getChatTitle,\n  isChatGroup,\n  isUserId,\n} from '../../../../global/helpers';\nimport { getPeerTitle } from '../../../../global/helpers/peers';\n\nexport function getSenderName(\n  lang: OldLangFn, message: ApiMessage, chatsById: Record<string, ApiChat>, usersById: Record<string, ApiUser>,\n) {\n  const { senderId } = message;\n  if (!senderId) {\n    return undefined;\n  }\n\n  const sender = isUserId(senderId) ? usersById[senderId] : chatsById[senderId];\n\n  let senderName = getPeerTitle(lang, sender);\n\n  const chat = chatsById[message.chatId];\n  if (chat) {\n    if ('isSelf' in sender && sender.isSelf) {\n      senderName = `${lang('FromYou')}  ${getChatTitle(lang, chat)}`;\n    } else if (isChatGroup(chat)) {\n      senderName += `  ${getChatTitle(lang, chat)}`;\n    }\n  }\n\n  return senderName;\n}\n","import type {\n  CoreAssistantMessage,\n  CoreToolMessage,\n  Message,\n} from 'ai';\nimport { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\ninterface ApplicationError extends Error {\n  info: string;\n  status: number;\n}\n\nexport const fetcher = async (url: string) => {\n  const res = await fetch(url);\n\n  if (!res.ok) {\n    const error = new Error(\n      'An error occurred while fetching the data.',\n    ) as ApplicationError;\n\n    error.info = await res.json();\n    error.status = res.status;\n\n    throw error;\n  }\n\n  return res.json();\n};\n\nexport function getLocalStorage(key: string) {\n  if (typeof window !== 'undefined') {\n    return JSON.parse(localStorage.getItem(key) || '[]');\n  }\n  return [];\n}\n\nexport function generateUUID(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nfunction addToolMessageToChat({\n  toolMessage,\n  messages,\n}: {\n  toolMessage: CoreToolMessage;\n  messages: Array<Message>;\n}): Array<Message> {\n  return messages.map((message) => {\n    if (message.toolInvocations) {\n      return {\n        ...message,\n        toolInvocations: message.toolInvocations.map((toolInvocation) => {\n          const toolResult = toolMessage.content.find(\n            (tool) => tool.toolCallId === toolInvocation.toolCallId,\n          );\n\n          if (toolResult) {\n            return {\n              ...toolInvocation,\n              state: 'result',\n              result: toolResult.result,\n            };\n          }\n\n          return toolInvocation;\n        }),\n      };\n    }\n\n    return message;\n  });\n}\n\ntype ResponseMessageWithoutId = CoreToolMessage | CoreAssistantMessage;\ntype ResponseMessage = ResponseMessageWithoutId & { id: string };\n\nexport function sanitizeResponseMessages({\n  messages,\n  reasoning,\n}: {\n  messages: Array<ResponseMessage>;\n  reasoning: string | undefined;\n}) {\n  const toolResultIds: Array<string> = [];\n\n  for (const message of messages) {\n    if (message.role === 'tool') {\n      for (const content of message.content) {\n        if (content.type === 'tool-result') {\n          toolResultIds.push(content.toolCallId);\n        }\n      }\n    }\n  }\n\n  const messagesBySanitizedContent = messages.map((message) => {\n    if (message.role !== 'assistant') return message;\n\n    if (typeof message.content === 'string') return message;\n\n    const sanitizedContent = message.content.filter((content) => (content.type === 'tool-call'\n      ? toolResultIds.includes(content.toolCallId)\n      : content.type === 'text'\n        ? content.text.length > 0\n        : true));\n\n    if (reasoning) {\n      // @ts-expect-error: reasoning message parts in sdk is wip\n      sanitizedContent.push({ type: 'reasoning', reasoning });\n    }\n\n    return {\n      ...message,\n      content: sanitizedContent,\n    };\n  });\n\n  return messagesBySanitizedContent.filter(\n    (message) => message.content.length > 0,\n  );\n}\n\nexport function sanitizeUIMessages(messages: Array<Message>): Array<Message> {\n  const messagesBySanitizedToolInvocations = messages.map((message) => {\n    if (message.role !== 'assistant') return message;\n\n    if (!message.toolInvocations) return message;\n\n    const toolResultIds: Array<string> = [];\n\n    for (const toolInvocation of message.toolInvocations) {\n      if (toolInvocation.state === 'result') {\n        toolResultIds.push(toolInvocation.toolCallId);\n      }\n    }\n\n    const sanitizedToolInvocations = message.toolInvocations.filter(\n      (toolInvocation) => toolInvocation.state === 'result'\n        || toolResultIds.includes(toolInvocation.toolCallId),\n    );\n\n    return {\n      ...message,\n      toolInvocations: sanitizedToolInvocations,\n    };\n  });\n\n  return messagesBySanitizedToolInvocations.filter(\n    (message) => message.content.length > 0\n      || (message.toolInvocations && message.toolInvocations.length > 0),\n  );\n}\n\nexport function getMostRecentUserMessage(messages: Array<Message>) {\n  const userMessages = messages.filter((message) => message.role === 'user');\n  return userMessages.at(-1);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"overlay\":\"RXAMu4VD\",\"mediaArea\":\"pruw1nLm\",\"preview\":\"_5HkplWee\",\"shiny\":\"xFjJpeOA\",\"wave\":\"Ux0tlNbE\",\"light\":\"_7esBA3m\",\"dark\":\"eic2vQ8c\",\"reactionBackground\":\"c3ajA3hg\",\"flipped\":\"furSXGdL\",\"reaction\":\"Et3MvYmN\",\"withCount\":\"mFTLUHm2\",\"reactionCount\":\"Tr8mYyDk\",\"weather\":\"KBjMtRUS\",\"weatherInner\":\"IFChB3tD\",\"temperature\":\"_ke1UBIl\"};","import React, {\n  memo, useMemo, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMediaAreaSuggestedReaction, ApiStory } from '../../../api/types';\n\nimport { getStoryKey, isSameReaction, isUserId } from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\nimport buildStyle from '../../../util/buildStyle';\nimport { REM } from '../../common/helpers/mediaDimensions';\n\nimport useEffectWithPrevDeps from '../../../hooks/useEffectWithPrevDeps';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useResizeObserver from '../../../hooks/useResizeObserver';\n\nimport ReactionAnimatedEmoji from '../../common/reactions/ReactionAnimatedEmoji';\n\nimport styles from './MediaArea.module.scss';\n\ntype OwnProps = {\n  story: ApiStory;\n  mediaArea: ApiMediaAreaSuggestedReaction;\n  index: number;\n  isPreview?: boolean;\n  className?: string;\n  style?: string;\n};\n\nconst REACTION_SIZE_MULTIPLIER = 0.6;\nconst EFFECT_SIZE_MULTIPLIER = 4;\n\nconst MediaAreaSuggestedReaction = ({\n  story,\n  mediaArea,\n  index,\n  className,\n  style,\n  isPreview,\n}: OwnProps) => {\n  const { sendStoryReaction } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const [customEmojiSize, setCustomEmojiSize] = useState(1.5 * REM);\n\n  const { peerId, id, views } = story;\n  const { reactions } = views || {};\n  const { reaction, isDark, isFlipped } = mediaArea;\n\n  const isChannel = !isUserId(peerId);\n  const containerId = `${getStoryKey(peerId, id)}-${index}-${isPreview ? 'preview' : 'viewer'}`;\n\n  const reactionCount = useMemo(() => (\n    reactions?.find((r) => isSameReaction(r.reaction, reaction))?.count\n  ), [reaction, reactions]);\n  const shouldDisplayCount = !isPreview && Boolean(reactionCount) && isChannel;\n\n  const updateCustomEmojiSize = useLastCallback(() => {\n    if (!ref.current) return;\n    const height = ref.current.clientHeight;\n    setCustomEmojiSize(Math.round(height * REACTION_SIZE_MULTIPLIER));\n  });\n\n  useEffectWithPrevDeps(([prevReactionCount]) => {\n    if (Boolean(reactionCount) !== Boolean(prevReactionCount)) {\n      updateCustomEmojiSize();\n    }\n  }, [reactionCount]);\n\n  useResizeObserver(ref, updateCustomEmojiSize);\n\n  const handleClick = useLastCallback(() => {\n    sendStoryReaction({\n      peerId,\n      storyId: id,\n      containerId,\n      reaction,\n    });\n  });\n\n  return (\n    <div\n      ref={ref}\n      className={buildClassName(isDark ? styles.dark : styles.light, className)}\n      style={buildStyle(style, `--custom-emoji-size: ${customEmojiSize}px`)}\n      onClick={handleClick}\n    >\n      <div\n        className={buildClassName(styles.reactionBackground, isFlipped && styles.flipped)}\n      />\n      {Boolean(customEmojiSize) && (\n        <ReactionAnimatedEmoji\n          className={buildClassName(styles.reaction, shouldDisplayCount && styles.withCount)}\n          reaction={reaction}\n          containerId={containerId}\n          size={customEmojiSize}\n          effectSize={customEmojiSize * EFFECT_SIZE_MULTIPLIER}\n          shouldPause={isPreview}\n          shouldLoop={!isPreview}\n        />\n      )}\n      {shouldDisplayCount && (\n        <span className={styles.reactionCount}>{reactionCount}</span>\n      )}\n    </div>\n  );\n};\n\nexport default memo(MediaAreaSuggestedReaction);\n","import React, {\n  type FC, memo,\n  useLayoutEffect,\n  useRef, useState,\n} from '../../../lib/teact/teact';\nimport { setExtraStyles } from '../../../lib/teact/teact-dom';\nimport { withGlobal } from '../../../global';\n\nimport type { ApiMediaAreaWeather, ApiSticker } from '../../../api/types';\n\nimport { requestForcedReflow, requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { selectRestrictedEmoji } from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport buildStyle from '../../../util/buildStyle';\nimport { convertToRGBA, getTextColor } from '../../../util/colors';\nimport { formatTemperature } from '../../../util/formatTemperature';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useResizeObserver from '../../../hooks/useResizeObserver';\n\nimport CustomEmoji from '../../common/CustomEmoji';\n\nimport styles from './MediaArea.module.scss';\n\ntype OwnProps = {\n  mediaArea: ApiMediaAreaWeather;\n  className?: string;\n  style?: string;\n  isPreview?: boolean;\n};\n\ntype StateProps = {\n  restrictedEmoji?: ApiSticker;\n};\n\nconst EMOJI_SIZE_MULTIPLIER = 0.7;\nconst TEMPERATURE_SIZE = 32;\n\nconst MediaAreaWeather: FC<OwnProps & StateProps> = ({\n  mediaArea,\n  className,\n  style,\n  restrictedEmoji,\n  isPreview,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const [customEmojiSize, setCustomEmojiSize] = useState(0);\n\n  const { temperatureC, color } = mediaArea;\n\n  const backgroundColor = convertToRGBA(color);\n  const textColor = getTextColor(color);\n\n  const updateCustomSize = useLastCallback((isImmediate?: boolean) => {\n    if (!ref.current) return undefined;\n    const el = ref.current;\n\n    const height = el.clientHeight;\n    const customEmojiHeight = Math.round(height * EMOJI_SIZE_MULTIPLIER);\n    setCustomEmojiSize(customEmojiHeight);\n    const applyFn = () => {\n      setExtraStyles(el, {\n        '--custom-emoji-size': `${customEmojiHeight}px`,\n        'font-size': `${height / TEMPERATURE_SIZE}rem`,\n      });\n    };\n\n    if (isImmediate) return applyFn;\n\n    requestMutation(applyFn);\n\n    return undefined;\n  });\n\n  useLayoutEffect(() => {\n    requestForcedReflow(() => updateCustomSize(true));\n  }, []);\n\n  useResizeObserver(ref, () => updateCustomSize());\n\n  return (\n    <div\n      ref={ref}\n      className={buildClassName(styles.weather, className)}\n      style={buildStyle(\n        style,\n        `--custom-background-color: ${backgroundColor}`,\n        `color: ${textColor}`,\n      )}\n    >\n      <div className={styles.weatherInner}>\n        {restrictedEmoji && (\n          <CustomEmoji\n            key={restrictedEmoji.id}\n            documentId={restrictedEmoji.id}\n            size={customEmojiSize}\n            noPlay={isPreview}\n            withTranslucentThumb\n            forceAlways\n          />\n        )}\n        <p className={styles.temperature}>\n          {formatTemperature(temperatureC)}\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>((global, ownProps): StateProps => {\n  const { mediaArea } = ownProps;\n  const restrictedEmoji = selectRestrictedEmoji(global, mediaArea.emoji);\n  return { restrictedEmoji };\n})(MediaAreaWeather));\n","export const formatTemperature = (temperatureC: number) => {\n  const isFahrenheit = Boolean(navigator.language === 'en-US');\n  return isFahrenheit ? `${Math.round((temperatureC * 9) / 5 + 32)}F` : `${Math.round(temperatureC)}C`;\n};\n","import React, {\n  memo, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMediaArea, ApiStory } from '../../../api/types';\n\nimport { MOBILE_SCREEN_MAX_WIDTH } from '../../../config';\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport buildClassName from '../../../util/buildClassName';\nimport buildStyle from '../../../util/buildStyle';\n\nimport useWindowSize from '../../../hooks/window/useWindowSize';\n\nimport MediaAreaSuggestedReaction from './MediaAreaSuggestedReaction';\nimport MediaAreaWeather from './MediaAreaWeather';\n\nimport styles from './MediaArea.module.scss';\n\ntype OwnProps = {\n  story: ApiStory;\n  isActive?: boolean;\n  isStoryPlaying?: boolean;\n  className?: string;\n};\n\nconst STORY_ASPECT_RATIO = 9 / 16;\nconst PERCENTAGE_BASE = 100;\n\nconst NO_SHINY_TYPES = new Set<ApiMediaArea['type']>(['channelPost', 'uniqueGift']);\n\nconst MediaAreaOverlay = ({\n  story, isActive, className, isStoryPlaying,\n}: OwnProps) => {\n  const {\n    openMapModal, openUniqueGiftBySlug, focusMessage, closeStoryViewer, openUrl,\n  } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const [mediaWidth, setMediaWidth] = useState(0);\n\n  const windowSize = useWindowSize();\n\n  useEffect(() => {\n    if (!ref.current) return;\n    const element = ref.current;\n    setMediaWidth(element!.clientWidth!);\n\n    if (windowSize.width > MOBILE_SCREEN_MAX_WIDTH) {\n      requestMutation(() => {\n        element.style.removeProperty('--media-width');\n        element.style.removeProperty('--media-height');\n      });\n      return;\n    }\n\n    const screenAspectRatio = windowSize.width / windowSize.height;\n\n    const width = screenAspectRatio < STORY_ASPECT_RATIO\n      ? element.clientHeight * STORY_ASPECT_RATIO : element.clientWidth;\n    const height = screenAspectRatio < STORY_ASPECT_RATIO\n      ? element.clientHeight : element.clientWidth / STORY_ASPECT_RATIO;\n\n    requestMutation(() => {\n      element.style.setProperty('--media-width', `${width}px`);\n      element.style.setProperty('--media-height', `${height}px`);\n    });\n  }, [isActive, windowSize]);\n\n  const handleMediaAreaClick = (mediaArea: ApiMediaArea) => {\n    switch (mediaArea.type) {\n      case 'geoPoint':\n      case 'venue': {\n        openMapModal({ geoPoint: mediaArea.geo });\n        break;\n      }\n      case 'channelPost': {\n        focusMessage({\n          chatId: mediaArea.channelId,\n          messageId: mediaArea.messageId,\n        });\n        closeStoryViewer();\n        break;\n      }\n      case 'url': {\n        openUrl({ url: mediaArea.url });\n        break;\n      }\n      case 'uniqueGift': {\n        openUniqueGiftBySlug({ slug: mediaArea.slug });\n        break;\n      }\n    }\n  };\n\n  const mediaAreas = story.mediaAreas;\n\n  return (\n    <div\n      className={buildClassName(styles.overlay, !isActive && styles.preview, className)}\n      ref={ref}\n    >\n      {mediaAreas?.map((mediaArea, i) => {\n        switch (mediaArea.type) {\n          case 'geoPoint':\n          case 'venue':\n          case 'channelPost':\n          case 'url':\n          case 'uniqueGift': {\n            const isShiny = isActive && !NO_SHINY_TYPES.has(mediaArea.type);\n            return (\n              <div\n                className={buildClassName(styles.mediaArea, isShiny && styles.shiny)}\n                style={prepareStyle(mediaArea)}\n                onClick={() => handleMediaAreaClick(mediaArea)}\n              />\n            );\n          }\n          case 'suggestedReaction':\n            return (\n              <MediaAreaSuggestedReaction\n                // eslint-disable-next-line react/no-array-index-key\n                key={`${mediaArea.type}-${i}`}\n                story={story}\n                mediaArea={mediaArea}\n                index={i}\n                isPreview={!isActive}\n                className={styles.mediaArea}\n                style={prepareStyle(mediaArea)}\n              />\n            );\n          case 'weather': {\n            return (\n              <MediaAreaWeather\n                // eslint-disable-next-line react/no-array-index-key\n                key={`${mediaArea.type}-${i}`}\n                mediaArea={mediaArea}\n                className={styles.mediaArea}\n                style={prepareStyle(mediaArea, mediaWidth)}\n                isPreview={!isActive || isStoryPlaying}\n              />\n            );\n          }\n          default:\n            return undefined;\n        }\n      })}\n    </div>\n  );\n};\n\nfunction prepareStyle(mediaArea: ApiMediaArea, mediaWidth?: number) {\n  const {\n    x, y, width, height, rotation, radius,\n  } = mediaArea.coordinates;\n\n  let pixelRadius = '';\n\n  if (mediaWidth && radius && mediaWidth > 0) {\n    const pixelWidth = (mediaWidth * (width / PERCENTAGE_BASE));\n    const pixelHeight = (mediaWidth * (height / PERCENTAGE_BASE));\n    pixelRadius = `${Math.min(pixelWidth, pixelHeight) * (radius / PERCENTAGE_BASE)}px`;\n  }\n\n  return buildStyle(\n    `left: ${x}%`,\n    `top: ${y}%`,\n    `width: ${width}%`,\n    `height: ${height}%`,\n    `transform: rotate(${rotation}deg) translate(-50%, -50%)`,\n    pixelRadius && `border-radius: ${pixelRadius}`,\n  );\n}\n\nexport default memo(MediaAreaOverlay);\n","import { useEffect } from '../../lib/teact/teact';\n\nimport { onBeforeUnload } from '../../util/schedulers';\nimport useLastCallback from '../useLastCallback';\n\nexport default function useBeforeUnload(callback: AnyToVoidFunction) {\n  const lastCallback = useLastCallback(callback);\n\n  useEffect(() => onBeforeUnload(lastCallback), [lastCallback]);\n}\n","import { requestMeasure, requestMutation } from '../lib/fasterdom/fasterdom';\nimport safePlay from './safePlay';\n\ntype AbsoluteVideoOptions = {\n  position: { x: number; y: number };\n  noLoop?: boolean;\n  size: number;\n  style?: string;\n};\n\nexport default class AbsoluteVideo {\n  private video?: HTMLVideoElement;\n\n  private isPlaying = false;\n\n  constructor(\n    videoUrl: string,\n    private container: HTMLElement,\n    private options: AbsoluteVideoOptions,\n  ) {\n    this.video = document.createElement('video');\n    this.video.src = videoUrl;\n    this.video.disablePictureInPicture = true;\n    this.video.muted = true;\n    if (options.style) {\n      this.video.setAttribute('style', options.style);\n    }\n    this.video.style.position = 'absolute';\n    this.video.load();\n\n    if (!this.options.noLoop) {\n      this.video.loop = true;\n    }\n\n    requestMutation(() => {\n      this.container.appendChild(this.video!);\n\n      this.recalculatePositionAndSize();\n    });\n  }\n\n  public play() {\n    if (this.isPlaying || !this.video) return;\n    this.recalculatePositionAndSize();\n    if (this.video.paused) {\n      safePlay(this.video);\n    }\n    this.isPlaying = true;\n  }\n\n  public pause() {\n    if (!this.isPlaying || !this.video) return;\n    if (!this.video.paused) {\n      this.video.pause();\n    }\n    this.isPlaying = false;\n  }\n\n  public destroy() {\n    this.pause();\n    this.video?.remove();\n    this.video = undefined;\n  }\n\n  public updatePosition(position: AbsoluteVideoOptions['position']) {\n    this.options.position = position;\n    this.recalculatePositionAndSize();\n  }\n\n  private recalculatePositionAndSize() {\n    const { size, position: { x, y } } = this.options;\n    requestMeasure(() => {\n      if (!this.video) return;\n      const video = this.video;\n      const { width, height } = this.container.getBoundingClientRect();\n      requestMutation(() => {\n        video.style.left = `${Math.round(x * width)}px`;\n        video.style.top = `${Math.round(y * height)}px`;\n        video.style.width = `${size}px`;\n        video.style.height = `${size}px`;\n      });\n    });\n  }\n}\n","import {\n  useEffect, useLayoutEffect, useRef,\n} from '../../../../lib/teact/teact';\nimport { getGlobal } from '../../../../global';\n\nimport type { ApiSticker } from '../../../../api/types';\nimport type { Signal } from '../../../../util/signals';\n\nimport { requestMeasure } from '../../../../lib/fasterdom/fasterdom';\nimport { ensureRLottie } from '../../../../lib/rlottie/RLottie.async';\nimport { selectIsAlwaysHighPriorityEmoji } from '../../../../global/selectors';\nimport AbsoluteVideo from '../../../../util/AbsoluteVideo';\nimport {\n  addCustomEmojiInputRenderCallback,\n  getCustomEmojiMediaDataForInput,\n} from '../../../../util/emoji/customEmojiManager';\nimport { round } from '../../../../util/math';\nimport { hexToRgb } from '../../../../util/switchTheme';\nimport { REM } from '../../../common/helpers/mediaDimensions';\n\nimport useColorFilter from '../../../../hooks/stickers/useColorFilter';\nimport useDynamicColorListener from '../../../../hooks/stickers/useDynamicColorListener';\nimport useEffectWithPrevDeps from '../../../../hooks/useEffectWithPrevDeps';\nimport useLastCallback from '../../../../hooks/useLastCallback';\nimport useResizeObserver from '../../../../hooks/useResizeObserver';\nimport useThrottledCallback from '../../../../hooks/useThrottledCallback';\nimport useBackgroundMode from '../../../../hooks/window/useBackgroundMode';\nimport useDevicePixelRatio from '../../../../hooks/window/useDevicePixelRatio';\n\nconst SIZE = 1.25 * REM;\nconst THROTTLE_MS = 300;\n\ntype CustomEmojiPlayer = {\n  play: () => void;\n  pause: () => void;\n  destroy: () => void;\n  updatePosition: (x: number, y: number) => void;\n};\n\nexport default function useInputCustomEmojis(\n  getHtml: Signal<string>,\n  inputRef: React.RefObject<HTMLDivElement>,\n  sharedCanvasRef: React.RefObject<HTMLCanvasElement>,\n  sharedCanvasHqRef: React.RefObject<HTMLCanvasElement>,\n  absoluteContainerRef: React.RefObject<HTMLElement>,\n  prefixId: string,\n  canPlayAnimatedEmojis: boolean,\n  isReady?: boolean,\n  isActive?: boolean,\n) {\n  const customColor = useDynamicColorListener(inputRef, undefined, !isReady);\n  const colorFilter = useColorFilter(customColor, true);\n  const dpr = useDevicePixelRatio();\n  const playersById = useRef<Map<string, CustomEmojiPlayer>>(new Map());\n\n  const clearPlayers = useLastCallback((ids: string[]) => {\n    ids.forEach((id) => {\n      const player = playersById.current.get(id);\n      if (player) {\n        player.destroy();\n        playersById.current.delete(id);\n      }\n    });\n  });\n\n  const synchronizeElements = useLastCallback(() => {\n    if (!isReady || !inputRef.current || !sharedCanvasRef.current || !sharedCanvasHqRef.current) return;\n\n    const global = getGlobal();\n    const playerIdsToClear = new Set(playersById.current.keys());\n    const customEmojis = Array.from(inputRef.current.querySelectorAll<HTMLElement>('.custom-emoji'));\n\n    customEmojis.forEach((element) => {\n      if (!element.dataset.uniqueId) {\n        return;\n      }\n      const playerId = `${prefixId}${element.dataset.uniqueId}${customColor || ''}`;\n      const documentId = element.dataset.documentId!;\n\n      playerIdsToClear.delete(playerId);\n\n      const mediaUrl = getCustomEmojiMediaDataForInput(documentId);\n      if (!mediaUrl) {\n        return;\n      }\n\n      const canvasBounds = sharedCanvasRef.current!.getBoundingClientRect();\n      const elementBounds = element.getBoundingClientRect();\n      const x = round((elementBounds.left - canvasBounds.left) / canvasBounds.width, 4);\n      const y = round((elementBounds.top - canvasBounds.top) / canvasBounds.height, 4);\n\n      if (playersById.current.has(playerId)) {\n        const player = playersById.current.get(playerId)!;\n        player.updatePosition(x, y);\n        return;\n      }\n\n      const customEmoji = global.customEmojis.byId[documentId];\n      if (!customEmoji) {\n        return;\n      }\n      const isHq = customEmoji?.stickerSetInfo && selectIsAlwaysHighPriorityEmoji(global, customEmoji.stickerSetInfo);\n      const renderId = [\n        prefixId, documentId, customColor, dpr,\n      ].filter(Boolean).join('_');\n\n      createPlayer({\n        customEmoji,\n        sharedCanvasRef,\n        sharedCanvasHqRef,\n        absoluteContainerRef,\n        renderId,\n        viewId: playerId,\n        mediaUrl,\n        isHq,\n        position: { x, y },\n        textColor: customColor,\n        colorFilter,\n      }).then((animation) => {\n        if (canPlayAnimatedEmojis) {\n          animation.play();\n        }\n\n        playersById.current.set(playerId, animation);\n      });\n    });\n\n    clearPlayers(Array.from(playerIdsToClear));\n  });\n\n  useEffect(() => {\n    return addCustomEmojiInputRenderCallback(synchronizeElements);\n  }, [synchronizeElements]);\n\n  useEffect(() => {\n    const activePlayersById = playersById.current;\n    // Always clear players on unmount\n    return () => {\n      clearPlayers(Array.from(activePlayersById.keys()));\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!getHtml() || !inputRef.current || !sharedCanvasRef.current || !isActive || !isReady) {\n      clearPlayers(Array.from(playersById.current.keys()));\n      return;\n    }\n\n    // Wait one frame for DOM to update\n    requestMeasure(() => {\n      synchronizeElements();\n    });\n  }, [getHtml, synchronizeElements, inputRef, clearPlayers, sharedCanvasRef, isActive, isReady]);\n\n  useLayoutEffect(() => {\n    document.documentElement.style.setProperty('--input-custom-emoji-filter', colorFilter || 'none');\n  }, [colorFilter]);\n\n  useEffectWithPrevDeps(([prevCustomColor]) => {\n    if (prevCustomColor !== undefined && customColor !== prevCustomColor) {\n      synchronizeElements();\n    }\n  }, [customColor, synchronizeElements]);\n\n  const throttledSynchronizeElements = useThrottledCallback(\n    synchronizeElements,\n    [synchronizeElements],\n    THROTTLE_MS,\n    false,\n  );\n  useResizeObserver(sharedCanvasRef, throttledSynchronizeElements);\n  useEffectWithPrevDeps(([prevDpr]) => {\n    if (dpr !== prevDpr) {\n      clearPlayers(Array.from(playersById.current.keys()));\n      synchronizeElements();\n    }\n  }, [dpr, synchronizeElements]);\n\n  const freezeAnimation = useLastCallback(() => {\n    playersById.current.forEach((player) => {\n      player.pause();\n    });\n  });\n\n  const unfreezeAnimation = useLastCallback(() => {\n    if (!canPlayAnimatedEmojis) {\n      return;\n    }\n\n    playersById.current?.forEach((player) => {\n      player.play();\n    });\n  });\n\n  const unfreezeAnimationOnRaf = useLastCallback(() => {\n    requestMeasure(unfreezeAnimation);\n  });\n\n  // Pausing frame may not happen in background,\n  // so we need to make sure it happens right after focusing,\n  // then we can play again.\n  useBackgroundMode(freezeAnimation, unfreezeAnimationOnRaf);\n}\n\nasync function createPlayer({\n  customEmoji,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  absoluteContainerRef,\n  renderId,\n  viewId,\n  mediaUrl,\n  position,\n  isHq,\n  textColor,\n  colorFilter,\n}: {\n  customEmoji: ApiSticker;\n  sharedCanvasRef: React.RefObject<HTMLCanvasElement>;\n  sharedCanvasHqRef: React.RefObject<HTMLCanvasElement>;\n  absoluteContainerRef: React.RefObject<HTMLElement>;\n  renderId: string;\n  viewId: string;\n  mediaUrl: string;\n  position: { x: number; y: number };\n  isHq?: boolean;\n  textColor?: string;\n  colorFilter?: string;\n}): Promise<CustomEmojiPlayer> {\n  if (customEmoji.isLottie) {\n    const color = customEmoji.shouldUseTextColor && textColor ? hexToRgb(textColor) : undefined;\n    const RLottie = await ensureRLottie();\n    const lottie = RLottie.init(\n      mediaUrl,\n      isHq ? sharedCanvasHqRef.current! : sharedCanvasRef.current!,\n      renderId,\n      {\n        size: SIZE,\n        coords: position,\n        isLowPriority: !isHq,\n      },\n      viewId,\n      color ? [color.r, color.g, color.b] : undefined,\n    );\n\n    return {\n      play: () => lottie.play(),\n      pause: () => lottie.pause(),\n      destroy: () => lottie.removeView(viewId),\n      updatePosition: (x: number, y: number) => {\n        return lottie.setSharedCanvasCoords(viewId, { x, y });\n      },\n    };\n  }\n\n  if (customEmoji.isVideo) {\n    const style = customEmoji.shouldUseTextColor && colorFilter ? `filter: ${colorFilter};` : undefined;\n    const absoluteVideo = new AbsoluteVideo(\n      mediaUrl,\n      absoluteContainerRef.current!,\n      { size: SIZE, position, style },\n    );\n    return {\n      play: () => absoluteVideo.play(),\n      pause: () => absoluteVideo.pause(),\n      destroy: () => absoluteVideo.destroy(),\n      updatePosition: (x: number, y: number) => absoluteVideo.updatePosition({ x, y }),\n    };\n  }\n\n  throw new Error('Unsupported custom emoji type');\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './TextFormatter';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst TextFormatterAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const TextFormatter = useModuleLoader(Bundles.Extra, 'TextFormatter', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return TextFormatter ? <TextFormatter {...props} /> : undefined;\n};\n\nexport default TextFormatterAsync;\n","/* eslint-disable no-console */\nclass GrammarChecker {\n  private languageToolURL: string;\n\n  constructor() {\n    this.languageToolURL = 'https://api.languagetoolplus.com/v2/check';\n  }\n\n  public async saplingEditOverview(text: string) {\n    const params = new URLSearchParams({\n      text,\n      language: 'en-US',\n      useragent: 'standalone',\n      disabledRules: 'WHITESPACE_RULE',\n      mode: 'allButTextLevelOnly',\n      allowIncompleteResults: 'true',\n    });\n\n    try {\n      const response = await fetch(this.languageToolURL, {\n        headers: {\n          accept: 'application/json',\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: params.toString(),\n        method: 'POST',\n      });\n      const data = await response.json();\n\n      console.log('LanguageTool response:', JSON.stringify(data));\n      return data.matches.map((m:any) => ({\n        description: m.rule.description,\n        start: m.offset,\n        end: m.offset + m.length,\n        id: m.rule.id,\n        general_error_type: m.rule.category.id.toLowerCase(),\n        error_type: GrammarChecker.classifyTypeGramma(m.rule),\n        replacement: m.replacements[0]?.value || '',\n        isPremium: !!m.rule?.isPremium,\n        shortMessage: m.shortMessage || '',\n        original_text: text.substring(m.offset, m.offset + m.length),\n        sentence: m.sentence,\n        sentence_start: text.indexOf(m.sentence),\n      }));\n    } catch (err) {\n      console.log(err);\n      return [];\n    }\n  }\n\n  public static classifyTypeGramma(rule:any) {\n    const category = rule?.category?.id?.toLowerCase() || '';\n    return category;\n  }\n\n  public async check(text: string) {\n    const editorData = await this.saplingEditOverview(text);\n    return editorData;\n  }\n}\n\nexport const sapling = new GrammarChecker();\n","/* eslint-disable no-null/no-null */\n/* eslint-disable @typescript-eslint/naming-convention */\n/* eslint-disable new-cap */\nimport {\n  useCallback, useEffect, useRef, useState,\n} from 'react';\nimport { diff_match_patch } from 'diff-match-patch';\nimport debounce from 'lodash.debounce';\n\nimport { sapling } from '../../utils/grammar';\n\nexport interface CorrectionItem {\n  description:string;\n  end: number;\n  error_type: string;\n  general_error_type: string;\n  id: string;\n  replacement: string;\n  sentence: string;\n  sentence_start: number;\n  original_text:string;\n  start: number;\n}\n\nexport interface ErrorMarker {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n  start: number;\n  end: number;\n  replacement: string;\n  general_error_type: string;\n}\n\nconst dmp = new diff_match_patch();\n\nfunction getTextNodes(node: HTMLElement) {\n  const walker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT, null);\n  const textNodes: Node[] = [];\n  while (walker.nextNode()) textNodes.push(walker.currentNode);\n  return textNodes;\n}\n\nfunction getNodeForIndex(textNodes: Node[], index: number) {\n  let remaining = index;\n  for (const node of textNodes) {\n    if (node.nodeType !== Node.TEXT_NODE) continue;\n    const textLength = (node as Text).length;\n    if (remaining <= textLength) {\n      return { node, offset: remaining };\n    }\n    remaining -= textLength;\n  }\n  return { node: null, offset: 0 };\n}\n\nfunction getUnderlineOffset(rect: DOMRect, containerRect: DOMRect, editableDiv: HTMLElement) {\n  const computed = getComputedStyle(editableDiv);\n  const lineHeight = parseFloat(computed.lineHeight || '16');\n  return {\n    left: rect.left - containerRect.left,\n    top: rect.top - containerRect.top,\n    width: rect.width,\n    height: lineHeight,\n  };\n}\n\nfunction pruneInvalidRanges(text: string, corrections: CorrectionItem[]) {\n  return corrections.filter(({ start, end, original_text }) => {\n    if (end > text.length) return false;\n    const span = text.slice(start, end);\n    return span === original_text && /\\S/.test(span);\n  });\n}\n\nfunction updateErrorOffsetsWithInvalidate(\n  oldText: string,\n  newText: string,\n  errors: CorrectionItem[],\n): CorrectionItem[] {\n  const diffs = dmp.diff_main(oldText, newText);\n  dmp.diff_cleanupSemantic(diffs);\n\n  const newErrors: CorrectionItem[] = [];\n  let oldCursor = 0;\n\n  for (const err of errors) {\n    const start = err.start;\n    const end = err.end;\n    let valid = true;\n    let offset = 0;\n    oldCursor = 0;\n\n    for (const [op, text] of diffs) {\n      const len = text.length;\n\n      if (op === 0) {\n        oldCursor += len;\n      } else if (op === -1) {\n        // deletion\n        if (oldCursor + len <= start) {\n          offset -= len;\n          oldCursor += len;\n        } else if (oldCursor < end) {\n          valid = false;\n          break;\n        }\n      } else if (op === 1) {\n        // insertion\n        if (oldCursor <= start) {\n          offset += len;\n        } else if (oldCursor < end) {\n          valid = false;\n          break;\n        }\n      }\n    }\n\n    if (valid) {\n      newErrors.push({\n        ...err,\n        start: start + offset,\n        end: end + offset,\n      });\n    }\n  }\n\n  return newErrors;\n}\n\nexport function useGrammarChecker(\n  inputRef: React.RefObject<HTMLElement | null>,\n  setErrorMarkers: (m: ErrorMarker[]) => void,\n  {\n    delay = 1000,\n  }: {\n    delay?: number;\n  },\n) {\n  const [errorRanges, setErrorRanges] = useState<CorrectionItem[]>([]);\n  const [spalingLoading, setSpalingLoading] = useState(false);\n  const lastTextRef = useRef('');\n  const lastCheckTimeRef = useRef(Date.now());\n\n  const highLightErrors = useCallback((corrections: CorrectionItem[]) => {\n    const textarea = inputRef.current;\n    if (!textarea) return;\n\n    const textContent = textarea.textContent || '';\n    const textNodes = getTextNodes(textarea);\n    if (!textNodes) return;\n\n    setErrorMarkers([]);\n    const validRanges = pruneInvalidRanges(textContent, corrections);\n    const markers: ErrorMarker[] = [];\n\n    for (const item of validRanges) {\n      const {\n        start, end, replacement, general_error_type,\n      } = item;\n      const { node: startNode, offset: startOffset } = getNodeForIndex(textNodes, start);\n      const { node: endNode, offset: endOffset } = getNodeForIndex(textNodes, end);\n      if (!startNode || !endNode) continue;\n\n      const range = document.createRange();\n      range.setStart(startNode, startOffset);\n      range.setEnd(endNode, endOffset);\n\n      const rects = range.getClientRects();\n      const textareaRect = textarea.getBoundingClientRect();\n      for (const rect of rects) {\n        markers.push({\n          ...getUnderlineOffset(rect, textareaRect, textarea),\n          start,\n          end,\n          replacement,\n          general_error_type,\n        });\n      }\n    }\n\n    setErrorMarkers(markers);\n  }, [inputRef, setErrorMarkers]);\n\n  const checkTextInput = async () => {\n    const text = inputRef.current?.innerText || '';\n    setSpalingLoading(true);\n    const corrections = await sapling.check(text);\n    lastTextRef.current = text;\n    lastCheckTimeRef.current = Date.now();\n\n    setErrorRanges(corrections);\n    if (corrections.length > 0) {\n      highLightErrors(corrections);\n    } else {\n      setErrorMarkers([]);\n    }\n    setSpalingLoading(false);\n  };\n\n  const inputNlpRuleCheck = useRef(debounce(checkTextInput, delay, { leading: false, trailing: true })).current;\n\n  const handleInputChange = useCallback(() => {\n    const newText = inputRef.current?.innerText || '';\n    lastTextRef.current = newText;\n    if (errorRanges.length > 0) {\n      const updatedErrors = updateErrorOffsetsWithInvalidate(lastTextRef.current, newText, errorRanges);\n      setErrorRanges(updatedErrors);\n      highLightErrors(updatedErrors);\n    }\n    if (newText.trim().length === 0) {\n      setErrorRanges([]);\n      setErrorMarkers([]);\n      return;\n    }\n    inputNlpRuleCheck();\n  }, [errorRanges, highLightErrors, inputNlpRuleCheck, inputRef, setErrorMarkers]);\n\n  useEffect(() => {\n    const editor = inputRef.current;\n    editor?.addEventListener('input', handleInputChange);\n    return () => {\n      editor?.removeEventListener('input', handleInputChange);\n    };\n  }, [handleInputChange, inputRef]);\n\n  const fixError = (index: number) => {\n    const correction = errorRanges[index];\n    const el = inputRef.current;\n    if (!correction || !el || !correction.replacement) return;\n\n    const { start, end, replacement } = correction;\n    const fullText = el.innerText || '';\n\n    const newText = fullText.slice(0, start) + replacement + fullText.slice(end);\n    el.innerText = newText;\n\n    //  errorRanges\n    const newErrors: CorrectionItem[] = [];\n    const offsetChange = replacement.length - (end - start);\n\n    for (let i = 0; i < errorRanges.length; i++) {\n      if (i === index) continue;\n\n      const err = errorRanges[i];\n      if (err.start >= end) {\n        newErrors.push({\n          ...err,\n          start: err.start + offsetChange,\n          end: err.end + offsetChange,\n        });\n      } else {\n        newErrors.push(err);\n      }\n    }\n\n    setErrorRanges(newErrors);\n    lastTextRef.current = newText;\n    highLightErrors(newErrors);\n  };\n  //  \n  const fixAllErrors = () => {\n    const el = inputRef.current;\n    if (!el || errorRanges.length === 0) return;\n\n    let fullText = el.innerText || '';\n    const sorted = [...errorRanges].sort((a, b) => a.start - b.start);\n\n    let offset = 0;\n    for (const { start, end, replacement } of sorted) {\n      if (!replacement) continue;\n      const realStart = start + offset;\n      const realEnd = end + offset;\n      fullText = fullText.slice(0, realStart) + replacement + fullText.slice(realEnd);\n      offset += replacement.length - (end - start);\n    }\n\n    el.innerText = fullText;\n    lastTextRef.current = fullText;\n\n    setErrorRanges([]);\n    setErrorMarkers([]);\n    inputNlpRuleCheck();\n  };\n\n  return {\n    corrections: errorRanges,\n    spalingLoading,\n    fixError,\n    fixAllErrors,\n  };\n}\n","/* eslint-disable max-len */\n/* eslint-disable no-null/no-null */\nimport type { CSSProperties } from 'react';\nimport React, { memo, useRef } from 'react';\nimport { Popover } from 'antd';\n\nexport type OwnProps = {\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n  replacement:string;\n  generalErrorType: string;\n  errorIndex?: number;\n  handleFixError:(errorIndex:number)=>void;\n};\n\nconst TooltipContent = (\n  {\n    replacement,\n    errorIndex,\n    handleFixError,\n  }:\n  { replacement:string;\n    errorIndex:number;\n    handleFixError:(errorIndex:number)=>void;\n  },\n) => {\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  const handleClick = () => {\n    handleFixError(errorIndex);\n  };\n  return (\n    <div className=\"InputErrorTooltip__content\">\n      <div>ReplaceMent</div>\n      <div\n        className=\"px-[12px] py-[10px] rounded-[8px] cursor-pointer hover:bg-[#F4F4F5]\"\n        onClick={handleClick}\n      >\n        {replacement}\n      </div>\n    </div>\n  );\n};\n\nconst InputErrorTooltip = (props: OwnProps) => {\n  const {\n    top, left, width, height, replacement, generalErrorType, errorIndex, handleFixError,\n  } = props;\n  const triggerRef = useRef<HTMLDivElement>(null);\n  return (\n    <div\n      className=\"absolute\"\n      style={{\n        left: `${left}px`, top: `${top}px`, width: `${width}px`, height: `${height}px`,\n      } as CSSProperties}\n    >\n      <Popover\n        placement=\"top\"\n        content={(\n          <TooltipContent\n            replacement={replacement}\n            errorIndex={errorIndex!!}\n            handleFixError={handleFixError}\n          />\n        )}\n      >\n        <div\n          ref={triggerRef}\n          className={`h-full w-full border-b-[2px] ${generalErrorType.toLocaleLowerCase() === 'typos' ? 'border-red-500/60' : 'border-[#FFD633]'}`}\n        />\n      </Popover>\n    </div>\n  );\n};\n\nexport default memo(InputErrorTooltip);\n","/* eslint-disable no-null/no-null */\n/* eslint-disable @typescript-eslint/naming-convention */\n/* eslint-disable max-len */\n/* eslint-disable @typescript-eslint/no-use-before-define */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { Button, Modal } from 'antd';\n\nimport type { ErrorMarker } from './useGrammarChecker';\n\nimport { LeftOutlined, RightOutlined } from '../../icons';\nimport { type GrammarlyCheckItem } from '../../utils/grammarly';\nimport { useGrammarChecker } from './useGrammarChecker';\n\nimport InputErrorTooltip from './InputErrorTooltip';\nimport HighlightedText from './tabs/HighlightedText';\n\nimport './InputGrammar.scss';\n\ntype CorrectionItem = {\n  description:string;\n  end: number;\n  error_type: string;\n  general_error_type: string;\n  id: string;\n  replacement: string;\n  sentence: string;\n  sentence_start: number;\n  original_text:string;\n  start: number;\n};\nexport interface InputGrammerProps {\n  inputRef: React.RefObject<HTMLDivElement | null>;\n}\nconst InputGrammar = (props:InputGrammerProps) => {\n  const { inputRef } = props;\n  const [errorMarkers, setErrorMarkers] = useState<ErrorMarker[]>([]);\n  const [errorsModalVisible, setErrorsModalVisible] = useState(false);\n  const [errorsModalPosition, setErrorsModalPosition] = useState<{ left: number; top: number }>({ left: 0, top: 0 });\n  const {\n    corrections, spalingLoading, fixError, fixAllErrors,\n  } = useGrammarChecker(inputRef, setErrorMarkers, {});\n  const showErrorModal = () => {\n    if (inputRef && inputRef.current) {\n      const inputReact = inputRef.current.getBoundingClientRect();\n      const { left, top } = inputReact;\n      setErrorsModalPosition({ left, top: top - 240 });\n      setErrorsModalVisible(true);\n    }\n  };\n  const closeErrorModal = useCallback(() => {\n    setErrorsModalVisible(false);\n  }, []);\n  return (\n    <>\n      <div className=\"absolute left-0 top-0 pointer-events-auto\">\n        {errorMarkers.map((item, index) => {\n          return (\n            <InputErrorTooltip\n              left={item.left}\n              top={item.top}\n              width={item.width}\n              height={item.height}\n              replacement={item.replacement}\n              errorIndex={index}\n              generalErrorType={item.general_error_type}\n              handleFixError={fixError}\n            />\n          );\n        })}\n      </div>\n      <div className=\"sapling-badge-container\">\n        <div className=\"sapling-status-container\">\n          <div className=\"sapling-badge-errors\">\n            {errorMarkers.length > 0 && (\n              <div className=\"sapling-badge-errors-count\" onClick={showErrorModal}>\n                {errorMarkers.length}\n              </div>\n            )}\n          </div>\n          {spalingLoading && (<div className=\"sapling-badge-spinner\" />)}\n        </div>\n      </div>\n      <Modal\n        className=\"sapling-errors-modal\"\n        closable={false}\n        footer={null}\n        open={errorsModalVisible}\n        onCancel={closeErrorModal}\n        destroyOnClose\n        style={{ top: errorsModalPosition.top, left: errorsModalPosition.left } as React.CSSProperties}\n      >\n        <ErrorsReview\n          errorRanges={corrections}\n          handleFixError={fixError}\n          handleFixAllErrors={fixAllErrors}\n          onClose={closeErrorModal}\n        />\n      </Modal>\n    </>\n  );\n};\n\nconst ErrorsReview = ({\n  errorRanges, onClose, handleFixAllErrors, handleFixError,\n}:{\n  errorRanges:CorrectionItem[];\n  onClose:()=>void;\n  handleFixAllErrors:()=>void;\n  handleFixError:(errorIndex:number)=>void; }) => {\n  const [currentErrorIndex, setCurrentErrorIndex] = useState(0);\n  const [currentErrorRange, setCurrentErrorRange] = useState<CorrectionItem>(errorRanges[0]);\n  const [currentError, setCurrentError] = useState<GrammarlyCheckItem[]>([]);\n  const [currentSentence, setCurrentSentence] = useState('');\n\n  useEffect(() => {\n    const curRange = errorRanges[currentErrorIndex];\n    if (curRange) {\n      setCurrentErrorRange(curRange);\n      setCurrentError([{\n        description: curRange.description,\n        offset: curRange.start - curRange.sentence_start,\n        length: curRange.end - curRange.start,\n        originalText: curRange.original_text,\n        remove_segment: false,\n        suggestions: [curRange.replacement],\n      }]);\n      setCurrentSentence(curRange.sentence);\n    }\n  }, [currentErrorIndex, errorRanges]);\n\n  const handleClickPrev = () => {\n    if (currentErrorIndex > 0) {\n      setCurrentErrorIndex(currentErrorIndex - 1);\n    }\n  };\n  const handleClickNext = () => {\n    if (currentErrorIndex < errorRanges.length - 1) {\n      setCurrentErrorIndex(currentErrorIndex + 1);\n    }\n  };\n  const handleAccept = useCallback(() => {\n    handleFixError(currentErrorIndex);\n    if (errorRanges.length === 1) {\n      onClose();\n    }\n    if (currentErrorIndex === errorRanges.length - 1) {\n      onClose();\n    }\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, [currentErrorIndex, currentErrorRange]);\n\n  const handleAcceptAll = useCallback(() => {\n    handleFixAllErrors();\n    onClose();\n  }, [handleFixAllErrors, onClose]);\n\n  return (\n    <div className=\"h-[190px] flex flex-col overflow-hidden\">\n      <div className=\"flex flex-row items-center justify-between\">\n        <h3>Review suggestions</h3>\n        <div className=\"h-[26px] rounded-[6px] overflow-hidden flex flex-row\">\n          <div className=\"w-[21px] bg-[#F1F1F1] cursor-pointer\" onClick={handleClickPrev}>\n            <LeftOutlined />\n          </div>\n          <div className=\"px-[5px] text-[#979797]\">{currentErrorIndex + 1}/{errorRanges.length}</div>\n          <div className=\"w-[21px] bg-[#F1F1F1] cursor-pointer\" onClick={handleClickNext}>\n            <RightOutlined />\n          </div>\n        </div>\n      </div>\n      <div className=\"flex-1 overflow-hidden flex flex-col\">\n        <div className=\"flex flex-row items-center gap-[8px]\">\n          <div className=\"w-[8px] h-[8px] rounded-full bg-[#FF9900]\" />\n          <span className=\"text-[14px] text-[#959595]\">Improve your text</span>\n        </div>\n        <div className=\"flex-1 overflow-auto\">\n          {currentError ? (\n            <HighlightedText text={currentSentence} errors={currentError} />\n          ) : undefined}\n        </div>\n      </div>\n      <div className=\"flex flex-row items-center justify-between  pt-[10px] border-t-[1px] border-black/10\">\n        <div\n          className=\"text-[#7D40FF] border-[1px] border-[#7D40FF] rounded-[6px] px-[8px] py-[5px]\"\n          onClick={handleAcceptAll}\n        >\n          Accept all ({errorRanges.length})\n        </div>\n        <div className=\"flex flex-row items-center gap-[8px]\">\n          {/* <Button color=\"default\" variant=\"text\">\n            Dismiss\n          </Button> */}\n          <Button color=\"purple\" variant=\"solid\" onClick={handleAccept}>\n            Accept\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default InputGrammar;\n","/* eslint-disable teactn/no-unused-prop-types */\n/* eslint-disable react/no-unused-prop-types */\n/* eslint-disable @typescript-eslint/no-use-before-define */\n/* eslint-disable @typescript-eslint/no-shadow */\n/* eslint-disable no-null/no-null */\nimport React, {\n  useEffect, useRef,\n} from '../../../../lib/teact/teact';\n\nimport type { InputGrammerProps } from './InputGrammar';\n\nimport { injectComponent } from '../../../../lib/injectComponent';\n\nimport InputGrammar from './InputGrammar';\n\nconst injectMessageAI = injectComponent(InputGrammar);\nconst InputGrammarWrapper = (props:InputGrammerProps) => {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  useEffect(() => {\n    let injected: { unmount: () => void } | undefined;\n    if (containerRef.current) {\n      injected = injectMessageAI(containerRef.current, { ...props });\n    }\n    return () => {\n      injected?.unmount();\n    };\n  }, [props]);\n  return (\n    <div className=\"absolute left-0 top-0 w-full h-full pointer-events-none\" ref={containerRef} />\n  );\n};\n\nexport default InputGrammarWrapper;\n","/* eslint-disable max-len */\n// eslint-disable-next-line simple-import-sort/imports\nimport type { ChangeEvent, RefObject } from 'react';\n// import { Sapling } from '@saplingai/sapling-js/observer';\nimport type { FC, TeactNode } from '../../../lib/teact/teact';\nimport React, {\n  getIsHeavyAnimating,\n  memo, useEffect, useLayoutEffect,\n  useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { ApiInputMessageReplyInfo } from '../../../api/types';\nimport type {\n  IAnchorPosition, MessageListType, SharedSettings, ThreadId,\n} from '../../../types';\nimport type { Signal } from '../../../util/signals';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport { requestForcedReflow, requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { selectCanPlayAnimatedEmojis, selectDraft, selectIsInSelectMode } from '../../../global/selectors';\nimport { selectSharedSettings } from '../../../global/selectors/sharedState';\nimport {\n  IS_ANDROID, IS_EMOJI_SUPPORTED, IS_IOS, IS_TOUCH_ENV,\n} from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport captureKeyboardListeners from '../../../util/captureKeyboardListeners';\nimport { getIsDirectTextInputDisabled } from '../../../util/directInputManager';\nimport parseEmojiOnlyString from '../../../util/emoji/parseEmojiOnlyString';\nimport focusEditableElement from '../../../util/focusEditableElement';\nimport { debounce, fastRaf } from '../../../util/schedulers';\nimport renderText from '../../common/helpers/renderText';\nimport { isSelectionInsideInput } from './helpers/selection';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useDerivedState from '../../../hooks/useDerivedState';\nimport useFlag from '../../../hooks/useFlag';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useInputCustomEmojis from './hooks/useInputCustomEmojis';\n\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\nimport TextTimer from '../../ui/TextTimer';\nimport TextFormatter from './TextFormatter.async';\nimport InputGrammarWrapper from '../../chatAssistant/component/input-grammar/InputGrammarWrapper';\n\n// eslint-disable-next-line import/no-relative-packages\n\nconst CONTEXT_MENU_CLOSE_DELAY_MS = 100;\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 350;\nconst TRANSITION_DURATION_FACTOR = 50;\n\nconst SCROLLER_CLASS = 'input-scroller';\nconst INPUT_WRAPPER_CLASS = 'message-input-wrapper';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  id: string;\n  chatId: string;\n  threadId: ThreadId;\n  isAttachmentModalInput?: boolean;\n  isStoryInput?: boolean;\n  customEmojiPrefix: string;\n  editableInputId?: string;\n  isReady: boolean;\n  isActive: boolean;\n  getHtml: Signal<string>;\n  placeholder: TeactNode | string;\n  timedPlaceholderLangKey?: string;\n  timedPlaceholderDate?: number;\n  forcedPlaceholder?: string;\n  noFocusInterception?: boolean;\n  canAutoFocus: boolean;\n  shouldSuppressFocus?: boolean;\n  shouldSuppressTextFormatter?: boolean;\n  canSendPlainText?: boolean;\n  onUpdate: (html: string) => void;\n  onSuppressedFocus?: () => void;\n  onSend: () => void;\n  onScroll?: (event: React.UIEvent<HTMLElement>) => void;\n  captionLimit?: number;\n  onFocus?: NoneToVoidFunction;\n  onBlur?: NoneToVoidFunction;\n  isNeedPremium?: boolean;\n  messageListType?: MessageListType;\n};\n\ntype StateProps = {\n  replyInfo?: ApiInputMessageReplyInfo;\n  isSelectModeActive?: boolean;\n  messageSendKeyCombo?: SharedSettings['messageSendKeyCombo'];\n  canPlayAnimatedEmojis: boolean;\n};\n\nconst MAX_ATTACHMENT_MODAL_INPUT_HEIGHT = 160;\nconst MAX_STORY_MODAL_INPUT_HEIGHT = 128;\nconst TAB_INDEX_PRIORITY_TIMEOUT = 2000;\n// Heuristics allowing the user to make a triple click\nconst SELECTION_RECALCULATE_DELAY_MS = 260;\nconst TEXT_FORMATTER_SAFE_AREA_PX = 140;\n// For some reason Safari inserts `<br>` after user removes text from input\nconst SAFARI_BR = '<br>';\nconst IGNORE_KEYS = [\n  'Esc', 'Escape', 'Enter', 'PageUp', 'PageDown', 'Meta', 'Alt', 'Ctrl', 'ArrowDown', 'ArrowUp', 'Control', 'Shift',\n];\n\nfunction clearSelection() {\n  const selection = window.getSelection();\n  if (!selection) {\n    return;\n  }\n\n  if (selection.removeAllRanges) {\n    selection.removeAllRanges();\n  } else if (selection.empty) {\n    selection.empty();\n  }\n}\n\nconst MessageInput: FC<OwnProps & StateProps> = ({\n  ref,\n  id,\n  chatId,\n  captionLimit,\n  isAttachmentModalInput,\n  isStoryInput,\n  customEmojiPrefix,\n  editableInputId,\n  isReady,\n  isActive,\n  getHtml,\n  placeholder,\n  timedPlaceholderLangKey,\n  timedPlaceholderDate,\n  forcedPlaceholder,\n  canSendPlainText,\n  canAutoFocus,\n  noFocusInterception,\n  shouldSuppressFocus,\n  shouldSuppressTextFormatter,\n  replyInfo,\n  isSelectModeActive,\n  canPlayAnimatedEmojis,\n  messageSendKeyCombo,\n  onUpdate,\n  onSuppressedFocus,\n  onSend,\n  onScroll,\n  onFocus,\n  onBlur,\n  isNeedPremium,\n  messageListType,\n}) => {\n  const {\n    editLastMessage,\n    replyToNextMessage,\n    showAllowedMessageTypesNotification,\n    openPremiumModal,\n  } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  let inputRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    inputRef = ref;\n  }\n\n  // eslint-disable-next-line no-null/no-null\n  const selectionTimeoutRef = useRef<number>(null);\n  // eslint-disable-next-line no-null/no-null\n  const cloneRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const scrollerCloneRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const sharedCanvasRef = useRef<HTMLCanvasElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const sharedCanvasHqRef = useRef<HTMLCanvasElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const absoluteContainerRef = useRef<HTMLDivElement>(null);\n\n  const oldLang = useOldLang();\n  const isContextMenuOpenRef = useRef(false);\n  const [isTextFormatterOpen, openTextFormatter, closeTextFormatter] = useFlag();\n  const [textFormatterAnchorPosition, setTextFormatterAnchorPosition] = useState<IAnchorPosition>();\n  const [selectedRange, setSelectedRange] = useState<Range>();\n  const [isTextFormatterDisabled, setIsTextFormatterDisabled] = useState<boolean>(false);\n  const { isMobile } = useAppLayout();\n  const isMobileDevice = isMobile && (IS_IOS || IS_ANDROID);\n\n  const [shouldDisplayTimer, setShouldDisplayTimer] = useState(false);\n\n  useEffect(() => {\n    setShouldDisplayTimer(Boolean(timedPlaceholderLangKey && timedPlaceholderDate));\n  }, [timedPlaceholderDate, timedPlaceholderLangKey]);\n\n  // useEffect(() => {\n  //   Sapling.init({\n  //     key: 'WCFKUN3GJEEC1FSEPFH6Q7T9R5C67QTE',\n  //     endpointHostname: 'https://api.sapling.ai',\n  //     editPathname: '/api/v1/edits',\n  //     statusBadge: true,\n  //     mode: 'dev',\n  //   });\n\n  //   const editor = inputRef.current;\n  //   if (editor) {\n  //     Sapling.observe(editor);\n  //   }\n  // });\n\n  const handleTimerEnd = useLastCallback(() => {\n    setShouldDisplayTimer(false);\n  });\n\n  useInputCustomEmojis(\n    getHtml,\n    inputRef,\n    sharedCanvasRef,\n    sharedCanvasHqRef,\n    absoluteContainerRef,\n    customEmojiPrefix,\n    canPlayAnimatedEmojis,\n    isReady,\n    isActive,\n  );\n\n  const maxInputHeight = isAttachmentModalInput\n    ? MAX_ATTACHMENT_MODAL_INPUT_HEIGHT\n    : isStoryInput ? MAX_STORY_MODAL_INPUT_HEIGHT : (isMobile ? 256 : 416);\n  const updateInputHeight = useLastCallback((willSend = false) => {\n    // Defer to avoid animation/layout conflicts during DOM updates\n    fastRaf(() => {\n      requestForcedReflow(() => {\n        const scroller = inputRef.current!.closest<HTMLDivElement>(`.${SCROLLER_CLASS}`)!;\n        const currentHeight = Number(scroller.style.height.replace('px', ''));\n        const clone = scrollerCloneRef.current!;\n        const { scrollHeight } = clone;\n        const newHeight = Math.min(scrollHeight, maxInputHeight);\n\n        if (newHeight === currentHeight) {\n          return undefined;\n        }\n\n        const isOverflown = scrollHeight > maxInputHeight;\n\n        function exec() {\n          const transitionDuration = Math.round(\n            TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight)),\n          );\n          scroller.style.height = `${newHeight}px`;\n          scroller.style.transitionDuration = `${transitionDuration}ms`;\n          scroller.classList.toggle('overflown', isOverflown);\n        }\n\n        if (willSend) {\n          // Delay to next frame to sync with sending animation\n          requestMutation(exec);\n          return undefined;\n        } else {\n          return exec;\n        }\n      });\n    });\n  });\n\n  useLayoutEffect(() => {\n    if (!isAttachmentModalInput) return;\n    updateInputHeight(false);\n  }, [isAttachmentModalInput, updateInputHeight]);\n\n  const htmlRef = useRef(getHtml());\n  useLayoutEffect(() => {\n    const html = isActive ? getHtml() : '';\n\n    if (html !== inputRef.current!.innerHTML) {\n      inputRef.current!.innerHTML = html;\n      inputRef.current!.dispatchEvent(new Event('input', { bubbles: true }));\n    }\n\n    if (html !== cloneRef.current!.innerHTML) {\n      cloneRef.current!.innerHTML = html;\n    }\n\n    if (html !== htmlRef.current) {\n      htmlRef.current = html;\n\n      updateInputHeight(!html);\n    }\n  }, [getHtml, isActive, updateInputHeight]);\n\n  const chatIdRef = useRef(chatId);\n  chatIdRef.current = chatId;\n  const focusInput = useLastCallback(() => {\n    if (!inputRef.current || isNeedPremium) {\n      return;\n    }\n\n    if (getIsHeavyAnimating()) {\n      setTimeout(focusInput, FOCUS_DELAY_MS);\n      return;\n    }\n\n    focusEditableElement(inputRef.current!);\n  });\n\n  const handleCloseTextFormatter = useLastCallback(() => {\n    closeTextFormatter();\n    clearSelection();\n  });\n\n  function checkSelection() {\n    // Disable the formatter on iOS devices for now.\n    if (IS_IOS) {\n      return false;\n    }\n\n    const selection = window.getSelection();\n    if (!selection || !selection.rangeCount || isContextMenuOpenRef.current) {\n      closeTextFormatter();\n      if (IS_ANDROID) {\n        setIsTextFormatterDisabled(false);\n      }\n      return false;\n    }\n\n    const selectionRange = selection.getRangeAt(0);\n    const selectedText = selectionRange.toString().trim();\n    if (\n      shouldSuppressTextFormatter\n      || !isSelectionInsideInput(selectionRange, editableInputId || EDITABLE_INPUT_ID)\n      || !selectedText\n      || parseEmojiOnlyString(selectedText)\n      || !selectionRange.START_TO_END\n    ) {\n      closeTextFormatter();\n      return false;\n    }\n\n    return true;\n  }\n\n  function processSelection() {\n    if (!checkSelection()) {\n      return;\n    }\n\n    if (isTextFormatterDisabled) {\n      return;\n    }\n\n    const selectionRange = window.getSelection()!.getRangeAt(0);\n    const selectionRect = selectionRange.getBoundingClientRect();\n    const scrollerRect = inputRef.current!.closest<HTMLDivElement>(`.${SCROLLER_CLASS}`)!.getBoundingClientRect();\n\n    let x = (selectionRect.left + selectionRect.width / 2) - scrollerRect.left;\n\n    if (x < TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = TEXT_FORMATTER_SAFE_AREA_PX;\n    } else if (x > scrollerRect.width - TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = scrollerRect.width - TEXT_FORMATTER_SAFE_AREA_PX;\n    }\n\n    setTextFormatterAnchorPosition({\n      x,\n      y: selectionRect.top - scrollerRect.top,\n    });\n\n    setSelectedRange(selectionRange);\n    openTextFormatter();\n  }\n\n  function processSelectionWithTimeout() {\n    if (selectionTimeoutRef.current) {\n      window.clearTimeout(selectionTimeoutRef.current);\n    }\n    // Small delay to allow browser properly recalculate selection\n    selectionTimeoutRef.current = window.setTimeout(processSelection, SELECTION_RECALCULATE_DELAY_MS);\n  }\n\n  function handleMouseDown(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (e.button !== 2) {\n      const listenerEl = e.currentTarget.closest(`.${INPUT_WRAPPER_CLASS}`) || e.target;\n\n      listenerEl.addEventListener('mouseup', processSelectionWithTimeout, { once: true });\n      return;\n    }\n\n    if (isContextMenuOpenRef.current) {\n      return;\n    }\n\n    isContextMenuOpenRef.current = true;\n\n    function handleCloseContextMenu(e2: KeyboardEvent | MouseEvent) {\n      if (e2 instanceof KeyboardEvent && e2.key !== 'Esc' && e2.key !== 'Escape') {\n        return;\n      }\n\n      setTimeout(() => {\n        isContextMenuOpenRef.current = false;\n      }, CONTEXT_MENU_CLOSE_DELAY_MS);\n\n      window.removeEventListener('keydown', handleCloseContextMenu);\n      window.removeEventListener('mousedown', handleCloseContextMenu);\n    }\n\n    document.addEventListener('mousedown', handleCloseContextMenu);\n    document.addEventListener('keydown', handleCloseContextMenu);\n  }\n\n  function handleKeyDown(e: React.KeyboardEvent<HTMLDivElement>) {\n    // https://levelup.gitconnected.com/javascript-events-handlers-keyboard-and-load-events-1b3e46a6b0c3#1960\n    const { isComposing } = e;\n\n    const html = getHtml();\n    if (!isComposing && !html && (e.metaKey || e.ctrlKey)) {\n      const targetIndexDelta = e.key === 'ArrowDown' ? 1 : e.key === 'ArrowUp' ? -1 : undefined;\n      if (targetIndexDelta) {\n        e.preventDefault();\n\n        replyToNextMessage({ targetIndexDelta });\n        return;\n      }\n    }\n\n    if (!isComposing && e.key === 'Enter' && !e.shiftKey) {\n      if (\n        !isMobileDevice\n        && (\n          (messageSendKeyCombo === 'enter' && !e.shiftKey)\n          || (messageSendKeyCombo === 'ctrl-enter' && (e.ctrlKey || e.metaKey))\n        )\n      ) {\n        e.preventDefault();\n\n        closeTextFormatter();\n        onSend();\n      }\n    } else if (!isComposing && e.key === 'ArrowUp' && !html && !e.metaKey && !e.ctrlKey && !e.altKey) {\n      e.preventDefault();\n      editLastMessage();\n    } else {\n      e.target.addEventListener('keyup', processSelectionWithTimeout, { once: true });\n    }\n  }\n  function handleChange(e: ChangeEvent<HTMLDivElement>) {\n    const { innerHTML, textContent } = e.currentTarget;\n\n    onUpdate(innerHTML === SAFARI_BR ? '' : innerHTML);\n\n    // Reset focus on the input to remove any active styling when input is cleared\n    if (\n      !IS_TOUCH_ENV\n      && (!textContent || !textContent.length)\n      // When emojis are not supported, innerHTML contains an emoji img tag that doesn't exist in the textContext\n      && !(!IS_EMOJI_SUPPORTED && innerHTML.includes('emoji-small'))\n      && !(innerHTML.includes('custom-emoji'))\n    ) {\n      const selection = window.getSelection()!;\n      if (selection) {\n        inputRef.current!.blur();\n        selection.removeAllRanges();\n        focusEditableElement(inputRef.current!, true);\n      }\n    }\n  }\n\n  function handleAndroidContextMenu(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (!checkSelection()) {\n      return;\n    }\n\n    setIsTextFormatterDisabled(!isTextFormatterDisabled);\n\n    if (!isTextFormatterDisabled) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      processSelection();\n    } else {\n      closeTextFormatter();\n    }\n  }\n\n  function handleClick() {\n    if (isAttachmentModalInput || canSendPlainText || (isStoryInput && isNeedPremium)) return;\n    showAllowedMessageTypesNotification({ chatId, messageListType });\n  }\n\n  const handleOpenPremiumModal = useLastCallback(() => openPremiumModal());\n\n  useEffect(() => {\n    if (IS_TOUCH_ENV) {\n      return;\n    }\n\n    if (canAutoFocus) {\n      focusInput();\n    }\n  }, [chatId, focusInput, replyInfo, canAutoFocus]);\n\n  useEffect(() => {\n    if (\n      !chatId\n      || editableInputId !== EDITABLE_INPUT_ID\n      || noFocusInterception\n      || isMobileDevice\n      || isSelectModeActive\n    ) {\n      return undefined;\n    }\n\n    const handleDocumentKeyDown = (e: KeyboardEvent) => {\n      if (getIsDirectTextInputDisabled()) {\n        return;\n      }\n\n      const { key } = e;\n      const target = e.target as HTMLElement | undefined;\n\n      if (!target || IGNORE_KEYS.includes(key)) {\n        return;\n      }\n\n      const input = inputRef.current!;\n      const isSelectionCollapsed = document.getSelection()?.isCollapsed;\n\n      if (\n        ((key.startsWith('Arrow') || (e.shiftKey && key === 'Shift')) && !isSelectionCollapsed)\n        || (e.code === 'KeyC' && (e.ctrlKey || e.metaKey) && target.tagName !== 'INPUT')\n      ) {\n        return;\n      }\n\n      if (\n        input\n        && target !== input\n        && target.tagName !== 'INPUT'\n        && target.tagName !== 'TEXTAREA'\n        && !target.isContentEditable\n      ) {\n        focusEditableElement(input, true, true);\n\n        const newEvent = new KeyboardEvent(e.type, e as any);\n        input.dispatchEvent(newEvent);\n      }\n    };\n\n    document.addEventListener('keydown', handleDocumentKeyDown, true);\n\n    return () => {\n      document.removeEventListener('keydown', handleDocumentKeyDown, true);\n    };\n  }, [chatId, editableInputId, isMobileDevice, isSelectModeActive, noFocusInterception]);\n\n  useEffect(() => {\n    const captureFirstTab = debounce((e: KeyboardEvent) => {\n      if (e.key === 'Tab' && !getIsDirectTextInputDisabled()) {\n        e.preventDefault();\n        requestMutation(focusInput);\n      }\n    }, TAB_INDEX_PRIORITY_TIMEOUT, true, false);\n\n    return captureKeyboardListeners({ onTab: captureFirstTab });\n  }, [focusInput]);\n\n  useEffect(() => {\n    const input = inputRef.current!;\n\n    function suppressFocus() {\n      input.blur();\n    }\n\n    if (shouldSuppressFocus) {\n      input.addEventListener('focus', suppressFocus);\n    }\n\n    return () => {\n      input.removeEventListener('focus', suppressFocus);\n    };\n  }, [shouldSuppressFocus]);\n\n  const isTouched = useDerivedState(() => Boolean(isActive && getHtml()), [isActive, getHtml]);\n\n  const className = buildClassName(\n    'form-control allow-selection',\n    isTouched && 'touched',\n    shouldSuppressFocus && 'focus-disabled',\n  );\n\n  const inputScrollerContentClass = buildClassName('input-scroller-content', isNeedPremium && 'is-need-premium');\n  const placeholderAriaLabel = typeof placeholder === 'string' ? placeholder : undefined;\n\n  return (\n    <div id={id} onClick={shouldSuppressFocus ? onSuppressedFocus : undefined} dir={oldLang.isRtl ? 'rtl' : undefined}>\n      <div\n        className={buildClassName('custom-scroll', SCROLLER_CLASS, isNeedPremium && 'is-need-premium')}\n        onScroll={onScroll}\n        onClick={!isAttachmentModalInput && !canSendPlainText ? handleClick : undefined}\n      >\n        <div className={inputScrollerContentClass}>\n          <InputGrammarWrapper inputRef={inputRef} />\n          <div\n            ref={inputRef}\n            id={editableInputId || EDITABLE_INPUT_ID}\n            className={className}\n            contentEditable={isAttachmentModalInput || canSendPlainText}\n            role=\"textbox\"\n            dir=\"auto\"\n            tabIndex={0}\n            onClick={focusInput}\n            onChange={handleChange}\n            onKeyDown={handleKeyDown}\n            onMouseDown={handleMouseDown}\n            onContextMenu={IS_ANDROID ? handleAndroidContextMenu : undefined}\n            onTouchCancel={IS_ANDROID ? processSelectionWithTimeout : undefined}\n            aria-label={placeholderAriaLabel}\n            onFocus={!isNeedPremium ? onFocus : undefined}\n            onBlur={!isNeedPremium ? onBlur : undefined}\n          />\n          {!forcedPlaceholder && (\n            <span\n              className={buildClassName(\n                'placeholder-text',\n                !isAttachmentModalInput && !canSendPlainText && 'with-icon',\n                isNeedPremium && 'is-need-premium',\n              )}\n              dir=\"auto\"\n            >\n              {!isAttachmentModalInput && !canSendPlainText\n                && <Icon name=\"lock-badge\" className=\"placeholder-icon\" />}\n              {shouldDisplayTimer ? (\n                <TextTimer langKey={timedPlaceholderLangKey!} endsAt={timedPlaceholderDate!} onEnd={handleTimerEnd} />\n              ) : placeholder}\n              {isStoryInput && isNeedPremium && (\n                <Button className=\"unlock-button\" size=\"tiny\" color=\"adaptive\" onClick={handleOpenPremiumModal}>\n                  {oldLang('StoryRepliesLockedButton')}\n                </Button>\n              )}\n            </span>\n          )}\n          <canvas ref={sharedCanvasRef} className=\"shared-canvas\" />\n          <canvas ref={sharedCanvasHqRef} className=\"shared-canvas\" />\n          <div ref={absoluteContainerRef} className=\"absolute-video-container\" />\n        </div>\n      </div>\n      <div\n        ref={scrollerCloneRef}\n        className={buildClassName('custom-scroll',\n          SCROLLER_CLASS,\n          'clone',\n          isNeedPremium && 'is-need-premium')}\n      >\n        <div className={inputScrollerContentClass}>\n          <div ref={cloneRef} className={buildClassName(className, 'clone')} dir=\"auto\" />\n        </div>\n      </div>\n      {captionLimit !== undefined && (\n        <div className=\"max-length-indicator\" dir=\"auto\">\n          {captionLimit}\n        </div>\n      )}\n      <TextFormatter\n        isOpen={isTextFormatterOpen}\n        anchorPosition={textFormatterAnchorPosition}\n        selectedRange={selectedRange}\n        setSelectedRange={setSelectedRange}\n        onClose={handleCloseTextFormatter}\n      />\n      {forcedPlaceholder && <span className=\"forced-placeholder\">{renderText(forcedPlaceholder!)}</span>}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId, threadId }: OwnProps): StateProps => {\n    const { messageSendKeyCombo } = selectSharedSettings(global);\n\n    return {\n      messageSendKeyCombo,\n      replyInfo: chatId && threadId ? selectDraft(global, chatId, threadId)?.replyInfo : undefined,\n      isSelectModeActive: selectIsInSelectMode(global),\n      canPlayAnimatedEmojis: selectCanPlayAnimatedEmojis(global),\n    };\n  },\n)(MessageInput));\n","import { useLayoutEffect, useMemo, useRef } from '../lib/teact/teact';\n\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport cycleRestrict from '../util/cycleRestrict';\nimport { preloadImage } from '../util/files';\nimport { MAX_WORKERS, requestMediaWorker } from '../util/launchMediaWorkers';\nimport useLastCallback from './useLastCallback';\n\nconst RADIUS_RATIO = 0.1; // Use 10% of the smallest dimension as the blur radius\n\nlet lastWorkerIndex = -1;\n\nexport default function useOffscreenCanvasBlur(\n  thumbData?: string, // data URI or blob URL\n  isDisabled = false,\n) {\n  // eslint-disable-next-line no-null/no-null\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const workerIndex = useMemo(() => cycleRestrict(MAX_WORKERS, ++lastWorkerIndex), []);\n  const offscreenRef = useRef<OffscreenCanvas>();\n\n  const blurThumb = useLastCallback(async (canvas: HTMLCanvasElement, uri: string) => {\n    const image = await preloadImage(uri);\n    if (!image) {\n      return;\n    }\n\n    requestMutation(() => {\n      canvas.width = image.width;\n      canvas.height = image.height;\n\n      offscreenRef.current = canvas.transferControlToOffscreen();\n\n      const radius = Math.ceil(Math.min(image.width, image.height) * RADIUS_RATIO);\n\n      requestMediaWorker({\n        name: 'offscreen-canvas:blurThumb',\n        args: [offscreenRef.current, uri, radius],\n        transferables: [offscreenRef.current],\n      }, workerIndex);\n    });\n  });\n\n  useLayoutEffect(() => {\n    if (!thumbData || isDisabled || offscreenRef.current) return;\n\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    blurThumb(canvas, thumbData);\n  }, [blurThumb, isDisabled, thumbData]);\n\n  return canvasRef;\n}\n","import { getMediaThumbUri, type MediaWithThumbs } from '../../../../global/helpers';\n\nimport useOffscreenCanvasBlur from '../../../../hooks/useOffscreenCanvasBlur';\n\ntype CanvasBlurReturnType = ReturnType<typeof useOffscreenCanvasBlur>;\n\nexport default function useBlurredMediaThumbRef(\n  forcedUri: string | undefined, isDisabled: boolean,\n): CanvasBlurReturnType;\nexport default function useBlurredMediaThumbRef(media: MediaWithThumbs, isDisabled?: boolean) : CanvasBlurReturnType;\nexport default function useBlurredMediaThumbRef(\n  media: MediaWithThumbs | string | undefined,\n  isDisabled?: boolean,\n) {\n  const dataUri = media ? typeof media === 'string' ? media : getMediaThumbUri(media) : undefined;\n\n  return useOffscreenCanvasBlur(dataUri, isDisabled);\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useMemo,\n} from '../../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../../global';\n\nimport type { ApiGroupCall } from '../../../api/types';\n\nimport { selectChat, selectTabState } from '../../../global/selectors';\nimport { selectChatGroupCall } from '../../../global/selectors/calls';\nimport buildClassName from '../../../util/buildClassName';\n\nimport useCurrentOrPrev from '../../../hooks/useCurrentOrPrev';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useHeaderPane, { type PaneState } from '../../middle/hooks/useHeaderPane';\n\nimport AvatarList from '../../common/AvatarList';\nimport Button from '../../ui/Button';\n\nimport './GroupCallTopPane.scss';\n\ntype OwnProps = {\n  chatId: string;\n  className?: string;\n  onPaneStateChange?: (state: PaneState) => void;\n};\n\ntype StateProps = {\n  groupCall?: ApiGroupCall;\n  isActive: boolean;\n};\n\nconst PREVIEW_AVATARS_COUNT = 3;\n\nconst GroupCallTopPane: FC<OwnProps & StateProps> = ({\n  chatId,\n  isActive,\n  className,\n  groupCall,\n  onPaneStateChange,\n}) => {\n  const {\n    requestMasterAndJoinGroupCall,\n    subscribeToGroupCallUpdates,\n  } = getActions();\n\n  const lang = useOldLang();\n\n  const handleJoinGroupCall = useCallback(() => {\n    requestMasterAndJoinGroupCall({\n      chatId,\n    });\n  }, [requestMasterAndJoinGroupCall, chatId]);\n\n  const participants = groupCall?.participants;\n\n  const fetchedParticipants = useMemo(() => {\n    if (!participants) {\n      return [];\n    }\n\n    // No need for expensive global updates on users and chats, so we avoid them\n    const usersById = getGlobal().users.byId;\n    const chatsById = getGlobal().chats.byId;\n\n    return Object.values(participants)\n      .slice(0, PREVIEW_AVATARS_COUNT)\n      .map(({ id }) => usersById[id] || chatsById[id])\n      .filter(Boolean);\n  }, [participants]);\n\n  useEffect(() => {\n    if (!groupCall?.id) return undefined;\n    if (!isActive && groupCall.isLoaded) return undefined;\n\n    subscribeToGroupCallUpdates({\n      id: groupCall.id,\n      subscribed: true,\n    });\n\n    return () => {\n      subscribeToGroupCallUpdates({\n        id: groupCall.id,\n        subscribed: false,\n      });\n    };\n  }, [groupCall?.id, groupCall?.isLoaded, isActive, subscribeToGroupCallUpdates]);\n\n  const renderingParticipantCount = useCurrentOrPrev(groupCall?.participantsCount, true);\n  const renderingFetchedParticipants = useCurrentOrPrev(fetchedParticipants, true);\n\n  const isRendering = Boolean(groupCall && isActive);\n\n  const { ref, shouldRender } = useHeaderPane({\n    isOpen: isRendering,\n    onStateChange: onPaneStateChange,\n  });\n\n  if (!shouldRender) return undefined;\n\n  return (\n    <div\n      ref={ref}\n      className={buildClassName(\n        'GroupCallTopPane',\n        className,\n      )}\n      onClick={handleJoinGroupCall}\n    >\n      <div className=\"info\">\n        <span className=\"title\">{lang('VoipGroupVoiceChat')}</span>\n        <span className=\"participants\">{lang('Participants', renderingParticipantCount ?? 0, 'i')}</span>\n      </div>\n      {Boolean(renderingFetchedParticipants?.length) && (\n        <AvatarList size=\"small\" peers={renderingFetchedParticipants} className=\"avatars\" />\n      )}\n      <Button round className=\"join\">\n        {lang('VoipChatJoin')}\n      </Button>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId }): StateProps => {\n    const chat = selectChat(global, chatId)!;\n    const groupCall = selectChatGroupCall(global, chatId);\n    const activeGroupCallId = selectTabState(global).isMasterTab ? global.groupCalls.activeGroupCallId : undefined;\n\n    return {\n      groupCall,\n      isActive: activeGroupCallId !== groupCall?.id && Boolean(\n        groupCall\n          ? groupCall.participantsCount > 0 && groupCall.isLoaded\n          : chat && chat.isCallNotEmpty && chat.isCallActive,\n      ),\n    };\n  },\n)(GroupCallTopPane));\n","import type { Scheduler } from '../util/schedulers';\nimport type { Signal } from '../util/signals';\n\nimport useDebouncedCallback from './useDebouncedCallback';\nimport useDerivedSignal from './useDerivedSignal';\nimport useThrottledCallback from './useThrottledCallback';\n\nexport function useThrottledResolver<T>(\n  resolver: () => T,\n  deps: any[],\n  msOrSchedulerFn: number | Scheduler,\n  noFirst = false,\n) {\n  return useThrottledCallback((setValue: (newValue: T) => void) => {\n    setValue(resolver());\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, deps, msOrSchedulerFn, noFirst);\n}\n\nexport function useThrottledSignal<T extends any>(\n  getValue: Signal<T>,\n  ms: number,\n  noFirst = false,\n): Signal<T> {\n  const throttledResolver = useThrottledResolver(() => getValue(), [getValue], ms, noFirst);\n\n  return useDerivedSignal(\n    throttledResolver, [throttledResolver, getValue], true,\n  );\n}\n\nexport function useDebouncedResolver<T>(\n  resolver: () => T,\n  deps: any[],\n  ms: number,\n  noFirst = false,\n  noLast = false,\n) {\n  return useDebouncedCallback((setValue: (newValue: T) => void) => {\n    setValue(resolver());\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, deps, ms, noFirst, noLast);\n}\n\nexport function useDebouncedSignal<T extends any>(\n  getValue: Signal<T>,\n  ms: number,\n  noFirst = false,\n  noLast = false,\n): Signal<T> {\n  const debouncedResolver = useDebouncedResolver(() => getValue(), [getValue], ms, noFirst, noLast);\n\n  return useDerivedSignal(\n    debouncedResolver, [debouncedResolver, getValue], true,\n  );\n}\n","import { useEffect } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ChatTranslatedMessages } from '../../../../types';\n\nimport { throttle } from '../../../../util/schedulers';\n\nconst MESSAGE_LIMIT_PER_REQUEST = 20;\nconst THROTTLE_DELAY = 500;\nconst PENDING_TRANSLATIONS = new Map<string, Map<string, number[]>>();\n\nexport default function useMessageTranslation(\n  chatTranslations: ChatTranslatedMessages | undefined,\n  chatId?: string,\n  messageId?: number,\n  requestedLanguageCode?: string,\n) {\n  const messageTranslation = requestedLanguageCode && messageId\n    ? chatTranslations?.byLangCode[requestedLanguageCode]?.[messageId] : undefined;\n\n  const { isPending, text } = messageTranslation || {};\n\n  useEffect(() => {\n    if (!chatId || !messageId) return;\n\n    if (!text && isPending === undefined && requestedLanguageCode) {\n      addPendingTranslation(chatId, messageId, requestedLanguageCode);\n    }\n  }, [chatId, text, isPending, messageId, requestedLanguageCode]);\n\n  if (!chatId || !messageId) {\n    return {\n      isPending: false,\n      translatedText: undefined,\n    };\n  }\n\n  return {\n    isPending,\n    translatedText: text,\n  };\n}\n\nconst throttledProcessPending = throttle(processPending, THROTTLE_DELAY);\n\nfunction processPending() {\n  const { translateMessagesByTencent } = getActions();\n  let hasUnprocessed = false;\n  PENDING_TRANSLATIONS.forEach((chats, toLanguageCode) => {\n    chats.forEach((messageIds, chatId) => {\n      const messageIdsToTranslate = messageIds.slice(0, MESSAGE_LIMIT_PER_REQUEST);\n\n      if (messageIdsToTranslate.length < messageIds.length) {\n        hasUnprocessed = true;\n      }\n\n      translateMessagesByTencent({ chatId, messageIds: messageIdsToTranslate, toLanguageCode });\n\n      removePendingTranslations(chatId, messageIdsToTranslate, toLanguageCode);\n    });\n  });\n\n  if (hasUnprocessed) {\n    throttledProcessPending();\n  }\n}\n\nfunction addPendingTranslation(\n  chatId: string,\n  messageId: number,\n  toLanguageCode: string,\n) {\n  const languageTranslations = PENDING_TRANSLATIONS.get(toLanguageCode) || new Map<string, number[]>();\n  const messageIds = languageTranslations.get(chatId) || [];\n\n  if (messageIds.includes(messageId)) {\n    throttledProcessPending();\n    return;\n  }\n\n  messageIds.push(messageId);\n  languageTranslations.set(chatId, messageIds);\n  PENDING_TRANSLATIONS.set(toLanguageCode, languageTranslations);\n\n  getActions().markMessagesTranslationPending({ chatId, messageIds, toLanguageCode });\n\n  throttledProcessPending();\n}\n\nfunction removePendingTranslations(\n  chatId: string,\n  messageIds: number[],\n  toLanguageCode: string,\n) {\n  const languageTranslations = PENDING_TRANSLATIONS.get(toLanguageCode);\n  if (!languageTranslations?.size) {\n    PENDING_TRANSLATIONS.delete(toLanguageCode);\n    return;\n  }\n\n  const oldMessageIds = languageTranslations.get(chatId);\n  if (!oldMessageIds?.length) {\n    languageTranslations.delete(chatId);\n    return;\n  }\n\n  const newMessageIds = oldMessageIds.filter((id) => !messageIds.includes(id));\n\n  if (!newMessageIds?.length) {\n    languageTranslations.delete(chatId);\n    if (!languageTranslations.size) {\n      PENDING_TRANSLATIONS.delete(toLanguageCode);\n    }\n    return;\n  }\n\n  languageTranslations.set(chatId, newMessageIds);\n}\n","import type { ApiLimitType } from '../../api/types';\nimport type { GlobalState } from '../types';\n\nimport { DEFAULT_LIMITS } from '../../config';\nimport { selectIsCurrentUserPremium } from './users';\n\nexport function selectCurrentLimit<T extends GlobalState>(global: T, limit: ApiLimitType) {\n  const { appConfig } = global;\n  if (!appConfig) {\n    return DEFAULT_LIMITS[limit][0];\n  }\n\n  const isPremium = selectIsCurrentUserPremium(global);\n  const { limits } = appConfig;\n\n  // When there are new limits when updating a layer, until we get a new configuration, we must use the default values\n  const value = limits[limit]?.[isPremium ? 1 : 0] ?? DEFAULT_LIMITS[limit][isPremium ? 1 : 0];\n  if (limit === 'dialogFilters') return value + 1; // Server does not count \"All\" as folder, but we need to\n  return value;\n}\n\nexport function selectPremiumLimit<T extends GlobalState>(global: T, limit: ApiLimitType) {\n  const { appConfig } = global;\n  if (!appConfig) return DEFAULT_LIMITS[limit][1];\n\n  const { limits } = appConfig;\n\n  return limits[limit][1];\n}\n","type IWaveformProps = {\n  peak: number;\n  fillStyle: string;\n  progressFillStyle: string;\n};\n\nexport const MAX_EMPTY_WAVEFORM_POINTS = 30;\nconst SPIKE_WIDTH = 2;\nconst SPIKE_STEP = 4;\nconst SPIKE_RADIUS = 1;\nconst HEIGHT = 23;\n\nexport function renderWaveform(\n  canvas: HTMLCanvasElement,\n  spikes: number[],\n  progress: number,\n  {\n    peak, fillStyle, progressFillStyle,\n  }: IWaveformProps,\n) {\n  const width = spikes.length * SPIKE_STEP;\n  const height = HEIGHT;\n\n  canvas.width = width * 2;\n  canvas.height = height * 2;\n  canvas.style.width = `${width}px`;\n  canvas.style.height = `${height}px`;\n\n  const ctx = canvas.getContext('2d')!;\n  ctx.scale(2, 2);\n\n  spikes.forEach((item, i) => {\n    ctx.globalAlpha = (i / spikes.length >= progress) ? 0.5 : 1;\n    ctx.fillStyle = progress > i / spikes.length ? progressFillStyle : fillStyle;\n    const spikeHeight = Math.max(2, HEIGHT * (item / Math.max(1, peak)));\n    roundedRectangle(ctx, i * SPIKE_STEP, (height + spikeHeight) / 2, SPIKE_WIDTH, spikeHeight, SPIKE_RADIUS);\n    ctx.fill();\n  });\n}\n\nfunction roundedRectangle(\n  ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number,\n) {\n  if (width < 2 * radius) {\n    radius = width / 2;\n  }\n  if (height < 2 * radius) {\n    radius = height / 2;\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + radius, y);\n  ctx.arcTo(x + width, y, x + width, y - height, radius);\n  ctx.arcTo(x + width, y - height, x, y - height, radius);\n  ctx.arcTo(x, y - height, x, y, radius);\n  ctx.arcTo(x, y, x + width, y, radius);\n  ctx.closePath();\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useEffect, useLayoutEffect, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type {\n  ApiAudio, ApiMessage, ApiVideo, ApiVoice,\n} from '../../api/types';\nimport type { BufferedRange } from '../../hooks/useBuffering';\nimport type { OldLangFn } from '../../hooks/useOldLang';\nimport type { ThemeKey } from '../../types';\nimport { ApiMediaFormat } from '../../api/types';\nimport { AudioOrigin } from '../../types';\n\nimport {\n  getMediaDuration,\n  getMediaFormat,\n  getMediaHash,\n  getMediaTransferState,\n  getMessageWebPageAudio,\n  hasMessageTtl,\n  isMessageLocal,\n  isOwnMessage,\n} from '../../global/helpers';\nimport { makeTrackId } from '../../util/audioPlayer';\nimport buildClassName from '../../util/buildClassName';\nimport { captureEvents } from '../../util/captureEvents';\nimport { formatMediaDateTime, formatMediaDuration, formatPastTimeShort } from '../../util/dates/dateFormat';\nimport { decodeWaveform, interpolateArray } from '../../util/waveform';\nimport { LOCAL_TGS_URLS } from './helpers/animatedAssets';\nimport { getFileSizeString } from './helpers/documentInfo';\nimport renderText from './helpers/renderText';\nimport { MAX_EMPTY_WAVEFORM_POINTS, renderWaveform } from './helpers/waveform';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useAudioPlayer from '../../hooks/useAudioPlayer';\nimport useBuffering from '../../hooks/useBuffering';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaWithLoadProgress from '../../hooks/useMediaWithLoadProgress';\nimport useOldLang from '../../hooks/useOldLang';\nimport useShowTransitionDeprecated from '../../hooks/useShowTransitionDeprecated';\n\nimport Button from '../ui/Button';\nimport Link from '../ui/Link';\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport AnimatedIcon from './AnimatedIcon';\nimport Icon from './icons/Icon';\n\nimport './Audio.scss';\n\ntype OwnProps = {\n  theme: ThemeKey;\n  message: ApiMessage;\n  senderTitle?: string;\n  uploadProgress?: number;\n  origin: AudioOrigin;\n  date?: number;\n  noAvatars?: boolean;\n  className?: string;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  isDownloading?: boolean;\n  isTranscribing?: boolean;\n  isTranscribed?: boolean;\n  canDownload?: boolean;\n  canTranscribe?: boolean;\n  isTranscriptionHidden?: boolean;\n  isTranscriptionError?: boolean;\n  autoPlay?: boolean;\n  onHideTranscription?: (isHidden: boolean) => void;\n  onPlay?: (messageId: number, chatId: string) => void;\n  onPause?: NoneToVoidFunction;\n  onReadMedia?: () => void;\n  onCancelUpload?: () => void;\n  onDateClick?: (arg: ApiMessage) => void;\n};\n\nexport const TINY_SCREEN_WIDTH_MQL = window.matchMedia('(max-width: 375px)');\nexport const WITH_AVATAR_TINY_SCREEN_WIDTH_MQL = window.matchMedia('(max-width: 410px)');\nconst AVG_VOICE_DURATION = 10;\n// This is needed for browsers requiring user interaction before playing.\nconst PRELOAD = true;\n\nconst Audio: FC<OwnProps> = ({\n  theme,\n  message,\n  senderTitle,\n  uploadProgress,\n  origin,\n  date,\n  noAvatars,\n  className,\n  isSelectable,\n  isSelected,\n  isDownloading,\n  isTranscribing,\n  isTranscriptionHidden,\n  isTranscribed,\n  isTranscriptionError,\n  canDownload,\n  canTranscribe,\n  autoPlay,\n  onHideTranscription,\n  onPlay,\n  onPause,\n  onReadMedia,\n  onCancelUpload,\n  onDateClick,\n}) => {\n  const {\n    cancelMediaDownload, downloadMedia, transcribeAudio, openOneTimeMediaModal,\n  } = getActions();\n\n  const {\n    content: {\n      audio: contentAudio, voice, video,\n    }, isMediaUnread,\n  } = message;\n  const audio = contentAudio || getMessageWebPageAudio(message);\n  const media = (voice || video || audio)!;\n  const mediaSource = (voice || video);\n  const isVoice = Boolean(voice || video);\n  const isSeeking = useRef<boolean>(false);\n  // eslint-disable-next-line no-null/no-null\n  const seekerRef = useRef<HTMLDivElement>(null);\n  const lang = useOldLang();\n  const { isRtl } = lang;\n\n  const { isMobile } = useAppLayout();\n  const [isActivated, setIsActivated] = useState(false);\n  const shouldLoad = isActivated || PRELOAD;\n  const coverHash = getMediaHash(media, 'pictogram');\n  const coverBlobUrl = useMedia(coverHash, false, ApiMediaFormat.BlobUrl);\n  const hasTtl = hasMessageTtl(message);\n  const isInOneTimeModal = origin === AudioOrigin.OneTimeModal;\n  const trackType = isVoice ? (hasTtl ? 'oneTimeVoice' : 'voice') : 'audio';\n\n  const mediaData = useMedia(\n    getMediaHash(media, 'inline'),\n    !shouldLoad,\n    getMediaFormat(media, 'inline'),\n  );\n\n  const { loadProgress: downloadProgress } = useMediaWithLoadProgress(\n    getMediaHash(media, 'download'),\n    !isDownloading,\n    getMediaFormat(media, 'download'),\n  );\n\n  const handleForcePlay = useLastCallback(() => {\n    setIsActivated(true);\n    onPlay?.(message.id, message.chatId);\n  });\n\n  const handleTrackChange = useLastCallback(() => {\n    setIsActivated(false);\n  });\n\n  const {\n    isBuffered, bufferedRanges, bufferingHandlers, checkBuffering,\n  } = useBuffering();\n\n  const noReset = isInOneTimeModal;\n  const {\n    isPlaying, playProgress, playPause, setCurrentTime, duration,\n  } = useAudioPlayer(\n    makeTrackId(message),\n    getMediaDuration(message)!,\n    trackType,\n    mediaData,\n    bufferingHandlers,\n    undefined,\n    checkBuffering,\n    Boolean(isActivated || autoPlay),\n    handleForcePlay,\n    handleTrackChange,\n    isMessageLocal(message) || hasTtl,\n    undefined,\n    onPause,\n    noReset,\n    hasTtl && !isInOneTimeModal,\n  );\n\n  const reversePlayProgress = 1 - playProgress;\n  const isOwn = isOwnMessage(message);\n  const isReverse = hasTtl && isInOneTimeModal;\n\n  const waveformCanvasRef = useWaveformCanvas(\n    theme,\n    mediaSource,\n    (isMediaUnread && !isOwn && !isReverse) ? 1 : playProgress,\n    isOwn,\n    !noAvatars,\n    isMobile,\n    isReverse,\n  );\n\n  const withSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n\n  useEffect(() => {\n    setIsActivated(isPlaying);\n  }, [isPlaying]);\n\n  const isLoadingForPlaying = isActivated && !isBuffered;\n\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(\n    uploadProgress || downloadProgress,\n    isLoadingForPlaying || isDownloading,\n    uploadProgress !== undefined,\n  );\n\n  const {\n    shouldRender: shouldRenderSpinner,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransitionDeprecated(isTransferring);\n\n  const shouldRenderCross = shouldRenderSpinner && (isLoadingForPlaying || isUploading);\n\n  const handleButtonClick = useLastCallback(() => {\n    if (isUploading) {\n      onCancelUpload?.();\n      return;\n    }\n\n    if (hasTtl) {\n      openOneTimeMediaModal({ message });\n      onReadMedia?.();\n      return;\n    }\n\n    if (!isPlaying) {\n      onPlay?.(message.id, message.chatId);\n    }\n\n    getActions().setAudioPlayerOrigin({ origin });\n    setIsActivated(!isActivated);\n    playPause();\n  });\n\n  useEffect(() => {\n    if (onReadMedia && isMediaUnread && isPlaying) {\n      onReadMedia();\n    }\n  }, [isPlaying, isMediaUnread, onReadMedia]);\n\n  const handleDownloadClick = useLastCallback(() => {\n    if (isDownloading) {\n      cancelMediaDownload({ media });\n    } else {\n      downloadMedia({ media, originMessage: message });\n    }\n  });\n\n  const handleSeek = useLastCallback((e: MouseEvent | TouchEvent) => {\n    if (isSeeking.current && seekerRef.current) {\n      const { width, left } = seekerRef.current.getBoundingClientRect();\n      const clientX = e instanceof MouseEvent ? e.clientX : e.targetTouches[0].clientX;\n      e.stopPropagation(); // Prevent Slide-to-Reply activation\n      // Prevent track skipping while seeking near end\n      setCurrentTime(Math.max(Math.min(duration * ((clientX - left) / width), duration - 0.1), 0.001));\n    }\n  });\n\n  const handleStartSeek = useLastCallback((e: MouseEvent | TouchEvent) => {\n    if (e instanceof MouseEvent && e.button === 2) return;\n    isSeeking.current = true;\n    handleSeek(e);\n  });\n\n  const handleStopSeek = useLastCallback(() => {\n    isSeeking.current = false;\n  });\n\n  const handleDateClick = useLastCallback(() => {\n    onDateClick!(message);\n  });\n\n  const handleTranscribe = useLastCallback(() => {\n    transcribeAudio({ chatId: message.chatId, messageId: message.id });\n  });\n\n  useEffect(() => {\n    if (!seekerRef.current || !withSeekline || isInOneTimeModal) return undefined;\n    return captureEvents(seekerRef.current, {\n      onCapture: handleStartSeek,\n      onRelease: handleStopSeek,\n      onClick: handleStopSeek,\n      onDrag: handleSeek,\n    });\n  }, [withSeekline, handleStartSeek, handleSeek, handleStopSeek, isInOneTimeModal]);\n\n  function renderFirstLine() {\n    if (isVoice) {\n      return senderTitle || 'Voice';\n    }\n\n    const { title, fileName } = audio!;\n\n    return title || fileName;\n  }\n\n  function renderSecondLine() {\n    if (isVoice) {\n      return (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          {formatMediaDuration((voice || video)!.duration)}\n        </div>\n      );\n    }\n\n    const { performer } = audio!;\n\n    return (\n      <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n        {formatMediaDuration(duration)}\n        <span className=\"bullet\">&bull;</span>\n        {performer && <span className=\"performer\" title={performer}>{renderText(performer)}</span>}\n        {performer && senderTitle && <span className=\"bullet\">&bull;</span>}\n        {senderTitle && <span title={senderTitle}>{renderText(senderTitle)}</span>}\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'Audio',\n    className,\n    isInOneTimeModal && 'non-interactive',\n    origin === AudioOrigin.Inline && 'inline',\n    isOwn && origin === AudioOrigin.Inline && 'own',\n    (origin === AudioOrigin.Search || origin === AudioOrigin.SharedMedia) && 'bigger',\n    isSelected && 'audio-is-selected',\n  );\n\n  const buttonClassNames = ['toogle-play-wrapper'];\n  if (shouldRenderCross) {\n    buttonClassNames.push('loading');\n  } else {\n    buttonClassNames.push(isPlaying ? 'pause' : 'play');\n  }\n\n  const contentClassName = buildClassName('content', withSeekline && 'with-seekline');\n\n  function renderWithTitle() {\n    return (\n      <div className={contentClassName}>\n        <div className=\"content-row\">\n          <p className=\"title\" dir=\"auto\" title={renderFirstLine()}>{renderText(renderFirstLine())}</p>\n\n          <div className=\"message-date\">\n            {Boolean(date) && (\n              <Link\n                className=\"date\"\n                onClick={handleDateClick}\n              >\n                {formatPastTimeShort(lang, date * 1000)}\n              </Link>\n            )}\n          </div>\n        </div>\n\n        {withSeekline && (\n          <div className=\"meta search-result\" dir={isRtl ? 'rtl' : undefined}>\n            <span className=\"duration with-seekline\" dir=\"auto\">\n              {playProgress < 1 && `${formatMediaDuration(duration * playProgress, duration)}`}\n            </span>\n            {renderSeekline(playProgress, bufferedRanges, seekerRef)}\n          </div>\n        )}\n        {!withSeekline && renderSecondLine()}\n      </div>\n    );\n  }\n\n  function renderTooglePlayWrapper() {\n    return (\n      <div className={buildClassName(...buttonClassNames)}>\n        <Button\n          round\n          ripple={!isMobile}\n          size=\"smaller\"\n          className=\"toggle-play\"\n          color={coverBlobUrl ? 'translucent-white' : 'primary'}\n          ariaLabel={isPlaying ? 'Pause audio' : 'Play audio'}\n          onClick={handleButtonClick}\n          isRtl={lang.isRtl}\n          backgroundImage={coverBlobUrl}\n          nonInteractive={isInOneTimeModal}\n        >\n          {!isInOneTimeModal && <Icon name=\"play\" />}\n          {!isInOneTimeModal && <Icon name=\"pause\" />}\n          {isInOneTimeModal && (\n            <AnimatedIcon\n              className=\"flame\"\n              tgsUrl={LOCAL_TGS_URLS.Flame}\n              nonInteractive\n              noLoop={false}\n              size={40}\n            />\n          )}\n        </Button>\n        {hasTtl && !isInOneTimeModal && (\n          <Icon name=\"view-once\" />\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className={fullClassName} dir={lang.isRtl ? 'rtl' : 'ltr'}>\n      {isSelectable && (\n        <div className=\"message-select-control no-selection\">\n          {isSelected && <Icon name=\"select\" />}\n        </div>\n      )}\n      {renderTooglePlayWrapper()}\n      {shouldRenderSpinner && (\n        <div className={buildClassName('media-loading', spinnerClassNames, shouldRenderCross && 'interactive')}>\n          <ProgressSpinner\n            progress={transferProgress}\n            transparent\n            withColor\n            size=\"m\"\n            onClick={shouldRenderCross ? handleButtonClick : undefined}\n            noCross={!shouldRenderCross}\n          />\n        </div>\n      )}\n      {isInOneTimeModal && !shouldRenderSpinner && (\n        <div className={buildClassName('media-loading')}>\n          <ProgressSpinner\n            progress={playProgress}\n            transparent\n            size=\"m\"\n            noCross\n            rotationOffset={3 / 4}\n          />\n        </div>\n      )}\n      {audio && canDownload && !isUploading && (\n        <Button\n          round\n          size=\"tiny\"\n          className=\"download-button\"\n          ariaLabel={isDownloading ? 'Cancel download' : 'Download'}\n          onClick={handleDownloadClick}\n        >\n          <Icon name={isDownloading ? 'close' : 'arrow-down'} />\n        </Button>\n      )}\n      {origin === AudioOrigin.Search && renderWithTitle()}\n      {origin !== AudioOrigin.Search && audio && renderAudio(\n        lang,\n        audio,\n        duration,\n        isPlaying,\n        playProgress,\n        bufferedRanges,\n        seekerRef,\n        (isDownloading || isUploading),\n        date,\n        transferProgress,\n        onDateClick ? handleDateClick : undefined,\n      )}\n      {origin === AudioOrigin.SharedMedia && mediaSource && renderWithTitle()}\n      {(origin === AudioOrigin.Inline || isInOneTimeModal || isTranscribed) && mediaSource && (\n        renderVoice(\n          mediaSource,\n          seekerRef,\n          waveformCanvasRef,\n          hasTtl ? reversePlayProgress : playProgress,\n          isMediaUnread,\n          isTranscribing,\n          isTranscriptionHidden,\n          isTranscribed,\n          isTranscriptionError,\n          canTranscribe ? handleTranscribe : undefined,\n          onHideTranscription,\n          origin,\n        )\n      )}\n    </div>\n  );\n};\n\nfunction getSeeklineSpikeAmounts(isMobile?: boolean, withAvatar?: boolean) {\n  return {\n    MIN_SPIKES: isMobile ? (TINY_SCREEN_WIDTH_MQL.matches ? 16 : 20) : 25,\n    MAX_SPIKES: isMobile\n      ? (TINY_SCREEN_WIDTH_MQL.matches\n        ? 35\n        : (withAvatar && WITH_AVATAR_TINY_SCREEN_WIDTH_MQL.matches ? 40 : 45))\n      : 75,\n  };\n}\n\nfunction renderAudio(\n  lang: OldLangFn,\n  audio: ApiAudio,\n  duration: number,\n  isPlaying: boolean,\n  playProgress: number,\n  bufferedRanges: BufferedRange[],\n  seekerRef: React.Ref<HTMLElement>,\n  showProgress?: boolean,\n  date?: number,\n  progress?: number,\n  handleDateClick?: NoneToVoidFunction,\n) {\n  const {\n    title, performer, fileName,\n  } = audio;\n  const showSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n  const { isRtl } = lang;\n\n  return (\n    <div className=\"content\">\n      <p className=\"title\" dir=\"auto\" title={title}>{renderText(title || fileName)}</p>\n      {showSeekline && (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          <span className=\"duration with-seekline\" dir=\"auto\">\n            {formatMediaDuration(duration * playProgress, duration)}\n          </span>\n          {renderSeekline(playProgress, bufferedRanges, seekerRef)}\n        </div>\n      )}\n      {!showSeekline && showProgress && (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          {progress ? `${getFileSizeString(audio!.size * progress)} / ` : undefined}{getFileSizeString(audio!.size)}\n        </div>\n      )}\n      {!showSeekline && !showProgress && (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          <span className=\"duration\" dir=\"auto\">{formatMediaDuration(duration)}</span>\n          {performer && (\n            <>\n              <span className=\"bullet\">&bull;</span>\n              <span className=\"performer\" dir=\"auto\" title={performer}>{renderText(performer)}</span>\n            </>\n          )}\n          {Boolean(date) && (\n            <>\n              <span className=\"bullet\">&bull;</span>\n              <Link className=\"date\" onClick={handleDateClick}>\n                {formatMediaDateTime(lang, date * 1000, true)}\n              </Link>\n            </>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction renderVoice(\n  media: ApiVoice | ApiVideo,\n  seekerRef: React.Ref<HTMLDivElement>,\n  waveformCanvasRef: React.Ref<HTMLCanvasElement>,\n  playProgress: number,\n  isMediaUnread?: boolean,\n  isTranscribing?: boolean,\n  isTranscriptionHidden?: boolean,\n  isTranscribed?: boolean,\n  isTranscriptionError?: boolean,\n  onClickTranscribe?: VoidFunction,\n  onHideTranscription?: (isHidden: boolean) => void,\n  origin?: AudioOrigin,\n) {\n  return (\n    <div className=\"content\">\n      <div className=\"waveform-wrapper\">\n        <div\n          className=\"waveform\"\n          draggable={false}\n          ref={seekerRef}\n        >\n          <canvas ref={waveformCanvasRef} />\n        </div>\n        {onClickTranscribe && (\n          // eslint-disable-next-line react/jsx-no-bind\n          <Button onClick={() => {\n            if ((isTranscribed || isTranscriptionError) && onHideTranscription) {\n              onHideTranscription(!isTranscriptionHidden);\n            } else if (!isTranscribing) {\n              onClickTranscribe();\n            }\n          }}\n          >\n            <Icon\n              name={(isTranscribed || isTranscriptionError) ? 'down' : 'transcribe'}\n              className={buildClassName(\n                'transcribe-icon',\n                (isTranscribed || isTranscriptionError) && !isTranscriptionHidden && 'transcribe-shown',\n              )}\n            />\n            {isTranscribing && (\n              <svg viewBox=\"0 0 32 24\" className=\"loading-svg\">\n                <rect\n                  className=\"loading-rect\"\n                  fill=\"transparent\"\n                  width=\"32\"\n                  height=\"24\"\n                  stroke-width=\"3\"\n                  stroke-linejoin=\"round\"\n                  rx=\"6\"\n                  ry=\"6\"\n                  stroke=\"white\"\n                  stroke-dashoffset=\"1\"\n                  stroke-dasharray=\"32,68\"\n                />\n              </svg>\n            )}\n          </Button>\n        )}\n      </div>\n      <p\n        className={buildClassName('voice-duration', origin !== AudioOrigin.OneTimeModal && isMediaUnread && 'unread')}\n        dir=\"auto\"\n      >\n        {playProgress === 0 || playProgress === 1\n          ? formatMediaDuration(media!.duration) : formatMediaDuration(media!.duration * playProgress)}\n      </p>\n    </div>\n  );\n}\n\nexport function useWaveformCanvas(\n  theme: ThemeKey,\n  media?: ApiVoice | ApiVideo,\n  playProgress = 0,\n  isOwn = false,\n  withAvatar = false,\n  isMobile = false,\n  isReverse = false,\n) {\n  // eslint-disable-next-line no-null/no-null\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  const { data: spikes, peak } = useMemo(() => {\n    if (!media) {\n      return undefined;\n    }\n\n    const { waveform, duration } = media;\n    if (!waveform) {\n      return {\n        data: new Array(Math.min(duration, MAX_EMPTY_WAVEFORM_POINTS)).fill(0),\n        peak: 0,\n      };\n    }\n\n    const { MIN_SPIKES, MAX_SPIKES } = getSeeklineSpikeAmounts(isMobile, withAvatar);\n    const durationFactor = Math.min(duration / AVG_VOICE_DURATION, 1);\n    const spikesCount = Math.round(MIN_SPIKES + (MAX_SPIKES - MIN_SPIKES) * durationFactor);\n    const decodedWaveform = decodeWaveform(new Uint8Array(waveform));\n\n    return interpolateArray(decodedWaveform, spikesCount);\n  }, [isMobile, media, withAvatar]) || {};\n\n  useLayoutEffect(() => {\n    const canvas = canvasRef.current;\n\n    if (!canvas || !spikes || peak === undefined) {\n      return;\n    }\n\n    const fillColor = theme === 'dark' ? '#494A78' : '#ADD3F7';\n    const fillOwnColor = theme === 'dark' ? '#B7ABED' : '#AEDFA4';\n    const progressFillColor = theme === 'dark' ? '#8774E1' : '#3390EC';\n    const progressFillOwnColor = theme === 'dark' ? '#FFFFFF' : '#4FAE4E';\n\n    const fillStyle = isOwn ? fillOwnColor : fillColor;\n    const progressFillStyle = isOwn ? progressFillOwnColor : progressFillColor;\n\n    renderWaveform(canvas, spikes, isReverse ? 1 - playProgress : playProgress, {\n      peak,\n      fillStyle,\n      progressFillStyle,\n    });\n  }, [isOwn, peak, playProgress, spikes, theme, isReverse]);\n\n  return canvasRef;\n}\n\nfunction renderSeekline(\n  playProgress: number,\n  bufferedRanges: BufferedRange[],\n  seekerRef: React.Ref<HTMLElement>,\n) {\n  return (\n    <div\n      className=\"seekline\"\n      ref={seekerRef as React.Ref<HTMLDivElement>}\n    >\n      {bufferedRanges.map(({ start, end }) => (\n        <div\n          className=\"seekline-buffered-progress\"\n          style={`left: ${start * 100}%; right: ${100 - end * 100}%`}\n        />\n      ))}\n      <span className=\"seekline-play-progress\">\n        <i\n          className=\"seekline-play-progress-inner\"\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n      <span className=\"seekline-thumb\">\n        <i\n          className=\"seekline-thumb-inner\"\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n    </div>\n  );\n}\n\nexport default memo(Audio);\n","/* eslint-disable no-bitwise */\n\n// Ref: https://github.com/telegramdesktop/tdesktop/blob/0743e71ab6b928d2ee5bae1aed991849b1e2b291/Telegram/SourceFiles/data/data_document.cpp#L1018\nexport function decodeWaveform(encoded5bit: Uint8Array) {\n  const bitsCount = encoded5bit.length * 8;\n  const valuesCount = Math.floor(bitsCount / 5);\n  if (!valuesCount) {\n    return [];\n  }\n\n  // Read each 5 bit of encoded5bit as 0-31 unsigned char.\n  // We count the index of the byte in which the desired 5-bit sequence starts.\n  // And then we read a uint16 starting from that byte to guarantee to get all of those 5 bits.\n  //\n  // BUT! if it is the last byte we have, we're not allowed to read a uint16 starting with it.\n  // Because it will be an overflow (we'll access one byte after the available memory).\n  // We see, that only the last 5 bits could start in the last available byte and be problematic.\n  // So we read in a general way all the entries in a general way except the last one.\n  const result = Array(valuesCount);\n  const bitsData = encoded5bit;\n  for (let i = 0, l = valuesCount - 1; i !== l; ++i) {\n    const byteIndex = Math.floor((i * 5) / 8);\n    const bitShift = Math.floor((i * 5) % 8);\n    const value = bitsData[byteIndex] + (bitsData[byteIndex + 1] << 8);\n    result[i] = ((value >> bitShift) & 0x1F);\n  }\n  const lastByteIndex = Math.floor(((valuesCount - 1) * 5) / 8);\n  const lastBitShift = Math.floor(((valuesCount - 1) * 5) % 8);\n  const lastValue = bitsData[lastByteIndex] + (bitsData[lastByteIndex + 1] << 8);\n  result[valuesCount - 1] = (lastValue >> lastBitShift) & 0x1F;\n\n  return result;\n}\n\nexport function interpolateArray(data: number[], fitCount: number) {\n  let peak = 0;\n  const newData = new Array(fitCount);\n  const springFactor = data.length / fitCount;\n  const leftFiller = data[0];\n  const rightFiller = data[data.length - 1];\n  for (let i = 0; i < fitCount; i++) {\n    const idx = Math.floor(i * springFactor);\n    const val = ((data[idx - 1] ?? leftFiller) + (data[idx] ?? leftFiller) + (data[idx + 1] ?? rightFiller)) / 3;\n    newData[i] = val;\n    if (peak < val) {\n      peak = val;\n    }\n  }\n  return { data: newData, peak };\n}\n","import { useRef } from 'react';\n\nimport usePreviousDeprecated from './usePreviousDeprecated';\n\nexport default function useSyncEffect<const T extends readonly any[]>(\n  effect: (args: T | readonly []) => NoneToVoidFunction | void,\n  dependencies: T,\n) {\n  const prevDeps = usePreviousDeprecated<T>(dependencies);\n  const cleanupRef = useRef<NoneToVoidFunction>();\n\n  if (!prevDeps || dependencies.some((d, i) => d !== prevDeps[i])) {\n    cleanupRef.current?.();\n    cleanupRef.current = effect(prevDeps || []) ?? undefined;\n  }\n}\n","import { useRef } from 'react';\n\n/**\n * @deprecated\n */\nfunction usePreviousDeprecated<T extends any>(next: T): T | undefined;\nfunction usePreviousDeprecated<T extends any>(next: T, shouldSkipUndefined: true): Exclude<T, undefined> | undefined;\n// eslint-disable-next-line max-len\nfunction usePreviousDeprecated<T extends any>(next: T, shouldSkipUndefined?: boolean): Exclude<T, undefined> | undefined;\nfunction usePreviousDeprecated<T extends any>(next: T, shouldSkipUndefined?: boolean) {\n  const ref = useRef<T>();\n  const { current } = ref;\n  if (!shouldSkipUndefined || next !== undefined) {\n    ref.current = next;\n  }\n\n  return current;\n}\n\nexport default usePreviousDeprecated;\n","import { getGlobal } from '../../../../global';\n\nimport type { GlobalState } from '../../../../global/types';\nimport type { Signal, SignalSetter } from '../../../../util/signals';\n\nimport { createSignal } from '../../../../util/signals';\nimport useSyncEffect from '../useSyncEffect';\n\n/*\n  This hook is a more performant variation of the standard React `useSelector` hook. It allows to:\n  a) Avoid multiple subscriptions to global updates by leveraging a single selector reference.\n  b) Return a signal instead of forcing a component update right away.\n */\n\ntype Selector<T extends unknown> = (global: GlobalState) => T;\n\ninterface State<T extends unknown> {\n  clientsCount: number;\n  getter: Signal<T>;\n  setter: SignalSetter;\n}\n\nconst bySelector = new Map<Selector<unknown>, State<unknown>>();\n\nfunction useSelectorSignal<T extends unknown>(selector: Selector<T>): Signal<T> {\n  let state = bySelector.get(selector);\n  if (!state) {\n    const [getter, setter] = createSignal(selector(getGlobal()));\n    state = { clientsCount: 0, getter, setter };\n    bySelector.set(selector, state);\n  }\n\n  useSyncEffect(() => {\n    const state2 = bySelector.get(selector)!;\n\n    state2.clientsCount++;\n\n    return () => {\n      state2.clientsCount--;\n\n      if (!state2.clientsCount) {\n        bySelector.delete(selector);\n      }\n    };\n  }, [selector]);\n\n  return state.getter as Signal<T>;\n}\n\nexport default useSelectorSignal;\n","import { useEffect } from 'react';\n\nimport { ApiMediaFormat } from '../../../api/types';\n\nimport { selectIsSynced } from '../../../global/selectors';\nimport * as mediaLoader from '../../../util/mediaLoader';\nimport useSelector from './data/useSelector';\nimport useForceUpdate from './useForceUpdate';\n\nconst useMedia = (\n  mediaHash: string | false | undefined,\n  noLoad = false,\n  mediaFormat = ApiMediaFormat.BlobUrl,\n  delay?: number | false,\n) => {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory(mediaHash) : undefined;\n  const forceUpdate = useForceUpdate();\n  const isSynced = useSelector(selectIsSynced);\n\n  useEffect(() => {\n    if (!noLoad && mediaHash && !mediaData) {\n      const startedAt = Date.now();\n\n      mediaLoader.fetch(mediaHash, mediaFormat).then(() => {\n        const spentTime = Date.now() - startedAt;\n        if (!delay || spentTime >= delay) {\n          forceUpdate();\n        } else {\n          setTimeout(forceUpdate, delay - spentTime);\n        }\n      });\n    }\n  }, [noLoad, mediaHash, mediaData, mediaFormat, delay, isSynced]);\n\n  return mediaData;\n};\n\nexport default useMedia;\n","import type { GlobalState } from '../../../../global/types';\n\nimport useDerivedState from '../useDerivedState';\nimport useSelectorSignal from './useSelectorSignal';\n\ntype Selector<T extends unknown> = (global: GlobalState) => T;\n\nexport default function useSelector<T extends unknown>(selector: Selector<T>) {\n  const selectorSignal = useSelectorSignal(selector);\n  return useDerivedState(selectorSignal);\n}\n","import { useRef } from 'react';\n\nimport type { Signal } from '../../../util/signals';\n\nimport useForceUpdate from './useForceUpdate';\nimport { useSignalEffect } from './useSignalEffect';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\n\ntype SyncResolver<T> = () => T;\ntype AsyncResolver<T> = (setter: (newValue: T) => void) => void;\ntype Resolver<T> =\n  SyncResolver<T>\n  | AsyncResolver<T>;\n\nfunction useDerivedState<T>(resolver: SyncResolver<T>, dependencies: readonly any[]): T;\nfunction useDerivedState<T>(resolver: AsyncResolver<T>, dependencies: readonly any[], isAsync: true): T;\nfunction useDerivedState<T>(signal: Signal<T>): T;\n\nfunction useDerivedState<T>(resolverOrSignal: Resolver<T> | T, dependencies?: readonly any[], isAsync = false) {\n  const resolver = dependencies ? resolverOrSignal as Resolver<T> : () => ((resolverOrSignal as Signal<T>)());\n  dependencies ??= [resolverOrSignal];\n\n  const valueRef = useRef<T>();\n  const forceUpdate = useForceUpdate();\n  const resolverRef = useStateRef(resolver);\n\n  function runCurrentResolver(isSync = false) {\n    const currentResolver = resolverRef.current;\n    if (isAsync) {\n      (currentResolver as AsyncResolver<T>)((newValue) => {\n        if (valueRef.current !== newValue) {\n          valueRef.current = newValue;\n          forceUpdate();\n        }\n      });\n    } else {\n      const newValue = (currentResolver as SyncResolver<T>)();\n      if (valueRef.current !== newValue) {\n        valueRef.current = newValue;\n\n        if (!isSync) {\n          forceUpdate();\n        }\n      }\n    }\n  }\n\n  useSyncEffect(() => {\n    runCurrentResolver(true);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies);\n\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useSignalEffect(runCurrentResolver, dependencies);\n\n  return valueRef.current as T;\n}\n\nexport default useDerivedState;\n","import { useRef } from 'react';\n\n// Allows to use state value as \"silent\" dependency in hooks (not causing updates).\n// Also useful for state values that update frequently (such as controlled input value).\nexport function useStateRef<T>(value: T) {\n  const ref = useRef<T>(value);\n  ref.current = value;\n  return ref;\n}\n","import { useRef } from 'react';\n\nimport { isSignal } from '../../../util/signals';\n\nexport function useSignalEffect(effect: NoneToVoidFunction, dependencies: readonly any[]) {\n  // The is extracted from `useEffectOnce` to run before all effects\n  const isFirstRun = useRef(true);\n  if (isFirstRun.current) {\n    isFirstRun.current = false;\n\n    dependencies?.forEach((dependency) => {\n      if (isSignal(dependency)) {\n        dependency.subscribe(effect);\n      }\n    });\n  }\n}\n","import type { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\n\nimport { DEBUG } from '../config';\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport { applyStyles } from '../util/animation';\nimport unloadVideo from '../util/browser/unloadVideo';\nimport { IS_SAFARI } from '../util/browser/windowEnvironment';\nimport { makeProgressiveLoader } from '../util/progressiveLoader';\n\nconst VIDEO_REVEAL_DELAY = 100;\n\nexport function useStreaming(videoRef: RefObject<HTMLVideoElement>, url?: string, mimeType?: string) {\n  useEffect(() => {\n    if (!url || !videoRef.current) return undefined;\n    const MediaSourceClass = getMediaSource();\n    const video = videoRef.current;\n\n    if (!IS_SAFARI || !mimeType || !MediaSourceClass?.isTypeSupported(mimeType)) {\n      return undefined;\n    }\n    const mediaSource = new MediaSourceClass();\n\n    function revealVideo() {\n      requestMutation(() => {\n        video.style.display = 'block';\n        setTimeout(() => {\n          requestMutation(() => {\n            applyStyles(video, { opacity: '1' });\n          });\n        }, VIDEO_REVEAL_DELAY);\n      });\n    }\n\n    function onSourceOpen() {\n      if (!url || !mimeType) return;\n\n      const sourceBuffer = mediaSource.addSourceBuffer(mimeType);\n      const loader = makeProgressiveLoader(url);\n\n      function onUpdateEnded() {\n        loader.next()\n          .then(({\n            value,\n            done,\n          }) => {\n            if (mediaSource.readyState !== 'open') return;\n            if (done) {\n              endOfStream(mediaSource);\n              return;\n            }\n            appendBuffer(sourceBuffer, value);\n          });\n      }\n\n      sourceBuffer.addEventListener('updateend', onUpdateEnded);\n\n      loader.next()\n        .then(({\n          value,\n          done,\n        }) => {\n          if (done || mediaSource.readyState !== 'open') return;\n          revealVideo();\n          appendBuffer(sourceBuffer, value);\n        });\n    }\n\n    mediaSource.addEventListener('sourceopen', onSourceOpen, { once: true });\n\n    requestMutation(() => {\n      applyStyles(video, {\n        display: 'none',\n        opacity: '0',\n      });\n      video.src = URL.createObjectURL(mediaSource);\n    });\n\n    return () => {\n      requestMutation(() => {\n        const src = video.src;\n        unloadVideo(video);\n        mediaSource.removeEventListener('sourceopen', onSourceOpen);\n        if (mediaSource.readyState === 'open') {\n          endOfStream(mediaSource);\n        }\n        URL.revokeObjectURL(src);\n      });\n    };\n  }, [mimeType, url, videoRef]);\n\n  return checkIfStreamingSupported(mimeType);\n}\n\nexport function checkIfStreamingSupported(mimeType?: string) {\n  if (!IS_SAFARI || !mimeType) return false;\n  return Boolean(getMediaSource()?.isTypeSupported(mimeType));\n}\n\nfunction appendBuffer(sourceBuffer: SourceBuffer, buffer: ArrayBuffer) {\n  try {\n    sourceBuffer.appendBuffer(buffer);\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[Stream] failed to append buffer', error);\n    }\n  }\n}\n\nfunction endOfStream(mediaSource: MediaSource) {\n  try {\n    mediaSource.endOfStream();\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[Stream] failed to end stream', error);\n    }\n  }\n}\n\nfunction getMediaSource(): typeof MediaSource | undefined {\n  if ('ManagedMediaSource' in window) {\n    // @ts-ignore\n    return ManagedMediaSource;\n  }\n  if ('MediaSource' in window) {\n    return MediaSource;\n  }\n  return undefined;\n}\n","export default function cycleRestrict(length: number, index: number) {\n  return index - Math.floor(index / length) * length;\n}\n","/* eslint-disable max-len */\nimport React, { memo } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport { selectCurrentChat } from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport { useGlobalSummaryBadge } from '../hook/useGlobalSummaryBadge';\nimport { GLOBAL_SUMMARY_CHATID } from '../variables';\nimport GlobalSummaryBadge from './global-summary-badge';\n\nimport ListItem from '../../ui/ListItem';\nimport ShowTransition from '../../ui/ShowTransition';\n\nimport SerenaPath from '../assets/serena.png';\n\ninterface StateProps {\n  isSelected: boolean;\n}\ninterface OwnProps {\n  frozenNotificationHeight: number;\n  archiveHeight: number;\n  unconfirmedSessionHeight: number;\n}\nconst ChatSerena = (props: OwnProps & StateProps) => {\n  const {\n    isSelected,\n    frozenNotificationHeight,\n    archiveHeight,\n    unconfirmedSessionHeight,\n  } = props;\n  const offsetTop = frozenNotificationHeight + archiveHeight + unconfirmedSessionHeight;\n  const { openChat } = getActions();\n  const chatClassName = buildClassName(\n    'Chat chat-item-clickable',\n    isSelected && 'selected',\n  );\n  const unreadCount = useGlobalSummaryBadge();\n  const handleClick = () => {\n    openChat({ id: GLOBAL_SUMMARY_CHATID });\n    GlobalSummaryBadge.updateRoomData('unreadCount', 0);\n  };\n  return (\n    <ListItem\n      className={chatClassName}\n      key={GLOBAL_SUMMARY_CHATID}\n      style={`top: ${offsetTop}px`}\n      // eslint-disable-next-line react/jsx-no-bind\n      onClick={handleClick}\n      withPortalForMenu\n    >\n      <img className=\"w-[54px] h-[54px] rounded-full mr-[12px]\" src={SerenaPath} alt=\"Serena\" />\n      <div className=\"info\">\n        <div className=\"info-row\">\n          <div className=\"title FullNameTitle-module__root\">\n            <h3 dir=\"auto\" role=\"button\" className=\"fullName FullNameTitle-module__fullName\">\n              Serena AI\n            </h3>\n          </div>\n        </div>\n        <div className=\"subtitle\">\n          <p className=\"last-message shared-canvas-container\" dir=\"ltr\">\n            Chat Summary\n          </p>\n          <ShowTransition isCustom className=\"ChatBadge-transition\" isOpen={unreadCount > 0}>\n            <div className=\"ChatBadge unread\">\n              {unreadCount}\n            </div>\n          </ShowTransition>\n        </div>\n      </div>\n    </ListItem>\n  );\n};\n\nexport default memo(withGlobal(\n  (global) => {\n    const chat = selectCurrentChat(global);\n    const isSelected = GLOBAL_SUMMARY_CHATID === chat?.id;\n    return {\n      isSelected,\n    };\n  },\n)(ChatSerena));\n","import { useEffect, useState } from '../../../lib/teact/teact';\n\nimport eventEmitter, { Actions } from '../lib/EventEmitter';\nimport { GLOBAL_SUMMARY_CHATID } from '../variables';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nexport function useGlobalSummaryBadge() {\n  const [unreadCount, setUnreadCount] = useState(0);\n  const updateUnreadCount = useLastCallback((param:{ chatId:string; count:number }) => {\n    if (param.chatId === GLOBAL_SUMMARY_CHATID) {\n      setUnreadCount(param.count);\n    }\n  });\n  useEffect(() => {\n    const roomAIData = localStorage.getItem('room-ai-data');\n    const count = roomAIData ? JSON.parse(roomAIData)?.[GLOBAL_SUMMARY_CHATID]?.unreadCount || 0 : 0;\n    setUnreadCount(count);\n    eventEmitter.on(Actions.UpdateRoomAIUnreadCount, updateUnreadCount);\n    return () => {\n      eventEmitter.off(Actions.UpdateRoomAIUnreadCount, updateUnreadCount);\n    };\n  }, []);\n  return unreadCount;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"sG8AAzvK\",\"minimized\":\"lTOui0dp\",\"button\":\"bNkLqJf1\",\"title\":\"rMTpNazX\",\"unread-count\":\"O7esHjyC\",\"unreadCount\":\"O7esHjyC\",\"info\":\"OS2LWzdu\",\"name\":\"bkCtPuPQ\",\"icon\":\"f4LUPgr4\",\"avatarWrapper\":\"RMY__Znz\",\"avatar\":\"qeb0Aox1\",\"chatsPreview\":\"_1817Hwgd\",\"unread\":\"SS39xuL3\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useCallback, useMemo } from '../../../lib/teact/teact';\nimport { getActions, getGlobal } from '../../../global';\n\nimport type { GlobalState } from '../../../global/types';\nimport type { CustomPeer } from '../../../types';\n\nimport { ARCHIVED_FOLDER_ID } from '../../../config';\nimport { getChatTitle } from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\nimport { compact } from '../../../util/iteratees';\nimport { formatIntegerCompact } from '../../../util/textFormat';\nimport renderText from '../../common/helpers/renderText';\n\nimport { useFolderManagerForOrderedIds, useFolderManagerForUnreadCounters } from '../../../hooks/useFolderManager';\nimport useLang from '../../../hooks/useLang';\n\nimport Avatar from '../../common/Avatar';\nimport Icon from '../../common/icons/Icon';\nimport Badge from '../../ui/Badge';\nimport ListItem, { type MenuItemContextAction } from '../../ui/ListItem';\n\nimport styles from './Archive.module.scss';\n\ntype OwnProps = {\n  archiveSettings: GlobalState['archiveSettings'];\n  onDragEnter?: NoneToVoidFunction;\n  onClick?: NoneToVoidFunction;\n};\n\nconst PREVIEW_SLICE = 5;\nconst ARCHIVE_CUSTOM_PEER: CustomPeer = {\n  isCustomPeer: true,\n  title: 'Archived Chats',\n  avatarIcon: 'archive-filled',\n  customPeerAvatarColor: '#9EAAB5',\n};\n\nconst Archive: FC<OwnProps> = ({\n  archiveSettings,\n  onDragEnter,\n  onClick,\n}) => {\n  const { updateArchiveSettings } = getActions();\n  const lang = useLang();\n\n  const orderedChatIds = useFolderManagerForOrderedIds(ARCHIVED_FOLDER_ID);\n  const unreadCounters = useFolderManagerForUnreadCounters();\n  const archiveUnreadCount = unreadCounters[ARCHIVED_FOLDER_ID]?.chatsCount;\n\n  const previewItems = useMemo(() => {\n    if (!orderedChatIds?.length) return lang('Loading');\n\n    const chatsById = getGlobal().chats.byId;\n\n    return orderedChatIds.slice(0, PREVIEW_SLICE).map((chatId, i, arr) => {\n      const isLast = i === arr.length - 1;\n      const chat = chatsById[chatId];\n      if (!chat) {\n        return undefined;\n      }\n\n      const title = getChatTitle(lang, chat);\n\n      return (\n        <>\n          <span className={buildClassName(styles.chat, archiveUnreadCount && chat.unreadCount && styles.unread)}>\n            {renderText(title)}\n          </span>\n          {isLast ? '' : ', '}\n        </>\n      );\n    });\n  }, [orderedChatIds, lang, archiveUnreadCount]);\n\n  const contextActions = useMemo(() => {\n    const actionMinimize = !archiveSettings.isMinimized && {\n      title: lang('ContextArchiveCollapse'),\n      icon: 'collapse',\n      handler: () => {\n        updateArchiveSettings({ isMinimized: true });\n      },\n    } satisfies MenuItemContextAction;\n\n    const actionExpand = archiveSettings.isMinimized && {\n      title: lang('ContextArchiveExpand'),\n      icon: 'expand',\n      handler: () => {\n        updateArchiveSettings({ isMinimized: false });\n      },\n    } satisfies MenuItemContextAction;\n\n    const actionHide = {\n      title: lang('ContextArchiveToMenu'),\n      icon: 'archive-to-main',\n      handler: () => {\n        updateArchiveSettings({ isHidden: true });\n      },\n    } satisfies MenuItemContextAction;\n\n    return compact([actionMinimize, actionExpand, actionHide]);\n  }, [archiveSettings.isMinimized, lang, updateArchiveSettings]);\n\n  const handleDragEnter = useCallback((e) => {\n    e.preventDefault();\n    onDragEnter?.();\n  }, [onDragEnter]);\n\n  function renderCollapsed() {\n    return (\n      <div className={buildClassName(styles.info, 'info')}>\n        <div className=\"info-row\">\n          <div className={buildClassName('title', styles.title)}>\n            <h3 dir=\"auto\" className={buildClassName(styles.name, 'fullName')}>\n              <Icon name=\"archive-filled\" className={styles.icon} />\n              {lang('ArchivedChats')}\n            </h3>\n          </div>\n          <Badge\n            className={styles.unreadCount}\n            text={archiveUnreadCount ? formatIntegerCompact(lang, archiveUnreadCount) : undefined}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  function renderRegular() {\n    return (\n      <>\n        <div className={buildClassName('status', styles.avatarWrapper)}>\n          <Avatar peer={ARCHIVE_CUSTOM_PEER} />\n        </div>\n        <div className={buildClassName(styles.info, 'info')}>\n          <div className=\"info-row\">\n            <div className={buildClassName('title', styles.title)}>\n              <h3 dir=\"auto\" className={buildClassName(styles.name, 'fullName')}>{lang('ArchivedChats')}</h3>\n            </div>\n          </div>\n          <div className=\"subtitle\">\n            <div className={buildClassName('status', styles.chatsPreview)}>\n              {previewItems}\n            </div>\n            <Badge\n              className={styles.unreadCount}\n              text={archiveUnreadCount ? formatIntegerCompact(lang, archiveUnreadCount) : undefined}\n            />\n          </div>\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <ListItem\n      onClick={onClick}\n      onDragEnter={handleDragEnter}\n      className={buildClassName(\n        styles.root,\n        archiveSettings.isMinimized && styles.minimized,\n        'chat-item-clickable',\n        'chat-item-archive',\n      )}\n      buttonClassName={styles.button}\n      contextActions={contextActions}\n      withPortalForMenu\n    >\n      {archiveSettings.isMinimized ? renderCollapsed() : renderRegular()}\n    </ListItem>\n  );\n};\n\nexport default memo(Archive);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"yftKUVDQ\",\"sticker\":\"UCBfMOiz\",\"title\":\"dB9cHelg\",\"description\":\"TJ_liZcJ\",\"is-ios\":\"z51XfrFn\",\"isIos\":\"z51XfrFn\",\"is-macos\":\"tiLqJXxs\",\"isMacos\":\"tiLqJXxs\",\"button-text\":\"aL7e0w4t\",\"buttonText\":\"aL7e0w4t\",\"centered\":\"NefQ8HbN\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useCallback } from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../global';\n\nimport type { ApiChatFolder, ApiSticker } from '../../../api/types';\nimport type { FolderEditDispatch } from '../../../hooks/reducers/useFoldersReducer';\nimport { SettingsScreens } from '../../../types';\n\nimport { selectAnimatedEmoji, selectChatFolder } from '../../../global/selectors';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport AnimatedIconFromSticker from '../../common/AnimatedIconFromSticker';\nimport Icon from '../../common/icons/Icon';\nimport Button from '../../ui/Button';\n\nimport styles from './EmptyFolder.module.scss';\nimport { FolderType } from \"./ChatList\"\n\ntype OwnProps = {\n  folderId?: number;\n  folderType: FolderType;\n  foldersDispatch: FolderEditDispatch;\n  onSettingsScreenSelect: (screen: SettingsScreens) => void;\n};\n\ntype StateProps = {\n  chatFolder?: ApiChatFolder;\n  animatedEmoji?: ApiSticker;\n};\n\nconst ICON_SIZE = 96;\n\nconst EmptyFolder: FC<OwnProps & StateProps> = ({\n  chatFolder, animatedEmoji, foldersDispatch, onSettingsScreenSelect,\n}) => {\n  const lang = useOldLang();\n  const { isMobile } = useAppLayout();\n\n  const handleEditFolder = useCallback(() => {\n    foldersDispatch({ type: 'editFolder', payload: chatFolder });\n    onSettingsScreenSelect(SettingsScreens.FoldersEditFolderFromChatList);\n  }, [chatFolder, foldersDispatch, onSettingsScreenSelect]);\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.sticker}>\n        {animatedEmoji && <AnimatedIconFromSticker sticker={animatedEmoji} size={ICON_SIZE} />}\n      </div>\n      <h3 className={styles.title} dir=\"auto\">{lang('FilterNoChatsToDisplay')}</h3>\n      <p className={styles.description} dir=\"auto\">\n        {lang(chatFolder ? 'ChatList.EmptyChatListFilterText' : 'Chat.EmptyChat')}\n      </p>\n      {chatFolder && (\n        <Button\n          ripple={!isMobile}\n          fluid\n          pill\n          onClick={handleEditFolder}\n          size=\"smaller\"\n          isRtl={lang.isRtl}\n        >\n          <Icon name=\"settings\" />\n          <div className={styles.buttonText}>\n            {lang('ChatList.EmptyChatListEditFilter')}\n          </div>\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>((global, { folderId, folderType }): StateProps => {\n  const chatFolder = folderId && folderType === 'folder' ? selectChatFolder(global, folderId) : undefined;\n\n  return {\n    chatFolder,\n    animatedEmoji: selectAnimatedEmoji(global, ''),\n  };\n})(EmptyFolder));\n","import React, { memo } from '../../../lib/teact/teact';\n\nimport useLang from '../../../hooks/useLang';\n\nimport styles from './FrozenAccountNotification.module.scss';\n\ntype OwnProps = {\n  onClick: () => void;\n};\n\nconst FrozenAccountNotification = ({ onClick }: OwnProps) => {\n  const lang = useLang();\n\n  return (\n    <div\n      className={styles.root}\n      onClick={onClick}\n    >\n      <div className={styles.title}>{lang('TitleFrozenAccount')}</div>\n      <div className={styles.subtitle}>{lang('SubtitleFrozenAccount')}</div>\n    </div>\n  );\n};\n\nexport default memo(FrozenAccountNotification);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"fOmerTkM\",\"title\":\"URLYINJA\",\"subtitle\":\"mCFsx7Tv\"};","// extracted by mini-css-extract-plugin\nexport default {\"minimized\":\"lTOui0dp\",\"root\":\"yEkGgZVL\",\"title\":\"VhAJDrnz\",\"info\":\"WmyL1NJ8\",\"buttons\":\"_40UGD1Y\",\"button\":\"pedMJD_v\"};","import React, { memo, useMemo, useRef } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiSession } from '../../../api/types';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useResizeObserver from '../../../hooks/useResizeObserver';\n\nimport Button from '../../ui/Button';\n\nimport styles from './UnconfirmedSession.module.scss';\n\ntype OwnProps = {\n  sessions: Record<string, ApiSession>;\n  onHeightChange: (height: number) => void;\n};\n\nconst UnconfirmedSession = ({ sessions, onHeightChange } : OwnProps) => {\n  const { changeSessionSettings, terminateAuthorization, showNotification } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const lang = useOldLang();\n\n  useResizeObserver(ref, (entry) => {\n    const height = entry.borderBoxSize?.[0]?.blockSize || entry.contentRect.height;\n    onHeightChange(height);\n  });\n\n  const firstUnconfirmed = useMemo(() => {\n    return Object.values(sessions).sort((a, b) => b.dateCreated - a.dateCreated)\n      .find((session) => session.isUnconfirmed)!;\n  }, [sessions]);\n\n  const locationString = useMemo(() => {\n    return [firstUnconfirmed.deviceModel, firstUnconfirmed.region, firstUnconfirmed.country].filter(Boolean).join(', ');\n  }, [firstUnconfirmed]);\n\n  const handleAccept = useLastCallback(() => {\n    changeSessionSettings({\n      hash: firstUnconfirmed.hash,\n      isConfirmed: true,\n    });\n  });\n\n  const handleReject = useLastCallback(() => {\n    terminateAuthorization({ hash: firstUnconfirmed.hash });\n    showNotification({\n      title: lang('UnconfirmedAuthDeniedTitle', 1),\n      message: lang('UnconfirmedAuthDeniedMessageSingle', locationString),\n    });\n  });\n\n  return (\n    <div className={styles.root} ref={ref}>\n      <h2 className={styles.title}>{lang('UnconfirmedAuthTitle')}</h2>\n      <p className={styles.info}>\n        {lang('UnconfirmedAuthSingle', locationString)}\n      </p>\n      <div className={styles.buttons}>\n        <Button fluid isText size=\"smaller\" className={styles.button} onClick={handleAccept}>\n          {lang('UnconfirmedAuthConfirm')}\n        </Button>\n        <Button fluid isText size=\"smaller\" color=\"danger\" onClick={handleReject} className={styles.button}>\n          {lang('UnconfirmedAuthDeny')}\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(UnconfirmedSession);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useEffect, useMemo, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiSession } from '../../../api/types';\nimport type { GlobalState } from '../../../global/types';\nimport type { FolderEditDispatch } from '../../../hooks/reducers/useFoldersReducer';\nimport type { SettingsScreens } from '../../../types';\nimport { LeftColumnContent } from '../../../types';\n\nimport {\n  AI_FOLDER_ID,\n  ALL_FOLDER_ID,\n  ARCHIVE_MINIMIZED_HEIGHT,\n  ARCHIVED_FOLDER_ID,\n  CHAT_HEIGHT_PX,\n  CHAT_LIST_SLICE,\n  FRESH_AUTH_PERIOD,\n  PRESET_FOLDER_ID,\n  SAVED_FOLDER_ID,\n  UNREAD_FOLDER_ID,\n} from '../../../config';\nimport { IS_APP, IS_MAC_OS } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { getOrderKey, getPinnedChatsCount } from '../../../util/folderManager';\nimport { getServerTime } from '../../../util/serverTime';\nimport ChatSerena from '../../chatAssistant/globalSummary/chat-serana';\n\nimport usePeerStoriesPolling from '../../../hooks/polling/usePeerStoriesPolling';\nimport useTopOverscroll from '../../../hooks/scroll/useTopOverscroll';\nimport useDebouncedCallback from '../../../hooks/useDebouncedCallback';\nimport { useFolderManagerForOrderedIds } from '../../../hooks/useFolderManager';\nimport { useHotkeys } from '../../../hooks/useHotkeys';\nimport useInfiniteScroll from '../../../hooks/useInfiniteScroll';\nimport { useIntersectionObserver } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOrderDiff from './hooks/useOrderDiff';\n\nimport InfiniteScroll from '../../ui/InfiniteScroll';\nimport Loading from '../../ui/Loading';\nimport Archive from './Archive';\nimport Chat from './Chat';\nimport EmptyFolder from './EmptyFolder';\nimport FrozenAccountNotification from './FrozenAccountNotification';\nimport UnconfirmedSession from './UnconfirmedSession';\n\nexport type FolderType = 'all' | 'archived' | 'saved' | 'folder' | 'preset' | 'unread' | 'ai'\n\ntype OwnProps = {\n  className?: string;\n  folderType: FolderType;\n  folderId?: number;\n  isActive: boolean;\n  canDisplayArchive?: boolean;\n  archiveSettings?: GlobalState['archiveSettings'];\n  isForumPanelOpen?: boolean;\n  sessions?: Record<string, ApiSession>;\n  foldersDispatch?: FolderEditDispatch;\n  onSettingsScreenSelect?: (screen: SettingsScreens) => void;\n  onLeftColumnContentChange?: (content: LeftColumnContent) => void;\n  isAccountFrozen?: boolean;\n  activeTag?: string[];\n};\n\nconst INTERSECTION_THROTTLE = 200;\nconst DRAG_ENTER_DEBOUNCE = 500;\nconst RESERVED_HOTKEYS = new Set(['9', '0']);\n\nconst ChatList: FC<OwnProps> = ({\n  className,\n  folderType,\n  folderId,\n  isActive,\n  isForumPanelOpen,\n  canDisplayArchive,\n  archiveSettings,\n  sessions,\n  foldersDispatch,\n  onSettingsScreenSelect,\n  onLeftColumnContentChange,\n  isAccountFrozen,\n}) => {\n  const {\n    openChat,\n    openNextChat,\n    closeForumPanel,\n    toggleStoryRibbon,\n    openFrozenAccountModal,\n  } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  const shouldIgnoreDragRef = useRef(false);\n  const [unconfirmedSessionHeight, setUnconfirmedSessionHeight] = useState(0);\n\n  const isArchived = folderType === 'archived';\n  const isAllFolder = folderType === 'all';\n  const isSaved = folderType === 'saved';\n  const isPresetFolder = folderType === 'preset';\n  const isUnreadFolder = folderType === 'unread';\n  const isAIFolder = folderType === 'ai';\n  const resolvedFolderId = (\n    isAllFolder ? ALL_FOLDER_ID : isArchived ? ARCHIVED_FOLDER_ID : isSaved ? SAVED_FOLDER_ID : isPresetFolder ? PRESET_FOLDER_ID : isUnreadFolder ? UNREAD_FOLDER_ID : isAIFolder ? AI_FOLDER_ID : folderId!\n  );\n\n  const shouldDisplayArchive = isAllFolder && canDisplayArchive && archiveSettings;\n  const shouldShowFrozenAccountNotification = isAccountFrozen && isAllFolder;\n\n  const orderedIds = useFolderManagerForOrderedIds(resolvedFolderId);\n  usePeerStoriesPolling(orderedIds);\n\n  const chatsHeight = (orderedIds?.length || 0) * CHAT_HEIGHT_PX;\n  const archiveHeight = shouldDisplayArchive\n    ? archiveSettings?.isMinimized ? ARCHIVE_MINIMIZED_HEIGHT : CHAT_HEIGHT_PX : 0;\n  const serenaHeight = resolvedFolderId === ALL_FOLDER_ID ? CHAT_HEIGHT_PX : 0;\n  const frozenNotificationHeight = shouldShowFrozenAccountNotification ? 68 : 0;\n\n  const { orderDiffById, getAnimationType } = useOrderDiff(orderedIds);\n\n  const [viewportIds, getMore] = useInfiniteScroll(undefined, orderedIds, undefined, CHAT_LIST_SLICE);\n\n  const shouldShowUnconfirmedSessions = useMemo(() => {\n    const sessionsArray = Object.values(sessions || {});\n    const current = sessionsArray.find((session) => session.isCurrent);\n    if (!current || getServerTime() - current.dateCreated < FRESH_AUTH_PERIOD) return false;\n\n    return !isAccountFrozen && isAllFolder && sessionsArray.some((session) => session.isUnconfirmed);\n  }, [isAllFolder, sessions, isAccountFrozen]);\n\n  useEffect(() => {\n    if (!shouldShowUnconfirmedSessions) setUnconfirmedSessionHeight(0);\n  }, [shouldShowUnconfirmedSessions]);\n\n  // Support <Alt>+<Up/Down> to navigate between chats\n  useHotkeys(useMemo(() => (isActive && orderedIds?.length ? {\n    'Alt+ArrowUp': (e: KeyboardEvent) => {\n      e.preventDefault();\n      openNextChat({ targetIndexDelta: -1, orderedIds });\n    },\n    'Alt+ArrowDown': (e: KeyboardEvent) => {\n      e.preventDefault();\n      openNextChat({ targetIndexDelta: 1, orderedIds });\n    },\n  } : undefined), [isActive, orderedIds]));\n\n  // Support <Cmd>+<Digit> to navigate between chats\n  useEffect(() => {\n    if (!isActive || isSaved || !orderedIds || !IS_APP) {\n      return undefined;\n    }\n\n    function handleKeyDown(e: KeyboardEvent) {\n      if (((IS_MAC_OS && e.metaKey) || (!IS_MAC_OS && e.ctrlKey)) && e.code.startsWith('Digit')) {\n        const [, digit] = e.code.match(/Digit(\\d)/) || [];\n        if (!digit || RESERVED_HOTKEYS.has(digit)) return;\n\n        const isArchiveInList = shouldDisplayArchive && archiveSettings && !archiveSettings.isMinimized;\n\n        const shift = isArchiveInList ? -1 : 0;\n        const position = Number(digit) + shift - 1;\n\n        if (isArchiveInList && position === -1) {\n          onLeftColumnContentChange?.(LeftColumnContent.Archived);\n          return;\n        }\n\n        if (position > orderedIds!.length - 1) return;\n\n        openChat({ id: orderedIds![position], shouldReplaceHistory: true });\n      }\n    }\n\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [\n    archiveSettings, isSaved, isActive, onLeftColumnContentChange, openChat, openNextChat, orderedIds,\n    shouldDisplayArchive,\n  ]);\n\n  const { observe } = useIntersectionObserver({\n    rootRef: containerRef,\n    throttleMs: INTERSECTION_THROTTLE,\n  });\n\n  const handleArchivedClick = useLastCallback(() => {\n    onLeftColumnContentChange!(LeftColumnContent.Archived);\n    closeForumPanel();\n  });\n\n  const handleFrozenAccountNotificationClick = useLastCallback(() => {\n    openFrozenAccountModal();\n  });\n\n  const handleArchivedDragEnter = useLastCallback(() => {\n    if (shouldIgnoreDragRef.current) {\n      shouldIgnoreDragRef.current = false;\n      return;\n    }\n    handleArchivedClick();\n  });\n\n  const handleDragEnter = useDebouncedCallback((chatId: string) => {\n    if (shouldIgnoreDragRef.current) {\n      shouldIgnoreDragRef.current = false;\n      return;\n    }\n    openChat({ id: chatId, shouldReplaceHistory: true });\n  }, [openChat], DRAG_ENTER_DEBOUNCE, true);\n\n  const handleDragLeave = useLastCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    if (x < rect.width || y < rect.y) return;\n    shouldIgnoreDragRef.current = true;\n  });\n\n  const handleShowStoryRibbon = useLastCallback(() => {\n    toggleStoryRibbon({ isShown: true, isArchived });\n  });\n\n  const handleHideStoryRibbon = useLastCallback(() => {\n    toggleStoryRibbon({ isShown: false, isArchived });\n  });\n\n  const renderedOverflowTrigger = useTopOverscroll(containerRef, handleShowStoryRibbon, handleHideStoryRibbon, isSaved);\n\n  function renderChats() {\n    const viewportOffset = orderedIds!.indexOf(viewportIds![0]);\n\n    const pinnedCount = getPinnedChatsCount(resolvedFolderId) || 0;\n\n    return viewportIds!.map((id, i) => {\n      const isPinned = viewportOffset + i < pinnedCount;\n      const offsetTop = unconfirmedSessionHeight + archiveHeight + frozenNotificationHeight + serenaHeight\n      + (viewportOffset + i) * CHAT_HEIGHT_PX;\n      return (\n        <Chat\n          key={id}\n          teactOrderKey={isPinned ? i : getOrderKey(id, isSaved)}\n          chatId={id}\n          isPinned={isPinned}\n          folderId={folderId}\n          isSavedDialog={isSaved}\n          animationType={getAnimationType(id)}\n          orderDiff={orderDiffById[id]}\n          offsetTop={offsetTop}\n          observeIntersection={observe}\n          onDragEnter={handleDragEnter}\n        />\n      );\n    });\n  }\n\n  return (\n    <InfiniteScroll\n      className={buildClassName('chat-list custom-scroll', isForumPanelOpen && 'forum-panel-open', className)}\n      ref={containerRef}\n      items={viewportIds}\n      itemSelector=\".ListItem:not(.chat-item-archive)\"\n      preloadBackwards={CHAT_LIST_SLICE}\n      withAbsolutePositioning\n      beforeChildren={renderedOverflowTrigger}\n      maxHeight={chatsHeight + archiveHeight + frozenNotificationHeight + unconfirmedSessionHeight}\n      onLoadMore={getMore}\n      onDragLeave={handleDragLeave}\n    >\n      {shouldShowUnconfirmedSessions && (\n        <UnconfirmedSession\n          key=\"unconfirmed\"\n          sessions={sessions!}\n          onHeightChange={setUnconfirmedSessionHeight}\n        />\n      )}\n      {shouldShowFrozenAccountNotification && (\n        <FrozenAccountNotification\n          key=\"frozen\"\n          onClick={handleFrozenAccountNotificationClick}\n        />\n      )}\n      {shouldDisplayArchive && (\n        <Archive\n          key=\"archive\"\n          archiveSettings={archiveSettings}\n          onClick={handleArchivedClick}\n          onDragEnter={handleArchivedDragEnter}\n        />\n      )}\n      {resolvedFolderId === ALL_FOLDER_ID && (\n        <ChatSerena\n          key=\"serena\"\n          frozenNotificationHeight={frozenNotificationHeight}\n          archiveHeight={archiveHeight}\n          unconfirmedSessionHeight={unconfirmedSessionHeight}\n        />\n      )}\n\n      {viewportIds?.length ? (\n        renderChats()\n      ) : viewportIds && !viewportIds.length && !isSaved ? (\n        (\n          <EmptyFolder\n            folderId={folderId}\n            folderType={folderType}\n            foldersDispatch={foldersDispatch!}\n            onSettingsScreenSelect={onSettingsScreenSelect!}\n          />\n        )\n      ) : (\n        <Loading key=\"loading\" />\n      )}\n    </InfiniteScroll>\n  );\n};\n\nexport default memo(ChatList);\n","import React, { useEffect, useRef } from '../../lib/teact/teact';\n\nimport { forceMutation, requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { IS_IOS, IS_SAFARI } from '../../util/browser/windowEnvironment';\nimport { stopScrollInertia } from '../../util/resetScroll';\nimport useDebouncedCallback from '../useDebouncedCallback';\nimport useLastCallback from '../useLastCallback';\n\nconst MOUSE_WHEEL_DEBOUNCE = 250;\nconst TRIGGER_HEIGHT = 1;\nconst INERTIA_THRESHOLD = 100;\n\nexport default function useTopOverscroll(\n  containerRef: React.RefObject<HTMLDivElement>,\n  onOverscroll?: AnyToVoidFunction,\n  onReset?: AnyToVoidFunction,\n  isDisabled?: boolean,\n) {\n  // eslint-disable-next-line no-null/no-null\n  const overscrollTriggerRef = useRef<HTMLDivElement>(null);\n\n  const isTriggerJustEnabled = useRef(false);\n  const lastScrollTopRef = useRef(0);\n  const isTriggerEnabledRef = useRef(false);\n  const lastIsOnTopRef = useRef(true);\n  const lastScrollAtRef = useRef(0);\n  const isReturningOverscrollRef = useRef(false);\n\n  const enableOverscrollTrigger = useLastCallback((noScrollInertiaStop = false) => {\n    if (isTriggerEnabledRef.current) return;\n    if (!overscrollTriggerRef.current || !containerRef.current) return;\n\n    overscrollTriggerRef.current.style.display = 'block';\n    containerRef.current.scrollTop = TRIGGER_HEIGHT;\n\n    if (!IS_SAFARI && !noScrollInertiaStop) {\n      stopScrollInertia(containerRef.current);\n    }\n\n    isTriggerJustEnabled.current = true;\n    lastScrollTopRef.current = TRIGGER_HEIGHT;\n    isTriggerEnabledRef.current = true;\n    lastIsOnTopRef.current = true;\n  });\n\n  const disableOverscrollTrigger = useLastCallback(() => {\n    if (!isTriggerEnabledRef.current) return;\n    if (!overscrollTriggerRef.current) return;\n\n    overscrollTriggerRef.current.style.display = 'none';\n\n    isTriggerEnabledRef.current = false;\n  });\n\n  const handleScroll = useLastCallback(() => {\n    if (!containerRef.current) return;\n\n    if (isTriggerJustEnabled.current) {\n      isTriggerJustEnabled.current = false;\n\n      return;\n    }\n\n    const newScrollTop = containerRef.current.scrollTop;\n    const isMovingDown = newScrollTop > lastScrollTopRef.current;\n    const isMovingUp = newScrollTop < lastScrollTopRef.current;\n    const isOnTop = newScrollTop === 0;\n    const lastEventDelay = Date.now() - lastScrollAtRef.current;\n\n    if (overscrollTriggerRef.current) {\n      if (isOnTop && !isTriggerEnabledRef.current) {\n        forceMutation(enableOverscrollTrigger, [containerRef.current, overscrollTriggerRef.current]);\n        return;\n      }\n\n      forceMutation(disableOverscrollTrigger, overscrollTriggerRef.current);\n    }\n\n    if (\n      isMovingUp && (\n        (lastIsOnTopRef.current && lastEventDelay > INERTIA_THRESHOLD)\n        || (newScrollTop < 0 && isReturningOverscrollRef.current) // Overscroll repeated by the user\n      )) {\n      onOverscroll?.();\n    } else if (isMovingDown && newScrollTop > 0) {\n      onReset?.();\n    }\n\n    lastScrollTopRef.current = newScrollTop;\n    lastIsOnTopRef.current = isOnTop;\n    lastScrollAtRef.current = Date.now();\n    isReturningOverscrollRef.current = isMovingDown && newScrollTop < 0;\n  });\n\n  // Handle non-scrollable container\n  const handleWheel = useDebouncedCallback((event: WheelEvent) => {\n    if (!containerRef.current) return;\n    const container = containerRef.current;\n\n    const isScrollable = container.scrollHeight > container.offsetHeight;\n    if (isScrollable || event.deltaY === 0) return;\n\n    if (event.deltaY < 0) {\n      onOverscroll?.();\n    } else {\n      onReset?.();\n    }\n  }, [containerRef, onOverscroll, onReset], MOUSE_WHEEL_DEBOUNCE);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return undefined;\n\n    if (container.scrollTop === 0) {\n      requestMutation(() => {\n        enableOverscrollTrigger(true);\n      });\n    }\n\n    container.addEventListener('scroll', handleScroll, { passive: true });\n    container.addEventListener('wheel', handleWheel, { passive: true });\n\n    return () => {\n      container.removeEventListener('scroll', handleScroll);\n      container.removeEventListener('wheel', handleWheel);\n    };\n  }, [containerRef, handleWheel]);\n\n  return !IS_IOS && !isDisabled ? (\n    <div ref={overscrollTriggerRef} className=\"overscroll-trigger\" key=\"overscroll-trigger\" />\n  ) : undefined;\n}\n","import {\n  useEffect, useMemo, useRef, useState,\n} from '../lib/teact/teact';\n\nimport { ApiMediaFormat } from '../api/types';\n\nimport { selectIsSynced } from '../global/selectors';\nimport { IS_PROGRESSIVE_SUPPORTED } from '../util/browser/windowEnvironment';\nimport * as mediaLoader from '../util/mediaLoader';\nimport { throttle } from '../util/schedulers';\nimport useSelector from './data/useSelector';\nimport useForceUpdate from './useForceUpdate';\nimport useUniqueId from './useUniqueId';\n\nconst STREAMING_PROGRESS = 0.75;\nconst STREAMING_TIMEOUT = 1500;\nconst PROGRESS_THROTTLE = 500;\n\nexport default function useMediaWithLoadProgress(\n  mediaHash: string | undefined,\n  noLoad = false,\n  mediaFormat = ApiMediaFormat.BlobUrl,\n  delay?: number | false,\n  isHtmlAllowed = false,\n) {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory(mediaHash) : undefined;\n  const isStreaming = IS_PROGRESSIVE_SUPPORTED && mediaFormat === ApiMediaFormat.Progressive;\n  const forceUpdate = useForceUpdate();\n  const isSynced = useSelector(selectIsSynced);\n  const id = useUniqueId();\n  const [loadProgress, setLoadProgress] = useState(mediaData && !isStreaming ? 1 : 0);\n  const startedAtRef = useRef<number>();\n\n  const handleProgress = useMemo(() => {\n    return throttle((progress: number) => {\n      if (startedAtRef.current && (!delay || (Date.now() - startedAtRef.current > delay))) {\n        setLoadProgress(progress);\n      }\n    }, PROGRESS_THROTTLE, true);\n  }, [delay]);\n\n  useEffect(() => {\n    if (!noLoad && mediaHash) {\n      if (!mediaData) {\n        setLoadProgress(0);\n\n        if (startedAtRef.current) {\n          mediaLoader.cancelProgress(handleProgress);\n        }\n\n        startedAtRef.current = Date.now();\n\n        mediaLoader.fetch(mediaHash, mediaFormat, isHtmlAllowed, handleProgress, id).then(() => {\n          const spentTime = Date.now() - startedAtRef.current!;\n          startedAtRef.current = undefined;\n\n          if (!delay || spentTime >= delay) {\n            forceUpdate();\n          } else {\n            setTimeout(forceUpdate, delay - spentTime);\n          }\n        });\n      } else if (isStreaming) {\n        setTimeout(() => {\n          setLoadProgress(STREAMING_PROGRESS);\n        }, STREAMING_TIMEOUT);\n      }\n    }\n  }, [\n    noLoad, mediaHash, mediaData, mediaFormat, isStreaming, delay, handleProgress, isHtmlAllowed, id, isSynced,\n  ]);\n\n  useEffect(() => {\n    if (noLoad && startedAtRef.current) {\n      mediaLoader.cancelProgress(handleProgress);\n      setLoadProgress(0);\n      startedAtRef.current = undefined;\n    }\n  }, [handleProgress, noLoad]);\n\n  useEffect(() => {\n    return () => {\n      if (mediaHash) {\n        mediaLoader.removeCallback(mediaHash, id);\n      }\n    };\n  }, [id, mediaHash]);\n\n  return { mediaData, loadProgress };\n}\n","import type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, {\n  memo, useEffect, useMemo, useRef,\n} from '../../lib/teact/teact';\n\nimport type { ApiChat, ApiPhoto, ApiUser } from '../../api/types';\n\nimport {\n  getChatAvatarHash,\n  getChatTitle,\n  getPhotoMediaHash,\n  getProfilePhotoMediaHash,\n  getUserFullName,\n  getVideoProfilePhotoMediaHash,\n  isAnonymousForwardsChat,\n  isChatWithRepliesBot,\n  isDeletedUser,\n  isUserId,\n} from '../../global/helpers';\nimport { IS_CANVAS_FILTER_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport buildClassName from '../../util/buildClassName';\nimport { getFirstLetters } from '../../util/textFormat';\nimport { getPeerColorClass } from './helpers/peerColor';\nimport renderText from './helpers/renderText';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useCanvasBlur from '../../hooks/useCanvasBlur';\nimport useFlag from '../../hooks/useFlag';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaTransitionDeprecated from '../../hooks/useMediaTransitionDeprecated';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport OptimizedVideo from '../ui/OptimizedVideo';\nimport Spinner from '../ui/Spinner';\nimport Icon from './icons/Icon';\n\nimport './ProfilePhoto.scss';\n\ntype OwnProps = {\n  chat?: ApiChat;\n  user?: ApiUser;\n  isSavedMessages?: boolean;\n  isSavedDialog?: boolean;\n  photo?: ApiPhoto;\n  canPlayVideo: boolean;\n  onClick: NoneToVoidFunction;\n};\n\nconst ProfilePhoto: FC<OwnProps> = ({\n  chat,\n  user,\n  photo,\n  isSavedMessages,\n  isSavedDialog,\n  canPlayVideo,\n  onClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const videoRef = useRef<HTMLVideoElement>(null);\n\n  const lang = useOldLang();\n  const { isMobile } = useAppLayout();\n\n  const isDeleted = user && isDeletedUser(user);\n  const isRepliesChat = chat && isChatWithRepliesBot(chat.id);\n  const isAnonymousForwards = chat && isAnonymousForwardsChat(chat.id);\n  const peer = (user || chat)!;\n  const canHaveMedia = peer && !isSavedMessages && !isDeleted && !isRepliesChat && !isAnonymousForwards;\n  const { isVideo } = photo || {};\n\n  const avatarHash = (!photo || photo.id === peer.avatarPhotoId) && getChatAvatarHash(peer, 'normal');\n\n  const previewHash = canHaveMedia && photo && !avatarHash && getPhotoMediaHash(photo, 'pictogram');\n  const previewBlobUrl = useMedia(previewHash || avatarHash);\n\n  const photoHash = canHaveMedia && photo && !isVideo && getProfilePhotoMediaHash(photo);\n  const photoBlobUrl = useMedia(photoHash);\n\n  const videoHash = canHaveMedia && photo && isVideo && getVideoProfilePhotoMediaHash(photo);\n  const videoBlobUrl = useMedia(videoHash);\n\n  const fullMediaData = videoBlobUrl || photoBlobUrl;\n  const [isVideoReady, markVideoReady] = useFlag();\n  const isFullMediaReady = Boolean(fullMediaData && (!isVideo || isVideoReady));\n  const transitionClassNames = useMediaTransitionDeprecated(isFullMediaReady);\n  const isBlurredThumb = canHaveMedia && !isFullMediaReady && !previewBlobUrl && photo?.thumbnail?.dataUri;\n  const blurredThumbCanvasRef = useCanvasBlur(\n    photo?.thumbnail?.dataUri, !isBlurredThumb, isMobile && !IS_CANVAS_FILTER_SUPPORTED,\n  );\n  const hasMedia = photo || previewBlobUrl || isBlurredThumb;\n\n  useEffect(() => {\n    if (videoRef.current && !canPlayVideo) {\n      videoRef.current.currentTime = 0;\n    }\n  }, [canPlayVideo]);\n\n  const specialIcon = useMemo(() => {\n    if (isSavedMessages) {\n      return isSavedDialog ? 'my-notes' : 'avatar-saved-messages';\n    }\n\n    if (isDeleted) {\n      return 'avatar-deleted-account';\n    }\n\n    if (isRepliesChat) {\n      return 'reply-filled';\n    }\n\n    if (isAnonymousForwards) {\n      return 'author-hidden';\n    }\n\n    return undefined;\n  }, [isAnonymousForwards, isDeleted, isSavedDialog, isRepliesChat, isSavedMessages]);\n\n  let content: TeactNode | undefined;\n\n  if (specialIcon) {\n    content = <Icon name={specialIcon} role=\"img\" />;\n  } else if (hasMedia) {\n    content = (\n      <>\n        {isBlurredThumb ? (\n          <canvas ref={blurredThumbCanvasRef} className=\"thumb\" />\n        ) : (\n          <img src={previewBlobUrl} draggable={false} className=\"thumb\" alt=\"\" />\n        )}\n        {photo && (\n          isVideo ? (\n            <OptimizedVideo\n              canPlay={canPlayVideo}\n              ref={videoRef}\n              src={fullMediaData}\n              className={buildClassName('avatar-media', transitionClassNames)}\n              muted\n              disablePictureInPicture\n              loop\n              playsInline\n              onReady={markVideoReady}\n            />\n          ) : (\n            <img\n              src={fullMediaData}\n              className={buildClassName('avatar-media', transitionClassNames)}\n              alt=\"\"\n            />\n          )\n        )}\n      </>\n    );\n  } else if (user) {\n    const userFullName = getUserFullName(user);\n    content = userFullName ? getFirstLetters(userFullName, 2) : undefined;\n  } else if (chat) {\n    const title = getChatTitle(lang, chat);\n    content = title && getFirstLetters(title, isUserId(chat.id) ? 2 : 1);\n  } else {\n    content = (\n      <div className=\"spinner-wrapper\">\n        <Spinner color=\"white\" />\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'ProfilePhoto',\n    getPeerColorClass(peer),\n    isSavedMessages && 'saved-messages',\n    isAnonymousForwards && 'anonymous-forwards',\n    isDeleted && 'deleted-account',\n    isRepliesChat && 'replies-bot-account',\n    (!isSavedMessages && !hasMedia) && 'no-photo',\n  );\n\n  return (\n    <div className={fullClassName} onClick={hasMedia ? onClick : undefined}>\n      {typeof content === 'string' ? renderText(content, ['hq_emoji']) : content}\n    </div>\n  );\n};\n\nexport default memo(ProfilePhoto);\n","// extracted by mini-css-extract-plugin\nexport default {\"fallbackPhoto\":\"Wm9Ygb23\",\"fallbackPhotoContents\":\"nflKKT3R\",\"fallbackPhotoVisible\":\"tFkRrvxe\",\"fallbackPhotoAvatar\":\"R7w3H5eC\",\"photoWrapper\":\"GBGLnrA7\",\"photoDashes\":\"uyvKpR3B\",\"photoDash\":\"wB4yjvei\",\"photoDash_current\":\"aZmp9FLh\",\"photoDashCurrent\":\"aZmp9FLh\",\"navigation\":\"ZZRcBh8v\",\"navigation_prev\":\"RQITz4WQ\",\"navigationPrev\":\"RQITz4WQ\",\"navigation_next\":\"_0F1Txru\",\"navigationNext\":\"_0F1Txru\",\"info\":\"UcyW7tVh\",\"status\":\"cpyXyZDl\",\"user-status\":\"_HDVUj4P\",\"userStatus\":\"_HDVUj4P\",\"get-status\":\"Qga38M20\",\"getStatus\":\"Qga38M20\",\"topicContainer\":\"yzg267rr\",\"topicTitle\":\"umOuiu3K\",\"topicIcon\":\"ZCxp0_t4\",\"topicIconTitle\":\"lkfZNWOm\",\"topicMessagesCounter\":\"tLTzQ2ks\"};","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useEffect, useState } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type {\n  ApiChat, ApiPeerPhotos, ApiSticker, ApiTopic, ApiUser, ApiUserStatus,\n} from '../../api/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport {\n  getUserStatus, isAnonymousForwardsChat, isChatChannel, isSystemBot, isUserOnline,\n} from '../../global/helpers';\nimport {\n  selectChat,\n  selectCurrentMessageList,\n  selectPeerPhotos,\n  selectTabState,\n  selectThreadMessagesCount,\n  selectTopic,\n  selectUser,\n  selectUserStatus,\n} from '../../global/selectors';\nimport { IS_TOUCH_ENV } from '../../util/browser/windowEnvironment';\nimport buildClassName from '../../util/buildClassName';\nimport { captureEvents, SwipeDirection } from '../../util/captureEvents';\nimport { MEMO_EMPTY_ARRAY } from '../../util/memo';\nimport renderText from './helpers/renderText';\n\nimport useIntervalForceUpdate from '../../hooks/schedulers/useIntervalForceUpdate';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\nimport usePreviousDeprecated from '../../hooks/usePreviousDeprecated';\nimport usePhotosPreload from './hooks/usePhotosPreload';\n\nimport Transition from '../ui/Transition';\nimport Avatar from './Avatar';\nimport FullNameTitle from './FullNameTitle';\nimport ProfilePhoto from './ProfilePhoto';\nimport TopicIcon from './TopicIcon';\n\nimport './ProfileInfo.scss';\nimport styles from './ProfileInfo.module.scss';\n\ntype OwnProps = {\n  peerId: string;\n  forceShowSelf?: boolean;\n  canPlayVideo: boolean;\n};\n\ntype StateProps =\n  {\n    user?: ApiUser;\n    userStatus?: ApiUserStatus;\n    chat?: ApiChat;\n    mediaIndex?: number;\n    avatarOwnerId?: string;\n    topic?: ApiTopic;\n    messagesCount?: number;\n    emojiStatusSticker?: ApiSticker;\n    emojiStatusSlug?: string;\n    profilePhotos?: ApiPeerPhotos;\n  };\n\nconst EMOJI_STATUS_SIZE = 24;\nconst EMOJI_TOPIC_SIZE = 120;\nconst LOAD_MORE_THRESHOLD = 3;\nconst MAX_PHOTO_DASH_COUNT = 30;\nconst STATUS_UPDATE_INTERVAL = 1000 * 60; // 1 min\n\nconst ProfileInfo: FC<OwnProps & StateProps> = ({\n  forceShowSelf,\n  canPlayVideo,\n  user,\n  userStatus,\n  chat,\n  mediaIndex,\n  avatarOwnerId,\n  topic,\n  messagesCount,\n  emojiStatusSticker,\n  emojiStatusSlug,\n  profilePhotos,\n  peerId,\n}) => {\n  const {\n    openMediaViewer,\n    openPremiumModal,\n    openStickerSet,\n    openPrivacySettingsNoticeModal,\n    loadMoreProfilePhotos,\n    openUniqueGiftBySlug,\n  } = getActions();\n\n  const lang = useOldLang();\n\n  useIntervalForceUpdate(user ? STATUS_UPDATE_INTERVAL : undefined);\n\n  const photos = profilePhotos?.photos || MEMO_EMPTY_ARRAY;\n  const prevMediaIndex = usePreviousDeprecated(mediaIndex);\n  const prevAvatarOwnerId = usePreviousDeprecated(avatarOwnerId);\n  const [hasSlideAnimation, setHasSlideAnimation] = useState(true);\n  // slideOptimized doesn't work well when animation is dynamically disabled\n  const slideAnimation = hasSlideAnimation ? (lang.isRtl ? 'slideRtl' : 'slide') : 'none';\n\n  const [currentPhotoIndex, setCurrentPhotoIndex] = useState(0);\n  const isFirst = photos.length <= 1 || currentPhotoIndex === 0;\n  const isLast = photos.length <= 1 || currentPhotoIndex === photos.length - 1;\n\n  useEffect(() => {\n    if (photos.length - currentPhotoIndex <= LOAD_MORE_THRESHOLD) {\n      loadMoreProfilePhotos({ peerId });\n    }\n  }, [currentPhotoIndex, peerId, photos.length]);\n\n  // Set the current avatar photo to the last selected photo in Media Viewer after it is closed\n  useEffect(() => {\n    if (prevAvatarOwnerId && prevMediaIndex !== undefined && mediaIndex === undefined) {\n      setHasSlideAnimation(false);\n      setCurrentPhotoIndex(prevMediaIndex);\n    }\n  }, [mediaIndex, prevMediaIndex, prevAvatarOwnerId]);\n\n  // Deleting the last profile photo may result in an error\n  useEffect(() => {\n    if (currentPhotoIndex > photos.length) {\n      setHasSlideAnimation(false);\n      setCurrentPhotoIndex(Math.max(0, photos.length - 1));\n    }\n  }, [currentPhotoIndex, photos.length]);\n\n  usePhotosPreload(photos, currentPhotoIndex);\n\n  const handleProfilePhotoClick = useLastCallback(() => {\n    openMediaViewer({\n      isAvatarView: true,\n      chatId: peerId,\n      mediaIndex: currentPhotoIndex,\n      origin: forceShowSelf ? MediaViewerOrigin.SettingsAvatar : MediaViewerOrigin.ProfileAvatar,\n    });\n  });\n\n  const handleStatusClick = useLastCallback(() => {\n    if (emojiStatusSlug) {\n      openUniqueGiftBySlug({ slug: emojiStatusSlug });\n      return;\n    }\n    if (!peerId) {\n      openStickerSet({\n        stickerSetInfo: emojiStatusSticker!.stickerSetInfo,\n      });\n      return;\n    }\n\n    openPremiumModal({ fromUserId: peerId });\n  });\n\n  const selectPreviousMedia = useLastCallback(() => {\n    if (isFirst) {\n      return;\n    }\n    setHasSlideAnimation(true);\n    setCurrentPhotoIndex(currentPhotoIndex - 1);\n  });\n\n  const selectNextMedia = useLastCallback(() => {\n    if (isLast) {\n      return;\n    }\n    setHasSlideAnimation(true);\n    setCurrentPhotoIndex(currentPhotoIndex + 1);\n  });\n\n  const handleOpenGetReadDateModal = useLastCallback(() => {\n    openPrivacySettingsNoticeModal({ chatId: chat!.id, isReadDate: false });\n  });\n\n  function handleSelectFallbackPhoto() {\n    if (!isFirst) return;\n    setHasSlideAnimation(true);\n    setCurrentPhotoIndex(photos.length - 1);\n  }\n\n  // Swipe gestures\n  useEffect(() => {\n    const element = document.querySelector<HTMLDivElement>(`.${styles.photoWrapper}`);\n    if (!element) {\n      return undefined;\n    }\n\n    return captureEvents(element, {\n      selectorToPreventScroll: '.Profile, .settings-content',\n      onSwipe: IS_TOUCH_ENV ? (e, direction) => {\n        if (direction === SwipeDirection.Right) {\n          selectPreviousMedia();\n          return true;\n        } else if (direction === SwipeDirection.Left) {\n          selectNextMedia();\n          return true;\n        }\n\n        return false;\n      } : undefined,\n    });\n  }, [selectNextMedia, selectPreviousMedia]);\n\n  if (!user && !chat) {\n    return undefined;\n  }\n\n  function renderTopic() {\n    return (\n      <div className={styles.topicContainer}>\n        <TopicIcon\n          topic={topic!}\n          size={EMOJI_TOPIC_SIZE}\n          className={styles.topicIcon}\n          letterClassName={styles.topicIconTitle}\n          noLoopLimit\n        />\n        <h3 className={styles.topicTitle} dir={lang.isRtl ? 'rtl' : undefined}>{renderText(topic!.title)}</h3>\n        <p className={styles.topicMessagesCounter}>\n          {messagesCount ? lang('Chat.Title.Topic', messagesCount, 'i') : lang('lng_forum_no_messages')}\n        </p>\n      </div>\n    );\n  }\n\n  function renderPhotoTabs() {\n    const totalPhotosLength = Math.max(photos.length, profilePhotos?.count || 0);\n    if (!photos || totalPhotosLength <= 1) {\n      return undefined;\n    }\n\n    const enumerator = Array.from({ length: Math.min(totalPhotosLength, MAX_PHOTO_DASH_COUNT) });\n    const activeDashIndex = currentPhotoIndex >= MAX_PHOTO_DASH_COUNT ? MAX_PHOTO_DASH_COUNT - 1 : currentPhotoIndex;\n\n    return (\n      <div className={styles.photoDashes}>\n        {enumerator.map((_, i) => (\n          <span className={buildClassName(styles.photoDash, i === activeDashIndex && styles.photoDash_current)} />\n        ))}\n      </div>\n    );\n  }\n\n  function renderPhoto(isActive?: boolean) {\n    const photo = photos.length > 0\n      ? photos[currentPhotoIndex]\n      : undefined;\n\n    return (\n      <ProfilePhoto\n        key={currentPhotoIndex}\n        user={user}\n        chat={chat}\n        photo={photo}\n        canPlayVideo={Boolean(isActive && canPlayVideo)}\n        onClick={handleProfilePhotoClick}\n      />\n    );\n  }\n\n  function renderStatus() {\n    const isAnonymousForwards = isAnonymousForwardsChat(peerId);\n    const isSystemBotChat = isSystemBot(peerId);\n    if (isAnonymousForwards || isSystemBotChat) return undefined;\n\n    if (user) {\n      return (\n        <div\n          className={buildClassName(\n            styles.status,\n            'status',\n            isUserOnline(user, userStatus) && 'online',\n          )}\n        >\n          <span className={styles.userStatus} dir=\"auto\">\n            {getUserStatus(lang, user, userStatus)}\n          </span>\n          {userStatus?.isReadDateRestrictedByMe && (\n            <span className={styles.getStatus} onClick={handleOpenGetReadDateModal}>\n              <span>{lang('StatusHiddenShow')}</span>\n            </span>\n          )}\n        </div>\n      );\n    }\n\n    return (\n      <span className={buildClassName(styles.status, 'status')} dir=\"auto\">{\n        isChatChannel(chat!)\n          ? lang('Subscribers', chat!.membersCount ?? 0, 'i')\n          : lang('Members', chat!.membersCount ?? 0, 'i')\n      }\n      </span>\n    );\n  }\n\n  if (topic) {\n    return renderTopic();\n  }\n\n  return (\n    <div\n      className={buildClassName('ProfileInfo')}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      <div className={styles.photoWrapper}>\n        {renderPhotoTabs()}\n        {!forceShowSelf && profilePhotos?.personalPhoto && (\n          <div className={buildClassName(\n            styles.fallbackPhoto,\n            isFirst && styles.fallbackPhotoVisible,\n          )}\n          >\n            <div className={styles.fallbackPhotoContents}>\n              {lang(profilePhotos.personalPhoto.isVideo ? 'UserInfo.CustomVideo' : 'UserInfo.CustomPhoto')}\n            </div>\n          </div>\n        )}\n        {forceShowSelf && profilePhotos?.fallbackPhoto && (\n          <div className={buildClassName(\n            styles.fallbackPhoto,\n            (isFirst || isLast) && styles.fallbackPhotoVisible,\n          )}\n          >\n            <div className={styles.fallbackPhotoContents} onClick={handleSelectFallbackPhoto}>\n              {!isLast && (\n                <Avatar\n                  photo={profilePhotos.fallbackPhoto}\n                  className={styles.fallbackPhotoAvatar}\n                  size=\"mini\"\n                />\n              )}\n              {lang(profilePhotos.fallbackPhoto.isVideo ? 'UserInfo.PublicVideo' : 'UserInfo.PublicPhoto')}\n            </div>\n          </div>\n        )}\n        <Transition activeKey={currentPhotoIndex} name={slideAnimation}>\n          {renderPhoto}\n        </Transition>\n\n        {!isFirst && (\n          <button\n            type=\"button\"\n            dir={lang.isRtl ? 'rtl' : undefined}\n            className={buildClassName(styles.navigation, styles.navigation_prev)}\n            aria-label={lang('AccDescrPrevious')}\n            onClick={selectPreviousMedia}\n          />\n        )}\n        {!isLast && (\n          <button\n            type=\"button\"\n            dir={lang.isRtl ? 'rtl' : undefined}\n            className={buildClassName(styles.navigation, styles.navigation_next)}\n            aria-label={lang('Next')}\n            onClick={selectNextMedia}\n          />\n        )}\n      </div>\n\n      <div className={styles.info} dir={lang.isRtl ? 'rtl' : 'auto'}>\n        {(user || chat) && (\n          <FullNameTitle\n            peer={(user || chat)!}\n            withEmojiStatus\n            emojiStatusSize={EMOJI_STATUS_SIZE}\n            onEmojiStatusClick={handleStatusClick}\n            noLoopLimit\n            canCopyTitle\n          />\n        )}\n        {renderStatus()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { peerId }): StateProps => {\n    const user = selectUser(global, peerId);\n    const userStatus = selectUserStatus(global, peerId);\n    const chat = selectChat(global, peerId);\n    const profilePhotos = selectPeerPhotos(global, peerId);\n    const { mediaIndex, chatId: avatarOwnerId } = selectTabState(global).mediaViewer;\n    const isForum = chat?.isForum;\n    const { threadId: currentTopicId } = selectCurrentMessageList(global) || {};\n    const topic = isForum && currentTopicId ? selectTopic(global, peerId, currentTopicId) : undefined;\n\n    const emojiStatus = (user || chat)?.emojiStatus;\n    const emojiStatusSticker = emojiStatus ? global.customEmojis.byId[emojiStatus.documentId] : undefined;\n    const emojiStatusSlug = emojiStatus?.type === 'collectible' ? emojiStatus.slug : undefined;\n\n    return {\n      user,\n      userStatus,\n      chat,\n      mediaIndex,\n      avatarOwnerId,\n      emojiStatusSticker,\n      emojiStatusSlug,\n      profilePhotos,\n      ...(topic && {\n        topic,\n        messagesCount: selectThreadMessagesCount(global, peerId, currentTopicId!),\n      }),\n    };\n  },\n)(ProfileInfo));\n","import { useEffect } from '../../../lib/teact/teact';\n\nimport type { ApiPhoto } from '../../../api/types';\nimport { ApiMediaFormat } from '../../../api/types';\n\nimport { getProfilePhotoMediaHash } from '../../../global/helpers';\nimport * as mediaLoader from '../../../util/mediaLoader';\n\nconst PHOTOS_TO_PRELOAD = 4;\n\nexport default function usePhotosPreload(\n  photos: ApiPhoto[],\n  currentIndex: number,\n) {\n  useEffect(() => {\n    photos.slice(currentIndex, currentIndex + PHOTOS_TO_PRELOAD).forEach((photo) => {\n      const mediaHash = getProfilePhotoMediaHash(photo);\n      const mediaData = mediaLoader.getFromMemory(mediaHash);\n      if (!mediaData) {\n        mediaLoader.fetch(mediaHash, ApiMediaFormat.BlobUrl);\n      }\n    });\n  }, [currentIndex, photos]);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"EVLTkrt1\",\"preview\":\"V3HabdKr\",\"linkPreview\":\"ClGe8yij\",\"media\":\"WAItYc5d\",\"nonInteractive\":\"AQWPv0bP\",\"expired\":\"tprkr7qf\",\"expiredIcon\":\"nLA7VEhv\"};","import React, { memo, useEffect } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMessageStoryData, ApiTypeStory } from '../../../api/types';\n\nimport { getStoryMediaHash } from '../../../global/helpers';\nimport { IS_CANVAS_FILTER_SUPPORTED } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatMediaDuration } from '../../../util/dates/dateFormat';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useCanvasBlur from '../../../hooks/useCanvasBlur';\nimport useCurrentOrPrev from '../../../hooks/useCurrentOrPrev';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useShowTransitionDeprecated from '../../../hooks/useShowTransitionDeprecated';\n\nimport Icon from '../../common/icons/Icon';\nimport MediaAreaOverlay from '../../story/mediaArea/MediaAreaOverlay';\n\nimport styles from './BaseStory.module.scss';\n\ninterface OwnProps {\n  story?: ApiTypeStory | ApiMessageStoryData;\n  isPreview?: boolean;\n  isProtected?: boolean;\n  isConnected?: boolean;\n}\n\nfunction BaseStory({\n  story, isPreview, isProtected, isConnected,\n}: OwnProps) {\n  const { openStoryViewer, loadPeerStoriesByIds, showNotification } = getActions();\n\n  const lang = useOldLang();\n  const { isMobile } = useAppLayout();\n  const isExpired = story && 'isDeleted' in story;\n  const isLoaded = story && 'content' in story;\n  const video = isLoaded ? story.content.video : undefined;\n  const imageHash = isLoaded ? getStoryMediaHash(story) : undefined;\n  const imgBlobUrl = useMedia(imageHash);\n  const thumbnail = isLoaded ? (video ? video.thumbnail?.dataUri : story.content.photo?.thumbnail?.dataUri) : undefined;\n  const mediaUrl = useCurrentOrPrev(imgBlobUrl, true);\n  const { shouldRender, transitionClassNames } = useShowTransitionDeprecated(Boolean(mediaUrl));\n  const blurredBackgroundRef = useCanvasBlur(\n    thumbnail,\n    isExpired && !isPreview,\n    isMobile && !IS_CANVAS_FILTER_SUPPORTED,\n  );\n\n  const fullClassName = buildClassName(\n    styles.root,\n    'media-inner',\n    (!isConnected || isExpired) && styles.nonInteractive,\n    isExpired && styles.expired,\n    isPreview && styles.preview,\n  );\n\n  useEffect(() => {\n    if (story && !(isLoaded || isExpired)) {\n      loadPeerStoriesByIds({ peerId: story.peerId, storyIds: [story.id] });\n    }\n  }, [story, isExpired, isLoaded]);\n\n  const handleClick = useLastCallback(() => {\n    if (isExpired) {\n      showNotification({\n        message: lang('StoryNotFound'),\n      });\n      return;\n    }\n\n    openStoryViewer({\n      peerId: story!.peerId,\n      storyId: story!.id,\n      isSinglePeer: true,\n      isSingleStory: true,\n    });\n  });\n\n  return (\n    <div\n      className={fullClassName}\n      onClick={isConnected ? handleClick : undefined}\n    >\n      {!isExpired && isPreview && (\n        <canvas ref={blurredBackgroundRef} className=\"thumbnail blurred-bg\" />\n      )}\n      {shouldRender && (\n        <>\n          <img\n            src={mediaUrl}\n            alt=\"\"\n            className={buildClassName(styles.media, isPreview && styles.linkPreview, transitionClassNames)}\n            draggable={false}\n          />\n          {isLoaded && <MediaAreaOverlay story={story} className={transitionClassNames} />}\n        </>\n      )}\n      {isExpired && (\n        <span>\n          <Icon name=\"story-expired\" className={styles.expiredIcon} />\n          {lang('StoryExpiredSubtitle')}\n        </span>\n      )}\n      {Boolean(video?.duration) && (\n        <div className=\"message-media-duration\">\n          {formatMediaDuration(video!.duration)}\n        </div>\n      )}\n      {isProtected && <span className=\"protector\" />}\n    </div>\n  );\n}\n\nexport default memo(BaseStory);\n","/* eslint-disable max-len */\n/* eslint-disable react/react-in-jsx-scope */\nimport React from 'react';\n\nexport const BotIcon = () => {\n  return (\n    <svg\n      height=\"16\"\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width=\"16\"\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M8.75 2.79933C9.19835 2.53997 9.5 2.05521 9.5 1.5C9.5 0.671573 8.82843 0 8 0C7.17157 0 6.5 0.671573 6.5 1.5C6.5 2.05521 6.80165 2.53997 7.25 2.79933V5H7C4.027 5 1.55904 7.16229 1.08296 10H0V13H1V14.5V16H2.5H13.5H15V14.5V13H16V10H14.917C14.441 7.16229 11.973 5 9 5H8.75V2.79933ZM7 6.5C4.51472 6.5 2.5 8.51472 2.5 11V14.5H13.5V11C13.5 8.51472 11.4853 6.5 9 6.5H7ZM7.25 11.25C7.25 12.2165 6.4665 13 5.5 13C4.5335 13 3.75 12.2165 3.75 11.25C3.75 10.2835 4.5335 9.5 5.5 9.5C6.4665 9.5 7.25 10.2835 7.25 11.25ZM10.5 13C11.4665 13 12.25 12.2165 12.25 11.25C12.25 10.2835 11.4665 9.5 10.5 9.5C9.5335 9.5 8.75 10.2835 8.75 11.25C8.75 12.2165 9.5335 13 10.5 13Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const UserIcon = () => {\n  return (\n    <svg\n      data-testid=\"geist-icon\"\n      height=\"16\"\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width=\"16\"\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M7.75 0C5.95507 0 4.5 1.45507 4.5 3.25V3.75C4.5 5.54493 5.95507 7 7.75 7H8.25C10.0449 7 11.5 5.54493 11.5 3.75V3.25C11.5 1.45507 10.0449 0 8.25 0H7.75ZM6 3.25C6 2.2835 6.7835 1.5 7.75 1.5H8.25C9.2165 1.5 10 2.2835 10 3.25V3.75C10 4.7165 9.2165 5.5 8.25 5.5H7.75C6.7835 5.5 6 4.7165 6 3.75V3.25ZM2.5 14.5V13.1709C3.31958 11.5377 4.99308 10.5 6.82945 10.5H9.17055C11.0069 10.5 12.6804 11.5377 13.5 13.1709V14.5H2.5ZM6.82945 9C4.35483 9 2.10604 10.4388 1.06903 12.6857L1 12.8353V13V15.25V16H1.75H14.25H15V15.25V13V12.8353L14.931 12.6857C13.894 10.4388 11.6452 9 9.17055 9H6.82945Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const AttachmentIcon = () => {\n  return (\n    <svg\n      height=\"16\"\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width=\"16\"\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M14.5 6.5V13.5C14.5 14.8807 13.3807 16 12 16H4C2.61929 16 1.5 14.8807 1.5 13.5V1.5V0H3H8H9.08579C9.351 0 9.60536 0.105357 9.79289 0.292893L14.2071 4.70711C14.3946 4.89464 14.5 5.149 14.5 5.41421V6.5ZM13 6.5V13.5C13 14.0523 12.5523 14.5 12 14.5H4C3.44772 14.5 3 14.0523 3 13.5V1.5H8V5V6.5H9.5H13ZM9.5 2.12132V5H12.3787L9.5 2.12132Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const VercelIcon = ({ size = 17 }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M8 1L16 15H0L8 1Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const GitIcon = () => {\n  return (\n    <svg\n      height=\"16\"\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width=\"16\"\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <g clipPath=\"url(#clip0_872_3147)\">\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M8 0C3.58 0 0 3.57879 0 7.99729C0 11.5361 2.29 14.5251 5.47 15.5847C5.87 15.6547 6.02 15.4148 6.02 15.2049C6.02 15.0149 6.01 14.3851 6.01 13.7154C4 14.0852 3.48 13.2255 3.32 12.7757C3.23 12.5458 2.84 11.836 2.5 11.6461C2.22 11.4961 1.82 11.1262 2.49 11.1162C3.12 11.1062 3.57 11.696 3.72 11.936C4.44 13.1455 5.59 12.8057 6.05 12.5957C6.12 12.0759 6.33 11.726 6.56 11.5261C4.78 11.3262 2.92 10.6364 2.92 7.57743C2.92 6.70773 3.23 5.98797 3.74 5.42816C3.66 5.22823 3.38 4.40851 3.82 3.30888C3.82 3.30888 4.49 3.09895 6.02 4.1286C6.66 3.94866 7.34 3.85869 8.02 3.85869C8.7 3.85869 9.38 3.94866 10.02 4.1286C11.55 3.08895 12.22 3.30888 12.22 3.30888C12.66 4.40851 12.38 5.22823 12.3 5.42816C12.81 5.98797 13.12 6.69773 13.12 7.57743C13.12 10.6464 11.25 11.3262 9.47 11.5261C9.76 11.776 10.01 12.2558 10.01 13.0056C10.01 14.0752 10 14.9349 10 15.2049C10 15.4148 10.15 15.6647 10.55 15.5847C12.1381 15.0488 13.5182 14.0284 14.4958 12.6673C15.4735 11.3062 15.9996 9.67293 16 7.99729C16 3.57879 12.42 0 8 0Z\"\n          fill=\"currentColor\"\n        />\n      </g>\n      <defs>\n        <clipPath id=\"clip0_872_3147\">\n          <rect width=\"16\" height=\"16\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n};\n\nexport const BoxIcon = ({ size = 16 }: { size: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M8 0.154663L8.34601 0.334591L14.596 3.58459L15 3.79466V4.25V11.75V12.2053L14.596 12.4154L8.34601 15.6654L8 15.8453L7.65399 15.6654L1.40399 12.4154L1 12.2053V11.75V4.25V3.79466L1.40399 3.58459L7.65399 0.334591L8 0.154663ZM2.5 11.2947V5.44058L7.25 7.81559V13.7647L2.5 11.2947ZM8.75 13.7647L13.5 11.2947V5.44056L8.75 7.81556V13.7647ZM8 1.84534L12.5766 4.22519L7.99998 6.51352L3.42335 4.2252L8 1.84534Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const HomeIcon = ({ size = 16 }: { size: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M12.5 6.56062L8.00001 2.06062L3.50001 6.56062V13.5L6.00001 13.5V11C6.00001 9.89539 6.89544 8.99996 8.00001 8.99996C9.10458 8.99996 10 9.89539 10 11V13.5L12.5 13.5V6.56062ZM13.78 5.71933L8.70711 0.646409C8.31659 0.255886 7.68342 0.255883 7.2929 0.646409L2.21987 5.71944C2.21974 5.71957 2.21961 5.7197 2.21949 5.71982L0.469676 7.46963L-0.0606537 7.99996L1.00001 9.06062L1.53034 8.53029L2.00001 8.06062V14.25V15H2.75001L6.00001 15H7.50001H8.50001H10L13.25 15H14V14.25V8.06062L14.4697 8.53029L15 9.06062L16.0607 7.99996L15.5303 7.46963L13.7806 5.71993C13.7804 5.71973 13.7802 5.71953 13.78 5.71933ZM8.50001 11V13.5H7.50001V11C7.50001 10.7238 7.72386 10.5 8.00001 10.5C8.27615 10.5 8.50001 10.7238 8.50001 11Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const GPSIcon = ({ size = 16 }: { size: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        d=\"M1 6L15 1L10 15L7.65955 8.91482C7.55797 8.65073 7.34927 8.44203 7.08518 8.34045L1 6Z\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"bevel\"\n        fill=\"transparent\"\n      />\n    </svg>\n  );\n};\n\nexport const InvoiceIcon = ({ size = 16 }: { size: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M13 15.1L12 14.5L10.1524 15.8857C10.0621 15.9534 9.93791 15.9534 9.8476 15.8857L8 14.5L6.14377 15.8922C6.05761 15.9568 5.94008 15.9601 5.85047 15.9003L3.75 14.5L3 15L2.83257 15.1116L1.83633 15.7758L1.68656 15.8756C1.60682 15.9288 1.5 15.8716 1.5 15.7758V15.5958V14.3985V14.1972V1.5V0H3H8H9.08579C9.351 0 9.60536 0.105357 9.79289 0.292893L14.2071 4.70711C14.3946 4.89464 14.5 5.149 14.5 5.41421V6.5V14.2507V14.411V15.5881V15.7881C14.5 15.8813 14.3982 15.9389 14.3183 15.891L14.1468 15.7881L13.1375 15.1825L13 15.1ZM12.3787 5L9.5 2.12132V5H12.3787ZM8 1.5V5V6.5H9.5H13V13.3507L12.7717 13.2138L11.9069 12.6948L11.1 13.3L10 14.125L8.9 13.3L8 12.625L7.1 13.3L5.94902 14.1632L4.58205 13.2519L3.75 12.6972L3 13.1972V1.5H8Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const LogoOpenAI = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        d=\"M14.9449 6.54871C15.3128 5.45919 15.1861 4.26567 14.5978 3.27464C13.7131 1.75461 11.9345 0.972595 10.1974 1.3406C9.42464 0.481584 8.3144 -0.00692594 7.15045 7.42132e-05C5.37487 -0.00392587 3.79946 1.1241 3.2532 2.79113C2.11256 3.02164 1.12799 3.72615 0.551837 4.72468C-0.339497 6.24071 -0.1363 8.15175 1.05451 9.45178C0.686626 10.5413 0.813308 11.7348 1.40162 12.7258C2.28637 14.2459 4.06498 15.0279 5.80204 14.6599C6.5743 15.5189 7.68504 16.0074 8.849 15.9999C10.6256 16.0044 12.2015 14.8754 12.7478 13.2069C13.8884 12.9764 14.873 12.2718 15.4491 11.2733C16.3394 9.75728 16.1357 7.84774 14.9454 6.54771L14.9449 6.54871ZM8.85001 14.9544C8.13907 14.9554 7.45043 14.7099 6.90468 14.2604C6.92951 14.2474 6.97259 14.2239 7.00046 14.2069L10.2293 12.3668C10.3945 12.2743 10.4959 12.1008 10.4949 11.9133V7.42173L11.8595 8.19925C11.8742 8.20625 11.8838 8.22025 11.8858 8.23625V11.9558C11.8838 13.6099 10.5263 14.9509 8.85001 14.9544ZM2.32133 12.2028C1.9651 11.5958 1.8369 10.8843 1.95902 10.1938C1.98284 10.2078 2.02489 10.2333 2.05479 10.2503L5.28366 12.0903C5.44733 12.1848 5.65003 12.1848 5.81421 12.0903L9.75604 9.84429V11.3993C9.75705 11.4153 9.74945 11.4308 9.73678 11.4408L6.47295 13.3004C5.01915 14.1264 3.1625 13.6354 2.32184 12.2028H2.32133ZM1.47155 5.24819C1.82626 4.64017 2.38619 4.17516 3.05305 3.93366C3.05305 3.96116 3.05152 4.00966 3.05152 4.04366V7.72424C3.05051 7.91124 3.15186 8.08475 3.31654 8.17725L7.25838 10.4228L5.89376 11.2003C5.88008 11.2093 5.86285 11.2108 5.84765 11.2043L2.58331 9.34327C1.13255 8.51426 0.63494 6.68272 1.47104 5.24869L1.47155 5.24819ZM12.6834 7.82274L8.74157 5.57669L10.1062 4.79968C10.1199 4.79068 10.1371 4.78918 10.1523 4.79568L13.4166 6.65522C14.8699 7.48373 15.3681 9.31827 14.5284 10.7523C14.1732 11.3593 13.6138 11.8243 12.9474 12.0663V8.27575C12.9489 8.08875 12.8481 7.91574 12.6839 7.82274H12.6834ZM14.0414 5.8057C14.0176 5.7912 13.9756 5.7662 13.9457 5.7492L10.7168 3.90916C10.5531 3.81466 10.3504 3.81466 10.1863 3.90916L6.24442 6.15521V4.60017C6.2434 4.58417 6.251 4.56867 6.26367 4.55867L9.52751 2.70063C10.9813 1.87311 12.84 2.36563 13.6781 3.80066C14.0323 4.40667 14.1605 5.11618 14.0404 5.8057H14.0414ZM5.50257 8.57726L4.13744 7.79974C4.12275 7.79274 4.11312 7.77874 4.11109 7.76274V4.04316C4.11211 2.38713 5.47368 1.0451 7.15197 1.0461C7.86189 1.0461 8.54902 1.2921 9.09476 1.74011C9.06993 1.75311 9.02737 1.77661 8.99899 1.79361L5.77012 3.63365C5.60493 3.72615 5.50358 3.89916 5.50459 4.08666L5.50257 8.57626V8.57726ZM6.24391 7.00022L7.99972 5.9997L9.75553 6.99972V9.00027L7.99972 10.0003L6.24391 9.00027V7.00022Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const LogoGoogle = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      data-testid=\"geist-icon\"\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        d=\"M8.15991 6.54543V9.64362H12.4654C12.2763 10.64 11.709 11.4837 10.8581 12.0509L13.4544 14.0655C14.9671 12.6692 15.8399 10.6182 15.8399 8.18188C15.8399 7.61461 15.789 7.06911 15.6944 6.54552L8.15991 6.54543Z\"\n        fill=\"#4285F4\"\n      />\n      <path\n        d=\"M3.6764 9.52268L3.09083 9.97093L1.01807 11.5855C2.33443 14.1963 5.03241 16 8.15966 16C10.3196 16 12.1305 15.2873 13.4542 14.0655L10.8578 12.0509C10.1451 12.5309 9.23598 12.8219 8.15966 12.8219C6.07967 12.8219 4.31245 11.4182 3.67967 9.5273L3.6764 9.52268Z\"\n        fill=\"#34A853\"\n      />\n      <path\n        d=\"M1.01803 4.41455C0.472607 5.49087 0.159912 6.70543 0.159912 7.99995C0.159912 9.29447 0.472607 10.509 1.01803 11.5854C1.01803 11.5926 3.6799 9.51991 3.6799 9.51991C3.5199 9.03991 3.42532 8.53085 3.42532 7.99987C3.42532 7.46889 3.5199 6.95983 3.6799 6.47983L1.01803 4.41455Z\"\n        fill=\"#FBBC05\"\n      />\n      <path\n        d=\"M8.15982 3.18545C9.33802 3.18545 10.3853 3.59271 11.2216 4.37818L13.5125 2.0873C12.1234 0.792777 10.3199 0 8.15982 0C5.03257 0 2.33443 1.79636 1.01807 4.41455L3.67985 6.48001C4.31254 4.58908 6.07983 3.18545 8.15982 3.18545Z\"\n        fill=\"#EA4335\"\n      />\n    </svg>\n  );\n};\n\nexport const LogoAnthropic = () => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      x=\"0px\"\n      y=\"0px\"\n      viewBox=\"0 0 92.2 65\"\n      style={{ color: 'currentcolor', fill: 'currentcolor' } as React.CSSProperties}\n      width=\"18px\"\n      height=\"18px\"\n    >\n      <path\n        d=\"M66.5,0H52.4l25.7,65h14.1L66.5,0z M25.7,0L0,65h14.4l5.3-13.6h26.9L51.8,65h14.4L40.5,0C40.5,0,25.7,0,25.7,0zM24.3,39.3l8.8-22.8l8.8,22.8H24.3z\"\n      />\n    </svg>\n  );\n};\n\nexport const RouteIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M7.53033 0.719661L7 0.189331L5.93934 1.24999L6.46967 1.78032L6.68934 1.99999H3.375C1.51104 1.99999 0 3.51103 0 5.37499C0 7.23895 1.51104 8.74999 3.375 8.74999H12.625C13.6605 8.74999 14.5 9.58946 14.5 10.625C14.5 11.6605 13.6605 12.5 12.625 12.5H4.88555C4.56698 11.4857 3.61941 10.75 2.5 10.75C1.11929 10.75 0 11.8693 0 13.25C0 14.6307 1.11929 15.75 2.5 15.75C3.61941 15.75 4.56698 15.0143 4.88555 14H12.625C14.489 14 16 12.489 16 10.625C16 8.76103 14.489 7.24999 12.625 7.24999H3.375C2.33947 7.24999 1.5 6.41052 1.5 5.37499C1.5 4.33946 2.33947 3.49999 3.375 3.49999H6.68934L6.46967 3.71966L5.93934 4.24999L7 5.31065L7.53033 4.78032L8.85355 3.4571C9.24408 3.06657 9.24408 2.43341 8.85355 2.04288L7.53033 0.719661ZM2.5 14.25C3.05228 14.25 3.5 13.8023 3.5 13.25C3.5 12.6977 3.05228 12.25 2.5 12.25C1.94772 12.25 1.5 12.6977 1.5 13.25C1.5 13.8023 1.94772 14.25 2.5 14.25ZM14.5 2.74999C14.5 3.30228 14.0523 3.74999 13.5 3.74999C12.9477 3.74999 12.5 3.30228 12.5 2.74999C12.5 2.19771 12.9477 1.74999 13.5 1.74999C14.0523 1.74999 14.5 2.19771 14.5 2.74999ZM16 2.74999C16 4.1307 14.8807 5.24999 13.5 5.24999C12.1193 5.24999 11 4.1307 11 2.74999C11 1.36928 12.1193 0.249991 13.5 0.249991C14.8807 0.249991 16 1.36928 16 2.74999Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const FileIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M14.5 13.5V6.5V5.41421C14.5 5.149 14.3946 4.89464 14.2071 4.70711L9.79289 0.292893C9.60536 0.105357 9.351 0 9.08579 0H8H3H1.5V1.5V13.5C1.5 14.8807 2.61929 16 4 16H12C13.3807 16 14.5 14.8807 14.5 13.5ZM13 13.5V6.5H9.5H8V5V1.5H3V13.5C3 14.0523 3.44772 14.5 4 14.5H12C12.5523 14.5 13 14.0523 13 13.5ZM9.5 5V2.12132L12.3787 5H9.5ZM5.13 5.00062H4.505V6.25062H5.13H6H6.625V5.00062H6H5.13ZM4.505 8H5.13H11H11.625V9.25H11H5.13H4.505V8ZM5.13 11H4.505V12.25H5.13H11H11.625V11H11H5.13Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const LoaderIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <g clipPath=\"url(#clip0_2393_1490)\">\n        <path d=\"M8 0V4\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\n        <path\n          opacity=\"0.5\"\n          d=\"M8 16V12\"\n          stroke=\"currentColor\"\n          strokeWidth=\"1.5\"\n        />\n        <path\n          opacity=\"0.9\"\n          d=\"M3.29773 1.52783L5.64887 4.7639\"\n          stroke=\"currentColor\"\n          strokeWidth=\"1.5\"\n        />\n        <path\n          opacity=\"0.1\"\n          d=\"M12.7023 1.52783L10.3511 4.7639\"\n          stroke=\"currentColor\"\n          strokeWidth=\"1.5\"\n        />\n        <path\n          opacity=\"0.4\"\n          d=\"M12.7023 14.472L10.3511 11.236\"\n          stroke=\"currentColor\"\n          strokeWidth=\"1.5\"\n        />\n        <path\n          opacity=\"0.6\"\n          d=\"M3.29773 14.472L5.64887 11.236\"\n          stroke=\"currentColor\"\n          strokeWidth=\"1.5\"\n        />\n        <path\n          opacity=\"0.2\"\n          d=\"M15.6085 5.52783L11.8043 6.7639\"\n          stroke=\"currentColor\"\n          strokeWidth=\"1.5\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M0.391602 10.472L4.19583 9.23598\"\n          stroke=\"currentColor\"\n          strokeWidth=\"1.5\"\n        />\n        <path\n          opacity=\"0.3\"\n          d=\"M15.6085 10.4722L11.8043 9.2361\"\n          stroke=\"currentColor\"\n          strokeWidth=\"1.5\"\n        />\n        <path\n          opacity=\"0.8\"\n          d=\"M0.391602 5.52783L4.19583 6.7639\"\n          stroke=\"currentColor\"\n          strokeWidth=\"1.5\"\n        />\n      </g>\n      <defs>\n        <clipPath id=\"clip0_2393_1490\">\n          <rect width=\"16\" height=\"16\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n};\n\nexport const UploadIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      data-testid=\"geist-icon\"\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M1.5 4.875C1.5 3.01104 3.01104 1.5 4.875 1.5C6.20018 1.5 7.34838 2.26364 7.901 3.37829C8.1902 3.96162 8.79547 4.5 9.60112 4.5H12.25C13.4926 4.5 14.5 5.50736 14.5 6.75C14.5 7.42688 14.202 8.03329 13.7276 8.44689L13.1622 8.93972L14.1479 10.0704L14.7133 9.57758C15.5006 8.89123 16 7.8785 16 6.75C16 4.67893 14.3211 3 12.25 3H9.60112C9.51183 3 9.35322 2.93049 9.2449 2.71201C8.44888 1.1064 6.79184 0 4.875 0C2.18261 0 0 2.18261 0 4.875V6.40385C0 7.69502 0.598275 8.84699 1.52982 9.59656L2.11415 10.0667L3.0545 8.89808L2.47018 8.42791C1.87727 7.95083 1.5 7.22166 1.5 6.40385V4.875ZM7.29289 7.39645C7.68342 7.00592 8.31658 7.00592 8.70711 7.39645L11.7803 10.4697L12.3107 11L11.25 12.0607L10.7197 11.5303L8.75 9.56066V15.25V16H7.25V15.25V9.56066L5.28033 11.5303L4.75 12.0607L3.68934 11L4.21967 10.4697L7.29289 7.39645Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const MenuIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M1 2H1.75H14.25H15V3.5H14.25H1.75H1V2ZM1 12.5H1.75H14.25H15V14H14.25H1.75H1V12.5ZM1.75 7.25H1V8.75H1.75H14.25H15V7.25H14.25H1.75Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const PencilEditIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M11.75 0.189331L12.2803 0.719661L15.2803 3.71966L15.8107 4.24999L15.2803 4.78032L5.15901 14.9016C4.45575 15.6049 3.50192 16 2.50736 16H0.75H0V15.25V13.4926C0 12.4981 0.395088 11.5442 1.09835 10.841L11.2197 0.719661L11.75 0.189331ZM11.75 2.31065L9.81066 4.24999L11.75 6.18933L13.6893 4.24999L11.75 2.31065ZM2.15901 11.9016L8.75 5.31065L10.6893 7.24999L4.09835 13.841C3.67639 14.2629 3.1041 14.5 2.50736 14.5H1.5V13.4926C1.5 12.8959 1.73705 12.3236 2.15901 11.9016ZM9 16H16V14.5H9V16Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const CheckedSquare = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M15 16H1C0.447715 16 0 15.5523 0 15V1C0 0.447715 0.447716 0 1 0L15 8.17435e-06C15.5523 8.47532e-06 16 0.447724 16 1.00001V15C16 15.5523 15.5523 16 15 16ZM11.7803 6.28033L12.3107 5.75L11.25 4.68934L10.7197 5.21967L6.5 9.43935L5.28033 8.21967L4.75001 7.68934L3.68934 8.74999L4.21967 9.28033L5.96967 11.0303C6.11032 11.171 6.30109 11.25 6.5 11.25C6.69891 11.25 6.88968 11.171 7.03033 11.0303L11.7803 6.28033Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const UncheckedSquare = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <rect\n        x=\"1\"\n        y=\"1\"\n        width=\"14\"\n        height=\"14\"\n        stroke=\"currentColor\"\n        strokeWidth=\"1.5\"\n        fill=\"none\"\n      />\n    </svg>\n  );\n};\n\nexport const MoreIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      width={size}\n      height={size}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <circle cx=\"4.5\" cy=\"11.5\" r=\"1.5\" fill=\"black\" />\n      <circle cx=\"11.5\" cy=\"11.5\" r=\"1.5\" fill=\"black\" />\n      <path d=\"M20 11.5C20 12.3284 19.3284 13 18.5 13C17.6716 13 17 12.3284 17 11.5C17 10.6716 17.6716 10 18.5 10C19.3284 10 20 10.6716 20 11.5Z\" fill=\"black\" />\n    </svg>\n\n  );\n};\n\nexport const TrashIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M6.75 2.75C6.75 2.05964 7.30964 1.5 8 1.5C8.69036 1.5 9.25 2.05964 9.25 2.75V3H6.75V2.75ZM5.25 3V2.75C5.25 1.23122 6.48122 0 8 0C9.51878 0 10.75 1.23122 10.75 2.75V3H12.9201H14.25H15V4.5H14.25H13.8846L13.1776 13.6917C13.0774 14.9942 11.9913 16 10.6849 16H5.31508C4.00874 16 2.92263 14.9942 2.82244 13.6917L2.11538 4.5H1.75H1V3H1.75H3.07988H5.25ZM4.31802 13.5767L3.61982 4.5H12.3802L11.682 13.5767C11.6419 14.0977 11.2075 14.5 10.6849 14.5H5.31508C4.79254 14.5 4.3581 14.0977 4.31802 13.5767Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const InfoIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8ZM6.25002 7H7.00002H7.75C8.30229 7 8.75 7.44772 8.75 8V11.5V12.25H7.25V11.5V8.5H7.00002H6.25002V7ZM8 6C8.55229 6 9 5.55228 9 5C9 4.44772 8.55229 4 8 4C7.44772 4 7 4.44772 7 5C7 5.55228 7.44772 6 8 6Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const ArrowUpIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M8.70711 1.39644C8.31659 1.00592 7.68342 1.00592 7.2929 1.39644L2.21968 6.46966L1.68935 6.99999L2.75001 8.06065L3.28034 7.53032L7.25001 3.56065V14.25V15H8.75001V14.25V3.56065L12.7197 7.53032L13.25 8.06065L14.3107 6.99999L13.7803 6.46966L8.70711 1.39644Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const StopIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M3 3H13V13H3V3Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const PaperclipIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n      className=\"-rotate-45\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M10.8591 1.70735C10.3257 1.70735 9.81417 1.91925 9.437 2.29643L3.19455 8.53886C2.56246 9.17095 2.20735 10.0282 2.20735 10.9222C2.20735 11.8161 2.56246 12.6734 3.19455 13.3055C3.82665 13.9376 4.68395 14.2927 5.57786 14.2927C6.47178 14.2927 7.32908 13.9376 7.96117 13.3055L14.2036 7.06304L14.7038 6.56287L15.7041 7.56321L15.204 8.06337L8.96151 14.3058C8.06411 15.2032 6.84698 15.7074 5.57786 15.7074C4.30875 15.7074 3.09162 15.2032 2.19422 14.3058C1.29682 13.4084 0.792664 12.1913 0.792664 10.9222C0.792664 9.65305 1.29682 8.43592 2.19422 7.53852L8.43666 1.29609C9.07914 0.653606 9.95054 0.292664 10.8591 0.292664C11.7678 0.292664 12.6392 0.653606 13.2816 1.29609C13.9241 1.93857 14.2851 2.80997 14.2851 3.71857C14.2851 4.62718 13.9241 5.49858 13.2816 6.14106L13.2814 6.14133L7.0324 12.3835C7.03231 12.3836 7.03222 12.3837 7.03213 12.3838C6.64459 12.7712 6.11905 12.9888 5.57107 12.9888C5.02297 12.9888 4.49731 12.7711 4.10974 12.3835C3.72217 11.9959 3.50444 11.4703 3.50444 10.9222C3.50444 10.3741 3.72217 9.8484 4.10974 9.46084L4.11004 9.46054L9.877 3.70039L10.3775 3.20051L11.3772 4.20144L10.8767 4.70131L5.11008 10.4612C5.11005 10.4612 5.11003 10.4612 5.11 10.4613C4.98779 10.5835 4.91913 10.7493 4.91913 10.9222C4.91913 11.0951 4.98782 11.2609 5.11008 11.3832C5.23234 11.5054 5.39817 11.5741 5.57107 11.5741C5.74398 11.5741 5.9098 11.5054 6.03206 11.3832L6.03233 11.3829L12.2813 5.14072C12.2814 5.14063 12.2815 5.14054 12.2816 5.14045C12.6586 4.7633 12.8704 4.25185 12.8704 3.71857C12.8704 3.18516 12.6585 2.6736 12.2813 2.29643C11.9041 1.91925 11.3926 1.70735 10.8591 1.70735Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const MoreHorizontalIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M4 8C4 8.82843 3.32843 9.5 2.5 9.5C1.67157 9.5 1 8.82843 1 8C1 7.17157 1.67157 6.5 2.5 6.5C3.32843 6.5 4 7.17157 4 8ZM9.5 8C9.5 8.82843 8.82843 9.5 8 9.5C7.17157 9.5 6.5 8.82843 6.5 8C6.5 7.17157 7.17157 6.5 8 6.5C8.82843 6.5 9.5 7.17157 9.5 8ZM13.5 9.5C14.3284 9.5 15 8.82843 15 8C15 7.17157 14.3284 6.5 13.5 6.5C12.6716 6.5 12 7.17157 12 8C12 8.82843 12.6716 9.5 13.5 9.5Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const MessageIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M2.8914 10.4028L2.98327 10.6318C3.22909 11.2445 3.5 12.1045 3.5 13C3.5 13.3588 3.4564 13.7131 3.38773 14.0495C3.69637 13.9446 4.01409 13.8159 4.32918 13.6584C4.87888 13.3835 5.33961 13.0611 5.70994 12.7521L6.22471 12.3226L6.88809 12.4196C7.24851 12.4724 7.61994 12.5 8 12.5C11.7843 12.5 14.5 9.85569 14.5 7C14.5 4.14431 11.7843 1.5 8 1.5C4.21574 1.5 1.5 4.14431 1.5 7C1.5 8.18175 1.94229 9.29322 2.73103 10.2153L2.8914 10.4028ZM2.8135 15.7653C1.76096 16 1 16 1 16C1 16 1.43322 15.3097 1.72937 14.4367C1.88317 13.9834 2 13.4808 2 13C2 12.3826 1.80733 11.7292 1.59114 11.1903C0.591845 10.0221 0 8.57152 0 7C0 3.13401 3.58172 0 8 0C12.4183 0 16 3.13401 16 7C16 10.866 12.4183 14 8 14C7.54721 14 7.10321 13.9671 6.67094 13.9038C6.22579 14.2753 5.66881 14.6656 5 15C4.23366 15.3832 3.46733 15.6195 2.8135 15.7653Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const CrossIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M12.4697 13.5303L13 14.0607L14.0607 13L13.5303 12.4697L9.06065 7.99999L13.5303 3.53032L14.0607 2.99999L13 1.93933L12.4697 2.46966L7.99999 6.93933L3.53032 2.46966L2.99999 1.93933L1.93933 2.99999L2.46966 3.53032L6.93933 7.99999L2.46966 12.4697L1.93933 13L2.99999 14.0607L3.53032 13.5303L7.99999 9.06065L12.4697 13.5303Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const CrossSmallIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M9.96966 11.0303L10.5 11.5607L11.5607 10.5L11.0303 9.96966L9.06065 7.99999L11.0303 6.03032L11.5607 5.49999L10.5 4.43933L9.96966 4.96966L7.99999 6.93933L6.03032 4.96966L5.49999 4.43933L4.43933 5.49999L4.96966 6.03032L6.93933 7.99999L4.96966 9.96966L4.43933 10.5L5.49999 11.5607L6.03032 11.0303L7.99999 9.06065L9.96966 11.0303Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const UndoIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M13.5 8C13.5 4.96643 11.0257 2.5 7.96452 2.5C5.42843 2.5 3.29365 4.19393 2.63724 6.5H5.25H6V8H5.25H0.75C0.335787 8 0 7.66421 0 7.25V2.75V2H1.5V2.75V5.23347C2.57851 2.74164 5.06835 1 7.96452 1C11.8461 1 15 4.13001 15 8C15 11.87 11.8461 15 7.96452 15C5.62368 15 3.54872 13.8617 2.27046 12.1122L1.828 11.5066L3.03915 10.6217L3.48161 11.2273C4.48831 12.6051 6.12055 13.5 7.96452 13.5C11.0257 13.5 13.5 11.0336 13.5 8Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const RedoIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M2.5 8C2.5 4.96643 4.97431 2.5 8.03548 2.5C10.5716 2.5 12.7064 4.19393 13.3628 6.5H10.75H10V8H10.75H15.25C15.6642 8 16 7.66421 16 7.25V2.75V2H14.5V2.75V5.23347C13.4215 2.74164 10.9316 1 8.03548 1C4.1539 1 1 4.13001 1 8C1 11.87 4.1539 15 8.03548 15C10.3763 15 12.4513 13.8617 13.7295 12.1122L14.172 11.5066L12.9609 10.6217L12.5184 11.2273C11.5117 12.6051 9.87945 13.5 8.03548 13.5C4.97431 13.5 2.5 11.0336 2.5 8Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const DeltaIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M2.67705 15H1L1.75 13.5L6.16147 4.67705L6.15836 4.67082L6.16667 4.66667L7.16147 2.67705L8 1L8.83853 2.67705L14.25 13.5L15 15H13.3229H2.67705ZM7 6.3541L10.5729 13.5H3.42705L7 6.3541Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const PenIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M8.75 0.189331L9.28033 0.719661L15.2803 6.71966L15.8107 7.24999L15.2803 7.78032L13.7374 9.32322C13.1911 9.8696 12.3733 9.97916 11.718 9.65188L9.54863 13.5568C8.71088 15.0648 7.12143 16 5.39639 16H0.75H0V15.25V10.6036C0 8.87856 0.935237 7.28911 2.4432 6.45136L6.34811 4.28196C6.02084 3.62674 6.13039 2.80894 6.67678 2.26255L8.21967 0.719661L8.75 0.189331ZM7.3697 5.43035L10.5696 8.63029L8.2374 12.8283C7.6642 13.8601 6.57668 14.5 5.39639 14.5H2.56066L5.53033 11.5303L4.46967 10.4697L1.5 13.4393V10.6036C1.5 9.42331 2.1399 8.33579 3.17166 7.76259L7.3697 5.43035ZM12.6768 8.26256C12.5791 8.36019 12.4209 8.36019 12.3232 8.26255L12.0303 7.96966L8.03033 3.96966L7.73744 3.67677C7.63981 3.57914 7.63981 3.42085 7.73744 3.32321L8.75 2.31065L13.6893 7.24999L12.6768 8.26256Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const SummarizeIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M1.75 12H1V10.5H1.75H5.25H6V12H5.25H1.75ZM1.75 7.75H1V6.25H1.75H4.25H5V7.75H4.25H1.75ZM1.75 3.5H1V2H1.75H7.25H8V3.5H7.25H1.75ZM12.5303 14.7803C12.2374 15.0732 11.7626 15.0732 11.4697 14.7803L9.21967 12.5303L8.68934 12L9.75 10.9393L10.2803 11.4697L11.25 12.4393V2.75V2H12.75V2.75V12.4393L13.7197 11.4697L14.25 10.9393L15.3107 12L14.7803 12.5303L12.5303 14.7803Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const SidebarLeftIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M6.245 2.5H14.5V12.5C14.5 13.0523 14.0523 13.5 13.5 13.5H6.245V2.5ZM4.995 2.5H1.5V12.5C1.5 13.0523 1.94772 13.5 2.5 13.5H4.995V2.5ZM0 1H1.5H14.5H16V2.5V12.5C16 13.8807 14.8807 15 13.5 15H2.5C1.11929 15 0 13.8807 0 12.5V2.5V1Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const PlusIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M8.75 1.75V1H7.25V1.75V6.75H2.25H1.5V8.25H2.25H7.25V13.25V14H8.75V13.25V8.25H13.75H14.5V6.75H13.75H8.75V1.75Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const CopyIcon = ({ size = 24 }: { size?: number }) => (\n  <svg\n    height={size}\n    viewBox=\"0 0 24 24\"\n    width={size}\n    fill=\"none\"\n  >\n    <path d=\"M0 4C0 1.79086 1.79086 0 4 0H20C22.2091 0 24 1.79086 24 4V20C24 22.2091 22.2091 24 20 24H4C1.79086 24 0 22.2091 0 20V4Z\" />\n    <path d=\"M9.60016 14.3991C9.60016 12.137 9.60016 11.0051 10.3033 10.3027C11.0056 9.59961 12.1375 9.59961 14.3997 9.59961H15.1996C17.4618 9.59961 18.5937 9.59961 19.296 10.3027C19.9992 11.0051 19.9992 12.137 19.9992 14.3991V15.1991C19.9992 17.4612 19.9992 18.5931 19.296 19.2955C18.5937 19.9986 17.4618 19.9986 15.1996 19.9986H14.3997C12.1375 19.9986 11.0056 19.9986 10.3033 19.2955C9.60016 18.5931 9.60016 17.4612 9.60016 15.1991V14.3991Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n    <path d=\"M15.9988 9.59946C15.9964 7.23409 15.9612 6.00861 15.2725 5.16949C15.1396 5.00762 14.9912 4.85919 14.8294 4.72633C13.943 4 12.6296 4 9.99942 4C7.37007 4 6.055 4 5.16949 4.72633C5.00762 4.85919 4.85919 5.00762 4.72633 5.16949C4 6.0558 4 7.36927 4 9.99942C4 12.6288 4 13.9438 4.72633 14.8294C4.85919 14.9912 5.00762 15.1396 5.16949 15.2725C6.00941 15.9604 7.23329 15.9972 9.59946 15.9988\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n  </svg>\n);\n\nexport const ThumbUpIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M6.89531 2.23972C6.72984 2.12153 6.5 2.23981 6.5 2.44315V5.25001C6.5 6.21651 5.7165 7.00001 4.75 7.00001H2.5V13.5H12.1884C12.762 13.5 13.262 13.1096 13.4011 12.5532L14.4011 8.55318C14.5984 7.76425 14.0017 7.00001 13.1884 7.00001H9.25H8.5V6.25001V3.51458C8.5 3.43384 8.46101 3.35807 8.39531 3.31114L6.89531 2.23972ZM5 2.44315C5 1.01975 6.6089 0.191779 7.76717 1.01912L9.26717 2.09054C9.72706 2.41904 10 2.94941 10 3.51458V5.50001H13.1884C14.9775 5.50001 16.2903 7.18133 15.8563 8.91698L14.8563 12.917C14.5503 14.1412 13.4503 15 12.1884 15H1.75H1V14.25V6.25001V5.50001H1.75H4.75C4.88807 5.50001 5 5.38808 5 5.25001V2.44315Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const ThumbDownIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M6.89531 13.7603C6.72984 13.8785 6.5 13.7602 6.5 13.5569V10.75C6.5 9.7835 5.7165 9 4.75 9H2.5V2.5H12.1884C12.762 2.5 13.262 2.89037 13.4011 3.44683L14.4011 7.44683C14.5984 8.23576 14.0017 9 13.1884 9H9.25H8.5V9.75V12.4854C8.5 12.5662 8.46101 12.6419 8.39531 12.6889L6.89531 13.7603ZM5 13.5569C5 14.9803 6.6089 15.8082 7.76717 14.9809L9.26717 13.9095C9.72706 13.581 10 13.0506 10 12.4854V10.5H13.1884C14.9775 10.5 16.2903 8.81868 15.8563 7.08303L14.8563 3.08303C14.5503 1.85882 13.4503 1 12.1884 1H1.75H1V1.75V9.75V10.5H1.75H4.75C4.88807 10.5 5 10.6119 5 10.75V13.5569Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const ChevronDownIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M12.0607 6.74999L11.5303 7.28032L8.7071 10.1035C8.31657 10.4941 7.68341 10.4941 7.29288 10.1035L4.46966 7.28032L3.93933 6.74999L4.99999 5.68933L5.53032 6.21966L7.99999 8.68933L10.4697 6.21966L11 5.68933L12.0607 6.74999Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const CheckCircleFillIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8ZM11.5303 6.53033L12.0607 6L11 4.93934L10.4697 5.46967L6.5 9.43934L5.53033 8.46967L5 7.93934L3.93934 9L4.46967 9.53033L5.96967 11.0303C6.26256 11.3232 6.73744 11.3232 7.03033 11.0303L11.5303 6.53033Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const GlobeIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M10.268 14.0934C11.9051 13.4838 13.2303 12.2333 13.9384 10.6469C13.1192 10.7941 12.2138 10.9111 11.2469 10.9925C11.0336 12.2005 10.695 13.2621 10.268 14.0934ZM8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM8.48347 14.4823C8.32384 14.494 8.16262 14.5 8 14.5C7.83738 14.5 7.67616 14.494 7.51654 14.4823C7.5132 14.4791 7.50984 14.4759 7.50647 14.4726C7.2415 14.2165 6.94578 13.7854 6.67032 13.1558C6.41594 12.5744 6.19979 11.8714 6.04101 11.0778C6.67605 11.1088 7.33104 11.125 8 11.125C8.66896 11.125 9.32395 11.1088 9.95899 11.0778C9.80021 11.8714 9.58406 12.5744 9.32968 13.1558C9.05422 13.7854 8.7585 14.2165 8.49353 14.4726C8.49016 14.4759 8.4868 14.4791 8.48347 14.4823ZM11.4187 9.72246C12.5137 9.62096 13.5116 9.47245 14.3724 9.28806C14.4561 8.87172 14.5 8.44099 14.5 8C14.5 7.55901 14.4561 7.12828 14.3724 6.71194C13.5116 6.52755 12.5137 6.37904 11.4187 6.27753C11.4719 6.83232 11.5 7.40867 11.5 8C11.5 8.59133 11.4719 9.16768 11.4187 9.72246ZM10.1525 6.18401C10.2157 6.75982 10.25 7.36805 10.25 8C10.25 8.63195 10.2157 9.24018 10.1525 9.81598C9.46123 9.85455 8.7409 9.875 8 9.875C7.25909 9.875 6.53877 9.85455 5.84749 9.81598C5.7843 9.24018 5.75 8.63195 5.75 8C5.75 7.36805 5.7843 6.75982 5.84749 6.18401C6.53877 6.14545 7.25909 6.125 8 6.125C8.74091 6.125 9.46123 6.14545 10.1525 6.18401ZM11.2469 5.00748C12.2138 5.08891 13.1191 5.20593 13.9384 5.35306C13.2303 3.7667 11.9051 2.51622 10.268 1.90662C10.695 2.73788 11.0336 3.79953 11.2469 5.00748ZM8.48347 1.51771C8.4868 1.52089 8.49016 1.52411 8.49353 1.52737C8.7585 1.78353 9.05422 2.21456 9.32968 2.84417C9.58406 3.42562 9.80021 4.12856 9.95899 4.92219C9.32395 4.89118 8.66896 4.875 8 4.875C7.33104 4.875 6.67605 4.89118 6.04101 4.92219C6.19978 4.12856 6.41594 3.42562 6.67032 2.84417C6.94578 2.21456 7.2415 1.78353 7.50647 1.52737C7.50984 1.52411 7.51319 1.52089 7.51653 1.51771C7.67615 1.50597 7.83738 1.5 8 1.5C8.16262 1.5 8.32384 1.50597 8.48347 1.51771ZM5.73202 1.90663C4.0949 2.51622 2.76975 3.7667 2.06159 5.35306C2.88085 5.20593 3.78617 5.08891 4.75309 5.00748C4.96639 3.79953 5.30497 2.73788 5.73202 1.90663ZM4.58133 6.27753C3.48633 6.37904 2.48837 6.52755 1.62761 6.71194C1.54392 7.12828 1.5 7.55901 1.5 8C1.5 8.44099 1.54392 8.87172 1.62761 9.28806C2.48837 9.47245 3.48633 9.62096 4.58133 9.72246C4.52807 9.16768 4.5 8.59133 4.5 8C4.5 7.40867 4.52807 6.83232 4.58133 6.27753ZM4.75309 10.9925C3.78617 10.9111 2.88085 10.7941 2.06159 10.6469C2.76975 12.2333 4.0949 13.4838 5.73202 14.0934C5.30497 13.2621 4.96639 12.2005 4.75309 10.9925Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const LockIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M10 4.5V6H6V4.5C6 3.39543 6.89543 2.5 8 2.5C9.10457 2.5 10 3.39543 10 4.5ZM4.5 6V4.5C4.5 2.567 6.067 1 8 1C9.933 1 11.5 2.567 11.5 4.5V6H12.5H14V7.5V12.5C14 13.8807 12.8807 15 11.5 15H4.5C3.11929 15 2 13.8807 2 12.5V7.5V6H3.5H4.5ZM11.5 7.5H10H6H4.5H3.5V12.5C3.5 13.0523 3.94772 13.5 4.5 13.5H11.5C12.0523 13.5 12.5 13.0523 12.5 12.5V7.5H11.5Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const EyeIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M4.02168 4.76932C6.11619 2.33698 9.88374 2.33698 11.9783 4.76932L14.7602 7.99999L11.9783 11.2307C9.88374 13.663 6.1162 13.663 4.02168 11.2307L1.23971 7.99999L4.02168 4.76932ZM13.1149 3.79054C10.422 0.663244 5.57797 0.663247 2.88503 3.79054L-0.318359 7.5106V8.48938L2.88503 12.2094C5.57797 15.3367 10.422 15.3367 13.1149 12.2094L16.3183 8.48938V7.5106L13.1149 3.79054ZM6.49997 7.99999C6.49997 7.17157 7.17154 6.49999 7.99997 6.49999C8.82839 6.49999 9.49997 7.17157 9.49997 7.99999C9.49997 8.82842 8.82839 9.49999 7.99997 9.49999C7.17154 9.49999 6.49997 8.82842 6.49997 7.99999ZM7.99997 4.99999C6.34311 4.99999 4.99997 6.34314 4.99997 7.99999C4.99997 9.65685 6.34311 11 7.99997 11C9.65682 11 11 9.65685 11 7.99999C11 6.34314 9.65682 4.99999 7.99997 4.99999Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const ShareIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M15 11.25V10.5H13.5V11.25V12.75C13.5 13.1642 13.1642 13.5 12.75 13.5H3.25C2.83579 13.5 2.5 13.1642 2.5 12.75L2.5 3.25C2.5 2.83579 2.83579 2.5 3.25 2.5H5.75H6.5V1H5.75H3.25C2.00736 1 1 2.00736 1 3.25V12.75C1 13.9926 2.00736 15 3.25 15H12.75C13.9926 15 15 13.9926 15 12.75V11.25ZM15 5.5L10.5 1V4C7.46243 4 5 6.46243 5 9.5V10L5.05855 9.91218C6.27146 8.09281 8.31339 7 10.5 7V10L15 5.5Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const CodeIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M4.21969 12.5303L4.75002 13.0607L5.81068 12L5.28035 11.4697L1.81068 7.99999L5.28035 4.53032L5.81068 3.99999L4.75002 2.93933L4.21969 3.46966L0.39647 7.29289C0.00594562 7.68341 0.00594562 8.31658 0.39647 8.7071L4.21969 12.5303ZM11.7804 12.5303L11.25 13.0607L10.1894 12L10.7197 11.4697L14.1894 7.99999L10.7197 4.53032L10.1894 3.99999L11.25 2.93933L11.7804 3.46966L15.6036 7.29289C15.9941 7.68341 15.9941 8.31658 15.6036 8.7071L11.7804 12.5303Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const PlayIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M13.4549 7.22745L13.3229 7.16146L2.5 1.74999L2.4583 1.72914L1.80902 1.4045L1.3618 1.18089C1.19558 1.09778 1 1.21865 1 1.4045L1 1.9045L1 2.63041L1 2.67704L1 13.3229L1 13.3696L1 14.0955L1 14.5955C1 14.7813 1.19558 14.9022 1.3618 14.8191L1.80902 14.5955L2.4583 14.2708L2.5 14.25L13.3229 8.83852L13.4549 8.77253L14.2546 8.37267L14.5528 8.2236C14.737 8.13147 14.737 7.86851 14.5528 7.77638L14.2546 7.62731L13.4549 7.22745ZM11.6459 7.99999L2.5 3.42704L2.5 12.5729L11.6459 7.99999Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const PythonIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        d=\"M7.90474 0.00013087C7.24499 0.00316291 6.61494 0.0588153 6.06057 0.15584C4.42745 0.441207 4.13094 1.0385 4.13094 2.14002V3.59479H7.9902V4.07971H4.13094H2.68259C1.56099 4.07971 0.578874 4.7465 0.271682 6.01496C-0.0826597 7.4689 -0.0983767 8.37619 0.271682 9.89434C0.546012 11.0244 1.20115 11.8296 2.32276 11.8296H3.64966V10.0856C3.64966 8.82574 4.75179 7.71441 6.06057 7.71441H9.91533C10.9884 7.71441 11.845 6.84056 11.845 5.77472V2.14002C11.845 1.10556 10.9626 0.328487 9.91533 0.15584C9.25237 0.046687 8.56448 -0.00290121 7.90474 0.00013087ZM5.81768 1.17017C6.21631 1.17017 6.54185 1.49742 6.54185 1.89978C6.54185 2.30072 6.21631 2.62494 5.81768 2.62494C5.41761 2.62494 5.09351 2.30072 5.09351 1.89978C5.09351 1.49742 5.41761 1.17017 5.81768 1.17017Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M12.3262 4.07971V5.77472C12.3262 7.08883 11.1997 8.19488 9.91525 8.19488H6.06049C5.0046 8.19488 4.13086 9.0887 4.13086 10.1346V13.7693C4.13086 14.8037 5.04033 15.4122 6.06049 15.709C7.28211 16.0642 8.45359 16.1285 9.91525 15.709C10.8868 15.4307 11.8449 14.8708 11.8449 13.7693V12.3145H7.99012V11.8296H11.8449H13.7745C14.8961 11.8296 15.3141 11.0558 15.7041 9.89434C16.1071 8.69865 16.0899 7.5488 15.7041 6.01495C15.4269 4.91058 14.8975 4.07971 13.7745 4.07971H12.3262ZM10.1581 13.2843C10.5582 13.2843 10.8823 13.6086 10.8823 14.0095C10.8823 14.4119 10.5582 14.7391 10.1581 14.7391C9.7595 14.7391 9.43397 14.4119 9.43397 14.0095C9.43397 13.6086 9.7595 13.2843 10.1581 13.2843Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const TerminalWindowIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M1.5 2.5H14.5V12.5C14.5 13.0523 14.0523 13.5 13.5 13.5H2.5C1.94772 13.5 1.5 13.0523 1.5 12.5V2.5ZM0 1H1.5H14.5H16V2.5V12.5C16 13.8807 14.8807 15 13.5 15H2.5C1.11929 15 0 13.8807 0 12.5V2.5V1ZM4 11.1339L4.44194 10.6919L6.51516 8.61872C6.85687 8.27701 6.85687 7.72299 6.51517 7.38128L4.44194 5.30806L4 4.86612L3.11612 5.75L3.55806 6.19194L5.36612 8L3.55806 9.80806L3.11612 10.25L4 11.1339ZM8 9.75494H8.6225H11.75H12.3725V10.9999H11.75H8.6225H8V9.75494Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const TerminalIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M1.53035 12.7804L1.00002 13.3108L-0.0606384 12.2501L0.469692 11.7198L4.18936 8.00011L0.469692 4.28044L-0.0606384 3.75011L1.00002 2.68945L1.53035 3.21978L5.60358 7.29301C5.9941 7.68353 5.9941 8.3167 5.60357 8.70722L1.53035 12.7804ZM8.75002 12.5001H8.00002V14.0001H8.75002H15.25H16V12.5001H15.25H8.75002Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const ClockRewind = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M7.96452 2.5C11.0257 2.5 13.5 4.96643 13.5 8C13.5 11.0336 11.0257 13.5 7.96452 13.5C6.12055 13.5 4.48831 12.6051 3.48161 11.2273L3.03915 10.6217L1.828 11.5066L2.27046 12.1122C3.54872 13.8617 5.62368 15 7.96452 15C11.8461 15 15 11.87 15 8C15 4.13001 11.8461 1 7.96452 1C5.06835 1 2.57851 2.74164 1.5 5.23347V3.75V3H0V3.75V7.25C0 7.66421 0.335786 8 0.75 8H3.75H4.5V6.5H3.75H2.63724C3.29365 4.19393 5.42843 2.5 7.96452 2.5ZM8.75 5.25V4.5H7.25V5.25V7.8662C7.25 8.20056 7.4171 8.51279 7.6953 8.69825L9.08397 9.62404L9.70801 10.0401L10.5401 8.79199L9.91603 8.37596L8.75 7.59861V5.25Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const LogsIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M9 2H9.75H14.25H15V3.5H14.25H9.75H9V2ZM9 12.5H9.75H14.25H15V14H14.25H9.75H9V12.5ZM9.75 7.25H9V8.75H9.75H14.25H15V7.25H14.25H9.75ZM1 12.5H1.75H2.25H3V14H2.25H1.75H1V12.5ZM1.75 2H1V3.5H1.75H2.25H3V2H2.25H1.75ZM1 7.25H1.75H2.25H3V8.75H2.25H1.75H1V7.25ZM5.75 12.5H5V14H5.75H6.25H7V12.5H6.25H5.75ZM5 2H5.75H6.25H7V3.5H6.25H5.75H5V2ZM5.75 7.25H5V8.75H5.75H6.25H7V7.25H6.25H5.75Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const ImageIcon = ({ size = 16 }: { size?: number }) => {\n  return (\n    <svg\n      height={size}\n      strokeLinejoin=\"round\"\n      viewBox=\"0 0 16 16\"\n      width={size}\n      style={{ color: 'currentcolor' } as React.CSSProperties}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M14.5 2.5H1.5V9.18933L2.96966 7.71967L3.18933 7.5H3.49999H6.63001H6.93933L6.96966 7.46967L10.4697 3.96967L11.5303 3.96967L14.5 6.93934V2.5ZM8.00066 8.55999L9.53034 10.0897L10.0607 10.62L9.00001 11.6807L8.46968 11.1503L6.31935 9H3.81065L1.53032 11.2803L1.5 11.3106V12.5C1.5 13.0523 1.94772 13.5 2.5 13.5H13.5C14.0523 13.5 14.5 13.0523 14.5 12.5V9.06066L11 5.56066L8.03032 8.53033L8.00066 8.55999ZM4.05312e-06 10.8107V12.5C4.05312e-06 13.8807 1.11929 15 2.5 15H13.5C14.8807 15 16 13.8807 16 12.5V9.56066L16.5607 9L16.0303 8.46967L16 8.43934V2.5V1H14.5H1.5H4.05312e-06V2.5V10.6893L-0.0606689 10.75L4.05312e-06 10.8107Z\"\n        fill=\"currentColor\"\n      />\n    </svg>\n  );\n};\n\nexport const FullscreenIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M1 5.25V6H2.5V5.25V2.5H5.25H6V1H5.25H2C1.44772 1 1 1.44772 1 2V5.25ZM5.25 14.9994H6V13.4994H5.25H2.5V10.7494V9.99939H1V10.7494V13.9994C1 14.5517 1.44772 14.9994 2 14.9994H5.25ZM15 10V10.75V14C15 14.5523 14.5523 15 14 15H10.75H10V13.5H10.75H13.5V10.75V10H15ZM10.75 1H10V2.5H10.75H13.5V5.25V6H15V5.25V2C15 1.44772 14.5523 1 14 1H10.75Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const DownloadIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M8.75 1V1.75V8.68934L10.7197 6.71967L11.25 6.18934L12.3107 7.25L11.7803 7.78033L8.70711 10.8536C8.31658 11.2441 7.68342 11.2441 7.29289 10.8536L4.21967 7.78033L3.68934 7.25L4.75 6.18934L5.28033 6.71967L7.25 8.68934V1.75V1H8.75ZM13.5 9.25V13.5H2.5V9.25V8.5H1V9.25V14C1 14.5523 1.44771 15 2 15H14C14.5523 15 15 14.5523 15 14V9.25V8.5H13.5V9.25Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const LineChartIcon = ({ size = 16 }: { size?: number }) => (\n  <svg\n    height={size}\n    strokeLinejoin=\"round\"\n    viewBox=\"0 0 16 16\"\n    width={size}\n    style={{ color: 'currentcolor' } as React.CSSProperties}\n  >\n    <path\n      fill=\"currentColor\"\n      fillRule=\"evenodd\"\n      d=\"M1 1v11.75A2.25 2.25 0 0 0 3.25 15H15v-1.5H3.25a.75.75 0 0 1-.75-.75V1H1Zm13.297 5.013.513-.547-1.094-1.026-.513.547-3.22 3.434-2.276-2.275a1 1 0 0 0-1.414 0L4.22 8.22l-.53.53 1.06 1.06.53-.53L7 7.56l2.287 2.287a1 1 0 0 0 1.437-.023l3.573-3.811Z\"\n      clipRule=\"evenodd\"\n    />\n  </svg>\n);\n\nexport const CloseIcon = ({ size = 24 }: { size?: number }) => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width={size} height={size} viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path d=\"M7 17L17 7M7 7L17 17\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n    </svg>\n  );\n};\n\nexport const ArrowRightIcon = ({ size = 24 }: { size?: number }) => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={size}\n      height={size}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n    >\n      <path d=\"M20.3635 12.7068C20.5509 12.5193 20.6562 12.265 20.6562 11.9998C20.6562 11.7347 20.5509 11.4803 20.3635 11.2928L14.7065 5.63582C14.5179 5.45366 14.2653 5.35287 14.0031 5.35515C13.7409 5.35742 13.4901 5.46259 13.3046 5.648C13.1192 5.83341 13.0141 6.08422 13.0118 6.34642C13.0095 6.60862 13.1103 6.86122 13.2925 7.04982L17.2425 10.9998L3.99946 10.9998C3.73425 10.9998 3.47989 11.1052 3.29236 11.2927C3.10482 11.4803 2.99946 11.7346 2.99946 11.9998C2.99946 12.265 3.10482 12.5194 3.29236 12.7069C3.47989 12.8945 3.73425 12.9998 3.99946 12.9998L17.2425 12.9998L13.2925 16.9498C13.1103 17.1384 13.0095 17.391 13.0118 17.6532C13.0141 17.9154 13.1192 18.1662 13.3046 18.3516C13.4901 18.537 13.7409 18.6422 14.0031 18.6445C14.2653 18.6468 14.5179 18.546 14.7065 18.3638L20.3635 12.7068Z\" fill=\"currentColor\" />\n    </svg>\n  );\n};\n\nexport const LeftOutlined = ({ size = 24 }: { size?: number }) => {\n  return (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M14 7L9 12L14 17\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n    </svg>\n  );\n};\nexport const RightOutlined = ({ size = 24 }: { size?: number }) => {\n  return (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M10 17L15 12L10 7\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n    </svg>\n  );\n};\n\nexport const SendIcon = ({ size = 24 }: { size?: number }) => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width={size} height={size} viewBox=\"0 0 15 15\" fill=\"none\">\n      <path d=\"M0 15L1.56 8.055L10.185 7.515L1.56 6.93L0 0L15 7.5L0 15Z\" fill=\"currentColor\" />\n    </svg>\n  );\n};\n\nexport const VoiceIcon = ({ size = 24 }: { size?: number }) => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={size}\n      height={size}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n    >\n      <path d=\"M0 4C0 1.79086 1.79086 0 4 0H20C22.2091 0 24 1.79086 24 4V20C24 22.2091 22.2091 24 20 24H4C1.79086 24 0 22.2091 0 20V4Z\" />\n      <path d=\"M13.5996 14.3449V9.65499C13.5996 7.03422 13.5996 5.72426 12.8596 5.3976C12.1187 5.07177 11.2475 5.99758 9.50496 7.8517C8.60251 8.81168 8.08807 9.02418 6.804 9.02418C5.68153 9.02418 5.11989 9.02418 4.71587 9.31084C3.87902 9.90582 4.00702 11.0683 4.00702 11.9999C4.00702 12.9316 3.87982 14.0941 4.71747 14.689C5.12069 14.9757 5.68233 14.9757 6.8048 14.9757C8.08887 14.9757 8.60331 15.1882 9.50576 16.1482C11.2483 18.0015 12.1195 18.9281 12.8604 18.6023C13.6004 18.2756 13.6004 16.9657 13.6004 14.344M15.9998 9.5C16.4998 10.1833 16.7998 11.0525 16.7998 11.9999C16.7998 12.9474 16.4998 13.8166 15.9998 14.4999M18.3999 7.83337C19.4 8.97168 20 10.4216 20 11.9999C20 13.5782 19.4 15.0282 18.3999 16.1665\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n    </svg>\n  );\n};\n\nexport const VoiceingIcon = ({ size = 24 }: { size?: number }) => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={size}\n      height={size}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n    >\n      <path d=\"M12 4V20M8 9V15M20 10V14M4 10V14M16 7V17\" stroke=\"#4C72FF\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n    </svg>\n  );\n};\n\nexport const RetryIcon = ({ size = 24 }: { size?: number }) => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={size}\n      height={size}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n    >\n      <path d=\"M0 4C0 1.79086 1.79086 0 4 0H20C22.2091 0 24 1.79086 24 4V20C24 22.2091 22.2091 24 20 24H4C1.79086 24 0 22.2091 0 20V4Z\" fill=\"white\" />\n      <g clip-path=\"url(#clip0_3718_62769)\">\n        <path d=\"M14.1126 4.6665L14.5113 5.41184C14.7806 5.91517 14.9153 6.16717 14.826 6.27517C14.7373 6.38317 14.444 6.29584 13.8566 6.12184C13.2543 5.94356 12.6294 5.85307 12.0013 5.85317C8.50331 5.85317 5.66797 8.60517 5.66797 11.9998C5.66691 13.082 5.95953 14.1442 6.51464 15.0732M9.89064 19.3332L9.49197 18.5878C9.22264 18.0838 9.08797 17.8318 9.17731 17.7245C9.26597 17.6165 9.55931 17.7032 10.1466 17.8778C10.7333 18.0518 11.3566 18.1458 12.002 18.1458C15.5 18.1458 18.3353 15.3938 18.3353 11.9992C18.3362 10.9172 18.0436 9.85527 17.4886 8.9265\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      </g>\n      <defs>\n        <clipPath id=\"clip0_3718_62769\">\n          <rect width=\"16\" height=\"16\" fill=\"white\" transform=\"translate(4 4)\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n};\n\nexport const DeleteIcon = ({ size = 20 }: { size?: number }) => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={size}\n      height={size}\n      viewBox=\"0 0 20 20\"\n      fill=\"none\"\n    >\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.29183 3.58321C7.29183 3.55495 7.30346 3.51147 7.35734 3.46432C7.41246 3.41609 7.50317 3.37488 7.61921 3.37488H12.3811C12.4972 3.37488 12.5879 3.41609 12.643 3.46432C12.6969 3.51147 12.7085 3.55495 12.7085 3.58321V4.62488H7.29183V3.58321ZM6.04183 4.62488V3.58321C6.04183 2.70201 6.82905 2.12488 7.61921 2.12488H12.3811C13.1713 2.12488 13.9585 2.70201 13.9585 3.58321V4.62488H15.6274H16.6699C17.0151 4.62488 17.2949 4.9047 17.2949 5.24988C17.2949 5.59506 17.0151 5.87488 16.6699 5.87488H16.2064L15.4459 15.8191C15.3457 17.122 14.2592 18.1283 12.9525 18.1283H7.04765C5.7409 18.1283 4.65446 17.1222 4.55423 15.8194L3.7937 5.87488H3.33105C2.98588 5.87488 2.70605 5.59506 2.70605 5.24988C2.70605 4.9047 2.98588 4.62488 3.33105 4.62488H4.37272H6.04183ZM13.3335 5.87488H6.66683H5.04735L5.80055 15.7235C5.85081 16.375 6.39416 16.8783 7.04765 16.8783H12.9525C13.606 16.8783 14.1493 16.3753 14.1996 15.7238L14.9528 5.87488H13.3335ZM11.6416 8.43754C11.9868 8.43754 12.2666 8.71736 12.2666 9.06254V13.752C12.2666 14.0972 11.9868 14.377 11.6416 14.377C11.2964 14.377 11.0166 14.0972 11.0166 13.752V9.06254C11.0166 8.71736 11.2964 8.43754 11.6416 8.43754ZM8.98372 9.06254C8.98372 8.71736 8.7039 8.43754 8.35872 8.43754C8.01355 8.43754 7.73372 8.71736 7.73372 9.06254V13.752C7.73372 14.0972 8.01355 14.377 8.35872 14.377C8.7039 14.377 8.98372 14.0972 8.98372 13.752V9.06254Z\" fill=\"#FF543D\" />\n    </svg>\n  );\n};\n\nexport const SettingIcon = ({ size = 20 }: { size?: number }) => {\n  return (\n\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M22 6.5H16\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      <path d=\"M6 6.5H2\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M10 10C8.067 10 6.5 8.433 6.5 6.5C6.5 4.567 8.067 3 10 3C11.933 3 13.5 4.567 13.5 6.5C13.5 8.433 11.933 10 10 10Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      <path d=\"M22 17.5H18\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      <path d=\"M8 17.5H2\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M14 21C12.067 21 10.5 19.433 10.5 17.5C10.5 15.567 12.067 14 14 14C15.933 14 17.5 15.567 17.5 17.5C17.5 19.433 15.933 21 14 21Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n    </svg>\n\n  );\n};\nexport const LanguageIcon = ({ size = 20 }: { size?: number }) => {\n  return (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M2 12C2 17.523 6.477 22 12 22C17.523 22 22 17.523 22 12C22 6.477 17.523 2 12 2C6.477 2 2 6.477 2 12Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n      <path d=\"M12.9999 2.04999C12.9999 2.04999 15.9999 5.99999 15.9999 12C15.9999 18 12.9999 21.95 12.9999 21.95M10.9999 21.95C10.9999 21.95 7.99988 18 7.99988 12C7.99988 5.99999 10.9999 2.04999 10.9999 2.04999M2.62988 15.5H21.3699M2.62988 8.49999H21.3699\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\n    </svg>\n  );\n};\n\nexport const LoadingIcon = ({ size = 20 }: { size?: number }) => {\n  return (\n    <svg width={size} height={size} viewBox=\"0 0 40 40\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"#3498db\">\n      <circle cx=\"10\" cy=\"20\" r=\"4\">\n        <animate attributeName=\"opacity\" from=\"0.3\" to=\"1\" dur=\"1.2s\" begin=\"0s\" repeatCount=\"indefinite\" />\n        <animate attributeName=\"r\" from=\"3\" to=\"4\" dur=\"1.2s\" begin=\"0s\" repeatCount=\"indefinite\" />\n      </circle>\n      <circle cx=\"20\" cy=\"20\" r=\"4\">\n        <animate attributeName=\"opacity\" from=\"0.3\" to=\"1\" dur=\"1.2s\" begin=\"0.2s\" repeatCount=\"indefinite\" />\n        <animate attributeName=\"r\" from=\"3\" to=\"4\" dur=\"1.2s\" begin=\"0.2s\" repeatCount=\"indefinite\" />\n      </circle>\n      <circle cx=\"30\" cy=\"20\" r=\"4\">\n        <animate attributeName=\"opacity\" from=\"0.3\" to=\"1\" dur=\"1.2s\" begin=\"0.4s\" repeatCount=\"indefinite\" />\n        <animate attributeName=\"r\" from=\"3\" to=\"4\" dur=\"1.2s\" begin=\"0.4s\" repeatCount=\"indefinite\" />\n      </circle>\n    </svg>\n  );\n};\n","import type { GlobalState } from '../types';\n\nimport { getMainUsername, isChatBasicGroup } from '../helpers';\nimport { selectChat, selectChatFullInfo } from './chats';\nimport { selectUser } from './users';\n\nexport function selectChatGroupCall<T extends GlobalState>(global: T, chatId: string) {\n  const fullInfo = selectChatFullInfo(global, chatId);\n  if (!fullInfo || !fullInfo.groupCallId) return undefined;\n\n  return selectGroupCall(global, fullInfo.groupCallId);\n}\n\nexport function selectGroupCall<T extends GlobalState>(global: T, groupCallId: string) {\n  return global.groupCalls.byId[groupCallId];\n}\n\nexport function selectGroupCallParticipant<T extends GlobalState>(\n  global: T, groupCallId: string, participantId: string,\n) {\n  return selectGroupCall(global, groupCallId)?.participants[participantId];\n}\n\nexport function selectIsAdminInActiveGroupCall<T extends GlobalState>(global: T): boolean {\n  const chatId = selectActiveGroupCall(global)?.chatId;\n\n  if (!chatId) return false;\n\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  return (isChatBasicGroup(chat) && chat.isCreator) || Boolean(chat.adminRights?.manageCall);\n}\n\nexport function selectActiveGroupCall<T extends GlobalState>(global: T) {\n  const { groupCalls: { activeGroupCallId } } = global;\n  if (!activeGroupCallId) {\n    return undefined;\n  }\n\n  return selectGroupCall(global, activeGroupCallId);\n}\n\nexport function selectPhoneCallUser<T extends GlobalState>(global: T) {\n  const { phoneCall, currentUserId } = global;\n  if (!phoneCall || !phoneCall.participantId || !phoneCall.adminId) {\n    return undefined;\n  }\n\n  const id = phoneCall.adminId === currentUserId ? phoneCall.participantId : phoneCall.adminId;\n  return selectUser(global, id);\n}\n\nexport function selectCanInviteToActiveGroupCall<T extends GlobalState>(global: T) {\n  const groupCall = selectActiveGroupCall(global);\n\n  if (!groupCall || !groupCall.chatId) {\n    return false;\n  }\n\n  const chat = selectChat(global, groupCall.chatId);\n  if (!chat) {\n    return false;\n  }\n\n  const hasPublicUsername = Boolean(getMainUsername(chat));\n  if (hasPublicUsername) {\n    return true;\n  }\n\n  const inviteLink = selectChatFullInfo(global, chat.id)?.inviteLink;\n  return Boolean(inviteLink);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"Gi8Nokbl\",\"header\":\"H01lE7mv\",\"title\":\"VQbs04hT\",\"caption\":\"X7bBlGdi\",\"table\":\"s5beXqqL\",\"tableCell\":\"gvrp3KoR\",\"tableHeading\":\"IHb3ZATQ\",\"tableValue\":\"zAPFdKbZ\",\"tableSecondaryValue\":\"_mYEmh_u\",\"value\":\"idLrmbhS\",\"negative\":\"SLfwGHQC\",\"decimalPart\":\"ZAfXkuWL\",\"decimalUsdPart\":\"HRXb_S2M\",\"toncoin\":\"it39BC_c\"};","import type { ReactNode } from 'react';\nimport type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\n\nimport type {\n  ApiBoostStatistics, ApiChannelMonetizationStatistics,\n  ApiChannelStatistics, ApiGroupStatistics, ApiPostStatistics, StatisticsOverviewItem,\n} from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { formatFullDate } from '../../../util/dates/dateFormat';\nimport { formatInteger, formatIntegerCompact } from '../../../util/textFormat';\n\nimport useLang from '../../../hooks/useLang';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Icon from '../../common/icons/Icon';\n\nimport styles from './StatisticsOverview.module.scss';\n\ntype OverviewCell = {\n  name: string;\n  title: string;\n  isPercentage?: boolean;\n  withAbsoluteValue?: boolean;\n  isPlain?: boolean;\n  isApproximate?: boolean;\n};\n\nconst CHANNEL_OVERVIEW: OverviewCell[][] = [\n  [\n    { name: 'followers', title: 'ChannelStats.Overview.Followers' },\n    { name: 'enabledNotifications', title: 'ChannelStats.Overview.EnabledNotifications', isPercentage: true },\n  ],\n  [\n    { name: 'viewsPerPost', title: 'ChannelStats.Overview.ViewsPerPost' },\n    { name: 'viewsPerStory', title: 'ChannelStats.Overview.ViewsPerStory' },\n  ],\n  [\n    { name: 'sharesPerPost', title: 'ChannelStats.Overview.SharesPerPost' },\n    { name: 'sharesPerStory', title: 'ChannelStats.Overview.SharesPerStory' },\n  ],\n  [\n    { name: 'reactionsPerPost', title: 'ChannelStats.Overview.ReactionsPerPost' },\n    { name: 'reactionsPerStory', title: 'ChannelStats.Overview.ReactionsPerStory' },\n  ],\n];\n\nconst GROUP_OVERVIEW: OverviewCell[][] = [\n  [\n    { name: 'members', title: 'Stats.GroupMembers' },\n    { name: 'messages', title: 'Stats.GroupMessages' },\n  ],\n  [\n    { name: 'viewers', title: 'Stats.GroupViewers' },\n    { name: 'posters', title: 'Stats.GroupPosters' },\n  ],\n];\n\nconst MESSAGE_OVERVIEW: OverviewCell[][] = [\n  [\n    { name: 'viewsCount', title: 'Stats.Message.Views', isPlain: true },\n    { name: 'publicForwards', title: 'Stats.Message.PublicShares', isPlain: true },\n  ],\n  [\n    { name: 'reactionsCount', title: 'Channel.Stats.Overview.Reactions', isPlain: true },\n    {\n      name: 'forwardsCount', title: 'Stats.Message.PrivateShares', isPlain: true, isApproximate: true,\n    },\n  ],\n];\n\nconst STORY_OVERVIEW: OverviewCell[][] = [\n  [\n    { name: 'viewsCount', title: 'Channel.Stats.Overview.Views', isPlain: true },\n    { name: 'publicForwards', title: 'PublicShares', isPlain: true },\n  ],\n  [\n    { name: 'reactionsCount', title: 'Channel.Stats.Overview.Reactions', isPlain: true },\n    { name: 'forwardsCount', title: 'PrivateShares', isPlain: true },\n  ],\n];\n\nconst BOOST_OVERVIEW: OverviewCell[][] = [\n  [\n    { name: 'level', title: 'Stats.Boosts.Level', isPlain: true },\n    {\n      name: 'premiumSubscribers',\n      title: 'Stats.Boosts.PremiumSubscribers',\n      isPercentage: true,\n      isApproximate: true,\n      withAbsoluteValue: true,\n    },\n  ],\n  [\n    { name: 'boosts', title: 'Stats.Boosts.ExistingBoosts', isPlain: true },\n    { name: 'remainingBoosts', title: 'Stats.Boosts.BoostsToLevelUp', isPlain: true },\n  ],\n];\n\ntype StatisticsType = 'channel' | 'group' | 'message' | 'boost' | 'story' | 'monetization';\n\nexport type OwnProps = {\n  type: StatisticsType;\n  title?: string;\n  className?: string;\n  isToncoin?: boolean;\n  statistics:\n  ApiChannelStatistics |\n  ApiGroupStatistics |\n  ApiPostStatistics |\n  ApiBoostStatistics |\n  ApiChannelMonetizationStatistics;\n  subtitle?: ReactNode;\n};\n\nconst StatisticsOverview: FC<OwnProps> = ({\n  title,\n  type,\n  statistics,\n  isToncoin,\n  className,\n  subtitle,\n}) => {\n  const oldLang = useOldLang();\n  const lang = useLang();\n\n  const renderOverviewItemValue = ({ change, percentage }: StatisticsOverviewItem) => {\n    if (!change) {\n      return undefined;\n    }\n\n    const isChangeNegative = Number(change) < 0;\n\n    return (\n      <span className={buildClassName(styles.value, isChangeNegative && styles.negative)}>\n        {isChangeNegative\n          ? `-${formatIntegerCompact(lang, Math.abs(change))}`\n          : `+${formatIntegerCompact(lang, change)}`}\n        {percentage && (\n          <>\n            {' '}\n            ({percentage}%)\n          </>\n        )}\n      </span>\n    );\n  };\n\n  const renderBalanceCell = (balance: number, usdRate: number, text: string) => {\n    const [integerTonPart, decimalTonPart] = balance.toFixed(4).split('.');\n    const [integerUsdPart, decimalUsdPart] = (balance * usdRate).toFixed(2).split('.');\n    return (\n      <div>\n        <Icon className={styles.toncoin} name=\"toncoin\" />\n        <b className={styles.tableValue}>\n          {integerTonPart}<span className={styles.decimalPart}>.{decimalTonPart}</span>\n        </b>\n        {' '}\n        <span className={styles.tableHeading}>\n           ${integerUsdPart}<span className={styles.decimalUsdPart}>.{decimalUsdPart}</span>\n        </span>\n        <h3 className={styles.tableHeading}>{oldLang(text)}</h3>\n      </div>\n    );\n  };\n\n  const { period } = (statistics as ApiGroupStatistics);\n  const { balances, usdRate } = (statistics as ApiChannelMonetizationStatistics);\n\n  const schema = getSchemaByType(type);\n\n  return (\n    <div className={buildClassName(styles.root, className)}>\n      <div className={styles.header}>\n        {title && (\n          <div className={styles.title}>\n            {title}\n          </div>\n        )}\n\n        {period && (\n          <div className={styles.caption}>\n            {formatFullDate(oldLang, period.minDate * 1000)}  {formatFullDate(oldLang, period.maxDate * 1000)}\n          </div>\n        )}\n      </div>\n\n      <table className={styles.table}>\n        {isToncoin ? (\n          <tr>\n            <td className={styles.tableCell}>\n              {renderBalanceCell(balances?.availableBalance || 0, usdRate || 0, 'lng_channel_earn_available')}\n              {renderBalanceCell(balances?.currentBalance || 0, usdRate || 0, 'lng_channel_earn_reward')}\n              {renderBalanceCell(balances?.overallRevenue || 0, usdRate || 0, 'lng_channel_earn_total')}\n            </td>\n          </tr>\n        ) : schema.map((row) => (\n          <tr>\n            {row.map((cell: OverviewCell) => {\n              const field = (statistics as any)[cell.name];\n\n              if (cell.isPlain) {\n                return (\n                  <td className={styles.tableCell}>\n                    <b className={styles.tableValue}>\n                      {`${cell.isApproximate ? '' : ''}${formatInteger(field)}`}\n                    </b>\n                    <h3 className={styles.tableHeading}>{oldLang(cell.title)}</h3>\n                  </td>\n                );\n              }\n\n              if (cell.isPercentage) {\n                return (\n                  <td className={styles.tableCell}>\n                    {cell.withAbsoluteValue && (\n                      <span className={styles.tableValue}>\n                        {`${cell.isApproximate ? '' : ''}${formatInteger(field.part)}`}\n                      </span>\n                    )}\n                    <span className={cell.withAbsoluteValue ? styles.tableSecondaryValue : styles.tableValue}>\n                      {field.percentage}%\n                    </span>\n                    <h3 className={styles.tableHeading}>{oldLang(cell.title)}</h3>\n                  </td>\n                );\n              }\n\n              return (\n                <td className={styles.tableCell}>\n                  <b className={styles.tableValue}>\n                    {formatIntegerCompact(lang, field.current)}\n                  </b>\n                  {' '}\n                  {renderOverviewItemValue(field)}\n                  <h3 className={styles.tableHeading}>{oldLang(cell.title)}</h3>\n                </td>\n              );\n            })}\n          </tr>\n        ))}\n      </table>\n\n      {subtitle}\n    </div>\n  );\n};\n\nfunction getSchemaByType(type: StatisticsType) {\n  switch (type) {\n    case 'group':\n      return GROUP_OVERVIEW;\n    case 'message':\n      return MESSAGE_OVERVIEW;\n    case 'boost':\n      return BOOST_OVERVIEW;\n    case 'story':\n      return STORY_OVERVIEW;\n    case 'channel':\n    default:\n      return CHANNEL_OVERVIEW;\n  }\n}\n\nexport default memo(StatisticsOverview);\n","import { useMemo } from '../lib/teact/teact';\nimport { getActions } from '../global';\n\nimport type { ApiSendMessageAction } from '../api/types';\nimport type { ThreadId } from '../types';\n\nimport { SEND_MESSAGE_ACTION_INTERVAL } from '../config';\nimport { throttle } from '../util/schedulers';\n\nconst useSendMessageAction = (chatId?: string, threadId?: ThreadId) => {\n  return useMemo(() => {\n    return throttle((action: ApiSendMessageAction) => {\n      if (!chatId || !threadId) return;\n      getActions().sendMessageAction({ chatId, threadId, action });\n    }, SEND_MESSAGE_ACTION_INTERVAL);\n  }, [chatId, threadId]);\n};\n\nexport default useSendMessageAction;\n","/* eslint-disable react/no-array-index-key */\nimport React from 'react';\n\nimport type { GrammarlyCheckItem } from '../../../utils/grammarly';\n\ntype Props = {\n  text: string;\n  errors: GrammarlyCheckItem[];\n};\n\nconst HighlightedText: React.FC<Props> = ({ text, errors }) => {\n  if (!errors.length) return <p><span>{text}</span></p>;\n\n  // \n  const fragments: React.ReactNode[] = [];\n  let lastIndex = 0;\n\n  errors.sort((a, b) => a.offset - b.offset).forEach((error, index) => {\n    const {\n      offset, length, suggestions,\n    } = error;\n\n    // \n    if (offset > lastIndex) {\n      fragments.push(<span key={`normal-${index}`}>{text.slice(lastIndex, offset)}</span>);\n    }\n\n    //  + \n    const original = text.slice(offset, offset + length);\n    const suggestion = suggestions[0] || '';\n\n    fragments.push(\n      <span\n        key={`error-${index}`}\n        className=\"bg-black/15 line-through mr-[4px]\"\n      >\n        {original}\n      </span>,\n    );\n\n    fragments.push(\n      <span\n        key={`suggestion-${index}`}\n        className=\"bg-[#8C42F033] mr-[4px] text-[#8C42F0]\"\n      >\n        {suggestion}\n      </span>,\n    );\n\n    lastIndex = offset + length;\n  });\n\n  // \n  if (lastIndex < text.length) {\n    fragments.push(<span key=\"end\">{text.slice(lastIndex)}</span>);\n  }\n\n  return <p>{fragments}</p>;\n};\n\nexport default HighlightedText;\n","// extracted by mini-css-extract-plugin\nexport default {\"anchor\":\"IYu2f7FM\",\"mirrorAnchor\":\"GsTZawTE\",\"root\":\"McmbiWZE\",\"mirror\":\"wNvU2uqi\"};","import React, { memo, useEffect, useRef } from '../../../lib/teact/teact';\n\nimport type { ApiAvailableEffect } from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\n\nimport useFlag from '../../../hooks/useFlag';\nimport { type ObserveFn, useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useOverlayPosition from './hooks/useOverlayPosition';\n\nimport AnimatedSticker from '../../common/AnimatedSticker';\nimport Portal from '../../ui/Portal';\n\nimport styles from './MessageEffect.module.scss';\n\ntype OwnProps = {\n  messageId?: number;\n  isMirrored?: boolean;\n  effect: ApiAvailableEffect;\n  shouldPlay?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  onStop?: VoidFunction;\n};\n\nconst EFFECT_SIZE = 256;\n\nconst MessageEffect = ({\n  messageId,\n  isMirrored,\n  effect,\n  shouldPlay,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  onStop,\n}: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  const anchorRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const canLoad = useIsIntersecting(anchorRef, observeIntersectionForLoading);\n  const canPlay = useIsIntersecting(anchorRef, observeIntersectionForPlaying);\n\n  const [isPlaying, startPlaying, stopPlaying] = useFlag();\n  const [isPositionUpdateRequired, requirePositionUpdate, resetPositionUpdate] = useFlag();\n\n  const effectHash = getEffectHash(effect);\n  const effectBlob = useMedia(effectHash, !canLoad);\n\n  const handleEnded = useLastCallback(() => {\n    stopPlaying();\n    onStop?.();\n  });\n\n  const updatePosition = useOverlayPosition({\n    anchorRef,\n    overlayRef: ref,\n    isMirrored,\n    isDisabled: !isPlaying,\n    isForMessageEffect: true,\n    id: effect.id,\n  });\n\n  useEffect(() => {\n    if (isPositionUpdateRequired) updatePosition();\n    resetPositionUpdate();\n  }, [updatePosition, resetPositionUpdate, isPositionUpdateRequired]);\n\n  useEffect(() => {\n    if (canPlay && shouldPlay && effectBlob) {\n      startPlaying();\n      requirePositionUpdate();\n    }\n  }, [canPlay, effectBlob, shouldPlay, updatePosition]);\n\n  const effectClassName = buildClassName(\n    styles.root,\n    isMirrored && styles.mirror,\n  );\n\n  return (\n    <div className={buildClassName(styles.anchor, isMirrored && styles.mirrorAnchor)} ref={anchorRef}>\n      {isPlaying && (\n        <Portal>\n          <AnimatedSticker\n            ref={ref}\n            key={`effect-${messageId ?? effect.id}`}\n            className={effectClassName}\n            tgsUrl={effectBlob}\n            size={EFFECT_SIZE}\n            play\n            isLowPriority\n            noLoop\n            forceAlways\n            onEnded={handleEnded}\n          />\n        </Portal>\n      )}\n    </div>\n  );\n};\n\nfunction getEffectHash(effect: ApiAvailableEffect) {\n  if (effect.effectAnimationId) {\n    return `sticker${effect.effectAnimationId}`;\n  }\n\n  return `sticker${effect.effectStickerId}?size=f`;\n}\n\nexport default memo(MessageEffect);\n","import React, { memo, useRef } from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiPeer } from '../../api/types';\nimport { StoryViewerOrigin } from '../../types';\n\nimport { isUserId } from '../../global/helpers';\nimport { getPeerTitle } from '../../global/helpers/peers';\nimport buildClassName from '../../util/buildClassName';\nimport { preventMessageInputBlurWithBubbling } from '../middle/helpers/preventMessageInputBlur';\n\nimport useContextMenuHandlers from '../../hooks/useContextMenuHandlers';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\nimport useStoryPreloader from './hooks/useStoryPreloader';\n\nimport Avatar from '../common/Avatar';\nimport Menu from '../ui/Menu';\nimport MenuItem from '../ui/MenuItem';\n\nimport styles from './StoryRibbon.module.scss';\n\ninterface OwnProps {\n  peer: ApiPeer;\n  isArchived?: boolean;\n}\n\nfunction StoryRibbonButton({ peer, isArchived }: OwnProps) {\n  const {\n    openChat,\n    openChatWithInfo,\n    openStoryViewer,\n    toggleStoriesHidden,\n  } = getActions();\n\n  const lang = useOldLang();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const isSelf = 'isSelf' in peer && peer.isSelf;\n  const isChannel = !isUserId(peer.id);\n\n  useStoryPreloader(peer.id);\n\n  const {\n    isContextMenuOpen, contextMenuAnchor,\n    handleBeforeContextMenu, handleContextMenu,\n    handleContextMenuClose, handleContextMenuHide,\n  } = useContextMenuHandlers(ref);\n\n  const getTriggerElement = useLastCallback(() => ref.current);\n  const getRootElement = useLastCallback(() => document.body);\n  const getMenuElement = useLastCallback(() => ref.current!.querySelector('.story-peer-context-menu .bubble'));\n  const getLayout = useLastCallback(() => ({ withPortal: true, isDense: true }));\n\n  const handleClick = useLastCallback(() => {\n    if (isContextMenuOpen) return;\n\n    openStoryViewer({ peerId: peer.id, origin: StoryViewerOrigin.StoryRibbon });\n  });\n\n  const handleMouseDown = useLastCallback((e: React.MouseEvent<HTMLElement>) => {\n    preventMessageInputBlurWithBubbling(e);\n    handleBeforeContextMenu(e);\n  });\n\n  const handleSavedStories = useLastCallback(() => {\n    openChatWithInfo({ id: peer.id, shouldReplaceHistory: true, profileTab: 'stories' });\n  });\n\n  const handleArchivedStories = useLastCallback(() => {\n    openChatWithInfo({ id: peer.id, shouldReplaceHistory: true, profileTab: 'storiesArchive' });\n  });\n\n  const handleOpenChat = useLastCallback(() => {\n    openChat({ id: peer.id, shouldReplaceHistory: true });\n  });\n\n  const handleOpenProfile = useLastCallback(() => {\n    openChatWithInfo({ id: peer.id, shouldReplaceHistory: true });\n  });\n\n  const handleArchivePeer = useLastCallback(() => {\n    toggleStoriesHidden({ peerId: peer.id, isHidden: !isArchived });\n  });\n\n  return (\n    <div\n      ref={ref}\n      role=\"button\"\n      data-peer-id={peer.id}\n      tabIndex={0}\n      className={styles.peer}\n      onMouseDown={handleMouseDown}\n      onClick={handleClick}\n      onContextMenu={handleContextMenu}\n    >\n      <Avatar\n        peer={peer}\n        withStory\n        storyViewerOrigin={StoryViewerOrigin.StoryRibbon}\n        storyViewerMode=\"full\"\n      />\n      <div className={buildClassName(styles.name, peer.hasUnreadStories && styles.name_hasUnreadStory)}>\n        {isSelf ? lang('MyStory') : getPeerTitle(lang, peer)}\n      </div>\n      {contextMenuAnchor !== undefined && (\n        <Menu\n          isOpen={isContextMenuOpen}\n          anchor={contextMenuAnchor}\n          getTriggerElement={getTriggerElement}\n          getRootElement={getRootElement}\n          getMenuElement={getMenuElement}\n          getLayout={getLayout}\n          className={buildClassName('story-peer-context-menu', styles.contextMenu)}\n          autoClose\n          withPortal\n          onClose={handleContextMenuClose}\n          onCloseAnimationEnd={handleContextMenuHide}\n        >\n          {isSelf ? (\n            <>\n              <MenuItem onClick={handleSavedStories} icon=\"play-story\">\n                {lang('StoryList.Context.SavedStories')}\n              </MenuItem>\n              <MenuItem onClick={handleArchivedStories} icon=\"archive\">\n                {lang('StoryList.Context.ArchivedStories')}\n              </MenuItem>\n            </>\n          ) : (\n            <>\n              {!isChannel && (\n                <MenuItem onClick={handleOpenChat} icon=\"message\">\n                  {lang('SendMessageTitle')}\n                </MenuItem>\n              )}\n              {isChannel ? (\n                <MenuItem onClick={handleOpenProfile} icon=\"channel\">\n                  {lang('ChatList.ContextOpenChannel')}\n                </MenuItem>\n              ) : (\n                <MenuItem onClick={handleOpenProfile} icon=\"user\">\n                  {lang('StoryList.Context.ViewProfile')}\n                </MenuItem>\n              )}\n              <MenuItem\n                onClick={handleArchivePeer}\n                icon={isArchived ? 'unarchive' : 'archive'}\n              >\n                {lang(isArchived ? 'StoryList.Context.Unarchive' : 'StoryList.Context.Archive')}\n              </MenuItem>\n            </>\n          )}\n        </Menu>\n      )}\n    </div>\n  );\n}\n\nexport default memo(StoryRibbonButton);\n","import React, { memo, useRef } from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type { ApiChat, ApiUser } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport { getIsMobile } from '../../hooks/useAppLayout';\nimport useHorizontalScroll from '../../hooks/useHorizontalScroll';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport StoryRibbonButton from './StoryRibbonButton';\n\nimport styles from './StoryRibbon.module.scss';\n\ninterface OwnProps {\n  isArchived?: boolean;\n  className?: string;\n  isClosing?: boolean;\n}\n\ninterface StateProps {\n  orderedPeerIds: string[];\n  usersById: Record<string, ApiUser>;\n  chatsById: Record<string, ApiChat>;\n}\n\nfunction StoryRibbon({\n  isArchived,\n  className,\n  orderedPeerIds,\n  usersById,\n  chatsById,\n  isClosing,\n}: OwnProps & StateProps) {\n  const lang = useOldLang();\n  const fullClassName = buildClassName(\n    styles.root,\n    !orderedPeerIds.length && styles.hidden,\n    isClosing && styles.closing,\n    className,\n    'no-scrollbar',\n  );\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  useHorizontalScroll(ref, getIsMobile());\n\n  return (\n    <div\n      ref={ref}\n      id=\"StoryRibbon\"\n      className={fullClassName}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {orderedPeerIds.map((peerId) => {\n        const peer = usersById[peerId] || chatsById[peerId];\n\n        if (!peer) {\n          return undefined;\n        }\n\n        return (\n          <StoryRibbonButton\n            key={peerId}\n            peer={peer}\n            isArchived={isArchived}\n          />\n        );\n      })}\n    </div>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { isArchived }): StateProps => {\n    const { orderedPeerIds: { active, archived } } = global.stories;\n    const usersById = global.users.byId;\n    const chatsById = global.chats.byId;\n\n    return {\n      orderedPeerIds: isArchived ? archived : active,\n      usersById,\n      chatsById,\n    };\n  },\n)(StoryRibbon));\n","import React from 'react';\nimport { getGlobal } from '../../../global';\n\nimport { isUserId } from '../../../global/helpers';\nimport { selectChat, selectUser } from '../../../global/selectors';\nimport { cn } from '../utils/util';\n\nimport Avatar from './Avatar';\n\nconst ChatAvatar = ({\n  chatId, classNames, size, style,\n}: { chatId: string; classNames?: string; size:number;style?: { [key:string]:string } }) => {\n  const global = getGlobal();\n  let peer;\n  if (isUserId(chatId)) {\n    peer = selectUser(global, chatId);\n  } else {\n    peer = selectChat(global, chatId);\n  }\n\n  return (\n    <Avatar\n      style={style}\n      key={chatId}\n      className={cn(classNames, 'overlay-avatar inline-block cursor-pointer')}\n      size={size}\n      peer={peer}\n    />\n  );\n};\n\nexport default ChatAvatar;\n","import type { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\n\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport useAppLayout from './useAppLayout';\n\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 500;\nconst MODAL_HIDE_DELAY_MS = 300;\n\nexport default function useInputFocusOnOpen(\n  inputRef: RefObject<HTMLInputElement | HTMLTextAreaElement>,\n  isOpen?: boolean,\n  onClose?: NoneToVoidFunction,\n) {\n  const { isMobile } = useAppLayout();\n\n  useEffect(() => {\n    if (isOpen) {\n      if (!isMobile) {\n        setTimeout(() => {\n          requestMutation(() => {\n            if (inputRef.current?.isConnected) {\n              inputRef.current.focus();\n            }\n          });\n        }, FOCUS_DELAY_MS);\n      }\n    } else {\n      if (inputRef.current?.isConnected) {\n        inputRef.current.blur();\n      }\n\n      if (onClose) {\n        setTimeout(onClose, MODAL_HIDE_DELAY_MS);\n      }\n    }\n  }, [inputRef, isMobile, isOpen, onClose]);\n}\n","import type { RefObject } from '../../lib/teact/teact';\nimport { useEffect } from '../../lib/teact/teact';\n\nimport { requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { throttle } from '../../util/schedulers';\n\nconst THROTTLE_DELAY = 100;\n\nconst useMarkScrolled = ({\n  containerRef, selector,\n}: {\n  containerRef: RefObject<HTMLDivElement | null>;\n  selector: string;\n}, deps: unknown[]) => {\n  useEffect(() => {\n    const elements = containerRef?.current?.querySelectorAll(selector);\n    if (!elements?.length) return undefined;\n\n    const handleScroll = throttle((event: Event) => {\n      const target = event.target as HTMLElement;\n      const isScrolled = target.scrollTop > 0;\n      requestMutation(() => {\n        target.classList.toggle('scrolled', isScrolled);\n      });\n    }, THROTTLE_DELAY);\n\n    elements.forEach((el) => el.addEventListener('scroll', handleScroll, { passive: true }));\n    // Trigger the scroll handler immediately to apply the current state\n    elements.forEach((el) => el.dispatchEvent(new Event('scroll', { bubbles: false })));\n\n    return () => {\n      elements.forEach((el) => el.removeEventListener('scroll', handleScroll));\n    };\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, [containerRef, selector, ...deps]);\n};\n\nexport default useMarkScrolled;\n","import { useMemo } from '../../../../lib/teact/teact';\n\nexport enum ChatAnimationTypes {\n  Move,\n  Opacity,\n  None,\n}\n\nexport function useChatAnimationType<T extends number | string>(orderDiffById: Record<T, number>) {\n  return useMemo(() => {\n    const orderDiffs = Object.values(orderDiffById) as number[];\n    const numberOfUp = orderDiffs.filter((diff) => diff < 0).length;\n    const numberOfDown = orderDiffs.filter((diff) => diff > 0).length;\n\n    return (chatId: T): ChatAnimationTypes => {\n      const orderDiff = orderDiffById[chatId];\n      if (orderDiff === 0) {\n        return ChatAnimationTypes.None;\n      }\n\n      if (\n        orderDiff === Infinity\n        || orderDiff === -Infinity\n        || (numberOfUp <= numberOfDown && orderDiff < 0)\n        || (numberOfDown < numberOfUp && orderDiff > 0)\n      ) {\n        return ChatAnimationTypes.Opacity;\n      }\n\n      return ChatAnimationTypes.Move;\n    };\n  }, [orderDiffById]);\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type { ApiTypingStatus, ApiUser } from '../../api/types';\n\nimport { getUserFirstOrLastName } from '../../global/helpers';\nimport { selectUser } from '../../global/selectors';\nimport renderText from './helpers/renderText';\n\nimport useOldLang from '../../hooks/useOldLang';\n\nimport DotAnimation from './DotAnimation';\n\nimport './TypingStatus.scss';\n\ntype OwnProps = {\n  typingStatus: ApiTypingStatus;\n};\n\ntype StateProps = {\n  typingUser?: ApiUser;\n};\n\nconst TypingStatus: FC<OwnProps & StateProps> = ({ typingStatus, typingUser }) => {\n  const lang = useOldLang();\n  const typingUserName = typingUser && !typingUser.isSelf && getUserFirstOrLastName(typingUser);\n  const content = lang(typingStatus.action)\n    // Fix for translation \"{user} is typing\"\n    .replace('{user}', '')\n    .replace('{emoji}', typingStatus.emoji || '').trim();\n\n  return (\n    <p className=\"typing-status\" dir={lang.isRtl ? 'rtl' : 'auto'}>\n      {typingUserName && (\n        <span className=\"sender-name\" dir=\"auto\">{renderText(typingUserName)}</span>\n      )}\n      <DotAnimation content={content} />\n    </p>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { typingStatus }): StateProps => {\n    if (!typingStatus.userId) {\n      return {};\n    }\n\n    const typingUser = selectUser(global, typingStatus.userId);\n\n    return { typingUser };\n  },\n)(TypingStatus));\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport renderText from './helpers/renderText';\n\nimport useOldLang from '../../hooks/useOldLang';\n\nimport './DotAnimation.scss';\n\ntype OwnProps = {\n  content: string;\n  className?: string;\n};\n\nconst DotAnimation: FC<OwnProps> = ({ content, className }) => {\n  const lang = useOldLang();\n  return (\n    <span className={buildClassName('DotAnimation', className)} dir={lang.isRtl ? 'rtl' : 'auto'}>\n      {renderText(content)}\n      <span className=\"ellipsis\" />\n    </span>\n  );\n};\n\nexport default DotAnimation;\n","import type { FC, MouseEvent as ReactMouseEvent, ReactNode } from 'react';\nimport React, { memo, useMemo, useRef } from 'react';\nimport { Tooltip } from 'antd';\nimport { getActions } from '../../../global';\n\nimport type {\n  ApiPeer, ApiPhoto, ApiWebDocument,\n} from '../../../api/types';\nimport type { CustomPeer } from '../../../types';\nimport { ApiMediaFormat } from '../../../api/types';\n\nimport { IS_TEST } from '../../../config';\nimport {\n  getChatAvatarHash,\n  getChatTitle,\n  getUserFullName,\n  // getVideoProfilePhotoMediaHash,\n  getWebDocumentHash,\n  isAnonymousForwardsChat,\n  isChatWithRepliesBot,\n  isDeletedUser,\n  isUserId,\n} from '../../../global/helpers';\nimport { isApiPeerChat, isApiPeerUser } from '../../../global/helpers/peers';\nimport buildClassName, { createClassNameBuilder } from '../../../util/buildClassName';\nimport { getFirstLetters } from '../../../util/textFormat';\nimport { REM } from '../../common/helpers/mediaDimensions';\nimport { getPeerColorClass } from '../../common/helpers/peerColor';\nimport { useFastClick } from '../hook/useFastClick';\nimport useMedia from '../hook/useMedia';\nimport useOldLang from '../hook/useOldLang';\n\nimport Icon from './Icon';\n\nimport '../../common/Avatar.scss';\n\n// const LOOP_COUNT = 3;\n\nexport const AVATAR_SIZES = {\n  micro: REM,\n  mini: 1.5 * REM,\n  tiny: 2 * REM,\n  small: 2.125 * REM,\n  medium: 2.75 * REM,\n  large: 3.375 * REM,\n  giant: 5.625 * REM,\n  jumbo: 7.5 * REM,\n};\n\nexport type AvatarSize =\n  'micro' | 'mini' | 'tiny' | 'small' | 'medium' | 'large' | 'giant' | 'jumbo' | number;\n\nconst cn = createClassNameBuilder('Avatar');\ncn.media = cn('media');\ncn.icon = cn('icon');\n\ntype OwnProps = {\n  className?: string;\n  style?: { [key:string]:string };\n  size?: AvatarSize;\n  peer?: ApiPeer | CustomPeer;\n  photo?: ApiPhoto;\n  webPhoto?: ApiWebDocument;\n  text?: string;\n  isSavedMessages?: boolean;\n  isSavedDialog?: boolean;\n  // withVideo?: boolean;\n  // loopIndefinitely?: boolean;\n  noPersonalPhoto?: boolean;\n  clickOpenRoom?: boolean;\n  onClick?: (e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasMedia: boolean) => void;\n};\n\nfunction buildStyle(...styles: Array<{ [key: string]: string }>): { [key: string]: string } {\n  return styles.reduce((acc, style) => ({ ...acc, ...style }), {});\n}\n\nconst Avatar: FC<OwnProps> = ({\n  className,\n  style,\n  size = 'large',\n  peer,\n  photo,\n  webPhoto,\n  text,\n  isSavedMessages,\n  isSavedDialog,\n  // withVideo,\n  // loopIndefinitely,\n  noPersonalPhoto,\n  clickOpenRoom = true,\n  onClick,\n}) => {\n  const { openChat } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  // const videoLoopCountRef = useRef(0);\n  const isCustomPeer = peer && 'isCustomPeer' in peer;\n  const realPeer = peer && !isCustomPeer ? peer : undefined;\n  const user = realPeer && isApiPeerUser(realPeer) ? realPeer : undefined;\n  const chat = realPeer && isApiPeerChat(realPeer) ? realPeer : undefined;\n  const isDeleted = user && isDeletedUser(user);\n  const isReplies = realPeer && isChatWithRepliesBot(realPeer.id);\n  const isAnonymousForwards = realPeer && isAnonymousForwardsChat(realPeer.id);\n  let imageHash: string | undefined;\n  // let videoHash: string | undefined;\n\n  const pxSize = typeof size === 'number' ? size : AVATAR_SIZES[size];\n\n  // const shouldLoadVideo = withVideo && photo?.isVideo;\n\n  const isBig = pxSize >= AVATAR_SIZES.jumbo;\n  if (!isSavedMessages && !isDeleted) {\n    if ((user && !noPersonalPhoto) || chat) {\n      imageHash = getChatAvatarHash(peer as ApiPeer, isBig ? 'big' : undefined);\n    } else if (photo) {\n      imageHash = `photo${photo.id}?size=m`;\n      // if (photo.isVideo && withVideo) {\n      //   videoHash = getVideoProfilePhotoMediaHash(photo);\n      // }\n    } else if (webPhoto) {\n      imageHash = getWebDocumentHash(webPhoto);\n    }\n  }\n\n  const specialIcon = useMemo(() => {\n    if (isCustomPeer) {\n      return peer.avatarIcon;\n    }\n\n    if (isSavedMessages) {\n      return isSavedDialog ? 'my-notes' : 'avatar-saved-messages';\n    }\n\n    if (isDeleted) {\n      return 'avatar-deleted-account';\n    }\n\n    if (isReplies) {\n      return 'reply-filled';\n    }\n\n    if (isAnonymousForwards) {\n      return 'author-hidden';\n    }\n\n    return undefined;\n  }, [isCustomPeer, isSavedMessages, isDeleted, isReplies, isAnonymousForwards, peer, isSavedDialog]);\n\n  const imgBlobUrl = useMedia(imageHash, false, ApiMediaFormat.BlobUrl);\n  // const videoBlobUrl = useMedia(videoHash, !shouldLoadVideo, ApiMediaFormat.BlobUrl);\n  const hasBlobUrl = Boolean(imgBlobUrl);\n  // `videoBlobUrl` can be taken from memory cache, so we need to check `shouldLoadVideo` again\n  // const shouldPlayVideo = Boolean(videoBlobUrl && shouldLoadVideo);\n\n  // const transitionClassNames = useMediaTransitionDeprecated(hasBlobUrl);\n\n  // const handleVideoEnded = useLastCallback((e) => {\n  //   const video = e.currentTarget;\n  //   if (!videoBlobUrl) return;\n\n  //   if (loopIndefinitely) return;\n\n  //   videoLoopCountRef.current += 1;\n  //   if (videoLoopCountRef.current >= LOOP_COUNT) {\n  //     video.style.display = 'none';\n  //   }\n  // });\n\n  const lang = useOldLang();\n\n  let content: ReactNode | undefined;\n  const author = user ? getUserFullName(user) : (chat ? getChatTitle(lang, chat) : text);\n\n  if (specialIcon) {\n    content = (\n      <Icon\n        name={specialIcon}\n        className={cn.icon}\n        role=\"img\"\n        ariaLabel={author}\n      />\n    );\n  } else if (hasBlobUrl) {\n    content = (\n      <>\n        <img\n          src={imgBlobUrl}\n          className={buildClassName(cn.media, 'avatar-media')}\n          alt={author}\n          decoding=\"async\"\n          draggable={false}\n        />\n        {/* {shouldPlayVideo && (\n          <OptimizedVideo\n            canPlay\n            src={videoBlobUrl}\n            className={buildClassName(cn.media, 'avatar-media', 'poster')}\n            muted\n            loop={loopIndefinitely}\n            autoPlay\n            disablePictureInPicture\n            playsInline\n            draggable={false}\n            onEnded={handleVideoEnded}\n          />\n        )} */}\n      </>\n    );\n  } else if (user) {\n    const userFullName = getUserFullName(user);\n    content = userFullName ? getFirstLetters(userFullName, 2) : undefined;\n  } else if (chat) {\n    const title = getChatTitle(lang, chat);\n    content = title && getFirstLetters(title, isUserId(chat.id) ? 2 : 1);\n  } else if (isCustomPeer) {\n    const title = peer.title || lang(peer.titleKey!);\n    content = title && getFirstLetters(title, 1);\n  } else if (text) {\n    content = getFirstLetters(text, 2);\n  }\n\n  const isPremiumGradient = isCustomPeer && peer.withPremiumGradient;\n  const customColor = isCustomPeer && peer.customPeerAvatarColor;\n\n  const hoverTitle = useMemo(() => {\n    if (user) {\n      return getUserFullName(user);\n    } else if (chat) {\n      return getChatTitle(lang, chat);\n    } else if (isCustomPeer) {\n      return peer.title || lang(peer.titleKey!);\n    }\n    return '';\n  }, [chat, isCustomPeer, lang, peer, user]);\n\n  const fullClassName = buildClassName(\n    'Avatar',\n    className,\n    getPeerColorClass(peer),\n    !peer && text && 'hidden-user',\n    isSavedMessages && 'saved-messages',\n    isAnonymousForwards && 'anonymous-forwards',\n    isDeleted && 'deleted-account',\n    isReplies && 'replies-bot-account',\n    isPremiumGradient && 'premium-gradient-bg',\n    (photo || webPhoto) && 'force-fit',\n    onClick && 'interactive',\n    (!isSavedMessages && !imgBlobUrl) && 'no-photo',\n  );\n\n  const hasMedia = Boolean(isSavedMessages || imgBlobUrl);\n\n  const { handleClick, handleMouseDown } = useFastClick((e: ReactMouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (clickOpenRoom && realPeer?.id) {\n      openChat({ id: realPeer.id });\n    }\n    if (onClick) {\n      onClick(e, hasMedia);\n    }\n  });\n\n  const customStyle = buildStyle(\n    pxSize ? { '--_size': `${pxSize}px` } : {},\n    customColor ? { '--color-user': customColor } : {},\n    style || {},\n  );\n\n  return (\n    <Tooltip placement=\"top\" title={hoverTitle}>\n      <div\n        ref={ref}\n        className={fullClassName}\n        id={realPeer?.id}\n        data-peer-id={realPeer?.id}\n        data-test-sender-id={IS_TEST ? realPeer?.id : undefined}\n        aria-label={typeof content === 'string' ? author : undefined}\n        style={customStyle as unknown as React.CSSProperties}\n        onClick={handleClick}\n        onMouseDown={handleMouseDown}\n      >\n        <div className=\"inner\">\n          {content}\n        </div>\n      </div>\n    </Tooltip>\n  );\n};\n\nexport default memo(Avatar);\n","import type React from 'react';\nimport { useCallback } from 'react';\n\nimport { IS_TOUCH_ENV, MouseButton } from '../../../util/browser/windowEnvironment';\n\ntype EventArg<E> = React.MouseEvent<E>;\ntype EventHandler<E> = (e: EventArg<E>) => void;\n\nexport function useFastClick<T extends HTMLDivElement | HTMLButtonElement>(callback?: EventHandler<T>) {\n  const handler = useCallback((e: EventArg<T>) => {\n    if (e.type === 'mousedown' && e.button !== MouseButton.Main) {\n      return;\n    }\n\n    callback!(e);\n  }, [callback]);\n\n  return IS_TOUCH_ENV\n    ? { handleClick: callback ? handler : undefined }\n    : { handleMouseDown: callback ? handler : undefined };\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useRef } from '../../lib/teact/teact';\n\nimport type { ApiMessage } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport {\n  getMessageHtmlId,\n  getMessageIsSpoiler,\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  getMessageVideo,\n} from '../../global/helpers';\nimport buildClassName from '../../util/buildClassName';\nimport { formatMediaDuration } from '../../util/dates/dateFormat';\nimport stopEvent from '../../util/stopEvent';\n\nimport useFlag from '../../hooks/useFlag';\nimport { useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaTransitionDeprecated from '../../hooks/useMediaTransitionDeprecated';\n\nimport MediaSpoiler from './MediaSpoiler';\n\nimport './Media.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  idPrefix?: string;\n  isProtected?: boolean;\n  observeIntersection?: ObserveFn;\n  onClick?: (messageId: number, chatId: string) => void;\n};\n\nconst Media: FC<OwnProps> = ({\n  message,\n  idPrefix = 'shared-media',\n  isProtected,\n  observeIntersection,\n  onClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n  const thumbDataUri = getMessageMediaThumbDataUri(message);\n  const mediaBlobUrl = useMedia(getMessageMediaHash(message, 'pictogram'), !isIntersecting);\n  const transitionClassNames = useMediaTransitionDeprecated(mediaBlobUrl);\n\n  const video = getMessageVideo(message);\n\n  const hasSpoiler = getMessageIsSpoiler(message);\n  const [isSpoilerShown, , hideSpoiler] = useFlag(hasSpoiler);\n\n  const handleClick = useLastCallback(() => {\n    hideSpoiler();\n    onClick!(message.id, message.chatId);\n  });\n\n  return (\n    <div\n      ref={ref}\n      id={`${idPrefix}${getMessageHtmlId(message.id)}`}\n      className=\"Media scroll-item\"\n      onClick={onClick ? handleClick : undefined}\n    >\n      <img\n        src={thumbDataUri}\n        className=\"media-miniature\"\n        alt=\"\"\n        draggable={!isProtected}\n        decoding=\"async\"\n        onContextMenu={isProtected ? stopEvent : undefined}\n      />\n      <img\n        src={mediaBlobUrl}\n        className={buildClassName('full-media', 'media-miniature', transitionClassNames)}\n        alt=\"\"\n        draggable={!isProtected}\n        decoding=\"async\"\n        onContextMenu={isProtected ? stopEvent : undefined}\n      />\n      {hasSpoiler && (\n        <MediaSpoiler\n          thumbDataUri={mediaBlobUrl || thumbDataUri}\n          isVisible={isSpoilerShown}\n          className=\"media-spoiler\"\n        />\n      )}\n      {video && <span className=\"video-duration\">{video.isGif ? 'GIF' : formatMediaDuration(video.duration)}</span>}\n      {isProtected && <span className=\"protector\" />}\n    </div>\n  );\n};\n\nexport default memo(Media);\n","import React, { memo } from '../../lib/teact/teact';\n\nimport type { ApiMessage, ApiMessageOutgoingStatus } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\nimport { formatPastTimeShort } from '../../util/dates/dateFormat';\n\nimport useOldLang from '../../hooks/useOldLang';\n\nimport MessageOutgoingStatus from './MessageOutgoingStatus';\n\nimport './LastMessageMeta.scss';\n\ntype OwnProps = {\n  className?: string;\n  message: ApiMessage;\n  outgoingStatus?: ApiMessageOutgoingStatus;\n  draftDate?: number;\n};\n\nconst LastMessageMeta = ({\n  className, message, outgoingStatus, draftDate,\n}: OwnProps) => {\n  const lang = useOldLang();\n\n  const shouldUseDraft = draftDate && draftDate > message.date;\n  return (\n    <div className={buildClassName('LastMessageMeta', className)}>\n      {outgoingStatus && !shouldUseDraft && (\n        <MessageOutgoingStatus status={outgoingStatus} />\n      )}\n      <span className=\"time\">\n        {formatPastTimeShort(lang, (shouldUseDraft ? draftDate : message.date) * 1000)}\n      </span>\n    </div>\n  );\n};\n\nexport default memo(LastMessageMeta);\n","import type { FC } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { OwnProps } from './CustomSendMenu';\n\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst CustomSendMenuAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const CustomSend = useModuleLoader(Bundles.Extra, 'CustomSendMenu', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return CustomSend ? <CustomSend {...props} /> : undefined;\n};\n\nexport default CustomSendMenuAsync;\n","import { useEffect, useState } from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport { IS_MOBILE } from '../../util/browser/windowEnvironment';\nimport useLastCallback from '../useLastCallback';\nimport useOldLang from '../useOldLang';\n\nconst NOTIFICATION_DURATION = 8000;\n\nexport default function useUnsupportedMedia(\n  ref: React.RefObject<HTMLVideoElement>, shouldDisableNotification?: boolean, isDisabled?: boolean,\n) {\n  const { showNotification } = getActions();\n  const lang = useOldLang();\n  const [isUnsupported, setIsUnsupported] = useState(false);\n\n  const handleUnsupported = useLastCallback(() => {\n    setIsUnsupported(true);\n    if (shouldDisableNotification) return;\n\n    showNotification({\n      message: IS_MOBILE ? lang('Video.Unsupported.Mobile') : lang('Video.Unsupported.Desktop'),\n      duration: NOTIFICATION_DURATION,\n    });\n  });\n\n  const onError = useLastCallback((event: Event) => {\n    const target = event.currentTarget as HTMLVideoElement;\n    const { error } = target;\n    if (!error) return;\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/MediaError/code\n    if (error.code === 3 || error.code === 4) {\n      handleUnsupported();\n    }\n  });\n\n  const onCanPlay = useLastCallback((event: Event) => {\n    const target = event.currentTarget as HTMLVideoElement;\n\n    if (!target.videoHeight || !target.videoWidth) {\n      handleUnsupported();\n    }\n  });\n\n  useEffect(() => {\n    if (isDisabled) return undefined;\n\n    const { current } = ref;\n    if (!current) {\n      return undefined;\n    }\n\n    current.addEventListener('error', onError);\n    current.addEventListener('canplay', onCanPlay);\n\n    return () => {\n      current.removeEventListener('error', onError);\n      current.removeEventListener('canplay', onCanPlay);\n    };\n  }, [isDisabled, ref]);\n\n  return isUnsupported;\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  useEffect, useLayoutEffect,\n  useRef, useSignal, useState,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiMessage } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport { ApiMediaFormat } from '../../../api/types';\n\nimport {\n  getMediaFormat,\n  getMessageMediaThumbDataUri,\n  getVideoMediaHash,\n  hasMessageTtl,\n} from '../../../global/helpers';\nimport { stopCurrentAudio } from '../../../util/audioPlayer';\nimport buildClassName from '../../../util/buildClassName';\nimport { formatMediaDuration } from '../../../util/dates/dateFormat';\nimport safePlay from '../../../util/safePlay';\nimport { ROUND_VIDEO_DIMENSIONS_PX } from '../../common/helpers/mediaDimensions';\n\nimport { useThrottledSignal } from '../../../hooks/useAsyncResolvers';\nimport useFlag from '../../../hooks/useFlag';\nimport { useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMediaTransition from '../../../hooks/useMediaTransition';\nimport useMediaWithLoadProgress from '../../../hooks/useMediaWithLoadProgress';\nimport usePreviousDeprecated from '../../../hooks/usePreviousDeprecated';\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport useBlurredMediaThumbRef from './hooks/useBlurredMediaThumbRef';\n\nimport Icon from '../../common/icons/Icon';\nimport MediaSpoiler from '../../common/MediaSpoiler';\nimport Button from '../../ui/Button';\nimport OptimizedVideo from '../../ui/OptimizedVideo';\nimport ProgressSpinner from '../../ui/ProgressSpinner';\n\nimport './RoundVideo.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  className?: string;\n  canAutoLoad?: boolean;\n  isDownloading?: boolean;\n  origin?: 'oneTimeModal';\n  observeIntersection?: ObserveFn;\n  onStop?: NoneToVoidFunction;\n  onReadMedia?: NoneToVoidFunction;\n  onHideTranscription?: (isHidden: boolean) => void;\n  isTranscriptionError?: boolean;\n  canTranscribe?: boolean;\n  isTranscribed?: boolean;\n  isTranscriptionHidden?: boolean;\n  isTranscribing?: boolean;\n};\n\nconst PROGRESS_CENTER = ROUND_VIDEO_DIMENSIONS_PX / 2;\nconst PROGRESS_MARGIN = 6;\nconst PROGRESS_CIRCUMFERENCE = (PROGRESS_CENTER - PROGRESS_MARGIN) * 2 * Math.PI;\nconst PROGRESS_THROTTLE = 16; // Min period needed for `playerEl.currentTime` to update\n\nlet stopPrevious: NoneToVoidFunction;\n\nconst RoundVideo: FC<OwnProps> = ({\n  message,\n  className,\n  canAutoLoad,\n  isDownloading,\n  origin,\n  observeIntersection,\n  onStop,\n  onReadMedia,\n  isTranscriptionError,\n  isTranscribed,\n  canTranscribe,\n  onHideTranscription,\n  isTranscriptionHidden,\n  isTranscribing,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const playerRef = useRef<HTMLVideoElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const circleRef = useRef<SVGCircleElement>(null);\n\n  const { cancelMediaDownload, openOneTimeMediaModal, transcribeAudio } = getActions();\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const video = message.content.video!;\n  const isMediaUnread = message.isMediaUnread;\n\n  const [isLoadAllowed, setIsLoadAllowed] = useState(canAutoLoad);\n  const shouldLoad = Boolean(isLoadAllowed && isIntersecting);\n  const { mediaData, loadProgress } = useMediaWithLoadProgress(\n    getVideoMediaHash(video, 'inline'),\n    !shouldLoad,\n    getMediaFormat(video, 'inline'),\n  );\n\n  const { loadProgress: downloadProgress } = useMediaWithLoadProgress(\n    getVideoMediaHash(video, 'download'),\n    !isDownloading,\n    ApiMediaFormat.BlobUrl,\n  );\n\n  const [isPlayerReady, markPlayerReady] = useFlag();\n  const hasTtl = hasMessageTtl(message);\n  const isInOneTimeModal = origin === 'oneTimeModal';\n  const shouldRenderSpoiler = hasTtl && !isInOneTimeModal;\n  const hasThumb = Boolean(getMessageMediaThumbDataUri(message));\n  const noThumb = !hasThumb || isPlayerReady || shouldRenderSpoiler;\n  const thumbRef = useBlurredMediaThumbRef(video, noThumb);\n  useMediaTransition(!noThumb, { ref: thumbRef });\n  const thumbDataUri = getMessageMediaThumbDataUri(message);\n  const isTransferring = (isLoadAllowed && !isPlayerReady) || isDownloading;\n  const wasLoadDisabled = usePreviousDeprecated(isLoadAllowed) === false;\n\n  const {\n    ref: spinnerRef,\n    shouldRender: shouldRenderSpinner,\n  } = useShowTransition({\n    isOpen: isTransferring,\n    noMountTransition: wasLoadDisabled,\n    withShouldRender: true,\n  });\n\n  const [isActivated, setIsActivated] = useState(false);\n\n  const [getProgress, setProgress] = useSignal(0);\n  const getThrottledProgress = useThrottledSignal(getProgress, PROGRESS_THROTTLE);\n\n  useEffect(() => {\n    if (!isActivated) {\n      return;\n    }\n\n    const playerEl = playerRef.current!;\n    setProgress(playerEl.currentTime / playerEl.duration);\n  }, [setProgress, isActivated, getThrottledProgress]);\n\n  useLayoutEffect(() => {\n    if (!isActivated || !circleRef.current) {\n      return;\n    }\n\n    const strokeDashOffset = PROGRESS_CIRCUMFERENCE - getThrottledProgress() * PROGRESS_CIRCUMFERENCE;\n    circleRef.current.setAttribute('stroke-dashoffset', strokeDashOffset.toString());\n  }, [isActivated, getThrottledProgress]);\n\n  const shouldPlay = Boolean(mediaData && isIntersecting);\n\n  const stopPlaying = useLastCallback(() => {\n    if (!playerRef.current) {\n      return;\n    }\n\n    setIsActivated(false);\n    setProgress(0);\n    safePlay(playerRef.current);\n  });\n\n  const capturePlaying = useLastCallback(() => {\n    stopPrevious?.();\n    stopPrevious = stopPlaying;\n  });\n\n  const togglePlaying = useLastCallback(() => {\n    const playerEl = playerRef.current!;\n    if (isActivated) {\n      if (playerEl.paused) {\n        safePlay(playerEl);\n        stopCurrentAudio();\n      } else {\n        playerEl.pause();\n      }\n    } else {\n      capturePlaying();\n      // Pause is a workaround for iOS Safari  otherwise it stops video after several frames\n      playerEl.pause();\n      playerEl.currentTime = 0;\n      safePlay(playerEl);\n      stopCurrentAudio();\n      setIsActivated(true);\n    }\n  });\n\n  useEffect(() => {\n    if (!isInOneTimeModal) {\n      return;\n    }\n    togglePlaying();\n  }, [isInOneTimeModal]);\n\n  const handleClick = useLastCallback((event) => {\n    if (event.target.closest('.transcribe-button')) {\n      return;\n    }\n\n    if (!mediaData) {\n      setIsLoadAllowed((isAllowed) => !isAllowed);\n\n      return;\n    }\n\n    if (isDownloading) {\n      cancelMediaDownload({ media: video });\n      return;\n    }\n\n    if (hasTtl && !isInOneTimeModal) {\n      openOneTimeMediaModal({ message });\n      onReadMedia?.();\n      return;\n    }\n\n    togglePlaying();\n  });\n\n  useEffect(() => {\n    if (onReadMedia && isMediaUnread && isActivated) {\n      onReadMedia();\n    }\n  }, [isActivated, isMediaUnread, onReadMedia]);\n\n  const handleTimeUpdate = useLastCallback((e: React.UIEvent<HTMLVideoElement>) => {\n    const playerEl = e.currentTarget;\n    setProgress(playerEl.currentTime / playerEl.duration);\n  });\n\n  const handleTranscribe = useLastCallback(() => {\n    transcribeAudio({ chatId: message.chatId, messageId: message.id });\n  });\n\n  function renderPlayWrapper() {\n    return (\n      <div className=\"play-wrapper\">\n        <Button\n          color=\"dark\"\n          round\n          size=\"smaller\"\n          className=\"play\"\n          nonInteractive\n        >\n          <Icon name=\"play\" />\n        </Button>\n        <Icon name=\"view-once\" />\n      </div>\n    );\n  }\n\n  const handleButtonClick = useLastCallback(() => {\n    if ((isTranscribed || isTranscriptionError) && onHideTranscription) {\n      onHideTranscription(!isTranscriptionHidden);\n    } else if (!isTranscribing) {\n      handleTranscribe();\n    }\n  });\n\n  return (\n    <div\n      ref={ref}\n      className={buildClassName('RoundVideo', 'media-inner', isInOneTimeModal && 'non-interactive', className)}\n      onClick={handleClick}\n    >\n      {mediaData && (\n        <div className=\"video-wrapper\">\n          {shouldRenderSpoiler && (\n            <MediaSpoiler\n              isVisible\n              thumbDataUri={thumbDataUri}\n              width={ROUND_VIDEO_DIMENSIONS_PX}\n              height={ROUND_VIDEO_DIMENSIONS_PX}\n              className=\"media-spoiler\"\n            />\n          )}\n          <OptimizedVideo\n            canPlay={shouldPlay}\n            ref={playerRef}\n            src={mediaData}\n            className=\"full-media\"\n            width={ROUND_VIDEO_DIMENSIONS_PX}\n            height={ROUND_VIDEO_DIMENSIONS_PX}\n            autoPlay={!shouldRenderSpoiler}\n            disablePictureInPicture\n            muted={!isActivated}\n            defaultMuted\n            loop={!isActivated}\n            playsInline\n            isPriority\n            onEnded={isActivated ? onStop ?? stopPlaying : undefined}\n            onTimeUpdate={isActivated ? handleTimeUpdate : undefined}\n            onReady={markPlayerReady}\n          />\n        </div>\n      )}\n      {!shouldRenderSpoiler && (\n        <canvas\n          ref={thumbRef}\n          className=\"thumbnail\"\n          style={`width: ${ROUND_VIDEO_DIMENSIONS_PX}px; height: ${ROUND_VIDEO_DIMENSIONS_PX}px`}\n        />\n      )}\n      <div className=\"progress\">\n        {isActivated && (\n          <svg width={ROUND_VIDEO_DIMENSIONS_PX} height={ROUND_VIDEO_DIMENSIONS_PX}>\n            <circle\n              ref={circleRef}\n              cx={PROGRESS_CENTER}\n              cy={PROGRESS_CENTER}\n              r={PROGRESS_CENTER - PROGRESS_MARGIN}\n              className=\"progress-circle\"\n              transform={`rotate(-90, ${PROGRESS_CENTER}, ${PROGRESS_CENTER})`}\n              stroke-dasharray={PROGRESS_CIRCUMFERENCE}\n              stroke-dashoffset={PROGRESS_CIRCUMFERENCE}\n            />\n          </svg>\n        )}\n      </div>\n      {shouldRenderSpinner && (\n        <div ref={spinnerRef} className=\"media-loading\">\n          <ProgressSpinner progress={isDownloading ? downloadProgress : loadProgress} />\n        </div>\n      )}\n      {shouldRenderSpoiler && !shouldRenderSpinner && renderPlayWrapper()}\n      {!mediaData && !isLoadAllowed && (\n        <Icon name=\"download\" />\n      )}\n      {!isInOneTimeModal && (\n        <div\n          className={buildClassName(\n            'message-media-duration', isMediaUnread && 'unread',\n          )}\n        >\n          {isActivated ? formatMediaDuration(playerRef.current!.currentTime) : formatMediaDuration(video.duration)}\n          {(!isActivated || playerRef.current!.paused) && <Icon name=\"muted\" />}\n        </div>\n      )}\n      {canTranscribe && (\n        <Button\n          onClick={handleButtonClick}\n          className=\"transcribe-button\"\n        >\n          {isTranscribed || isTranscriptionError ? <Icon name=\"down\" /> : <Icon name=\"transcribe\" />}\n          {isTranscribing && (\n            <svg viewBox=\"0 0 32 24\" className=\"loading-svg\">\n              <rect\n                className=\"loading-rect\"\n                fill=\"transparent\"\n                width=\"32\"\n                height=\"24\"\n                stroke-width=\"3\"\n                stroke-linejoin=\"round\"\n                rx=\"6\"\n                ry=\"6\"\n                stroke=\"white\"\n                stroke-dashoffset=\"1\"\n                stroke-dasharray=\"32,68\"\n              />\n            </svg>\n          )}\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default RoundVideo;\n","import React, { type TeactNode } from '../../../../lib/teact/teact';\n\nimport type { ApiKeyboardButton } from '../../../../api/types';\nimport type { LangFn } from '../../../../util/localization';\n\nimport { STARS_ICON_PLACEHOLDER } from '../../../../config';\nimport { replaceWithTeact } from '../../../../util/replaceWithTeact';\nimport renderText from '../../../common/helpers/renderText';\n\nimport { type OldLangFn } from '../../../../hooks/useOldLang';\n\nimport Icon from '../../../common/icons/Icon';\n\nexport default function renderKeyboardButtonText(lang: OldLangFn | LangFn, button: ApiKeyboardButton): TeactNode {\n  if (button.type === 'receipt') {\n    return lang('PaymentReceipt');\n  }\n\n  if (button.type === 'buy') {\n    return replaceWithTeact(button.text, STARS_ICON_PLACEHOLDER, <Icon className=\"star-currency-icon\" name=\"star\" />);\n  }\n\n  return renderText(button.text);\n}\n","import {\n  useEffect, useMemo, useRef, useState,\n} from '../lib/teact/teact';\nimport { getActions, getGlobal } from '../global';\n\nimport type { Track, TrackId } from '../util/audioPlayer';\nimport type { MediaSessionHandlers } from '../util/mediaSession';\n\nimport { PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION } from '../config';\nimport { selectTabState } from '../global/selectors';\nimport { register } from '../util/audioPlayer';\nimport {\n  registerMediaSession, setPlaybackState, setPositionState, updateMetadata,\n} from '../util/mediaSession';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\nimport useEffectWithPrevDeps from './useEffectWithPrevDeps';\nimport useLastCallback from './useLastCallback';\nimport useSyncEffect from './useSyncEffect';\n\ntype Handler = (e: Event) => void;\n\nconst DEFAULT_SKIP_TIME = 10;\n\nconst useAudioPlayer = (\n  trackId: TrackId | undefined,\n  originalDuration: number, // Sometimes incorrect for voice messages\n  trackType: Track['type'],\n  src?: string,\n  handlers?: Record<string, Handler>,\n  metadata?: MediaMetadata,\n  onInit?: (element: HTMLAudioElement) => void,\n  shouldPlay = false,\n  onForcePlay?: NoneToVoidFunction,\n  onTrackChange?: NoneToVoidFunction,\n  noPlaylist = false,\n  noProgressUpdates = false,\n  onPause?: NoneToVoidFunction,\n  noReset = false,\n  noHandleEvents = false,\n) => {\n  // eslint-disable-next-line no-null/no-null\n  const controllerRef = useRef<ReturnType<typeof register>>(null);\n\n  const [isPlaying, setIsPlaying] = useState(false);\n  let isPlayingSync = isPlaying;\n\n  const [playProgress, setPlayProgress] = useState<number>(0);\n\n  const handleTrackChange = useLastCallback(() => {\n    setIsPlaying(false);\n    if (onTrackChange) onTrackChange();\n  });\n\n  useSyncEffect(() => {\n    if (!trackId) {\n      return;\n    }\n    controllerRef.current = register(trackId, trackType, (eventName, e) => {\n      if (noHandleEvents) {\n        return;\n      }\n      switch (eventName) {\n        case 'onPlay': {\n          const {\n            setVolume, setPlaybackRate, toggleMuted, proxy,\n          } = controllerRef.current!;\n          setIsPlaying(true);\n          if (trackType !== 'oneTimeVoice') {\n            registerMediaSession(metadata, makeMediaHandlers(controllerRef));\n          }\n          setPlaybackState('playing');\n          const { audioPlayer } = selectTabState(getGlobal());\n          setVolume(audioPlayer.volume);\n          toggleMuted(Boolean(audioPlayer.isMuted));\n          const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n          if (trackType === 'voice' || duration > PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION) {\n            setPlaybackRate(audioPlayer.playbackRate);\n          }\n          setPositionState({\n            duration: proxy.duration || 0,\n            playbackRate: proxy.playbackRate,\n            position: proxy.currentTime,\n          });\n          break;\n        }\n        case 'onRateChange': {\n          const { proxy } = controllerRef.current!;\n          setPositionState({\n            duration: proxy.duration || 0,\n            playbackRate: proxy.playbackRate,\n            position: proxy.currentTime,\n          });\n          break;\n        }\n        case 'onPause':\n          setIsPlaying(false);\n          setPlaybackState('paused');\n          onPause?.();\n          break;\n        case 'onTimeUpdate': {\n          const { proxy } = controllerRef.current!;\n          if (noReset && proxy.currentTime === 0) {\n            break;\n          }\n          const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n          if (!noProgressUpdates) setPlayProgress(proxy.currentTime / duration);\n          break;\n        }\n        case 'onEnded': {\n          setPlaybackState('paused');\n          break;\n        }\n      }\n      handlers?.[eventName]?.(e);\n    }, onForcePlay, handleTrackChange);\n\n    const { proxy } = controllerRef.current!;\n\n    if (!isPlaying && !proxy.paused) {\n      setIsPlaying(true);\n      // `isPlayingSync` is only needed to help `setIsPlaying` because it is asynchronous\n      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n      isPlayingSync = true;\n    }\n\n    if (onInit && !noHandleEvents) {\n      onInit(proxy);\n    }\n  }, [trackId]);\n\n  useEffect(() => {\n    if (isPlaying && metadata) updateMetadata(metadata);\n  }, [metadata, isPlaying]);\n\n  const {\n    play,\n    pause,\n    setCurrentTime,\n    proxy,\n    destroy,\n    setVolume,\n    stop,\n    isFirst,\n    isLast,\n    requestNextTrack,\n    requestPreviousTrack,\n    setPlaybackRate,\n    toggleMuted,\n  } = controllerRef.current ?? {};\n\n  const duration = useMemo(() => {\n    return proxy?.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n  }, [proxy?.duration, originalDuration]);\n\n  // RAF progress\n  useEffect(() => {\n    if (!proxy) {\n      return;\n    }\n    if (noReset && proxy.currentTime === 0) {\n      return;\n    }\n    if (duration && !isSafariPatchInProgress(proxy) && !noProgressUpdates) {\n      setPlayProgress(proxy.currentTime / duration);\n    }\n  }, [duration, playProgress, proxy, noProgressUpdates, noReset]);\n\n  // Cleanup\n  useEffect(() => () => {\n    destroy?.(noPlaylist);\n  }, [destroy, noPlaylist]);\n\n  // Autoplay once `src` is present\n  useEffectWithPrevDeps(([prevShouldPlay, prevSrc]) => {\n    if (prevShouldPlay === shouldPlay && src === prevSrc) {\n      return;\n    }\n\n    // When paused by another player\n    if (proxy?.src && proxy?.paused) {\n      return;\n    }\n\n    if (shouldPlay && src && !isPlaying) {\n      play?.(src);\n    }\n  }, [shouldPlay, src, isPlaying, play, proxy?.src, proxy?.paused, trackType]);\n\n  const playIfPresent = useLastCallback(() => {\n    if (src) {\n      play?.(src);\n    }\n  });\n\n  const playPause = useLastCallback(() => {\n    if (isPlaying) {\n      pause?.();\n    } else {\n      playIfPresent();\n    }\n  });\n\n  const setTime = useLastCallback((time: number) => {\n    setCurrentTime?.(time);\n    if (duration && proxy) {\n      setPlayProgress(proxy.currentTime / duration);\n    }\n  });\n\n  return {\n    isPlaying: isPlayingSync,\n    playProgress,\n    playPause,\n    pause,\n    play: playIfPresent,\n    stop,\n    setCurrentTime: setTime,\n    setVolume,\n    audioProxy: proxy,\n    duration,\n    requestNextTrack,\n    requestPreviousTrack,\n    isFirst,\n    isLast,\n    setPlaybackRate,\n    toggleMuted,\n  };\n};\n\nfunction makeMediaHandlers(controllerRef: React.RefObject<ReturnType<typeof register>>) {\n  let mediaHandlers: MediaSessionHandlers = {};\n  if (controllerRef && controllerRef.current) {\n    const {\n      play, pause, setCurrentTime, proxy, requestNextTrack, requestPreviousTrack, isFirst, isLast,\n    } = controllerRef.current;\n    mediaHandlers = {\n      play: () => {\n        play(proxy.src);\n      },\n      pause: () => {\n        pause();\n      },\n      stop: () => {\n        pause();\n        setCurrentTime(0);\n        getActions().closeAudioPlayer();\n      },\n      seekbackward: (event) => {\n        const skipTime = event.seekOffset || DEFAULT_SKIP_TIME;\n        setCurrentTime(Math.max(proxy.currentTime - skipTime, 0));\n      },\n      seekforward: (event) => {\n        const skipTime = event.seekOffset || DEFAULT_SKIP_TIME;\n        setCurrentTime(Math.min(proxy.currentTime + skipTime, proxy.duration));\n      },\n      seekTo: (event) => {\n        if (event.seekTime) {\n          setCurrentTime(event.seekTime);\n        }\n      },\n    };\n\n    if (!isLast()) {\n      mediaHandlers.nexttrack = () => {\n        requestNextTrack();\n      };\n    }\n    if (!isFirst()) {\n      mediaHandlers.previoustrack = () => {\n        requestPreviousTrack();\n      };\n    }\n  }\n  return mediaHandlers;\n}\n\nexport default useAudioPlayer;\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useRef,\n} from '../../../lib/teact/teact';\n\nimport type { IAnchorPosition } from '../../../types';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport Menu from '../../ui/Menu';\nimport MenuItem from '../../ui/MenuItem';\nimport MenuSeparator from '../../ui/MenuSeparator';\n\nimport './MessageContextMenu.scss';\n\ntype OwnProps = {\n  isOpen: boolean;\n  anchor: IAnchorPosition;\n  sponsorInfo?: string;\n  canReport?: boolean;\n  triggerRef: React.RefObject<HTMLElement>;\n  shouldSkipAbout?: boolean;\n  onClose: NoneToVoidFunction;\n  onCloseAnimationEnd?: NoneToVoidFunction;\n  onAboutAdsClick: NoneToVoidFunction;\n  onSponsoredHide: NoneToVoidFunction;\n  onSponsorInfo?: NoneToVoidFunction;\n  onSponsoredReport?: NoneToVoidFunction;\n};\n\nconst SponsoredContextMenu: FC<OwnProps> = ({\n  isOpen,\n  sponsorInfo,\n  canReport,\n  anchor,\n  triggerRef,\n  shouldSkipAbout,\n  onClose,\n  onCloseAnimationEnd,\n  onAboutAdsClick,\n  onSponsoredHide,\n  onSponsorInfo,\n  onSponsoredReport,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const menuRef = useRef<HTMLDivElement>(null);\n  const lang = useOldLang();\n\n  const getTriggerElement = useLastCallback(() => triggerRef.current);\n  const getLayout = useLastCallback(() => ({ withPortal: true }));\n  const getMenuElement = useLastCallback(() => menuRef.current);\n  const getRootElement = useLastCallback(() => document.body);\n\n  const isSeparatorNeeded = sponsorInfo || !shouldSkipAbout || canReport;\n\n  return (\n    <Menu\n      ref={menuRef}\n      isOpen={isOpen}\n      anchor={anchor}\n      withPortal\n      className=\"with-menu-transitions\"\n      getLayout={getLayout}\n      getTriggerElement={getTriggerElement}\n      getMenuElement={getMenuElement}\n      getRootElement={getRootElement}\n      onClose={onClose}\n      onCloseAnimationEnd={onCloseAnimationEnd}\n    >\n      {sponsorInfo && onSponsorInfo && (\n        <MenuItem icon=\"channel\" onClick={onSponsorInfo}>{lang('SponsoredMessageSponsor')}</MenuItem>\n      )}\n      {!shouldSkipAbout && (\n        <MenuItem icon=\"info\" onClick={onAboutAdsClick}>\n          {lang(canReport ? 'AboutRevenueSharingAds' : 'SponsoredMessageInfo')}\n        </MenuItem>\n      )}\n      {canReport && onSponsoredReport && (\n        <MenuItem icon=\"hand-stop\" onClick={onSponsoredReport}>\n          {lang('ReportAd')}\n        </MenuItem>\n      )}\n      {isSeparatorNeeded && <MenuSeparator />}\n      <MenuItem icon=\"close-circle\" onClick={onSponsoredHide}>\n        {lang('HideAd')}\n      </MenuItem>\n    </Menu>\n  );\n};\n\nexport default memo(SponsoredContextMenu);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { IAnchorPosition } from '../../../types';\n\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useShowTransition from '../../../hooks/useShowTransition';\n\nimport SponsoredContextMenu from './SponsoredContextMenu';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  randomId: string;\n  sponsorInfo?: string;\n  additionalInfo?: string;\n  canReport?: boolean;\n  anchor: IAnchorPosition;\n  triggerRef: React.RefObject<HTMLElement>;\n  shouldSkipAbout?: boolean;\n  onItemClick?: NoneToVoidFunction;\n  onClose: NoneToVoidFunction;\n  onCloseAnimationEnd: NoneToVoidFunction;\n};\n\nconst SponsoredMessageContextMenuContainer: FC<OwnProps> = ({\n  isOpen,\n  randomId,\n  sponsorInfo,\n  additionalInfo,\n  canReport,\n  anchor,\n  triggerRef,\n  shouldSkipAbout,\n  onItemClick,\n  onClose,\n  onCloseAnimationEnd,\n}) => {\n  const {\n    openAboutAdsModal,\n    showDialog,\n    reportSponsored,\n    hideSponsored,\n  } = getActions();\n\n  const { ref } = useShowTransition({\n    isOpen,\n    onCloseAnimationEnd,\n  });\n\n  const handleItemClick = useLastCallback(() => {\n    onItemClick?.();\n    onClose();\n  });\n\n  const handleAboutAdsOpen = useLastCallback(() => {\n    openAboutAdsModal({\n      randomId,\n      additionalInfo,\n      canReport,\n      sponsorInfo,\n    });\n    handleItemClick();\n  });\n\n  const handleSponsoredHide = useLastCallback(() => {\n    hideSponsored();\n    handleItemClick();\n  });\n\n  const handleSponsorInfo = useLastCallback(() => {\n    showDialog({\n      data: {\n        message: [sponsorInfo, additionalInfo].filter(Boolean).join('\\n'),\n      },\n    });\n    handleItemClick();\n  });\n\n  const handleReportSponsoredMessage = useLastCallback(() => {\n    reportSponsored({ randomId });\n    handleItemClick();\n  });\n\n  if (!anchor) {\n    return undefined;\n  }\n\n  return (\n    <div ref={ref} className=\"ContextMenuContainer\">\n      <SponsoredContextMenu\n        isOpen={isOpen}\n        anchor={anchor}\n        triggerRef={triggerRef}\n        canReport={canReport}\n        sponsorInfo={sponsorInfo}\n        shouldSkipAbout={shouldSkipAbout}\n        onClose={onClose}\n        onCloseAnimationEnd={onClose}\n        onAboutAdsClick={handleAboutAdsOpen}\n        onSponsoredHide={handleSponsoredHide}\n        onSponsorInfo={handleSponsorInfo}\n        onSponsoredReport={handleReportSponsoredMessage}\n      />\n    </div>\n  );\n};\n\nexport default memo(SponsoredMessageContextMenuContainer);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"Ky16H_sV\",\"button-text\":\"W01t9CIf\",\"buttonText\":\"W01t9CIf\",\"sticker\":\"c8lE3XW5\",\"title\":\"wlwD1B1Q\",\"description\":\"V8OCFHmp\",\"is-ios\":\"IxW_z_r0\",\"isIos\":\"IxW_z_r0\",\"is-macos\":\"OFxKGCEJ\",\"isMacos\":\"OFxKGCEJ\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useCallback } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { ApiSticker } from '../../../api/types';\n\nimport { getHasAdminRight } from '../../../global/helpers';\nimport { selectAnimatedEmoji, selectChat } from '../../../global/selectors';\nimport buildClassName from '../../../util/buildClassName';\nimport { REM } from '../../common/helpers/mediaDimensions';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport AnimatedIconFromSticker from '../../common/AnimatedIconFromSticker';\nimport Button from '../../ui/Button';\n\nimport styles from './EmptyForum.module.scss';\n\ntype OwnProps = {\n  chatId: string;\n};\n\ntype StateProps = {\n  animatedEmoji?: ApiSticker;\n  canManageTopics?: boolean;\n};\n\nconst ICON_SIZE = 7 * REM;\n\nconst EmptyForum: FC<OwnProps & StateProps> = ({\n  chatId, animatedEmoji, canManageTopics,\n}) => {\n  const { openCreateTopicPanel } = getActions();\n\n  const lang = useOldLang();\n  const { isMobile } = useAppLayout();\n\n  const handleCreateTopic = useCallback(() => {\n    openCreateTopicPanel({ chatId });\n  }, [chatId, openCreateTopicPanel]);\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.sticker}>\n        {animatedEmoji && <AnimatedIconFromSticker sticker={animatedEmoji} size={ICON_SIZE} />}\n      </div>\n      <h3 className={styles.title} dir=\"auto\">{lang('ChatList.EmptyTopicsTitle')}</h3>\n      <p className={buildClassName(styles.description, styles.centered)} dir=\"auto\">\n        {lang('ChatList.EmptyTopicsDescription')}\n      </p>\n      {canManageTopics && (\n        <Button\n          ripple={!isMobile}\n          fluid\n          onClick={handleCreateTopic}\n          size=\"smaller\"\n          isRtl={lang.isRtl}\n        >\n          <div className={styles.buttonText}>\n            {lang('ChatList.EmptyTopicsCreate')}\n          </div>\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>((global, { chatId }): StateProps => {\n  const chat = selectChat(global, chatId);\n  const canManageTopics = chat && (chat.isCreator || getHasAdminRight(chat, 'manageTopics'));\n\n  return {\n    animatedEmoji: selectAnimatedEmoji(global, ''),\n    canManageTopics,\n  };\n})(EmptyForum));\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"Fn34Vu_9\",\"closed-icon\":\"MB7Gomjn\",\"closedIcon\":\"MB7Gomjn\",\"topic-icon\":\"oXJl4tra\",\"topicIcon\":\"oXJl4tra\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type {\n  ApiChat, ApiDraft, ApiMessage, ApiMessageOutgoingStatus,\n  ApiPeer, ApiTopic, ApiTypeStory, ApiTypingStatus,\n} from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { ChatAnimationTypes } from './hooks';\n\nimport { groupStatefulContent } from '../../../global/helpers';\nimport { getIsChatMuted } from '../../../global/helpers/notifications';\nimport {\n  selectCanAnimateInterface,\n  selectCanDeleteTopic,\n  selectChat,\n  selectChatMessage,\n  selectCurrentMessageList,\n  selectDraft,\n  selectNotifyDefaults,\n  selectNotifyException,\n  selectOutgoingStatus,\n  selectPeerStory,\n  selectSender,\n  selectThreadInfo,\n  selectThreadParam,\n  selectTopics,\n} from '../../../global/selectors';\nimport { IS_OPEN_IN_NEW_TAB_SUPPORTED } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { createLocationHash } from '../../../util/routing';\nimport renderText from '../../common/helpers/renderText';\n\nimport useFlag from '../../../hooks/useFlag';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useChatListEntry from './hooks/useChatListEntry';\nimport useTopicContextActions from './hooks/useTopicContextActions';\n\nimport Icon from '../../common/icons/Icon';\nimport LastMessageMeta from '../../common/LastMessageMeta';\nimport TopicIcon from '../../common/TopicIcon';\nimport ConfirmDialog from '../../ui/ConfirmDialog';\nimport ListItem from '../../ui/ListItem';\nimport MuteChatModal from '../MuteChatModal.async';\nimport ChatBadge from './ChatBadge';\n\nimport styles from './Topic.module.scss';\n\ntype OwnProps = {\n  chatId: string;\n  topic: ApiTopic;\n  isSelected: boolean;\n  style: string;\n  observeIntersection?: ObserveFn;\n  orderDiff: number;\n  animationType: ChatAnimationTypes;\n};\n\ntype StateProps = {\n  chat: ApiChat;\n  isChatMuted?: boolean;\n  canDelete?: boolean;\n  lastMessage?: ApiMessage;\n  lastMessageStory?: ApiTypeStory;\n  lastMessageOutgoingStatus?: ApiMessageOutgoingStatus;\n  lastMessageSender?: ApiPeer;\n  typingStatus?: ApiTypingStatus;\n  draft?: ApiDraft;\n  canScrollDown?: boolean;\n  wasTopicOpened?: boolean;\n  withInterfaceAnimations?: boolean;\n  topics?: Record<number, ApiTopic>;\n};\n\nconst Topic: FC<OwnProps & StateProps> = ({\n  topic,\n  isSelected,\n  chatId,\n  chat,\n  isChatMuted,\n  style,\n  lastMessage,\n  lastMessageStory,\n  canScrollDown,\n  lastMessageOutgoingStatus,\n  observeIntersection,\n  canDelete,\n  lastMessageSender,\n  animationType,\n  withInterfaceAnimations,\n  orderDiff,\n  typingStatus,\n  draft,\n  wasTopicOpened,\n  topics,\n}) => {\n  const {\n    openThread,\n    deleteTopic,\n    focusLastMessage,\n    setViewForumAsMessages,\n  } = getActions();\n\n  const lang = useOldLang();\n\n  const [isDeleteModalOpen, openDeleteModal, closeDeleteModal] = useFlag();\n  const [isMuteModalOpen, openMuteModal, closeMuteModal] = useFlag();\n  const [shouldRenderDeleteModal, markRenderDeleteModal, unmarkRenderDeleteModal] = useFlag();\n  const [shouldRenderMuteModal, markRenderMuteModal, unmarkRenderMuteModal] = useFlag();\n\n  const {\n    isPinned, isClosed, notifySettings,\n  } = topic;\n  const isMuted = Boolean(notifySettings.mutedUntil || (notifySettings.mutedUntil === undefined && isChatMuted));\n\n  const handleOpenDeleteModal = useLastCallback(() => {\n    markRenderDeleteModal();\n    openDeleteModal();\n  });\n\n  const handleDelete = useLastCallback(() => {\n    deleteTopic({ chatId: chat.id, topicId: topic.id });\n  });\n\n  const handleMute = useLastCallback(() => {\n    markRenderMuteModal();\n    openMuteModal();\n  });\n\n  const { renderSubtitle, ref } = useChatListEntry({\n    chat,\n    chatId,\n    lastMessage,\n    draft,\n    lastMessageSender,\n    lastMessageTopic: topic,\n    observeIntersection,\n    isTopic: true,\n    typingStatus,\n    topics,\n    statefulMediaContent: groupStatefulContent({ story: lastMessageStory }),\n\n    animationType,\n    withInterfaceAnimations,\n    orderDiff,\n  });\n\n  const handleOpenTopic = useLastCallback(() => {\n    openThread({ chatId, threadId: topic.id, shouldReplaceHistory: true });\n    setViewForumAsMessages({ chatId, isEnabled: false });\n\n    if (canScrollDown) {\n      focusLastMessage();\n    }\n  });\n\n  const contextActions = useTopicContextActions({\n    topic,\n    chat,\n    isChatMuted,\n    wasOpened: wasTopicOpened,\n    canDelete,\n    handleDelete: handleOpenDeleteModal,\n    handleMute,\n  });\n\n  return (\n    <ListItem\n      className={buildClassName(\n        styles.root,\n        'Chat',\n        isSelected && 'selected',\n        'chat-item-clickable',\n      )}\n      onClick={handleOpenTopic}\n      style={style}\n      href={IS_OPEN_IN_NEW_TAB_SUPPORTED ? `#${createLocationHash(chatId, 'thread', topic.id)}` : undefined}\n      contextActions={contextActions}\n      withPortalForMenu\n      ref={ref}\n    >\n      <div className=\"info\">\n        <div className=\"info-row\">\n          <div className={buildClassName('title')}>\n            <TopicIcon topic={topic} className={styles.topicIcon} observeIntersection={observeIntersection} />\n            <h3 dir=\"auto\" className=\"fullName\">{renderText(topic.title)}</h3>\n          </div>\n          {Boolean(notifySettings.mutedUntil) && <Icon name=\"muted\" />}\n          <div className=\"separator\" />\n          {isClosed && (\n            <Icon name=\"lock-badge\" className={styles.closedIcon} />\n          )}\n          {lastMessage && (\n            <LastMessageMeta\n              message={lastMessage}\n              outgoingStatus={lastMessageOutgoingStatus}\n            />\n          )}\n        </div>\n        <div className=\"subtitle\">\n          {renderSubtitle()}\n          <ChatBadge\n            chat={chat}\n            isPinned={isPinned}\n            isMuted={isMuted}\n            topic={topic}\n            wasTopicOpened={wasTopicOpened}\n            topics={topics}\n          />\n        </div>\n      </div>\n      {shouldRenderDeleteModal && (\n        <ConfirmDialog\n          isOpen={isDeleteModalOpen}\n          onClose={closeDeleteModal}\n          onCloseAnimationEnd={unmarkRenderDeleteModal}\n          confirmIsDestructive\n          confirmHandler={handleDelete}\n          text={lang('lng_forum_topic_delete_sure')}\n          confirmLabel={lang('Delete')}\n        />\n      )}\n      {shouldRenderMuteModal && (\n        <MuteChatModal\n          isOpen={isMuteModalOpen}\n          onClose={closeMuteModal}\n          onCloseAnimationEnd={unmarkRenderMuteModal}\n          chatId={chatId}\n          topicId={topic.id}\n        />\n      )}\n    </ListItem>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId, topic, isSelected }) => {\n    const chat = selectChat(global, chatId);\n\n    const lastMessage = selectChatMessage(global, chatId, topic.lastMessageId);\n    const { isOutgoing } = lastMessage || {};\n    const lastMessageSender = lastMessage && selectSender(global, lastMessage);\n    const typingStatus = selectThreadParam(global, chatId, topic.id, 'typingStatus');\n    const draft = selectDraft(global, chatId, topic.id);\n    const threadInfo = selectThreadInfo(global, chatId, topic.id);\n    const wasTopicOpened = Boolean(threadInfo?.lastReadInboxMessageId);\n    const topics = selectTopics(global, chatId);\n\n    const { chatId: currentChatId, threadId: currentThreadId } = selectCurrentMessageList(global) || {};\n\n    const storyData = lastMessage?.content.storyData;\n    const lastMessageStory = storyData && selectPeerStory(global, storyData.peerId, storyData.id);\n\n    const isChatMuted = chat && getIsChatMuted(\n      chat, selectNotifyDefaults(global), selectNotifyException(global, chat.id),\n    );\n\n    return {\n      chat,\n      lastMessage,\n      lastMessageSender,\n      typingStatus,\n      isChatMuted,\n      canDelete: selectCanDeleteTopic(global, chatId, topic.id),\n      withInterfaceAnimations: selectCanAnimateInterface(global),\n      draft,\n      ...(isOutgoing && lastMessage && {\n        lastMessageOutgoingStatus: selectOutgoingStatus(global, lastMessage),\n      }),\n      canScrollDown: isSelected && chat?.id === currentChatId && currentThreadId === topic.id,\n      wasTopicOpened,\n      topics,\n      lastMessageStory,\n    };\n  },\n)(Topic));\n","import { useMemo } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiChat, ApiTopic } from '../../../../api/types';\nimport type { MenuItemContextAction } from '../../../ui/ListItem';\n\nimport { getCanManageTopic, getHasAdminRight } from '../../../../global/helpers';\nimport { IS_OPEN_IN_NEW_TAB_SUPPORTED } from '../../../../util/browser/windowEnvironment';\nimport { compact } from '../../../../util/iteratees';\n\nimport useOldLang from '../../../../hooks/useOldLang';\n\nexport default function useTopicContextActions({\n  topic,\n  chat,\n  isChatMuted,\n  wasOpened,\n  canDelete,\n  handleDelete,\n  handleMute,\n}: {\n  topic: ApiTopic;\n  chat: ApiChat;\n  isChatMuted?: boolean;\n  wasOpened?: boolean;\n  canDelete?: boolean;\n  handleDelete?: NoneToVoidFunction;\n  handleMute?: NoneToVoidFunction;\n}) {\n  const lang = useOldLang();\n\n  return useMemo(() => {\n    const {\n      isPinned, notifySettings, isClosed, id: topicId,\n    } = topic;\n\n    const chatId = chat.id;\n\n    const {\n      editTopic,\n      toggleTopicPinned,\n      markTopicRead,\n      updateTopicMutedState,\n      openChatInNewTab,\n    } = getActions();\n\n    const canToggleClosed = getCanManageTopic(chat, topic);\n    const canTogglePinned = chat.isCreator || getHasAdminRight(chat, 'manageTopics');\n\n    const actionOpenInNewTab = IS_OPEN_IN_NEW_TAB_SUPPORTED && {\n      title: 'Open in new tab',\n      icon: 'open-in-new-tab',\n      handler: () => {\n        openChatInNewTab({ chatId: chat.id, threadId: topicId });\n      },\n    };\n\n    const actionUnreadMark = topic.unreadCount || !wasOpened\n      ? {\n        title: lang('MarkAsRead'),\n        icon: 'readchats',\n        handler: () => {\n          markTopicRead({ chatId, topicId });\n        },\n      }\n      : undefined;\n\n    const actionPin = canTogglePinned ? (isPinned\n      ? {\n        title: lang('UnpinFromTop'),\n        icon: 'unpin',\n        handler: () => toggleTopicPinned({ chatId, topicId, isPinned: false }),\n      }\n      : {\n        title: lang('PinToTop'),\n        icon: 'pin',\n        handler: () => toggleTopicPinned({ chatId, topicId, isPinned: true }),\n      }) : undefined;\n\n    const actionMute = ((isChatMuted && notifySettings.mutedUntil === undefined) || notifySettings.mutedUntil)\n      ? {\n        title: lang('ChatList.Unmute'),\n        icon: 'unmute',\n        handler: () => updateTopicMutedState({ chatId, topicId, isMuted: false }),\n      }\n      : {\n        title: `${lang('ChatList.Mute')}...`,\n        icon: 'mute',\n        handler: handleMute,\n      };\n\n    const actionCloseTopic = canToggleClosed ? (isClosed\n      ? {\n        title: lang('lng_forum_topic_reopen'),\n        icon: 'reopen-topic',\n        handler: () => editTopic({ chatId, topicId, isClosed: false }),\n      }\n      : {\n        title: lang('lng_forum_topic_close'),\n        icon: 'close-topic',\n        handler: () => editTopic({ chatId, topicId, isClosed: true }),\n      }) : undefined;\n\n    const actionDelete = canDelete ? {\n      title: lang('lng_forum_topic_delete'),\n      icon: 'delete',\n      destructive: true,\n      handler: handleDelete,\n    } : undefined;\n\n    return compact([\n      actionOpenInNewTab,\n      actionPin,\n      actionUnreadMark,\n      actionMute,\n      actionCloseTopic,\n      actionDelete,\n    ]) as MenuItemContextAction[];\n  }, [topic, chat, isChatMuted, wasOpened, lang, canDelete, handleDelete, handleMute]);\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  beginHeavyAnimation,\n  memo, useEffect, useMemo, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { ApiChat } from '../../../api/types';\nimport type { TopicsInfo } from '../../../types';\nimport { MAIN_THREAD_ID } from '../../../api/types';\n\nimport {\n  GENERAL_TOPIC_ID, TOPIC_HEIGHT_PX, TOPIC_LIST_SENSITIVE_AREA, TOPICS_SLICE,\n} from '../../../config';\nimport { requestNextMutation } from '../../../lib/fasterdom/fasterdom';\nimport { getOrderedTopics } from '../../../global/helpers';\nimport {\n  selectCanAnimateInterface,\n  selectChat,\n  selectCurrentMessageList,\n  selectIsForumPanelOpen,\n  selectTabState,\n  selectTopicsInfo,\n} from '../../../global/selectors';\nimport { IS_TOUCH_ENV } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport { captureEvents, SwipeDirection } from '../../../util/captureEvents';\nimport { waitForTransitionEnd } from '../../../util/cssAnimationEndListeners';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\nimport useHistoryBack from '../../../hooks/useHistoryBack';\nimport useInfiniteScroll from '../../../hooks/useInfiniteScroll';\nimport { useIntersectionObserver, useOnIntersect } from '../../../hooks/useIntersectionObserver';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\nimport usePreviousDeprecated from '../../../hooks/usePreviousDeprecated';\nimport useOrderDiff from './hooks/useOrderDiff';\n\nimport GroupCallTopPane from '../../calls/group/GroupCallTopPane';\nimport GroupChatInfo from '../../common/GroupChatInfo';\nimport Icon from '../../common/icons/Icon';\nimport HeaderActions from '../../middle/HeaderActions';\nimport Button from '../../ui/Button';\nimport InfiniteScroll from '../../ui/InfiniteScroll';\nimport Loading from '../../ui/Loading';\nimport EmptyForum from './EmptyForum';\nimport Topic from './Topic';\n\nimport styles from './ForumPanel.module.scss';\n\ntype OwnProps = {\n  isOpen?: boolean;\n  isHidden?: boolean;\n  onTopicSearch?: NoneToVoidFunction;\n  onCloseAnimationEnd?: VoidFunction;\n  onOpenAnimationStart?: VoidFunction;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  topicsInfo?: TopicsInfo;\n  currentTopicId?: number;\n  withInterfaceAnimations?: boolean;\n};\n\nconst INTERSECTION_THROTTLE = 200;\n\nconst ForumPanel: FC<OwnProps & StateProps> = ({\n  chat,\n  currentTopicId,\n  isOpen,\n  isHidden,\n  topicsInfo,\n  onTopicSearch,\n  onCloseAnimationEnd,\n  onOpenAnimationStart,\n  withInterfaceAnimations,\n}) => {\n  const {\n    closeForumPanel, openChatWithInfo, loadTopics,\n  } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const scrollTopHandlerRef = useRef<HTMLDivElement>(null);\n  const { isMobile } = useAppLayout();\n  const chatId = chat?.id;\n\n  useEffect(() => {\n    if (chatId && !topicsInfo) {\n      loadTopics({ chatId });\n    }\n  }, [topicsInfo, chatId]);\n\n  const [isScrolled, setIsScrolled] = useState(false);\n  const lang = useOldLang();\n\n  const handleClose = useLastCallback(() => {\n    closeForumPanel();\n  });\n\n  useEffect(() => {\n    if (!withInterfaceAnimations && !isOpen) {\n      onCloseAnimationEnd?.();\n    }\n  }, [withInterfaceAnimations, isOpen, onCloseAnimationEnd]);\n\n  const handleToggleChatInfo = useLastCallback(() => {\n    if (!chat) return;\n    openChatWithInfo({ id: chat.id, shouldReplaceHistory: true });\n  });\n\n  const { observe } = useIntersectionObserver({\n    rootRef: containerRef,\n    throttleMs: INTERSECTION_THROTTLE,\n  });\n\n  useOnIntersect(scrollTopHandlerRef, observe, ({ isIntersecting }) => {\n    setIsScrolled(!isIntersecting);\n  });\n\n  const orderedIds = useMemo(() => {\n    return topicsInfo\n      ? getOrderedTopics(\n        Object.values(topicsInfo.topicsById),\n        topicsInfo.orderedPinnedTopicIds,\n      ).map(({ id }) => id)\n      : [];\n  }, [topicsInfo]);\n\n  const { orderDiffById, getAnimationType } = useOrderDiff(orderedIds, chat?.id);\n\n  const [viewportIds, getMore] = useInfiniteScroll(() => {\n    if (!chat) return;\n    loadTopics({ chatId: chat.id });\n  }, orderedIds, !topicsInfo?.totalCount || orderedIds.length >= topicsInfo.totalCount, TOPICS_SLICE);\n\n  const shouldRenderRef = useRef(false);\n  const isVisible = isOpen && !isHidden;\n  const prevIsVisible = usePreviousDeprecated(isVisible);\n\n  if (prevIsVisible !== isVisible) {\n    shouldRenderRef.current = false;\n  }\n\n  useHistoryBack({\n    isActive: isVisible,\n    onBack: handleClose,\n  });\n\n  useEffect(() => (isVisible ? captureEscKeyListener(handleClose) : undefined), [handleClose, isVisible]);\n\n  useEffect(() => {\n    if (prevIsVisible !== isVisible) {\n      // For performance reasons, we delay animation of the topic list panel to the next animation frame\n      requestNextMutation(() => {\n        if (!ref.current) return;\n\n        const endHeavyAnimation = beginHeavyAnimation();\n        waitForTransitionEnd(ref.current, endHeavyAnimation);\n\n        onOpenAnimationStart?.();\n\n        if (isVisible) {\n          shouldRenderRef.current = true;\n          ref.current!.style.transform = 'none';\n        } else {\n          shouldRenderRef.current = false;\n          ref.current!.style.transform = '';\n        }\n      });\n    }\n  }, [isVisible, onOpenAnimationStart, prevIsVisible]);\n\n  useEffect(() => {\n    if (!IS_TOUCH_ENV) {\n      return undefined;\n    }\n\n    return captureEvents(ref.current!, {\n      selectorToPreventScroll: '.chat-list',\n      onSwipe: ((e, direction) => {\n        const closeDirection = lang.isRtl ? SwipeDirection.Left : SwipeDirection.Right;\n\n        if (direction === closeDirection) {\n          closeForumPanel();\n          return true;\n        }\n\n        return false;\n      }),\n    });\n  }, [closeForumPanel, lang.isRtl]);\n\n  function renderTopics() {\n    const viewportOffset = orderedIds!.indexOf(viewportIds![0]);\n\n    return viewportIds?.map((id, i) => (\n      <Topic\n        key={id}\n        chatId={chat!.id}\n        topic={topicsInfo!.topicsById[id]}\n        style={`top: ${(viewportOffset + i) * TOPIC_HEIGHT_PX}px;`}\n        isSelected={currentTopicId === id}\n        observeIntersection={observe}\n        animationType={getAnimationType(id)}\n        orderDiff={orderDiffById[id]}\n      />\n    ));\n  }\n\n  const isLoading = topicsInfo === undefined;\n\n  return (\n    <div\n      ref={ref}\n      className={buildClassName(\n        styles.root,\n        isScrolled && styles.scrolled,\n        lang.isRtl && styles.rtl,\n        !withInterfaceAnimations && styles.noAnimation,\n      )}\n      onTransitionEnd={!isOpen ? onCloseAnimationEnd : undefined}\n    >\n      <div id=\"TopicListHeader\" className=\"left-header\">\n        <Button\n          round\n          size=\"smaller\"\n          color=\"translucent\"\n          onClick={handleClose}\n          ariaLabel={lang('Close')}\n        >\n          <Icon name=\"close\" />\n        </Button>\n\n        {chat && (\n          <GroupChatInfo\n            noAvatar\n            className={styles.info}\n            chatId={chat.id}\n            onClick={handleToggleChatInfo}\n          />\n        )}\n\n        {chat\n          && (\n            <HeaderActions\n              chatId={chat.id}\n              threadId={MAIN_THREAD_ID}\n              messageListType=\"thread\"\n              canExpandActions={false}\n              isForForum\n              isMobile={isMobile}\n              onTopicSearch={onTopicSearch}\n            />\n          )}\n      </div>\n\n      {chat && <GroupCallTopPane chatId={chat.id} />}\n\n      <div className={styles.notch} />\n\n      <InfiniteScroll\n        className=\"chat-list custom-scroll\"\n        ref={containerRef}\n        items={viewportIds}\n        preloadBackwards={TOPICS_SLICE}\n        withAbsolutePositioning\n        maxHeight={(orderedIds?.length || 0) * TOPIC_HEIGHT_PX}\n        onLoadMore={getMore}\n        sensitiveArea={TOPIC_LIST_SENSITIVE_AREA}\n        beforeChildren={<div ref={scrollTopHandlerRef} className={styles.scrollTopHandler} />}\n      >\n        {Boolean(viewportIds?.length) && (\n          renderTopics()\n        )}\n        {isLoading && !viewportIds?.length && (\n          <Loading key=\"loading\" />\n        )}\n      </InfiniteScroll>\n      {!isLoading && viewportIds?.length === 1 && viewportIds[0] === GENERAL_TOPIC_ID && (\n        <EmptyForum chatId={chatId!} />\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global): StateProps => {\n    const chatId = selectTabState(global).forumPanelChatId;\n    const chat = chatId ? selectChat(global, chatId) : undefined;\n    const {\n      chatId: currentChatId,\n      threadId: currentThreadId,\n    } = selectCurrentMessageList(global) || {};\n    const topicsInfo = chatId ? selectTopicsInfo(global, chatId) : undefined;\n\n    return {\n      chat,\n      currentTopicId: chatId === currentChatId ? Number(currentThreadId) : undefined,\n      withInterfaceAnimations: selectCanAnimateInterface(global),\n      topicsInfo,\n    };\n  },\n  (global) => selectIsForumPanelOpen(global),\n)(ForumPanel));\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"MlF2n1nb\",\"rtl\":\"Xs2y1fCE\",\"no-animation\":\"kmDMv6D8\",\"noAnimation\":\"kmDMv6D8\",\"notch\":\"hGeb3TQJ\",\"scrolled\":\"SZ24u3cn\",\"scroll-top-handler\":\"ERz3fcar\",\"scrollTopHandler\":\"ERz3fcar\",\"info\":\"Sf633zAP\"};","import { useEffect, useLayoutEffect, useState } from '../../lib/teact/teact';\n\nimport { ElectronEvent } from '../../types/electron';\n\nimport { IS_IOS } from '../../util/browser/windowEnvironment';\n\ntype ElementType = HTMLElement;\ntype RefType = {\n  current: ElementType | null;\n};\n\ntype ReturnType = [boolean, () => void, () => void] | [false];\ntype CallbackType = (isPlayed: boolean) => void;\n\nconst prop = getBrowserFullscreenElementProp();\n\nexport default function useFullscreen(elRef: RefType, exitCallback?: CallbackType,\n  enterCallback?: CallbackType): ReturnType {\n  const [isFullscreen, setIsFullscreen] = useState(Boolean(prop && document[prop]));\n\n  const setFullscreen = () => {\n    if (!elRef.current || !(prop || IS_IOS) || isFullscreen) {\n      return;\n    }\n    safeRequestFullscreen(elRef.current);\n    setIsFullscreen(true);\n  };\n\n  const exitFullscreen = () => {\n    if (!elRef.current) {\n      return;\n    }\n    safeExitFullscreen();\n    setIsFullscreen(false);\n  };\n\n  useLayoutEffect(() => {\n    const element = elRef.current;\n    const listener = () => {\n      const isEnabled = Boolean(prop && document[prop]);\n      setIsFullscreen(isEnabled);\n      if (isEnabled) {\n        enterCallback?.(false);\n      } else {\n        exitCallback?.(false);\n      }\n      // In Firefox fullscreen video controls are not visible by default, so we force them manually\n      if (element instanceof HTMLVideoElement) element.controls = isEnabled;\n    };\n\n    const listenerEnter = () => {\n      setIsFullscreen(true);\n      if (enterCallback) enterCallback(true);\n    };\n\n    const listenerExit = () => {\n      setIsFullscreen(false);\n      if (exitCallback) exitCallback(false);\n    };\n\n    document.addEventListener('fullscreenchange', listener, false);\n    document.addEventListener('webkitfullscreenchange', listener, false);\n    document.addEventListener('mozfullscreenchange', listener, false);\n\n    if (element) {\n      element.addEventListener('webkitbeginfullscreen', listenerEnter, false);\n      element.addEventListener('webkitendfullscreen', listenerExit, false);\n    }\n\n    return () => {\n      document.removeEventListener('fullscreenchange', listener, false);\n      document.removeEventListener('webkitfullscreenchange', listener, false);\n      document.removeEventListener('mozfullscreenchange', listener, false);\n      if (element) {\n        element.removeEventListener('webkitbeginfullscreen', listenerEnter, false);\n        element.removeEventListener('webkitendfullscreen', listenerExit, false);\n      }\n    };\n    // eslint-disable-next-line\n  }, []);\n\n  if (!prop && !IS_IOS) {\n    return [false];\n  }\n\n  return [isFullscreen, setFullscreen, exitFullscreen];\n}\n\nexport const useFullscreenStatus = () => {\n  const [isFullscreen, setIsFullscreen] = useState(false);\n\n  useEffect(() => {\n    const listener = () => {\n      setIsFullscreen(checkIfFullscreen());\n    };\n\n    const removeElectronListener = window.electron?.on(ElectronEvent.FULLSCREEN_CHANGE, setIsFullscreen);\n    window.electron?.isFullscreen().then(setIsFullscreen);\n\n    document.addEventListener('fullscreenchange', listener, false);\n    document.addEventListener('webkitfullscreenchange', listener, false);\n    document.addEventListener('mozfullscreenchange', listener, false);\n\n    return () => {\n      removeElectronListener?.();\n\n      document.removeEventListener('fullscreenchange', listener, false);\n      document.removeEventListener('webkitfullscreenchange', listener, false);\n      document.removeEventListener('mozfullscreenchange', listener, false);\n    };\n  }, []);\n\n  return isFullscreen;\n};\n\nfunction getBrowserFullscreenElementProp() {\n  if (typeof document.fullscreenElement !== 'undefined') {\n    return 'fullscreenElement';\n  } else if (typeof document.mozFullScreenElement !== 'undefined') {\n    return 'mozFullScreenElement';\n  } else if (typeof document.webkitFullscreenElement !== 'undefined') {\n    return 'webkitFullscreenElement';\n  }\n  return '';\n}\n\nexport function checkIfFullscreen() {\n  const fullscreenProp = getBrowserFullscreenElementProp();\n  return Boolean(fullscreenProp && document[fullscreenProp]);\n}\n\nexport function safeRequestFullscreen(element: ElementType) {\n  if (element.requestFullscreen) {\n    element.requestFullscreen();\n  } else if (element.webkitRequestFullscreen) {\n    element.webkitRequestFullscreen();\n  } else if (element.webkitEnterFullscreen) {\n    element.webkitEnterFullscreen();\n  } else if (element.mozRequestFullScreen) {\n    element.mozRequestFullScreen();\n  }\n}\n\nexport function safeExitFullscreen() {\n  if (document.exitFullscreen) {\n    document.exitFullscreen();\n  } else if (document.mozCancelFullScreen) {\n    document.mozCancelFullScreen();\n  } else if (document.webkitCancelFullScreen) {\n    document.webkitCancelFullScreen();\n  } else if (document.webkitExitFullscreen) {\n    document.webkitExitFullscreen();\n  }\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { useMemo, useRef } from '../../../lib/teact/teact';\n\nimport type {\n  ApiChat,\n  ApiMessage, ApiPeer, ApiReplyInfo, MediaContainer,\n} from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { ChatTranslatedMessages } from '../../../types';\nimport type { IconName } from '../../../types/icons';\n\nimport { CONTENT_NOT_SUPPORTED } from '../../../config';\nimport {\n  getMessageIsSpoiler,\n  getMessageMediaHash,\n  getMessageRoundVideo,\n  isChatChannel,\n  isChatGroup,\n  isMessageTranslatable,\n  isUserId,\n} from '../../../global/helpers';\nimport { getMediaContentTypeDescription } from '../../../global/helpers/messageSummary';\nimport { getPeerTitle } from '../../../global/helpers/peers';\nimport buildClassName from '../../../util/buildClassName';\nimport freezeWhenClosed from '../../../util/hoc/freezeWhenClosed';\nimport { getPictogramDimensions } from '../helpers/mediaDimensions';\nimport renderText from '../helpers/renderText';\nimport { renderTextWithEntities } from '../helpers/renderTextWithEntities';\n\nimport { useFastClick } from '../../../hooks/useFastClick';\nimport { useIsIntersecting } from '../../../hooks/useIntersectionObserver';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useThumbnail from '../../../hooks/useThumbnail';\nimport useMessageTranslation from '../../middle/message/hooks/useMessageTranslation';\n\nimport RippleEffect from '../../ui/RippleEffect';\nimport Icon from '../icons/Icon';\nimport MediaSpoiler from '../MediaSpoiler';\nimport MessageSummary from '../MessageSummary';\nimport PeerColorWrapper from '../PeerColorWrapper';\n\nimport './EmbeddedMessage.scss';\n\ntype OwnProps = {\n  className?: string;\n  replyInfo?: ApiReplyInfo;\n  message?: ApiMessage;\n  sender?: ApiPeer;\n  senderChat?: ApiChat;\n  forwardSender?: ApiPeer;\n  title?: string;\n  customText?: string;\n  noUserColors?: boolean;\n  isProtected?: boolean;\n  isInComposer?: boolean;\n  chatTranslations?: ChatTranslatedMessages;\n  requestedChatTranslationLanguage?: string;\n  isOpen?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  onClick: ((e: React.MouseEvent) => void);\n};\n\nconst NBSP = '\\u00A0';\nconst EMOJI_SIZE = 17;\n\nconst EmbeddedMessage: FC<OwnProps> = ({\n  className,\n  message,\n  replyInfo,\n  sender,\n  senderChat,\n  forwardSender,\n  title,\n  customText,\n  isProtected,\n  isInComposer,\n  noUserColors,\n  chatTranslations,\n  requestedChatTranslationLanguage,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  onClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const isIntersecting = useIsIntersecting(ref, observeIntersectionForLoading);\n\n  const containedMedia: MediaContainer | undefined = useMemo(() => {\n    const media = (replyInfo?.type === 'message' && replyInfo.replyMedia) || message?.content;\n    if (!media) {\n      return undefined;\n    }\n\n    return {\n      content: media,\n    };\n  }, [message, replyInfo]);\n\n  const gif = containedMedia?.content?.video?.isGif ? containedMedia.content.video : undefined;\n  const isVideoThumbnail = Boolean(gif && !gif.previewPhotoSizes?.length);\n\n  const mediaHash = containedMedia && getMessageMediaHash(containedMedia, isVideoThumbnail ? 'full' : 'pictogram');\n  const mediaBlobUrl = useMedia(mediaHash, !isIntersecting);\n  const mediaThumbnail = useThumbnail(containedMedia);\n\n  const isRoundVideo = Boolean(containedMedia && getMessageRoundVideo(containedMedia));\n  const isSpoiler = Boolean(containedMedia && getMessageIsSpoiler(containedMedia));\n  const isQuote = Boolean(replyInfo?.type === 'message' && replyInfo.isQuote);\n  const replyForwardInfo = replyInfo?.type === 'message' ? replyInfo.replyFrom : undefined;\n\n  const shouldTranslate = message && isMessageTranslatable(message);\n  const { translatedText } = useMessageTranslation(\n    chatTranslations, message?.chatId, shouldTranslate ? message?.id : undefined, requestedChatTranslationLanguage,\n  );\n\n  const lang = useOldLang();\n\n  const senderTitle = sender ? getPeerTitle(lang, sender)\n    : (replyForwardInfo?.hiddenUserName || message?.forwardInfo?.hiddenUserName);\n  const senderChatTitle = senderChat ? getPeerTitle(lang, senderChat) : undefined;\n  const forwardSenderTitle = forwardSender ? getPeerTitle(lang, forwardSender)\n    : message?.forwardInfo?.hiddenUserName;\n  const areSendersSame = sender && sender.id === forwardSender?.id;\n\n  const { handleClick, handleMouseDown } = useFastClick(onClick);\n\n  function renderTextContent() {\n    if (replyInfo?.type === 'message' && replyInfo.quoteText) {\n      return renderTextWithEntities({\n        text: replyInfo.quoteText.text,\n        entities: replyInfo.quoteText.entities,\n        asPreview: true,\n        emojiSize: EMOJI_SIZE,\n      });\n    }\n\n    if (!message) {\n      return customText || renderMediaContentType(containedMedia) || NBSP;\n    }\n\n    return (\n      <MessageSummary\n        message={message}\n        noEmoji={Boolean(mediaThumbnail)}\n        translatedText={translatedText}\n        observeIntersectionForLoading={observeIntersectionForLoading}\n        observeIntersectionForPlaying={observeIntersectionForPlaying}\n        emojiSize={EMOJI_SIZE}\n      />\n    );\n  }\n\n  function renderMediaContentType(media?: MediaContainer) {\n    if (!media || media.content.text) return NBSP;\n    const description = getMediaContentTypeDescription(lang, media.content, {});\n    if (!description || description === CONTENT_NOT_SUPPORTED) return NBSP;\n    return (\n      <span>\n        {renderText(description)}\n      </span>\n    );\n  }\n\n  function checkShouldRenderSenderTitle() {\n    if (!senderChat) return true;\n    if (isUserId(senderChat?.id)) return true;\n    if (senderChat.id === sender?.id) return false;\n    return true;\n  }\n  function renderSender() {\n    if (title) {\n      return renderText(title);\n    }\n\n    if (!senderTitle) {\n      return NBSP;\n    }\n\n    let icon: IconName | undefined;\n    if (senderChat) {\n      if (isChatChannel(senderChat)) {\n        icon = 'channel-filled';\n      }\n\n      if (isChatGroup(senderChat)) {\n        icon = 'group-filled';\n      }\n    }\n\n    const isReplyToQuote = isInComposer && Boolean(replyInfo && 'quoteText' in replyInfo && replyInfo?.quoteText);\n\n    return (\n      <span className=\"embedded-sender-wrapper\">\n        {checkShouldRenderSenderTitle() && (\n          <span className=\"embedded-sender\">\n            {renderText(isReplyToQuote ? lang('ReplyToQuote', senderTitle) : senderTitle)}\n          </span>\n        )}\n        {icon && <Icon name={icon} className=\"embedded-chat-icon\" />}\n        {icon && senderChatTitle && (\n          <span className=\"embedded-sender-chat\">\n            {renderText(senderChatTitle)}\n          </span>\n        )}\n      </span>\n    );\n  }\n\n  function renderForwardSender() {\n    return forwardSenderTitle && !areSendersSame && (\n      <span className=\"embedded-forward-sender-wrapper\">\n        <Icon name={forwardSender ? 'share-filled' : 'forward'} className=\"embedded-origin-icon\" />\n        <span className=\"forward-sender-title\">\n          {renderText(forwardSenderTitle)}\n        </span>\n      </span>\n    );\n  }\n\n  return (\n    <PeerColorWrapper\n      peer={sender}\n      emojiIconClassName=\"EmbeddedMessage--background-icons\"\n      ref={ref}\n      shouldReset\n      noUserColors={noUserColors}\n      className={buildClassName(\n        'EmbeddedMessage',\n        className,\n        isQuote && 'is-quote',\n        mediaThumbnail && 'with-thumb',\n        'no-selection',\n      )}\n      dir={lang.isRtl ? 'rtl' : undefined}\n      onClick={handleClick}\n      onMouseDown={handleMouseDown}\n    >\n      <div className=\"hover-effect\" />\n      <RippleEffect />\n      {mediaThumbnail && renderPictogram(\n        mediaThumbnail, mediaBlobUrl, isVideoThumbnail, isRoundVideo, isProtected, isSpoiler,\n      )}\n      <div className=\"message-text\">\n        <p className={buildClassName('embedded-text-wrapper', isQuote && 'multiline')}>\n          {renderTextContent()}\n        </p>\n        <div className=\"message-title\">\n          {renderSender()}\n          {renderForwardSender()}\n        </div>\n      </div>\n    </PeerColorWrapper>\n  );\n};\n\nfunction renderPictogram(\n  thumbDataUri: string,\n  blobUrl?: string,\n  isFullVideo?: boolean,\n  isRoundVideo?: boolean,\n  isProtected?: boolean,\n  isSpoiler?: boolean,\n) {\n  const { width, height } = getPictogramDimensions();\n\n  const srcUrl = blobUrl || thumbDataUri;\n  const shouldRenderVideo = isFullVideo && blobUrl;\n\n  return (\n    <div className={buildClassName('embedded-thumb', isRoundVideo && 'round')}>\n      {!isSpoiler && !shouldRenderVideo && (\n        <img\n          src={srcUrl}\n          width={width}\n          height={height}\n          alt=\"\"\n          className=\"pictogram\"\n          draggable={false}\n        />\n      )}\n      {!isSpoiler && shouldRenderVideo && (\n        <video\n          src={blobUrl}\n          width={width}\n          height={height}\n          playsInline\n          disablePictureInPicture\n          className=\"pictogram\"\n        />\n      )}\n      <MediaSpoiler\n        thumbDataUri={shouldRenderVideo ? thumbDataUri : srcUrl}\n        isVisible={Boolean(isSpoiler)}\n        width={width}\n        height={height}\n      />\n      {isProtected && <span className=\"protector\" />}\n    </div>\n  );\n}\n\nexport const ClosableEmbeddedMessage = freezeWhenClosed(EmbeddedMessage);\n\nexport default EmbeddedMessage;\n","import { useEffect } from '../../../lib/teact/teact';\nimport { getGlobal } from '../../../global';\n\nimport { ApiMediaFormat } from '../../../api/types';\n\nimport { getStoryMediaHash } from '../../../global/helpers';\nimport { selectPeerStories } from '../../../global/selectors';\nimport unloadVideo from '../../../util/browser/unloadVideo';\nimport { preloadImage } from '../../../util/files';\nimport * as mediaLoader from '../../../util/mediaLoader';\nimport { getProgressiveUrl } from '../../../util/mediaLoader';\nimport { makeProgressiveLoader } from '../../../util/progressiveLoader';\nimport { pause } from '../../../util/schedulers';\nimport { PRIMARY_VIDEO_MIME } from '../helpers/videoFormats';\n\nimport { checkIfStreamingSupported } from '../../../hooks/useStreaming';\n\nconst preloadedStories: Record<string, Set<number>> = {};\nconst PEER_STORIES_FOR_PRELOAD = 5;\nconst PROGRESSIVE_PRELOAD_DURATION = 1000;\nconst STREAM_PRELOAD_SIZE = 1024 * 1024 * 2; // 2 MB\n\nconst FIRST_PRELOAD_DELAY = 1000;\nconst canPreload = pause(FIRST_PRELOAD_DELAY);\n\ntype MediaHash = { hash: string; format: ApiMediaFormat; isStream?: boolean };\n\nfunction useStoryPreloader(peerIds: string[]): void;\nfunction useStoryPreloader(peerId?: string, aroundStoryId?: number): void;\nfunction useStoryPreloader(peerId?: string | string[], aroundStoryId?: number) {\n  useEffect(() => {\n    if (peerId === undefined) return;\n\n    const preloadHashes = async (mediaHashes: Array<MediaHash>) => {\n      await canPreload;\n      mediaHashes.forEach(({ hash, format, isStream }) => {\n        if (isStream) {\n          preloadStream(hash);\n          return;\n        }\n        mediaLoader.fetch(\n          hash,\n          format,\n        )\n          .then((result) => {\n            if (!result) return;\n\n            if (format === ApiMediaFormat.Progressive) {\n              preloadProgressive(result);\n            }\n            if (format === ApiMediaFormat.BlobUrl) {\n              preloadImage(result);\n            }\n          });\n      });\n    };\n\n    const peerIds = Array.isArray(peerId) ? peerId : [peerId];\n\n    peerIds.forEach((id) => {\n      const storyId = aroundStoryId || getGlobal().stories.byPeerId[id]?.orderedIds?.[0];\n      if (!storyId) return;\n      preloadHashes(getPreloadMediaHashes(id, storyId));\n    });\n  }, [aroundStoryId, peerId]);\n}\n\nfunction findIdsAroundCurrentId<T>(ids: T[], currentId: T, aroundAmount: number): T[] {\n  const currentIndex = ids.indexOf(currentId);\n  const start = Math.max(currentIndex - aroundAmount, 0);\n  const end = Math.min(currentIndex + aroundAmount, ids.length);\n  return ids.slice(start, end);\n}\n\nfunction getPreloadMediaHashes(peerId: string, storyId: number) {\n  const peerStories = selectPeerStories(getGlobal(), peerId);\n  if (!peerStories || !peerStories.orderedIds?.length) {\n    return [];\n  }\n\n  const preloadIds = findIdsAroundCurrentId(peerStories.orderedIds, storyId, PEER_STORIES_FOR_PRELOAD);\n\n  const mediaHashes: Array<MediaHash> = [];\n  preloadIds.forEach((currentStoryId) => {\n    if (preloadedStories[peerId]?.has(currentStoryId)) {\n      return;\n    }\n\n    const story = peerStories.byId[currentStoryId];\n    if (!story || !('content' in story)) {\n      return;\n    }\n\n    const isVideo = Boolean(story.content.video);\n\n    // Media\n    mediaHashes.push({\n      hash: getStoryMediaHash(story, 'full'),\n      format: isVideo ? ApiMediaFormat.Progressive : ApiMediaFormat.BlobUrl,\n      isStream: isVideo && checkIfStreamingSupported(PRIMARY_VIDEO_MIME),\n    });\n    // Thumbnail\n    mediaHashes.push({ hash: getStoryMediaHash(story), format: ApiMediaFormat.BlobUrl });\n    if (story.content.altVideos) {\n      mediaHashes.push({\n        hash: getStoryMediaHash(story, 'full', true)!,\n        format: ApiMediaFormat.Progressive,\n      });\n    }\n\n    preloadedStories[peerId] = (preloadedStories[peerId] || new Set()).add(currentStoryId);\n  });\n\n  return mediaHashes;\n}\n\nfunction preloadProgressive(url: string) {\n  const head = document.head;\n  const video = document.createElement('video');\n  video.preload = 'auto';\n  video.src = url;\n  video.muted = true;\n  video.autoplay = true;\n  video.disableRemotePlayback = true;\n  video.style.display = 'none';\n  head.appendChild(video);\n  video.load();\n  setTimeout(() => {\n    unloadVideo(video);\n    head.removeChild(video);\n  }, PROGRESSIVE_PRELOAD_DURATION);\n}\n\n// eslint-disable-next-line no-async-without-await/no-async-without-await\nasync function preloadStream(hash: string) {\n  const loader = makeProgressiveLoader(getProgressiveUrl(hash));\n  let cachedSize = 0;\n  for await (const chunk of loader) {\n    cachedSize += chunk.byteLength;\n    if (cachedSize >= STREAM_PRELOAD_SIZE) {\n      break;\n    }\n  }\n}\n\nexport default useStoryPreloader;\n","import { useEffect, useRef } from '../../../lib/teact/teact';\n\nimport useForceUpdate from '../../../hooks/useForceUpdate';\nimport useSyncEffect from '../../../hooks/useSyncEffect';\n\nexport default function useAsyncRendering<T extends any[]>(dependencies: T, delay?: number) {\n  const isDisabled = delay === undefined;\n  const shouldRenderRef = useRef(isDisabled);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n\n  useSyncEffect(() => {\n    if (isDisabled) {\n      return;\n    }\n\n    shouldRenderRef.current = false;\n\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = undefined;\n    }\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies);\n\n  useEffect(() => {\n    if (isDisabled || shouldRenderRef.current) {\n      return;\n    }\n\n    const exec = () => {\n      shouldRenderRef.current = true;\n      forceUpdate();\n    };\n\n    if (delay! > 0) {\n      timeoutRef.current = window.setTimeout(exec, delay);\n    } else {\n      exec();\n    }\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies);\n\n  return shouldRenderRef.current;\n}\n","import { pause } from './schedulers';\n\ntype PendingDownload = {\n  url: string;\n  filename: string;\n};\n\n// Chrome prevents more than 10 downloads per second\nconst LIMIT_PER_BATCH = 10;\nconst BATCH_INTERVAL = 1000;\n\nlet pendingDownloads: PendingDownload[] = [];\nlet planned = false;\n\nexport default function download(url: string, filename: string) {\n  pendingDownloads.push({ url, filename });\n  if (!planned) {\n    planned = true;\n    setTimeout(async () => {\n      await processQueue();\n      planned = false;\n    }, BATCH_INTERVAL);\n  }\n}\n\nasync function processQueue() {\n  let count = 0;\n  for (const pendingDownload of pendingDownloads) {\n    downloadOne(pendingDownload);\n    count++;\n    if (count === LIMIT_PER_BATCH) {\n      await pause(BATCH_INTERVAL);\n      count = 0;\n    }\n  }\n  pendingDownloads = [];\n}\n\nfunction downloadOne({ url, filename }: PendingDownload) {\n  const link = document.createElement('a');\n  link.href = url;\n  link.target = '_blank';\n  link.rel = 'noopener noreferrer';\n  link.download = filename;\n  try {\n    link.click();\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err); // Suppress redundant \"Blob loading failed\" error popup on IOS\n  }\n}\n","import { ApiMediaFormat } from '../api/types';\n\nimport { callApi } from '../api/gramjs';\n\nconst MB = 1024 * 1024;\nconst DEFAULT_PART_SIZE = 0.25 * MB;\nconst MAX_END_TO_CACHE = 5 * MB - 1; // We only cache the first 2 MB of each file\n\nconst bufferCache = new Map<string, ArrayBuffer>();\nconst sizeCache = new Map<string, number>();\nconst pendingRequests = new Map<string, Promise<{ arrayBuffer?: ArrayBuffer; fullSize?: number } | undefined>>();\n\nexport async function* makeProgressiveLoader(\n  url: string,\n  start = 0,\n  chunkSize = DEFAULT_PART_SIZE,\n): AsyncGenerator<ArrayBuffer, void, undefined> {\n  const match = url.match(/fileSize=(\\d+)/);\n  let fileSize;\n  if (match) {\n    fileSize = match && Number(match[1]);\n  } else {\n    fileSize = sizeCache.get(url);\n  }\n\n  while (true) {\n    if (fileSize && start >= fileSize) return;\n\n    let end = start + chunkSize - 1;\n    if (fileSize && end > fileSize) {\n      end = fileSize - 1;\n    }\n\n    // Check if we have the chunk in memory\n    const cacheKey = `${url}:${start}-${end}`;\n    let arrayBuffer = bufferCache.get(cacheKey);\n\n    if (!arrayBuffer) {\n      let request = pendingRequests.get(cacheKey);\n      if (!request) {\n        request = callApi('downloadMedia', {\n          mediaFormat: ApiMediaFormat.Progressive,\n          url,\n          start,\n          end,\n        });\n\n        pendingRequests.set(cacheKey, request);\n      }\n\n      const result = await request.finally(() => {\n        pendingRequests.delete(cacheKey);\n      });\n\n      if (!result?.arrayBuffer) return;\n\n      // If fileSize is not yet defined, retrieve it from the first chunk's response\n      if (result.fullSize && !fileSize) {\n        fileSize = result.fullSize;\n        sizeCache.set(url, result.fullSize);\n      }\n\n      // Store the chunk in memory\n      arrayBuffer = result.arrayBuffer;\n\n      // Cache the first 2 MB of each file\n      if (end <= MAX_END_TO_CACHE) {\n        bufferCache.set(cacheKey, result.arrayBuffer);\n      }\n    }\n\n    // Yield the chunk data\n    yield arrayBuffer;\n\n    start = end + 1;\n  }\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport type { OwnProps } from './MuteChatModal';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst MuteChatModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const MuteChatModal = useModuleLoader(Bundles.Extra, 'MuteChatModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return MuteChatModal ? <MuteChatModal {...props} /> : undefined;\n};\n\nexport default MuteChatModalAsync;\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport type { OwnProps } from './ChatFolderModal';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst ChatFolderModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const ChatFolderModal = useModuleLoader(Bundles.Extra, 'ChatFolderModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return ChatFolderModal ? <ChatFolderModal {...props} /> : undefined;\n};\n\nexport default ChatFolderModalAsync;\n","/* eslint-disable no-null/no-null */\nimport type { ReactNode } from 'react';\nimport { Component } from 'react';\n\ninterface ErrorBoundaryProps {\n  children: ReactNode;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n}\n\nclass ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError() {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: any, errorInfo: any) {\n    // eslint-disable-next-line no-console\n    console.error('Error caught by ErrorBoundary:', error, errorInfo);\n  }\n\n  render() {\n    const { hasError } = this.state;\n    const { children } = this.props;\n    if (hasError) {\n      return null; // \n    }\n    return children;\n  }\n}\n\nexport default ErrorBoundary;\n"],"names":["Keys","memo","MessageOutgoingStatus","status","React","createElement","className","Transition","name","activeKey","Icon","withGlobal","global","userId","chat","selectCurrentChat","user","selectUser","contactName","getUserFirstOrLastName","undefined","DeleteMemberModal","isOpen","onClose","deleteChatMember","getActions","lang","useOldLang","handleDeleteChatMember","useCallback","chatId","id","ConfirmDialog","title","textParts","renderText","confirmLabel","confirmHandler","confirmIsDestructive","IGNORE_TAGS","Set","handlers","createCallbackManager","useHotkeys","hotkeys","useEffect","entries","Object","addCallback","e","target","HTMLElement","has","tagName","shouldFireEvent","forEach","hotkey","handler","event","alt","ctrl","meta","mod","shift","key","altKey","ctrlKey","metaKey","shiftKey","pressedKey","Boolean","toLowerCase","code","replace","isExactHotkey","keys","split","map","part","trim","modifiers","includes","reservedKeys","find","parseHotkey","getHotkeyMatcher","document","documentElement","addEventListener","runCallbacks","THROTTLE","RE_ENDS_ON_EMOJI","RegExp","twemojiRegex","source","RE_ENDS_ON_EMOJI_IMG","EMOJI_IMG_REGEX","useCustomEmojiTooltip","isEnabled","getHtml","setHtml","getSelectionRange","inputRef","customEmojis","loadCustomEmojiForEmoji","clearCustomEmojiForEmoji","isManuallyClosed","markManuallyClosed","unmarkManuallyClosed","useFlag","extractLastEmojiThrottled","useThrottledResolver","html","collapsed","match","IS_EMOJI_SUPPORTED","htmlBeforeSelection","getHtmlBeforeSelection","current","getLastEmoji","useDerivedSignal","isActive","useDerivedState","hasCustomEmojis","length","lastEmoji","emoji","insertCustomEmoji","useLastCallback","inputEl","regexText","regex","count","newHtml","buildCustomEmojiHtml","repeat","htmlAfterSelection","innerHTML","substring","requestNextMutation","focusEditableElement","isCustomEmojiTooltipOpen","closeCustomEmojiTooltip","buttonVariants","cva","variants","variant","default","destructive","outline","secondary","ghost","link","size","sm","lg","icon","defaultVariants","Button","asChild","props","ref","Comp","Slot","_extends","cn","displayName","ConnectorClass","constructor","onUpdate","channel","_defineProperty","Map","throttleWithTickEnd","this","payloads","pendingPayloads","transferables","pendingTransferables","postMessage","destroy","init","args","postMessageOnTickEnd","type","request","messageData","requestStates","requestStatesByCallback","restMessageData","messageId","generateUniqueId","payload","requestState","promise","Promise","resolve","reject","assign","withCallback","callback","pop","set","catch","finally","delete","cancelCallback","progressCallback","isCanceled","get","onMessage","data","update","error","response","callbackArgs","Error","message","push","postMessagesOnTickEnd","createConnector","worker","connector","handleMessage","removeEventListener","Textarea","createIntroduceReplyMessage","timestamp","Date","getTime","content","uuidv4","createdAt","role","annotations","createIntroduceSummaryMessage","createIntroduceTranslationMessage","createIntroducePortraitMessage","createGlobalIntroduceMessage","getGlobal","getRoomLastFocusTime","roomAIData","localStorage","getItem","JSON","parse","lastFocusTime","getRoomLastSummaryId","lastSummaryId","getRoomUnreadCount","selectChat","unreadCount","getRoomAIUnreadCount","getRoomTranslateLanguage","translateLanguage","updateRoomTranslateLanguage","language","setItem","stringify","updateRoomAIData","value","parsedData","currentData","eventEmitter","emit","Actions","UpdateRoomAIUnreadCount","increaseUnreadCount","InputLanguageModal","closeInputLanguageModal","updateTranslateLanguage","search","setSearch","useState","handleSelect","langCode","handleSearch","translateLanguages","useMemo","SUPPORTED_TRANSLATION_LANGUAGES","translatedName","Intl","DisplayNames","of","originalName","filteredDisplayedLanguages","filter","Modal","isSlim","hasCloseButton","InputText","onChange","placeholder","teactExperimentControlled","buildClassName","ListItem","secondaryIcon","disabled","multiline","narrow","allowDisabledClick","onClick","highlight","InputTranslateTip","inputLanguageModalOpen","openInputLanguageModal","setTranslateLanguage","tooltipOpen","openTooltip","closeTooltip","RoomStorage","setTimeout","toUpperCase","src","aiTranslatePath","resetInput","applyIosAutoCapitalizationFix","focus","IS_IOS","classList","add","body","appendChild","RE_COMMAND","GDOCS_ELEMENT_ID_REGEXP","headers","parseHtml","DOMParser","parseFromString","wrapNodeAnchor","node","href","anchor","cloneNode","wrapNodeInline","style","el","wrapNode","inner","result","newNode","fontWeight","fontStyle","textDecoration","verticalAlign","applyInlineStyles","dirty","createTextNode","textContent","styledNode","nodeName","childNodes","getCleanNode","newWrapper","createDocumentFragment","items","i","indexOf","applyBlockStyles","nodes","filterNode","nodeType","STYLE_TAG_REGEX","VALID_TARGET_IDS","EDITABLE_INPUT_ID","EDITABLE_INPUT_MODAL_ID","EDITABLE_STORY_INPUT_ID","useClipboardPaste","insertTextAndUpdateCursor","setAttachments","setNextText","editedMessage","shouldStripCustomEmoji","onCustomEmojiStripped","showNotification","handlePaste","async","clipboardData","input","closest","preventDefault","activeElement","pastedText","getData","pastedFormattedText","parseHtmlAsFormattedText","fragment","clipboardContent","filteredNodes","Array","from","cleanNodes","getCleanDocument","err","DEBUG","console","textContents","querySelectorAll","getElementsByTagName","removeAttribute","replaceWith","dataset","entityType","getAttribute","ignoreOnPaste","remove","ENTITY_CLASS_BY_NODE_NAME","setAttribute","innerText","ApiMessageEntityTypes","MentionName","CustomEmoji","trimEnd","preparePastedHtml","containsCustomEmoji","stripCustomEmoji","files","getFilesFromDataTransferItems","slice","textToPaste","entities","text","isWordDocument","hasText","shouldSetAttachments","newAttachments","all","file","buildAttachment","canReplace","canReplaceMessageMedia","isUploadingDocumentSticker","isUploadingFileSticker","isInAlbum","groupedId","attachments","concat","isFrozen","URL_ENTITIES","TextUrl","Url","INLINE_BOT_QUERY_REGEXP","HAS_NEW_LINE","MEMO_NO_RESULT","username","query","canShowHelp","usernameLowered","tempEl","buildQueryStateMemo","memoized","STARTS_ENDS_ON_EMOJI_IMG_REGEX","POLYFILL_OPTIONS","encoderPath","URL","reuseWorker","BLOB_PARAMS","opusRecorderPromise","OpusRecorder","mediaRecorder","start","analyzerCallback","startMediaRecorder","startedAt","now","pausedAt","chunks","waveform","ondataavailable","typedArray","releaseAnalyzer","recorder","sourceNode","analyser","context","createAnalyser","fftSize","connect","dataLength","frequencyBinCount","dataArray","Uint8Array","isDestroyed","tick","getByteFrequencyData","volume","reduce","acc","cb","requestMeasure","subscribeToAnalyzer","stop","onstop","blob","Blob","duration","Math","round","onerror","delayStop","max","pause","getCorrectedText","errors","sorted","sort","a","b","offset","suggestions","suggestion","SkeletonScreen","loading","setLoading","grammarlyResult","setGrammarlyResult","fetch","method","then","json","grammarlyFormal","handleAccept","newText","HighlightedText","color","grammarlyFriendly","grammarlyCheck","grammarlyRephrase","grammarlyShorten","injectMessageAI","injectComponent","label","children","ImproveTab","RephraseTab","ShortenTab","FriendlyTab","FormalTab","Tabs","defaultActiveKey","tabPosition","isGrammarToolOpen","openGrammarTool","closeGrammarTool","containerRef","useRef","injected","unmount","captureEscKeyListener","useVirtualBackdrop","handleToggleMenu","GrammerInput","AttachmentModal","useModuleLoader","Bundles","Extra","AttachMenu","threadId","isButtonVisible","canAttachMedia","canAttachPolls","canSendPhotos","canSendVideos","canSendDocuments","canSendAudios","attachBots","peerType","isScheduled","theme","shouldCollectDebugLogs","onFileSelect","onMenuOpen","onMenuClose","onPollCreate","canEditMedia","editingMessage","messageListType","paidMessagesStars","isAttachMenuOpen","openAttachMenu","closeAttachMenu","handleMouseEnter","handleMouseLeave","markMouseInside","useMouseInside","canSendVideoAndPhoto","canSendVideoOrPhoto","isAttachmentBotMenuOpen","markAttachmentBotMenuOpen","unmarkAttachmentBotMenuOpen","isMenuOpen","isPhotoOrVideo","getMessagePhoto","getMessageWebPagePhoto","getMessageVideo","getMessageWebPageVideo","isFile","getMessageAudio","getMessageVoice","getMessageDocument","handleToggleAttachMenu","handleFileSelect","shouldSuggestCompression","validatedFiles","validateFiles","handleQuickSelect","openSystemFilesDialog","CONTENT_TYPES_WITH_PREVIEW","SUPPORTED_PHOTO_CONTENT_TYPES","SUPPORTED_VIDEO_CONTENT_TYPES","join","handleDocumentSelect","SUPPORTED_AUDIO_CONTENT_TYPES","handleSendLogs","File","getDebugLogs","DEBUG_LOG_FILENAME","bots","values","bot","isForAttachMenu","attachMenuPeerTypes","oldLang","useLang","ResponsiveHoverButton","onActivate","ariaLabel","ariaControls","hasPopup","Menu","autoClose","positionX","positionY","onCloseAnimationEnd","onMouseEnter","IS_TOUCH_ENV","onMouseLeave","noCloseOnBackdrop","ariaLabelledBy","MenuItem","Fragment","AttachBotItem","onMenuOpened","onMenuClosed","BotCommandMenu","selectCurrentMessageList","selectChatMessage","BotKeyboardMenu","clickBotInlineButton","isKeyboardSingleUse","buttonTexts","texts","keyboardButtons","row","button","renderKeyboardButtonText","noCompact","j","ripple","BotMenuButton","isDisabled","textRef","textEl","width","scrollWidth","setProperty","composerEl","removeProperty","ChatCommandTooltip","shouldForceShowEditing","forwardMessages","fromChatId","toChatId","messageIds","forwardMessageIds","noAuthors","noCaptions","isShareMessageModalShown","isModalShown","shouldPreventComposerAnimation","selectTabState","editingId","selectEditingScheduledId","selectEditingId","shouldAnimate","selectCanAnimateInterface","isForwarding","forwardedMessages","draft","selectDraft","replyInfo","replyToPeerId","senderChat","sender","selectEditingMessage","replyToMsgId","selectSender","selectForwardedSender","selectPeer","forwardInfo","isChatWithSelf","selectIsChatWithSelf","isChannelPost","hiddenUserName","quoteText","isSenderChannel","isChatChannel","forwardsHaveCaptions","some","forward","isContextMenuDisabled","storyData","isReplyToDiscussion","forwardedMessagesCount","isCurrentUserPremium","selectIsCurrentUserPremium","isInChangingRecipientMode","currentUserId","ComposerEmbeddedMessage","onClear","resetDraftReplyInfo","updateDraftReplyInfo","setEditingId","focusMessage","changeRecipient","openChatOrTopicWithReplyInDraft","setForwardNoAuthors","setForwardNoCaptions","exitForwardMode","setShouldPreventComposerAnimation","isReplyToTopicStart","action","isShowingReply","isReplyWithQuote","isShown","shouldRender","transitionClassNames","useShowTransitionDeprecated","clearEmbedded","isContextMenuOpen","contextMenuAnchor","handleContextMenu","handleContextMenuClose","handleContextMenuHide","useContextMenuHandlers","handleMessageClick","handleClearClick","stopPropagation","buildAutoCloseMenuItemHandler","handleForwardToAnotherChatClick","handleShowMessageClick","focusMessageFromDraft","noForumTopicPanel","handleRemoveQuoteClick","handleChangeReplyRecipientClick","handleReplyInSenderChat","handleDoNotReplyClick","getTriggerElement","getRootElement","getMenuElement","querySelector","renderingSender","useCurrentOrPrev","innerClassName","getPeerColorClass","leftIcon","customText","strippedMessage","strippedText","renderingLeftIcon","canReplyInSenderChat","onContextMenu","ClosableEmbeddedMessage","isInComposer","faded","customIcon","MenuSeparator","DropArea","InlineBotTooltip","MentionTooltip","PollModal","SendAsMenu","StickerTooltip","RE_LINK","RE_LINK_TEMPLATE","noWebPage","selectNoWebPage","attachmentSettings","selectTheme","webPagePreview","WebPagePreview","isEditing","loadWebPagePreview","clearWebPagePreview","toggleMessageWebPage","updateAttachmentSettings","formattedTextWithLinkRef","isInvertedMedia","isSmallerMedia","webPageMediaSize","detectLinkDebounced","useDebouncedResolver","formattedText","linkEntity","entity","url","getLink","useSyncEffect","hasMediaSizeOptions","hasLargeMedia","renderingWebPage","handleClearWebpagePreview","handlePreviewClick","updateIsInvertedMedia","updateIsLargerMedia","photo","webPageWithoutPhoto","messageStub","webPage","WebPage","inPreview","onContainerClick","MainButtonState","storyId","isMobile","chatBot","isSystemBot","selectBot","isChatWithBot","isChatWithUser","isUserId","userFullInfo","selectUserFullInfo","selectPeerPaidMessagesStars","chatFullInfo","selectChatFullInfo","messageWithActualBotKeyboard","selectNewestMessageWithBotKeyboardButtons","shouldSuggestStickers","shouldSuggestCustomEmoji","shouldUpdateStickerSetOrder","shouldPaidMessageAutoApprove","settings","byKey","selectSharedSettings","baseEmojiKeywords","emojiKeywords","BASE_EMOJI_KEYWORD_LANG","botKeyboardMessageId","keyboardMessage","currentUser","defaultSendAsId","sendAsId","sendAsPeerIds","peer","adminRights","anonymous","sendAsUser","sendAsChat","requestedDraft","selectRequestedDraft","requestedDraftFiles","selectRequestedDraftFiles","tabState","isStoryViewerOpen","storyViewer","currentMessageList","isForCurrentMessageList","canSendVoiceByPrivacy","noVoiceMessages","slowMode","editingDraft","selectEditingScheduledDraft","selectEditingDraft","story","selectPeerStory","sentStoryReaction","sentReaction","replyToMessage","replyToTopic","isForum","isForumAsMessages","MAIN_THREAD_ID","selectTopicFromMessage","isInScheduledList","canSendQuickReplies","isSilentPosting","getChatNotifySettings","selectNotifyDefaults","selectNotifyException","areEffectsSupported","SERVICE_NOTIFICATIONS_USER_ID","canPlayEffect","selectPerformanceSettingsValue","shouldPlayEffect","shouldPlayEffectInComposer","effectId","effect","availableEffectById","effectReactions","reactions","maxMessageLength","config","DEFAULT_MAX_MESSAGE_LENGTH","starsBalance","stars","balance","amount","isStarsBalanceModalOpen","starsBalanceModal","isAccountFrozen","selectIsCurrentUserFrozen","isAppConfigLoaded","availableReactions","topReactions","isOnActiveTab","isBlurred","canScheduleUntilOnline","selectCanScheduleUntilOnline","isChannel","isRightColumnShown","selectIsRightColumnShown","isSelectModeActive","selectIsInSelectMode","withScheduledButton","hasScheduledMessages","botKeyboardPlaceholder","keyboardPlaceholder","pollModal","stickersForEmoji","stickers","forEmoji","customEmojiForEmoji","topInlineBotIds","topInlineBots","userIds","contentToBeScheduled","recentEmojis","keywords","inlineBots","byUsername","isInlineBotLoading","isLoading","botCommands","botInfo","commands","botMenuButton","menuButton","attachMenu","attachMenuPeerType","selectChatType","fileSizeLimit","selectCurrentLimit","MAX_UPLOAD_FILEPART_SIZE","captionLimit","isReactionPickerOpen","selectIsReactionPickerOpen","canBuyPremium","selectIsPremiumPurchaseBlocked","canPlayAnimatedEmojis","selectCanPlayAnimatedEmojis","canSendOneTimeMedia","stealthMode","stories","quickReplyMessages","quickReplies","messagesById","byId","isContactRequirePremium","isPaymentMessageConfirmDialogOpen","shouldDisplayGiftsButton","disallowedGifts","Composer","dropAreaState","isReady","inputPlaceholder","editableInputCssSelector","editableInputId","inputId","onDropHide","onFocus","onBlur","onForward","sendMessage","clearDraft","showDialog","openPollModal","closePollModal","loadScheduledHistory","openThread","addRecentEmoji","sendInlineBotResult","loadSendAs","resetOpenChatWithDraft","callAttachBot","addRecentCustomEmoji","showAllowedMessageTypesNotification","openStoryReactionPicker","openGiftModal","closeReactionPicker","sendStoryReaction","editMessage","saveEffectInDraft","setReactionEffect","hideEffectInComposer","updateChatSilentPosting","counterRef","storyReactionRef","useSignal","isMounted","setIsMounted","useGetSelectionRange","lastMessageSendTimeSeconds","prevDropAreaState","usePreviousDeprecated","windowWidth","windowSize","isInMessageList","isInStoryViewer","canShowSendAs","isSymbolMenuForced","forceShowSymbolMenu","cancelForceShowSymbolMenu","sendMessageAction","useSendMessageAction","isInputHasFocus","markInputHasFocus","unmarkInputHasFocus","onAttachMenuOpen","onAttachMenuClose","isInlineAILoading","setIsInlineAILoading","canMediaBeReplaced","emojiSet","members","groupChatMembers","chatBotCommands","chatEmojiSetId","isSentStoryReactionHeart","isSameReaction","HEART_REACTION","processMessageInputForCustomEmoji","customEmojiNotificationNumber","requestCalendar","calendar","useSchedule","useTimeout","isChannelWithProfiles","areProfilesShown","isChatSuperGroup","shouldAnimateSendAsButtonRef","prevChatId","prevSendAsPeerIds","hasAttachments","nextText","canSendStickers","canSendGifs","canAttachEmbedLinks","canSendVoices","canSendPlainText","getAllowedAttachmentOptions","isNeedPremium","isSendTextBlocked","messagesCount","messagesInInput","starsForAllMessages","closeConfirmDialog","closeConfirmModalPayForMessage","dialogHandler","paymentMessageConfirmDialogHandler","shouldAutoApprove","setAutoApprove","setShouldPaidMessageAutoApprove","handleWithConfirmation","handleActionWithPaymentConfirmation","usePaidMessageConfirmation","hasWebPagePreview","isComposerBlocked","insertHtmlAndUpdateCursor","inInputId","selection","window","getSelection","messageInput","getElementById","rangeCount","selectionRange","getRangeAt","isSelectionInsideInput","insertHtmlInSelection","dispatchEvent","Event","bubbles","insertFormattedTextAndUpdateCursor","getTextWithEntitiesAsHtml","insertCustomEmojiAndUpdateCursor","insertNextText","shouldForceCompression","shouldForceAsFile","handleAppendFiles","onCaptionUpdate","handleClearAttachments","handleSetAttachments","openLimitReachedModal","setShouldForceAsFile","setShouldForceCompression","setShouldSuggestCompression","MEMO_EMPTY_ARRAY","newValue","attachment","getAttachmentMediaType","limit","shouldForce","isSpoiler","newAttachment","shouldSendAsSpoiler","suggestCompression","useAttachmentModal","isBotKeyboardOpen","openBotKeyboard","closeBotKeyboard","isBotCommandMenuOpen","openBotCommandMenu","closeBotCommandMenu","isSymbolMenuOpen","openSymbolMenu","closeSymbolMenu","isSendAsMenuOpen","openSendAsMenu","closeSendAsMenu","isHoverDisabled","disableHover","enableHover","startRecordingVoice","stopRecordingVoice","pauseRecordingVoice","activeVoiceRecording","currentRecordTime","recordButtonRef","mainButtonRef","startRecordTimeRef","isViewOnceEnabled","setIsViewOnceEnabled","toogleViewOnceEnabled","useVoiceRecording","setActiveVoiceRecording","setCurrentRecordTime","IS_SAFARI","IS_VOICE_RECORDING_SUPPORTED","voiceRecording","tickVolume","requestMutation","boxShadow","shouldSendRecordingStatus","useInterval","SEND_MESSAGE_ACTION_INTERVAL","isEditingRef","useStateRef","updateInlineAILoading","updataAIResponse","on","off","isAdmin","isChatAdmin","isEmojiTooltipOpen","closeEmojiTooltip","filteredEmojis","filteredCustomEmojis","insertEmoji","useEmojiTooltip","isStickerTooltipOpen","closeStickerTooltip","loadStickersForEmoji","clearStickersForEmoji","getSingleEmoji","cleanHtml","prepareForRegExp","parseEmojiOnlyString","hasStickers","singleEmoji","useStickerTooltip","isMentionTooltipOpen","closeMentionTooltip","insertMention","mentionFilteredUsers","useMentionTooltip","isInlineBotTooltipOpen","botId","inlineBotId","isGallery","isInlineBotTooltipGallery","switchPm","inlineBotSwitchPm","switchWebview","inlineBotSwitchWebview","results","inlineBotResults","closeInlineBotTooltip","help","inlineBotHelp","loadMore","loadMoreForInlineBot","queryInlineBot","resetInlineBot","resetAllInlineBots","extractBotQueryThrottled","startsWith","getPlainText","parseBotQuery","prevUsername","useInlineBotTooltip","hasQuickReplies","isChatCommandTooltipOpen","close","closeChatCommandTooltip","filteredBotCommands","botTooltipCommands","filteredQuickReplies","quickReplyCommands","setFilteredBotCommands","setFilteredQuickReplies","detectCommandThrottled","getCommand","command","nextFilteredBotCommands","c","newFilteredQuickReplies","quickReply","shortcut","useChatCommandTooltip","useDraft","saveDraft","loadCustomEmojis","isTouchedRef","isLocalDraft","isLocal","updateDraft","prevState","shouldKeepReply","runDebouncedForSaveDraft","useRunDebounced","DRAFT_DEBOUNCE","useLayoutEffectWithPrevDeps","prevThreadId","prevDraft","isTouched","customEmojiIds","documentId","ids","useLayoutEffect","chatIdRef","threadIdRef","scopedhatId","scopedThreadId","useBackgroundMode","useBeforeUnload","resetComposer","shouldPreserveInput","handleEditComplete","handleEditCancel","useEditing","setEditingDraft","openDeleteMessageModal","setShouldForceShowEditing","replyingToId","useEffectWithPrevDeps","prevEditedMessage","prevReplyingToId","EDITABLE_INPUT_CSS_SELECTOR","shouldSetNoWebPage","edited","getShouldResetNoWebPageDebounced","restoreNewDraftAfterEditing","hasMessageMedia","messageList","isSchedule","handleBlur","resetComposerRef","stopRecordingVoiceRef","areAllGiftsDisallowed","every","shouldShowGiftButton","showCustomEmojiPremiumNotification","notificationNumber","shouldReplaceHistory","actionText","initialSection","Number","mainButtonState","Edit","Schedule","Send","Record","Forward","canShowCustomSendMenu","isCustomSendMenuOpen","storyReactionPickerAnchor","handleStoryPickerContextMenu","handleBeforeContextMenu","handleBeforeStoryPickerContextMenu","handleStoryPickerContextMenuHide","peerId","position","handleEmbeddedClear","validateTextLength","isAttachmentModal","maxLength","extraLength","textParams","toString","hasErrorKey","checkSlowMode","nowSeconds","getServerTime","secondsSinceLastMessage","floor","nextSendDateNotReached","nextSendDate","seconds","secondsRemaining","formatMediaDuration","isSlowMode","blur","canSendAttachments","attachmentsToSend","sendAttachments","sendCompressed","shouldCompress","sendGrouped","shouldSendGrouped","isSilent","scheduledAt","prepareAttachmentsToSend","shouldGroupMessages","isLocalOnly","handleSendAttachmentsFromModal","handleSendAttachments","handleSendCore","currentAttachments","webPageUrl","handleSend","record","ttlSeconds","ONE_TIME_MEDIA_TTL_SECONDS","voice","callApi","toLanguageCode","log","handleSendWithConfirmation","handleClickBotMenu","parsedLink","tryParseDeepLink","appName","processDeepLink","handleActivateBotCommandMenu","handleMessageSchedule","queryId","restArgs","prevContentToBeScheduled","handleCustomEmojiSelect","emojiSetId","stickerSetInfo","isFree","handleCustomEmojiSelectAttachmentModal","handleGifSelect","gif","isScheduleRequested","handleStickerSelect","sticker","canUpdateStickerSetsOrder","isPreloadedGlobally","handleInlineBotSelect","inlineResult","handleBotCommandSelect","handlePollSend","poll","sendSilent","additionalArgs","handleSendAsMenuOpen","insertTextAndUpdateCursorAttachmentModal","removeSymbol","execCommand","tempInput","contentEditable","left","top","element","lastChild","textLength","range","createRange","setStart","setEnd","removeAllRanges","addRange","removeChild","deleteLastCharacterOutsideSelection","removeSymbolAttachmentModal","handleAllScheduledClick","handleGiftClick","forUserId","handleToggleSilentPosting","localId","withBotMenuButton","isBotMenuButtonOpen","timedPlaceholderLangKey","timedPlaceholderDate","activeUntil","isComposerHasFocus","isReactionSelectorOpen","formatStarsAsIcon","asFont","withNodes","topic","shouldRenderReactionSelector","reactionSelectorTransitonClassNames","areVoiceMessagesNotAllowed","mainButtonHandler","scheduledDefaultDate","setSeconds","setMilliseconds","scheduledMaxDate","setFullYear","getFullYear","sendButtonAriaLabel","fullClassName","handleToggleReaction","reaction","emoticon","customEmojiMessage","isReaction","handleToggleEffectReaction","handleReactionPickerOpen","sendAsMessage","handleLikeStory","containerId","getStoryKey","handleSendScheduled","handleSendSilent","handleSendWhenOnline","SCHEDULED_WHEN_ONLINE","handleSendScheduledAttachments","handleSendSilentAttachments","handleRemoveEffect","handleStopEffect","onSend","withBotCommands","effectEmoji","shouldRenderPaidBadge","DropAreaState","None","withQuick","QuickFile","onHide","ReactionSelector","allAvailableReactions","onToggleReaction","isPrivate","isInSavedMessages","onShowMore","isForMessage","shouldSchedule","canSchedule","forceDarkTheme","onSendSilent","onSendScheduled","onFileAppend","onAttachmentsUpdate","onCustomEmojiSelect","onRemoveSymbol","onEmojiSelect","onSendWhenOnline","isQuiz","shouldBeAnonymous","selectedSendAsId","filteredUsers","onInsertUserName","withUsername","self","height","x","y","filterUnits","dy","in","stdDeviation","fill","d","isSavedMessages","onSelectResult","Avatar","SymbolMenuButton","isMessageComposer","onGifSelect","onStickerSelect","inputCssSelector","idPrefix","MessageInput","customEmojiPrefix","isStoryInput","forcedPlaceholder","canAutoFocus","noFocusInterception","shouldSuppressFocus","shouldSuppressTextFormatter","onSuppressedFocus","Spinner","slideClassName","direction","formatVoiceRecordDuration","GrammarToolWrapper","InputTranslate","CustomEmojiTooltip","EmojiTooltip","emojis","onMouseDown","ReactionAnimatedEmoji","getReactionKey","withEffectOnly","noFastClick","nonInteractive","pill","fluid","AnimatedCounter","number","MessageEffect","shouldPlay","onStop","CustomSendMenu","onSendSchedule","onRemoveEffect","withEffects","hasCurrentEffect","PaymentMessageConfirmDialog","userName","getPeerTitle","messagePriceInStars","SerenaIcon","item","GlobalIntroduceMessage","mutate","useSWRConfig","firstName","lastName","sendSmmaryIntroduceMessage","ChataiStores","summary","storeMessage","AddSummaryMessage","sendPortraitIntroduceMessage","sendTranslationIntroduceMessage","sendSmartreplyIntroduceMessage","activeId","listeners","useSpeechPlayer","isSpeaking","setIsSpeaking","localUtteranceRef","playing","speak","options","speechSynthesis","speaking","pending","cancel","utterance","SpeechSynthesisUtterance","onend","fn","CustomizationTopicIcon","VectorIcon","UserGroupIcon","KeyBusinessIcon","ChainTrendIcon","ChatAvatar","classNames","SummaryTopicItem","topicItem","index","summaryItems","openDrawer","useDrawerStore","ErrorBoundary","summaryItem","relevantMessageIds","showMessageDetail","DrawerKey","OriginalMessages","relevantMessages","SummaryPenddingItem","pendingItem","CheckIcon","SummaryGarbageItem","garBageItem","chatRoomName","level","ActionsItems","summaryInfo","mainTopic","pendingMatters","deleteMessage","handleCopy","summaryStartTime","summaryEndTime","copyText","formatTimestampRange","subItem","copy","CopyIcon","VoiceingIcon","handleVoicePlay","voiceText","VoiceIcon","DeleteIcon","SummaryInfoContent","SerenaLogoPath","formatTimestamp","CalendarIcon","MessageIcon","summaryMessageCount","summaryChatIds","UserIcon","zIndex","String","MainSummaryContent","customizationTemplate","customizationTopic","WriteIcon","ActionsIcon","SummaryContent","garbageMessage","setSummaryInfo","setCustomizationTemplate","setCustomizationTopic","setMainTopic","setPendingMatters","setGarbageMessage","parseMessage","messageContent","messageObj","FormLabel","setTitle","setIcon","lable","GoogleMeetIcon","ErrorTip","EmailItem","email","onDelete","DefaultAvatar","CloseIcon","GoogleEventCreateMessage","disabledDate","dayjs","startOf","RangePicker","DatePicker","setEmail","startDate","setStartDate","endDate","setEndDate","emails","setEmails","emailError","setEmailError","dateError","setDateError","titleError","setTitleError","selectedTimezone","setSelectedTimezone","DateTimeFormat","resolvedOptions","timeZone","themeKey","validateEmail","test","handleTitleChange","handleTimeZoomChange","handleTimeChange","dates","dateStrings","handleEmailChange","handleEmailComplete","emailStr","prev","handleEmailEnter","currentTarget","handleDeleteEmail","handleSubmit","googleToken","CHATAI_IDB_STORE","attendees","dateTime","end","reminders","useDefault","overrides","minutes","conferenceData","createRequest","requestId","conferenceSolutionKey","Authorization","res","CreateCalendarSuccess","ConfigProvider","algorithm","darkAlgorithm","defaultAlgorithm","Input","presets","endOf","showTime","format","TimezoneSelect","onPressEnter","htmlType","GoogleEventDetailMessage","setMessageContent","parsedMessage","attendee","hangoutLink","GoogleLoginAuthMessage","updateToken","accessToken","UpdateGoogleToken","token","GoogleAuthSuccess","handleLogin","loginWithGoogle","GoogleIcon","GroupSearchMessage","chatIds","setChatIds","splice","membersCount","getChatTitle","openChat","handleClick","renderChatAvatar","listStyle","IntroducePortraitMessage","PortraitBg","IntroduceSmartreplyMessage","SmartReplyBg","IntroduceSummaryMessage","SummaryBg","IntroduceTranslationMessage","ActionInfoContent","summaryTime","messageCount","actionItemClassName","RoomAIDescriptionMessage","messages","urgentMessage","setUrgentMessage","DangerIcon","UserSearchMessage","senderIds","setSenderIds","getUserFullName","components","inline","pre","ol","li","ul","strong","rel","h1","h2","h3","h4","h5","h6","remarkPlugins","remarkGfm","NonMemoizedMarkdown","ReactMarkdown","Markdown","prevProps","nextProps","MessageReasoning","reasoning","isExpanded","setIsExpanded","LoaderIcon","ChevronDownIcon","AnimatePresence","initial","motion","div","animate","exit","opacity","marginTop","marginBottom","expanded","transition","ease","PreviewAttachment","isUploading","contentType","isAuto","isOwn","isOwnMessage","waveformCanvasRef","useWaveformCanvas","imgBlobUrl","useMedia","getPhotoMediaHash","ApiMediaFormat","BlobUrl","fullMediaData","blobUrl","forcedWidth","thumbnail","withBlurredBackground","onPreviewClick","openMediaViewer","origin","MediaViewerOrigin","Inline","withDynamicLoading","AIRoomBubble","audio","getTitle","fileName","draggable","dir","renderMessageContent","ThinkingMessage","errorMsg","highlights","contentItem","SerenaPath","renderSummary","AppendixIcon","fillRule","replys","reply","saveReplyDraft","currentChat","onReplyClick","AIMessageType","DefaultMessage","experimental_attachments","PurePreviewMessage","messageType","matched","Default","GlobalSummary","GlobalSummaryMessage","UrgentCheck","UrgentCheckMessage","GroupSearch","UserSearch","GoogleAuth","GoogleEventInsert","GoogleEventDetail","RoomSummary","RoomSummaryMessage","RoomActions","RoomActionMessage","SmartreplyIntroduce","SummaryIntroduce","TranslationIntroduce","PortraitIntroduce","GlobalIntroduce","RoomAIDescription","AISearchSugesstion","AISearchSugesstionsMessage","AIReplyMention","ReplyMentionMessage","AIMediaSummary","RoomAIMediaMessage","PreviewMessage","equal","toolInvocations","delay","cx","LoadingIcon","PureMessages","hasMore","upLoadRef","anchorRef","messagesContainerRef","endRef","messagesEndRef","onViewportEnter","onViewportLeave","isAtBottom","scrollToBottom","setIsAtBottom","useSWR","fallbackData","scrollBehavior","setScrollBehavior","scrollIntoView","behavior","useScrollToBottom","hasScrollToBottom","hasSentMessage","setHasSentMessage","container","maxAttempts","interval","lastScrollHeight","scrollHeight","attempts","requestAnimationFrame","scrollUntilStable","useMessages","onScroll","handleScroll","scrollTop","firstChild","block","isAuxiliary","Messages","RE_USERNAME_SEARCH","setFilteredUsers","extractUsernameTagThrottled","getUsernameTag","getWithInlineBots","usernameTag","usersById","users","memberIds","member","filteredIds","filterPeersByQuery","unique","pickTruthy","forceFocus","usernames","mainUsername","getMainUsername","userFirstOrLastName","htmlToInsert","fixedHtmlBeforeSelection","cleanWebkitNewLines","atIndex","lastIndexOf","shiftCaretPosition","substr","caretPosition","getCaretPosition","newCaretPosition","setCaretPosition","useOrderDiff","orderedIds","orderById","prevOrderById","orderDiffById","mapValues","order","getAnimationType","useChatAnimationType","OFFSET_X","REM","useOverlayPosition","overlayRef","isMirrored","isForMessageEffect","updatePosition","anchorRect","getBoundingClientRect","elementRect","innerWidth","anchorCenterY","anchorBottomY","bottom","right","messagesContainer","passive","MAX_NESTING_PARENTS","commonAncestorContainer","parentNode","iterations","parentElement","useForumPanelRender","isForumPanelOpen","shouldRenderForumPanelRef","isAnimationStartedRef","forceUpdate","useForceUpdate","handleForumPanelAnimationEnd","handleForumPanelAnimationStart","shouldRenderForumPanel","isAnimationStarted","WebPageUniqueGift","gift","observeIntersectionForLoading","observeIntersectionForPlaying","stickerRef","backdrop","model","pattern","getGiftAttributes","backgroundColors","centerColor","edgeColor","RadialPatternBackground","patternColor","patternIcon","StickerView","noAvatars","canAutoLoad","canAutoPlay","asForwarded","isDownloading","isProtected","isConnected","backgroundEmojiId","shouldWarnAboutSvg","autoLoadFileMaxSizeMb","lastPlaybackTimestamp","onMediaClick","onDocumentClick","onAudioPlay","onCancelMediaTransfer","openUrl","openTelegramLink","getMessageWebPage","useAppLayout","stickersRef","handleMediaClick","handleContainerClick","handleOpenTelegramLink","useEnsureStory","hasCustomColor","isWithTextColor","documents","shouldUseTextColor","customColor","useDynamicColorListener","linkTimestamp","siteName","displayUrl","description","video","mediaSize","isStory","isGift","quickButtonLangKey","getWebpageButtonLangKey","isEmoji","quickButtonTitle","truncatedDescription","trimText","isArticle","isSquarePhoto","calculateMediaDimensions","media","isOutgoing","isInWebPage","isMediaInteractive","PeerColorWrapper","isRtl","EmojiIconBackground","emojiDocumentId","BaseStory","isPreview","shouldSkipModal","SafeLink","Photo","observeIntersection","onCancelUpload","Video","Audio","AudioOrigin","onPlay","Document","shouldLoop","caption","isRectangular","noForcedUpperCase","VISIBLITY_MARGIN","DURATION","SnapEffectContainer","styles","root","SNAP_EFFECT_CONTAINER_ID","animateSnap","selectCanAnimateSnapEffect","rect","scrollX","scrollY","innerHeight","seed","filterId","SNAP_EFFECT_ID","component","viewBox","smallestSide","baseSeed","xmlns","SVG_NAMESPACE","baseFrequency","numOctaves","slope","intercept","attributeName","dur","in2","operator","scale","xChannelSelector","yChannelSelector","createFilter","min","elementContainer","svg","jsxToHtml","foreignObject","computedStyle","getComputedStyle","clone","getPropertyValue","snapContainer","once","getSingularPaidMedia","extendedMedia","singularMedia","accumulate","list","initValue","accumulator","calculateContainerSize","layout","dimensions","sides","calculateAlbumLayout","album","ratios","isSingleMessage","paidMedia","getMessageContent","getRatios","isPaidMedia","proportions","ratio","getProportions","averageRatio","getAverageRatio","albumCount","forceCalc","maxWidth","getAvailableWidth","params","minWidth","maxHeight","spacing","originalRatios","clamp","cropRatios","pushAttempt","lineCounts","heights","currentCount","multiHeight","attemptCount","sum","first","second","third","fourth","optimalAttempt","optimalDiff","lineCount","totalHeight","bad1","bad2","line","diff","abs","optimalCounts","optimalHeights","rowCount","colCount","lineHeight","col","layoutWithComplexLayouter","AlbumRectPart","layoutTwoTopBottom","layoutTwoLeftRightEqual","minimalWidth","secondWidth","firstWidth","layoutTwoLeftRight","layoutTwo","firstHeight","thirdHeight","secondHeight","rightWidth","leftWidth","layoutThreeLeftAndOther","layoutThreeTopAndOther","layoutThree","w","h0","h","w0","w2","w1","layoutFourTopAndOther","layoutFourLeftAndOther","layoutFour","containerStyle","initializationDeferred","Deferred","IS_TRANSLATION_SUPPORTED","Worker","CHAT_STATS","throttledMakeChatDecision","throttle","updateChatDetectedLanguage","chatStats","messagesChecked","translatableCount","detectableCount","languageOccurrences","metadata","isTranslatable","detectedLanguage","occurrences","QUICK_REACTION_AREA_WIDTH","QUICK_REACTION_AREA_HEIGHT","GROUP_MESSAGE_HOVER_ATTRIBUTE","useOuterHandlers","selectMessage","isInSelectMode","canReply","isContextMenuShown","quickReactionRef","shouldHandleMouseLeave","getIsMessageListReady","sendDefaultReaction","isQuickReactionVisible","markQuickReactionVisible","unmarkQuickReactionVisible","isSwiped","markSwiped","unmarkSwiped","doubleTapTimeoutRef","handleMouseMove","useThrottledCallback","quickReactionContainer","clientX","clientY","quickReactionX","quickReactionWidth","quickReactionY","quickReactionHeight","isVisibleX","isVisibleY","captureEvents","selectorToPreventScroll","excludedClosestSelector","onSwipe","SwipeDirection","Left","onRelease","handleMouseDown","preventMessageInputBlur","clearInterval","IS_ANDROID","contains","getIsKeyboardVisible","handleTap","stopEvent","matches","handleDoubleClick","quoteOffset","handleContentDoubleClick","handleSendQuickReaction","lastGroupElement","getLastElementInDocumentGroup","handleDocumentGroupMouseLeave","handleDocumentGroupMouseEnter","nextElementSibling","EmbeddedStory","noUserColors","isIntersecting","useIsIntersecting","isFullStory","isExpiredStory","isVideoStory","mediaBlobUrl","getStoryMediaHash","mediaThumbnail","dataUri","pictogramUrl","senderTitle","handleFastClick","useFastClick","peerColor","shouldReset","srcUrl","getPictogramDimensions","renderPictogram","TOPIC_ICON_SIZE","TopicChip","getTopicColorCssVariable","iconColor","TopicIcon","blankSrc","isClosed","withSelectControl","WrappedComponent","ownProps","clickArg","noSelectControls","isSelected","selectIsMessageSelected","toggleMessageSelection","handleMessageSelect","withShift","newProps","dims","PhotoWithSelect","VideoWithSelect","activeDownloads","selectActiveDownloads","uploadsByKey","fileUploads","byMessageKey","Album","hasCustomAppendix","albumLayout","cancelUploadMedia","mainMessage","mediaCount","handlePaidMediaClick","handleAlbumMessageClick","handleCancelUpload","containerWidth","containerHeight","renderingPaidMedia","paidPhotoOrPreview","paidVideoOrPreview","fileUpload","getMessageKey","uploadProgress","progress","selectCanAutoLoadMedia","selectCanAutoPlayMedia","shouldAffectAppendix","getMessageHtmlId","mediaType","getIsDownloading","SIZE","useAnimatedEmoji","soundId","activeEmojiInteractions","preferredSize","interactWithAnimatedEmoji","sendEmojiInteraction","sendWatchingEmojiInteraction","audioRef","soundMediaData","buildStyle","IS_ELECTRON","interactions","startedInteractions","sendInteractionBunch","play","safePlay","startSize","isReversed","performance","interactionMessageId","customEmojiId","selectAnimatedEmojiEffect","selectAnimatedEmojiSound","noPlay","AnimatedCustomEmoji","getCustomEmojiSize","LIKE_STICKER_ID","isBig","withSharedAnimation","forceOnHeavyAnimation","selectAnimatedEmoji","AnimatedEmoji","forceLoadPreview","AnimatedIconFromSticker","quality","noLoad","forcePreview","forceAlways","CommentButton","isCustomShape","threadInfo","asActionButton","openFrozenAccountModal","shouldRenderLoading","useAsyncRendering","originMessageId","lastMessageId","lastReadInboxMessageId","recentReplierIds","originChannelId","isComments","recentRepliers","hasUnread","commentsText","s","formatIntegerCompact","tabIndex","getContactName","contact","countryList","phoneCodes","phoneCodeList","Contact","openAddContactDialog","openChatWithInfo","phoneNumber","isRegistered","canAddContact","getCanAddContact","handleOpenChat","handleAddContact","copyTextToClipboard","emojiIconClassName","formatPhoneNumberWithCode","isText","ContextMenuContainer","COLOR","FactCheck","factCheck","isToggleDisabled","cutoutRef","isCollapsed","isCollapsible","setIsCollapsed","useCollapsibleLines","countryLocalized","countryCode","canExpand","handleExpand","handleToggle","renderTextWithEntities","Separator","Game","canAutoLoadMedia","game","photoHash","getGamePreviewPhotoHash","videoHash","getGamePreviewVideoHash","photoBlobUrl","videoBlobUrl","handleGameClick","inlineButtons","Skeleton","playsInline","muted","disablePictureInPicture","autoPlay","loop","getMessageText","giveaway","channelIds","giftSticker","selectGiftStickerForDuration","months","Giveaway","isLoadingInfo","giveawayInfo","setGiveawayInfo","giveawayResults","isResults","untilDate","prizeDescription","quantity","winnersCount","hasEnded","translatedNames","countries","isoToEmoji","handlePeerClick","channelId","handleShowInfoClick","handleCloseInfo","giveawayInfoTitle","AnimatedIconWithPreview","tgsUrl","LOCAL_TGS_URLS","PartyPopper","noLoop","winnerIds","PeerChip","forceShowSelf","withPeerColors","renderGiveawayResultsDescription","formatDateTimeToString","renderGiveawayDescription","isOnlyConfirm","isResultsInfo","chatTitle","isApiPeerChat","formatDateAtTime","otherChannelsCount","otherChannelsString","isSeveral","firstKey","giveawayDuration","firstParagraph","additionalPrizes","secondKey","secondParagraph","activatedCount","isRefunded","isWinner","lastParagraph","disallowedCountry","adminDisallowedChatId","disallowedChat","chats","disallowedChatTitle","joinedTooEarlyDate","isParticipating","renderGiveawayInfo","InlineButtons","RE_TME_LINK","renderIcon","Invoice","invoice","getMessageInvoice","currency","isTest","photoUrl","getWebDocumentHash","blurredBackgroundRef","useBlurredMediaThumbRef","prevShouldAffectAppendix","contentEl","MESSAGE_CONTENT_SELECTOR","getCustomAppendixBg","appendixBg","CUSTOM_APPENDIX_ATTRIBUTE","crossOrigin","forceAspectRatio","formatCurrency","iconClassName","InvoiceMediaPreview","openInvoice","loadExtendedMedia","refreshExtendedMedia","isExtendedMedia","MediaSpoiler","thumbDataUri","isVisible","spoiler","buy","lock","formatCurrencyAsString","TIMER_CIRCUMFERENCE","TIMER_RADIUS","PI","MOVE_THRESHOLD","DEFAULT_MAP_CONFIG","zoom","PinSvg","cy","r","Location","openMapModal","countdownRef","location","getMessageLocation","geo","serverTime","isExpired","isGeoLiveExpired","secondsBeforeEnd","date","period","point","setPoint","shouldRenderText","dpr","useDevicePixelRatio","mediaHash","buildStaticMapHash","prevMediaBlobUrl","mapBlobUrl","accuracyRadiusPx","accuracyRadius","lat","getMetersPerPixel","updateCountdown","countdownEl","svgEl","lastElementChild","timerEl","firstElementChild","timeLeft","strokeDashOffset","formatCountdownShort","long","geoPoint","pinClassName","heading","getVenueColor","venueType","iconSrc","getVenueIconUrl","mapPin","renderPin","renderOverlay","address","formatLocationLastUpdate","editDate","transform","renderInfo","MessageMeta","outgoingStatus","signature","withReactionOffset","repliesThreadInfo","renderQuickReactionButton","noReplies","isTranslated","isPinned","withFullDate","onTranslationClick","onEffectClick","onOpenThread","paidMessageStars","isActivated","markActivated","handleImportedClick","dateTitle","createDateTime","timeFormat","editDateTime","isEdited","forwardedDateTime","savedDate","viewsTitle","viewsCount","pluralValue","forwardsCount","repliesTitle","time","formatTime","formatPastTimeShort","isImported","containerClassName","isVideoProcessingPending","MessagePhoneCall","phoneCall","requestMasterAndRequestCall","isVideo","reason","isMissed","isCancelled","handleCall","formattedDuration","formatTimeDuration","timeFormatted","ARE_CALLS_SUPPORTED","getCallMessageKey","PaidMediaOverlay","isClickable","isBought","buttonText","starsAmount","replaceWithTeact","STARS_ICON_PLACEHOLDER","StarIcon","getPercentage","total","toFixed","PollOption","answer","voteResults","totalVoters","maxVotersCount","correctResults","option","correctAnswer","showIcon","isChosen","answerPercent","votersCount","finalPercent","setFinalPercent","lineWidth","isAnimationDoesNotStart","lineStyle","Poll","onSendVote","loadMessage","openPollResults","requestConfetti","isSubmitting","setIsSubmitting","chosenOptions","setChosenOptions","wasSubmitted","setWasSubmitted","closePeriod","setClosePeriod","closed","closeDate","timerCircleRef","hasVoted","canVote","canViewResult","isPublic","isMultiple","multipleChoice","recentVoterIds","isCorrect","answers","hidden","quiz","chosen","timer","clearTimeout","recentVoters","handleRadioChange","handleCheckboxChange","handleVoteClick","handleViewResultsClick","showSolution","solution","solutionEntities","containerSelector","question","getPollTypeString","AvatarList","peers","CheckboxGroup","loadingOptions","isRound","RadioGroup","loadingOption","getReadableVotersCount","Sticker","withEffect","onStopEffect","openStickerSet","effectRef","hasEffect","getStickerMediaHash","IS_WEBM_SUPPORTED","canLoad","canPlay","mediaHashEffect","effectBlobUrl","isPlayingEffect","startPlayingEffect","stopPlayingEffect","handleEffectEnded","shouldRenderEffect","openModal","isMemojiSticker","getStickerDimensions","fullMediaHash","fullMediaClassName","Portal","AnimatedSticker","isLowPriority","onEnded","connectionState","lastReadId","selectPeerStories","targetUser","isUnread","openStoryViewer","isSinglePeer","isSingleStory","isDeleted","isLoaded","imageHash","thumbUrl","isSelf","QUICK_REACTION_SIZE","EXTRA_SPACE_FOR_REACTIONS","focusedMessage","activeReactions","loadingThread","withSenderName","withAvatar","isLastInDocumentGroup","isFirstInGroup","viaBotId","transcriptionId","viaBusinessBotId","isSystemBotChat","isAnonymousForwards","isAnonymousForwardsChat","isGroup","isChatGroup","webPageStoryData","webPageStory","forceSenderName","isAnonymousOwnMessage","canShowSender","originSender","botSender","senderAdminMember","adminMembersById","isThreadTop","replyFrom","getMessageReplyInfo","storyReplyPeerId","storyReplyId","getStoryReplyInfo","shouldHideReply","replyMessage","selectReplyMessage","forwardHeader","replyMessageSender","selectSenderFromHeader","replyMessageForwardSender","replyMessageChat","isReplyPrivate","isChatPublic","isNotJoined","isRestricted","replyStory","storySender","selectUploadProgress","isFocused","m","selectIsMessageFocused","focusDirection","noHighlight","noFocusHighlight","isResizingContainer","quote","focusedQuote","focusedQuoteOffset","scrollTargetPosition","middleSearch","selectCurrentMiddleSearch","isHashtag","getMessageSingleRegularEmoji","animatedEmoji","animatedCustomEmoji","getMessageSingleCustomEmoji","selectCanReplyToMessage","downloadableMedia","getMessageDownloadableMedia","selectThreadInfo","commentsMessage","isInDocumentGroup","documentGroupFirstMessageId","selectMessageIdsByGroupId","reactionMessage","hasUnreadReaction","unreadReactions","hasTopicChip","messageTopic","chatTranslations","selectChatTranslations","requestedTranslationLanguage","selectRequestedMessageTranslationLanguage","requestedChatTranslationLanguage","selectRequestedChatTranslationLanguage","areTranslationsEnabled","canTranslate","hasActiveReactions","isPremium","senderBoosts","boostsApplied","chatLevel","boostLevel","transcribeMinLevel","appConfig","groupTranscribeLevelMin","viaBusinessBot","selectPollFromMessage","maxTimestamp","selectMessageTimestampableDuration","selectMessageLastPlaybackTimestamp","hasTranslation","selectMessageTranslations","autoTranslate","selectIsMessageProtected","isChatProtected","selectIsChatProtected","isRepliesChat","isGroupSelected","selectIsDocumentGroupSelected","isPinnedList","canAutoPlayMedia","shouldLoopStickers","selectShouldLoopStickers","defaultReaction","isMessageLocal","selectDefaultReaction","isTranscribing","transcriptions","isPending","transcribedText","shouldDetectChatLanguage","selectShouldDetectChatLanguage","hasLinkedChat","linkedChatId","withAnimatedEffects","isLoadingComments","isCommentsInfo","loadingChatId","loadingMessageId","selectOutgoingStatus","tags","savedReactionTags","canTranscribeVoice","Message","observeIntersectionForBottom","noComments","appearanceOrder","isJustAdded","isLastInGroup","isFirstInDocumentGroup","isLastInList","memoFirstUnreadIdRef","onIntersectPinnedMessage","disableContextMenuHint","animateUnreadReaction","focusLastMessage","markMentionsRead","requestMessageTranslation","bottomMarkerRef","isTranscriptionHidden","setTranscriptionHidden","isPlayingSnapAnimation","setIsPlayingSnapAnimation","isPlayingDeleteAnimation","setIsPlayingDeleteAnimation","requestEffect","hideEffect","isTouchScreen","useOnIntersect","contextMenuTarget","noAppearanceAnimation","markShown","MESSAGE_APPEARANCE_DELAY","useShowTransition","noMountTransition","isTranscriptionError","useUnmountCleanup","viewportPinnedIdsToRemove","hasMessageReply","isReplyToMessage","paidMediaPhoto","paidMediaVideo","messageReplyInfo","storyReplyInfo","withVoiceTranscription","hasStoryReply","hasThread","getMessageCustomShape","hasAnimatedEmoji","hasReactions","areReactionsEmpty","isLinkedChannelPost","isMention","canShowSenderBoosts","isStoryMention","isRoundVideo","isAlbum","msg","isInDocumentGroupNotFirst","isInDocumentGroupNotLast","canShowActionButton","canForward","isForwardingAllowed","canFocus","fromMessageId","hasFactCheck","hasForwardedCustomShape","hasSubheader","childMessageIds","messageSender","avatarPeer","messageColorPeer","senderPeer","hasTtl","hasMessageTtl","handleSenderClick","handleViaBotClick","handleReplyClick","handleDocumentClick","handleAudioPlay","handleAlbumMediaClick","handlePhotoMediaClick","handleVideoMediaClick","handleMetaClick","handleTranslationClick","handleOpenThread","handleReadMedia","handleVoteSend","handleGroupForward","handleForward","handleFocus","handleFocusForwarded","handleDocumentGroupSelectAll","handleTopicChipClick","handleStoryClick","isTranslatingChat","openAudioPlayer","markMessagesRead","sendPollVote","openForwardMenu","openChatLanguageModal","searchChatMediaMessages","replyToTopId","isQuote","channelPostId","focusMessageId","replyMessageId","ScheduledInline","openMediaViewerWithPhotoOrVideo","currentMediaMessageId","videoContent","webpageTimestamp","isGif","albumMessageId","albumIndex","mediaIndex","ScheduledAlbum","originalChatId","savedFromPeerId","groupedChatId","selectWithGroupedId","useInnerHandlers","handleEffectClick","isPartialAlbumDelete","isDeleting","textMessage","hasMultipleCaptions","captionMessage","hasTextContent","hasMessageText","hasUnreadMention","getIsReady","setLanguage","threshold","detectLanguage","useTextLanguage","LimitedMap","previousMetadata","processMessageMetadata","useDetectChatLanguage","shouldTranslate","isMessageTranslatable","isTranslationPending","translatedText","useMessageTranslation","previousTranslatedText","currentTranslatedText","isMediaWithCommentButton","withCommentButton","withQuickReactionButton","hasOutsideReactions","contentClassName","hasCommentCounter","hasCommentButton","hasActionButton","isGeoLiveActive","peerColorClass","isInvertibleMedia","MESSAGE_CONTENT_CLASS_NAME","isMedia","isMediaWithNoText","hasInlineKeyboard","isViaBot","hasFooter","emojiOnlyCount","EMOJI_SIZES","buildContentClassName","withAppendix","emojiSize","paidMessageStarsInMeta","metaPosition","reactionsPosition","quickReactionPosition","useEnsureMessage","useFocusMessage","elementRef","viaBusinessBotTitle","getPeerFullTitle","canShowPostAuthor","senderId","postAuthorTitle","useMessageResizeObserver","bottomMarker","isElementInViewport","unreadMentionIds","extraPadding","sizeCalculations","calculatedWidth","contentWidth","reactionsMaxWidth","noMediaCorners","previewWidth","previewHeight","calculateDimensionsForMessageMedia","fromOwnMessage","MIN_MEDIA_WIDTH_WITH_TEXT","getMinMediaWidth","renderMessageText","isForAnimation","MessageText","messageOrStory","withTranslucentThumbs","canBeEmpty","ReactionStaticEmoji","renderReactionsAndMeta","Reactions","metaChildren","noRecentReactors","renderWebPage","renderInvertibleMediaContent","messageText","shouldRenderSenderName","renderForwardTitle","renderSenderName","shouldSkipRenderForwardTitle","shouldSkipRenderAdminTitle","senderEmojiStatus","emojiStatus","senderIsPremium","shouldRenderForwardAvatar","hasBotSenderUsername","senderColor","loopLimit","EMOJI_STATUS_LOOP_LIMIT","fakeType","FakeIcon","customTitle","isOwner","forwardAuthor","onCopy","onDoubleClick","onMouseMove","textContentClass","shouldReadMedia","EmbeddedMessage","forwardSender","RoundVideo","onReadMedia","onHideTranscription","isTranscribed","canTranscribe","isSelectable","canDownload","Story","StoryMention","DotAnimation","footerClass","hasContentAfterText","isMetaInText","renderInvertedMediaContent","renderContent","MessageAppendix","isOutside","targetHref","isSynced","userStatus","selectUserStatus","areMessagesLoaded","selectChatMessages","PrivateChatInfo","customPeer","typingStatus","avatarSize","statusIcon","withDots","withMediaViewer","withStory","withFullInfo","withUpdatingStatus","emojiStatusSize","noStatusOrTyping","noEmojiStatus","noFake","noVerified","noRtl","isSavedDialog","adminMember","storyViewerOrigin","onEmojiStatusClick","iconElement","rightElement","loadFullUser","loadMoreProfilePhotos","hasAvatarMediaViewer","isPreload","useIntervalForceUpdate","handleAvatarViewerOpen","hasMedia","isAvatarView","ProfileAvatar","MiddleHeaderAvatar","storyViewerMode","FullNameTitle","withEmojiStatus","subtitleKey","TypingStatus","translatedStatus","getUserStatus","mainUserNameClassName","isUserOnline","renderStatusOrTyping","RippleEffect","RE_BR","RE_SPACE","RE_CLEAN_HTML","RE_EXTRA_NEW_LINE","isStarsBalanceModeOpen","isWaitingStarsTopup","setIsWaitingStarsTopup","confirmPaymentHandlerRef","closePaymentMessageConfirmDialogOpen","handleStarsTopup","openStarsBalanceModal","topup","balanceNeeded","purpose","PAID_MESSAGES_PURPOSE","openPaymentMessageConfirmDialogOpen","setPaidMessageAutoApprove","loadPeerStoriesByIds","loadStoryThrottled","throttled","storyIds","inputs","twMerge","clsx","isSameDay","toDateString","isSameYear","timePart","getHours","padStart","getMinutes","month","getMonth","day","getDate","normalizeTimestamp","ts","isToday","d2","d1","pad","n","formatDate","POLLING_INTERVAL","PEER_LAST_POLLING_TIME","PEER_ID_QUEUE","loadFromQueue","queue","queueToLoad","otherQueue","LIMIT_PER_REQUEST","loadStoriesMaxIds","peerIds","usePeerStoriesPolling","pollablePeerIds","lastPollingTime","isStatusAvailable","isContact","isUserBot","isSupport","usePrevDuringAnimation","timeoutRef","isCurrentPresent","isPrevPresent","ChatBadge","topics","isMuted","shouldShowOnlyMostImportant","wasTopicOpened","forceHidden","hasMiniApp","requestMainWebView","unreadMentionsCount","unreadReactionsCount","isTopicUnopened","topicsWithUnread","shouldBeUnMuted","notifySettings","mutedUntil","isEveryUnreadMuted","hasUnreadMark","isSignal","handleOpenApp","extractCurrentThemeParams","ShowTransition","isCustom","unreadReactionsElement","unreadMentionsElement","unopenedTopicElement","unreadCountElement","pinnedElement","miniAppButton","visiblePinnedElement","elements","formatUsername","asAbsoluteLink","TME_LINK_PREFIX","useLeftHeaderButtonRtlForumTransition","shouldHideSearch","shouldDisableDropdownMenuTransitionRef","prevShouldHideSearch","handleDropdownMenuTransitionEnd","cancelMediaDownload","videoRef","isPaidPreview","localBlobUrl","isSpoilerShown","showSpoiler","hideSpoiler","isIntersectingForLoading","isIntersectingForPlaying","wasIntersectedRef","isLoadAllowed","setIsLoadAllowed","shouldLoad","isPlayAllowed","setIsPlayAllowed","getVideoMediaHash","isFullMediaPreloaded","mediaLoader","mediaData","loadProgress","useMediaWithLoadProgress","getMediaFormat","isPlayerReady","markPlayerReady","getMediaThumbUri","hasThumb","isInline","isUnsupported","useUnsupportedMedia","previewMediaHash","isPreviewPreloaded","canLoadPreview","previewBlobUrl","shouldHidePreview","previewRef","useMediaTransition","noThumb","thumbRef","downloadProgress","isTransferring","transferProgress","getMediaTransferState","wasLoadDisabled","spinnerRef","shouldRenderSpinner","withShouldRender","playButtonRef","playProgress","setPlayProgress","handleTimeUpdate","currentTime","isFinite","calculateExtendedPreviewDimensions","calculateVideoDimensions","isFromSpinner","isAllowed","handleClickOnSpinner","componentClassName","MIN_MEDIA_HEIGHT","OptimizedVideo","defaultMuted","onTimeUpdate","onReady","withAnimation","ProgressSpinner","emojiDataPromise","emojiRawData","emojiData","RE_EMOJI_SEARCH","RE_LOWERCASE_TEST","EMOJIS_LIMIT","FILTER_MIN_LENGTH","prepareRecentEmojisMemo","recentEmojiIds","prepareLibraryMemo","byNative","buildCollectionByKey","baseEmojisByKeyword","natives","emojisByKeyword","byKeyword","byName","names","maxKeyLength","keyword","searchInLibraryMemo","library","matchedKeywords","flat","matchedNames","setById","setFilteredEmojis","setFilteredCustomEmojis","exec","uncompressEmoji","ensureEmojiData","detectEmojiCodeThrottled","getEmojiCode","updateFiltered","nativeEmojis","native","uniqueByField","selectCustomEmojiForEmojis","isForce","emojiHtml","emojiCode","newShouldAutoInsert","endsWith","SymbolMenu","setStickerSearchQuery","setGifSearchQuery","triggerRef","isSymbolMenuLoaded","onSymbolMenuLoadingComplete","setContextMenuAnchor","symbolMenuButtonClassName","handleActivateSymbolMenu","triggerEl","handleSearchOpen","handleSymbolMenuOpen","EDITABLE_INPUT_MODAL_CSS_SELECTOR","getLayout","withPortal","onLoad","onSearchOpen","character","langProvider","ElectronEvent","INCLUDE_FILTER_FIELDS","EXCLUDE_FILTER_FIELDS","selectChatFilters","state","mode","selectTemp","selectedChatIds","selectedChatTypes","includedChatIds","includeFilters","pick","folder","excludedChatIds","excludeFilters","getSuggestedFolderName","filters","groups","channels","contacts","nonContacts","INITIAL_STATE","chatFilter","foldersReducer","folderId","omit","isChatList","useFoldersReducer","useReducer","ChatCallStatus","previewMessageId","selectChatLastMessageId","lastMessage","selectChatLastMessage","savedDialogSender","fromId","lastMessageSender","currentChatId","currentThreadId","isSelectedForum","forumPanelChatId","lastMessageTopic","selectThreadParam","topicsInfo","selectTopicsInfo","lastMessageStory","getIsChatMuted","selectIsForumPanelOpen","canScrollDown","canChangeFolder","chatFolders","lastMessageOutgoingStatus","withInterfaceAnimations","listedTopicIds","topicsById","Chat","orderDiff","animationType","offsetTop","onDragEnter","openSavedDialog","toggleChatInfo","loadTopics","openForumPanel","closeForumPanel","setShouldCloseRightColumn","reportMessages","isDeleteModalOpen","openDeleteModal","closeDeleteModal","isMuteModalOpen","openMuteModal","closeMuteModal","isChatFolderModalOpen","openChatFolderModal","closeChatFolderModal","shouldRenderDeleteModal","markRenderDeleteModal","unmarkRenderDeleteModal","shouldRenderMuteModal","markRenderMuteModal","unmarkRenderMuteModal","shouldRenderChatFolderModal","markRenderChatFolderModal","unmarkRenderChatFolderModal","renderSubtitle","useChatListEntry","statefulMediaContent","groupStatefulContent","getIsForumPanelClosed","useSelectorSignal","selectIsForumPanelClosed","force","handleDragEnter","handleDelete","handleMute","handleChatFolderChange","handleReport","contextActions","useChatContextActions","isOnline","hasShownClass","isAvatarOnlineShown","IS_OPEN_IN_NEW_TAB_SUPPORTED","createLocationHash","chatClassName","withPortalForMenu","withStoryGap","subscriptionUntil","StoryViewerOrigin","ChatList","isCallActive","isCallNotEmpty","LastMessageMeta","draftDate","hasMainMiniApp","DeleteChatModal","MuteChatModal","ChatFolderModal","ANIMATION_DURATION","RIBBON_OFFSET","RIBBON_Z_INDEX","STROKE_OFFSET","CANVAS_OFFSET","callbacks","animateOpening","isArchived","cancelDelayedCallbacks","toggler","leftMainHeader","ribbonPeers","toggleAvatars","getHTMLElements","headerBottom","headerRight","toTop","lastToggleAvatar","firstToggleAvatar","lastId","getPeerId","reverse","isLast","toggleAvatar","selectByPeerId","fromTop","fromLeft","fromWidth","toLeft","toWidth","fromTranslateX","fromTranslateY","fromScale","toTranslateX","toTranslateY","toScale","createGhost","ghost2","togglerStyles","ghostLast","ghostAnimateName","applyStyles","ghostRevealName","createDelayedCallback","ANIMATION_END_DELAY","animateClosing","ribbon","ribbonStyles","sourceEl","oncontextmenu","sourceCanvas","canvas","getContext","drawImage","ms","timeout","clear","SMALL_IMAGE_THRESHOLD","MIN_MESSAGE_LENGTH_FOR_BLUR","MIN_MEDIA_WIDTH","isPhoto","isWebPagePhoto","isWebPageVideo","calculateInlineImageDimensions","minMediaWidth","stretchFactor","finalWidth","finalHeight","isSmall","forcePlaceCaretAtEnd","nodeValue","selectNodeContents","collapse","MENU_CLOSE_TIMEOUT","closeTimeout","menuCloseTimeout","isMouseInside","WebLink","onMessageClick","linkData","getFirstLinkInMessage","domain","formattedDescription","renderMessageSummary","safeLinkContent","Media","Link","cache","WeakMap","cached","areSortedArraysEqual","lastArgs","lastResult","letterClassName","noLoopLimit","iconEmojiId","TopicDefaultIcon","topicId","onStart","onEnd","isLongPressActive","isPressed","timerId","canProcessEvent","touches","onMouseUp","onTouchStart","onTouchEnd","extractorEl","deleteContents","createContextualFragment","lastInsertedNode","insertNode","setStartAfter","setEndAfter","useCommonAncestor","sel","cloneRange","intersectsNode","cloneContents","caretRange","endContainer","endOffset","Node","TEXT_NODE","removeAllSelections","orderedPeerIds","archived","active","byPeerId","isRibbonShown","isArchivedRibbonShown","chatsById","peerStories","canShow","toggleStoryRibbon","PREVIEW_AVATAR_COUNT","closeFriends","isCloseFriend","isRead","isForCloseFriends","preloadPeerIds","useStoryPreloader","beginHeavyAnimation","avatar","withStorySolid","forceFriendStorySolid","Component","domRoot","$aiRoot","createRoot","render","SELECTED_APPENDIX_COLORS","dark","outgoing","incoming","light","requestMediaWorker","MAX_WORKERS","navigator","hardwareConcurrency","instances","launchMediaWorkers","IS_TEST","inputSelector","getRange","setRange","onSelectionChange","Element","DropTarget","isQuick","isGeneric","svgRef","isHovered","markHovered","unmarkHovered","handleDragLeave","relatedTarget","toTarget","handleResize","baseVal","useResizeObserver","useEffectOnce","onDrop","onDragLeave","rx","hideTimeoutRef","prevWithQuick","handleFilesDrop","dataTransfer","dt","folderFiles","handleQuickFilesDrop","fromTarget","shouldRenderQuick","onDragOver","handleDragOver","reducer","initialState","reducerRef","dispatch","NothingFound","create","drawerKey","drawerParams","closeDrawer","SVG_EXTENSIONS","smaller","withDate","datetime","onDateClick","downloadMedia","setSharedSettingOption","isSvgDialogOpen","openSvgDialog","closeSvgDialog","shouldNotWarnAboutSvg","setShouldNotWarnAboutSvg","extension","getDocumentExtension","wasIntersected","markIntersected","shouldDownload","documentHash","getDocumentMediaHash","hasPreview","getDocumentHasPreview","previewData","innerMediaType","handleDownload","originMessage","handleSvgConfirm","handleDateClick","thumbnailDataUri","actionIcon","isDocumentVideo","Checkbox","checked","onCheck","DAY_MINUTES","WEEK_MINUTES","getWeekStart","setHours","getDay","setDate","shiftTimeRanges","ranges","shiftedRanges","startMinute","endMinute","last","DAYS","_","BusinessHours","businessHours","transitionRef","expand","isMyTime","showInMyTime","showInLocalTime","timezoneSignal","timezones","timezoneMinuteDifference","timezone","timezoneId","getTimezoneOffset","utcOffset","workHours","weekStart","days","dayStart","dayEnd","splitDays","segments","isBusinessOpen","localTimeHours","minutesSinceWeekStart","currentDay","handleTriggerOffset","slide","ACTIVE_SLIDE_CLASS_NAME","offsetHeight","handleAnimationStart","TO_SLIDE_CLASS_NAME","isStatic","withColorTransition","formatWeekday","segment","EFFECT_EMOJIS","birthdayNumbers","animatedEmojiEffects","isPremiumPurchaseBlocked","UserBirthday","birthday","isInSettings","animationPlayedRef","isPlayingAnimation","playAnimation","stopAnimation","formattedDate","age","today","year","setMonth","formatDateToString","getAge","numbersForAge","numbers","byEmoji","digit","effectSticker","randomEffect","random","hash","effectHash","column","valueKey","canGiftPremium","handleOpenGiftModal","secondaryIconClassName","onSecondaryIconClick","IS_OFFSET_PATH_SUPPORTED","birthdate","chatOrUserId","botAppPermissions","selectBotAppPermissions","botVerification","chatInviteLink","inviteLink","bio","about","canInviteUsers","isUserRightBanned","getHasAdminRight","topicLink","selectTopicLink","hasSavedMessages","listIds","saved","personalChannel","personalChannelId","isBotCanManageEmojiStatus","ChatExtra","updateChatMutedState","updateTopicMutedState","loadPeerStories","requestCollectibleInfo","toggleUserEmojiStatusPermission","toggleUserLocationPermission","chatUsernames","businessLocation","businessWorkHours","personalChannelMessageId","prevPeerId","locationMediaHash","locationBlobUrl","locationRightComponent","isTopicInfo","shouldRenderAllLinks","activeUsernames","u","activeChatUsernames","getChatLink","handleClickLocation","handleNotificationChange","manageEmojiStatusChange","handleLocationPermissionChange","isAccessGranted","geolocation","handleOpenSavedDialog","formattedNumber","handlePhoneClick","FRAGMENT_PHONE_LENGTH","FRAGMENT_PHONE_CODE","collectible","handleUsernameClick","isChat","isEditable","shouldMarkBotTrusted","appTermsInfo","terms","ChatAnimationTypes","renderUsernames","allowSelection","Switcher","inactive","iconId","usernameList","otherUsernames","usernameLinks","idx","dataTransferItems","traverseFileTreePromise","entry","itemFile","getAsFile","isDirectory","createReader","readEntries","entriesPromises","kind","webkitGetAsEntry","PRIMARY_VIDEO_MIME","SECONDARY_VIDEO_MIME","InviteLink","withShare","onRevoke","openChatWithDraft","isOnlyCopy","copyLink","handleCopyClick","handleShare","PrimaryLinkMenuButton","onTrigger","readOnly","DropdownMenu","trigger","isInSearch","isServiceNotifications","deleteTitle","getCanDeleteChat","toggleChatPinned","toggleSavedDialogPinned","toggleChatArchived","markChatMessagesRead","markChatUnread","openChatInNewTab","actionOpenInNewTab","togglePinned","actionPin","actionDelete","compact","actionAddToFolder","actionMute","actionMaskAsRead","actionMarkAsUnread","actionArchive","isChatArchived","actionReport","isInFolder","PROVIDERS","google","bing","osm","apple","VENUE_COLORS","arts_entertainment","building","education","food","home","nightlife","parks_outdoors","shops","travel","work","RANDOM_COLORS","prepareMapUrl","provider","providerUrl","cos","str","prevHash","currVal","charCodeAt","setTrigger","confirmPaymentMessage","formatStarsAsText","totalAmount","withMarkdown","HeaderMenuContainer","isSuperGroup","selectLanguageCode","translationLanguage","selectTranslationLanguage","doNotTranslate","noMenu","fullInfo","isMainThread","isDiscussionThread","getIsSavedDialog","isUserBlocked","selectIsUserBlocked","canRestartBot","canStartBot","selectIsChatBotNotStarted","canUnblock","canSubscribe","canSearch","canCall","canMute","canLeave","canEnterVoiceChat","canCreateVoiceChat","manageCall","isCreator","isChatBasicGroup","canViewStatistics","canViewMonetization","canViewBoosts","canShowBoostModal","pendingJoinRequests","requestsPending","shouldJoinToSend","isJoinToSend","shouldSendJoinRequest","isJoinRequest","noAnimation","isTranslating","selectCanTranslateChat","isTranslationDisabled","detectedChatLanguage","HeaderActions","isForForum","canExpandActions","onTopicSearch","joinChannel","sendBotCommand","openMiddleSearch","restartBot","requestNextManagementScreen","unblockUser","setViewForumAsMessages","menuButtonRef","setIsMenuOpen","menuAnchor","setMenuAnchor","handleHeaderMenuOpen","handleHeaderMenuClose","handleHeaderMenuHide","handleSubscribeClick","handleStartBot","handleRestartBot","handleUnblock","handleJoinRequestsClick","screen","ManagementScreens","JoinRequests","handleSearchClick","setFocusInSearchInput","handleAsMessagesClick","handleRequestCall","handleHotkeySearchClick","IS_APP","withExtraActions","onJoinRequestsClick","withForumActions","onSubscribeChannel","onSearchClick","onAsMessagesClick","searchInput","CLOSE_DURATION","RESIZE_THROTTLE","useHeaderPane","providedRef","withResizeObserver","onStateChange","setShouldRender","localRef","lastHeightRef","reset","handleUpdate","requestForcedReflow","currentHeight","applyAnimationState","noTransition","cumulativeHeight","shiftPx","apply","setExtraStyles","isPanelOpen","path","DEFAULT_HANDLERS","seekbackward","seekforward","previoustrack","nexttrack","seekTo","registerMediaSession","mediaSession","updateMetadata","setMediaSessionHandlers","warn","setActionHandler","clearMediaSession","playbackState","setPositionState","setPlaybackState","buildMediaMetadata","artist","artwork","MediaMetadata","onlineCount","selectChatOnlineCount","selectTopic","selectThreadMessagesCount","GroupChatInfo","noAvatar","withChatType","loadFullChat","isTopic","isMin","shouldRestoreHeight","getChatTypeString","groupStatus","getGroupStatus","onlineStatus","withThumb","downloadButtonRef","shouldRenderDownloadButton","dimensionsStyle","fileSelector","accept","noMultiple","onchange","click","useCanvasBlur","IS_CANVAS_FILTER_SUPPORTED","thumbClassNames","useMediaTransitionDeprecated","shouldSpinnerRender","spinnerClassNames","getColorFromExtension","sizeString","getFileSizeString","subtitle","getDocumentThumbnailDimensions","formatMediaDateTime","NO_CORNER_THRESHOLD","ChatForumLastMessage","renderLastMessage","lastMessageRef","mainColumnRef","lastActiveTopic","otherTopics","getOrderedTopics","isReversedCorner","setIsReversedCorner","overwrittenWidth","setOverwrittenWidth","handleOpenTopicClick","handleOpenTopicMouseDown","getIsMobile","lastMessageElement","mainColumnElement","lastMessageWidth","offsetWidth","mainColumnWidth","shouldTryLoadingStory","mediaContent","mediaHasPreview","getMessageSticker","getMessageMediaThumbDataUri","getMessageMediaHash","getMessageRoundVideo","renderLastMessageOrTyping","isDraftReplyToTopic","isEmptyLocalReply","asPreview","senderName","getMessageSenderName","messageSummary","MessageSummary","noEmoji","inChatList","getMessageIsSpoiler","Opacity","Move","CHAT_HEIGHT_PX","tracks","currentTrackId","voiceQueue","musicQueue","playNext","trackId","isReverseOrder","currentTrack","onTrackChange","nextTrackId","findNextInQueue","audioPlayer","parseMessageKey","splitTrackId","messageKey","nextTrack","onForcePlay","stopCurrentAudio","register","trackType","track","handleEvent","eventName","isSafariPatchInProgress","proxy","Proxy","createAudio","trackIdComparator","addTrackToQueue","paused","preventPlayAfterPatch","preload","patchSafariProgressiveAudio","globalSearch","currentContent","GlobalSearchContent","Music","openedChatId","queueFilter","cleanUpQueue","prevSrc","setCurrentTime","fastSeek","setVolume","setPlaybackRate","rate","playbackRate","toggleMuted","requestNextTrack","isFirst","requestPreviousTrack","shouldRemoveFromQueue","trackIdFilter","removeFromQueue","currentId","getTrackQueue","Search","chatAudio","makeTrackId","getMessageServerKey","one","two","dateOne","keyOne","dateTwo","keyTwo","localeCompare","isPrivateChat","getPrivateChatUserId","isBot","canDeleteForAll","isBasicGroup","leaveChannel","deleteHistory","deleteSavedHistory","deleteChannel","deleteChatUser","blockUser","handleDeleteForAll","shouldDeleteForAll","handleDeleteAndStop","handleDeleteChat","handleLeaveChat","header","COLOR_REPLACE_PATTERN","AttachBotIcon","Text","iconSvg","mediaDataWithReplacedColors","doc","stroke","strokeWidth","outerHTML","isInSideMenu","canShowNew","toggleAttachBot","icons","openMenu","closeMenu","menuPosition","setMenuPosition","isFromSideMenu","handleCloseMenu","handleCloseAnimationEnd","handleRemoveBot","shortName","isDisclaimerNeeded","MAX_QUICK_IMG_SIZE","MAX_THUMB_IMG_SIZE","MAX_ASPECT_RATIO","FILE_EXT_REGEX","filename","createObjectURL","mimeType","quick","shouldSendAsFile","img","preloadImage","validateAspectRatio","shouldShrink","GIF_MIME_TYPE","compressedBlobUrl","resizedUrl","scaleImage","revokeObjectURL","videoWidth","videoHeight","preloadVideo","createPosterForVideo","performer","coverUrl","fetchFromUrl","selectCover","common","picture","cover","coverBlob","parseAudioMetadata","uniqueId","shouldSendCompressed","attach","getBoostProgressInfo","boostInfo","freezeOnLevelUp","boosts","currentLevelBoosts","nextLevelBoosts","hasMyBoost","prepaidGiveaways","isJustUpgraded","currentLevel","hasNextLevel","levelProgress","remainingBoosts","isMaxLevel","getSenderName","sanitizeUIMessages","toolResultIds","toolInvocation","toolCallId","sanitizedToolInvocations","MediaAreaSuggestedReaction","mediaArea","customEmojiSize","setCustomEmojiSize","views","isDark","isFlipped","reactionCount","shouldDisplayCount","updateCustomEmojiSize","clientHeight","prevReactionCount","effectSize","shouldPause","restrictedEmoji","selectRestrictedEmoji","MediaAreaWeather","temperatureC","backgroundColor","convertToRGBA","textColor","getTextColor","updateCustomSize","isImmediate","customEmojiHeight","applyFn","withTranslucentThumb","formatTemperature","STORY_ASPECT_RATIO","NO_SHINY_TYPES","prepareStyle","mediaWidth","rotation","radius","coordinates","pixelRadius","pixelWidth","pixelHeight","MediaAreaOverlay","isStoryPlaying","openUniqueGiftBySlug","closeStoryViewer","setMediaWidth","useWindowSize","clientWidth","MOBILE_SCREEN_MAX_WIDTH","screenAspectRatio","mediaAreas","isShiny","slug","handleMediaAreaClick","lastCallback","onBeforeUnload","AbsoluteVideo","videoUrl","load","recalculatePositionAndSize","isPlaying","TextFormatter","GrammarChecker","languageToolURL","saplingEditOverview","URLSearchParams","useragent","disabledRules","allowIncompleteResults","rule","general_error_type","category","error_type","classifyTypeGramma","replacement","replacements","shortMessage","original_text","sentence","sentence_start","check","sapling","dmp","diff_match_patch","getNodeForIndex","textNodes","remaining","getUnderlineOffset","containerRect","editableDiv","computed","parseFloat","TooltipContent","errorIndex","handleFixError","InputErrorTooltip","generalErrorType","Popover","placement","toLocaleLowerCase","ErrorsReview","errorRanges","handleFixAllErrors","currentErrorIndex","setCurrentErrorIndex","currentErrorRange","setCurrentErrorRange","currentError","setCurrentError","currentSentence","setCurrentSentence","curRange","originalText","remove_segment","handleAcceptAll","handleClickPrev","LeftOutlined","handleClickNext","RightOutlined","errorMarkers","setErrorMarkers","errorsModalVisible","setErrorsModalVisible","errorsModalPosition","setErrorsModalPosition","corrections","spalingLoading","fixError","fixAllErrors","setErrorRanges","setSpalingLoading","lastTextRef","lastCheckTimeRef","highLightErrors","textarea","walker","createTreeWalker","NodeFilter","SHOW_TEXT","nextNode","currentNode","getTextNodes","validRanges","span","pruneInvalidRanges","markers","startNode","startOffset","endNode","rects","getClientRects","textareaRect","inputNlpRuleCheck","debounce","leading","trailing","handleInputChange","updatedErrors","oldText","diffs","diff_main","diff_cleanupSemantic","newErrors","oldCursor","valid","op","len","updateErrorOffsetsWithInvalidate","editor","correction","fullText","offsetChange","realStart","realEnd","useGrammarChecker","closeErrorModal","showErrorModal","inputReact","closable","footer","open","onCancel","destroyOnClose","SCROLLER_CLASS","TEXT_FORMATTER_SAFE_AREA_PX","IGNORE_KEYS","messageSendKeyCombo","isAttachmentModalInput","editLastMessage","replyToNextMessage","openPremiumModal","selectionTimeoutRef","cloneRef","scrollerCloneRef","sharedCanvasRef","sharedCanvasHqRef","absoluteContainerRef","isContextMenuOpenRef","isTextFormatterOpen","openTextFormatter","closeTextFormatter","textFormatterAnchorPosition","setTextFormatterAnchorPosition","selectedRange","setSelectedRange","isTextFormatterDisabled","setIsTextFormatterDisabled","isMobileDevice","shouldDisplayTimer","setShouldDisplayTimer","handleTimerEnd","prefixId","colorFilter","useColorFilter","playersById","clearPlayers","player","synchronizeElements","playerIdsToClear","playerId","mediaUrl","getCustomEmojiMediaDataForInput","canvasBounds","elementBounds","customEmoji","isHq","selectIsAlwaysHighPriorityEmoji","renderId","viewId","isLottie","hexToRgb","lottie","ensureRLottie","coords","g","removeView","setSharedCanvasCoords","absoluteVideo","createPlayer","animation","addCustomEmojiInputRenderCallback","activePlayersById","prevCustomColor","throttledSynchronizeElements","prevDpr","freezeAnimation","unfreezeAnimation","unfreezeAnimationOnRaf","useInputCustomEmojis","maxInputHeight","updateInputHeight","willSend","fastRaf","scroller","newHeight","isOverflown","transitionDuration","toggle","htmlRef","focusInput","getIsHeavyAnimating","handleCloseTextFormatter","empty","clearSelection","checkSelection","selectedText","START_TO_END","processSelection","selectionRect","scrollerRect","processSelectionWithTimeout","handleOpenPremiumModal","handleDocumentKeyDown","getIsDirectTextInputDisabled","isSelectionCollapsed","isContentEditable","newEvent","KeyboardEvent","captureFirstTab","captureKeyboardListeners","onTab","suppressFocus","inputScrollerContentClass","placeholderAriaLabel","InputGrammarWrapper","onKeyDown","isComposing","targetIndexDelta","handleCloseContextMenu","e2","onTouchCancel","TextTimer","langKey","endsAt","anchorPosition","RADIUS_RATIO","lastWorkerIndex","thumbData","canvasRef","workerIndex","cycleRestrict","offscreenRef","blurThumb","uri","image","transferControlToOffscreen","ceil","useOffscreenCanvasBlur","groupCall","selectChatGroupCall","isMasterTab","groupCalls","activeGroupCallId","participantsCount","GroupCallTopPane","onPaneStateChange","requestMasterAndJoinGroupCall","subscribeToGroupCallUpdates","handleJoinGroupCall","participants","fetchedParticipants","subscribed","renderingParticipantCount","renderingFetchedParticipants","isRendering","resolver","deps","msOrSchedulerFn","noFirst","setValue","useThrottledSignal","getValue","throttledResolver","noLast","useDebouncedCallback","useDebouncedSignal","debouncedResolver","PENDING_TRANSLATIONS","requestedLanguageCode","messageTranslation","byLangCode","languageTranslations","markMessagesTranslationPending","throttledProcessPending","addPendingTranslation","translateMessagesByTencent","hasUnprocessed","messageIdsToTranslate","oldMessageIds","newMessageIds","removePendingTranslations","DEFAULT_LIMITS","limits","selectPremiumLimit","MAX_EMPTY_WAVEFORM_POINTS","SPIKE_WIDTH","SPIKE_STEP","SPIKE_RADIUS","HEIGHT","TINY_SCREEN_WIDTH_MQL","matchMedia","WITH_AVATAR_TINY_SCREEN_WIDTH_MQL","AVG_VOICE_DURATION","isReverse","spikes","peak","MIN_SPIKES","MAX_SPIKES","getSeeklineSpikeAmounts","durationFactor","spikesCount","fitCount","newData","springFactor","leftFiller","rightFiller","val","interpolateArray","encoded5bit","bitsCount","valuesCount","bitsData","l","byteIndex","bitShift","lastByteIndex","lastBitShift","lastValue","decodeWaveform","fillStyle","progressFillStyle","ctx","globalAlpha","spikeHeight","beginPath","moveTo","arcTo","closePath","roundedRectangle","renderWaveform","renderSeekline","bufferedRanges","seekerRef","onPause","transcribeAudio","openOneTimeMediaModal","contentAudio","isMediaUnread","getMessageWebPageAudio","mediaSource","isVoice","isSeeking","setIsActivated","coverHash","getMediaHash","coverBlobUrl","isInOneTimeModal","OneTimeModal","handleForcePlay","handleTrackChange","isBuffered","bufferingHandlers","checkBuffering","useBuffering","noReset","playPause","useAudioPlayer","getMediaDuration","reversePlayProgress","withSeekline","isLoadingForPlaying","shouldRenderCross","handleButtonClick","setAudioPlayerOrigin","handleDownloadClick","handleSeek","MouseEvent","targetTouches","handleStartSeek","handleStopSeek","handleTranscribe","renderFirstLine","onCapture","onDrag","SharedMedia","buttonClassNames","renderWithTitle","renderSecondLine","backgroundImage","AnimatedIcon","Flame","transparent","withColor","noCross","rotationOffset","showProgress","showSeekline","renderAudio","onClickTranscribe","ry","renderVoice","dependencies","prevDeps","next","shouldSkipUndefined","cleanupRef","bySelector","mediaFormat","selector","selectorSignal","getter","setter","createSignal","clientsCount","state2","resolverOrSignal","isAsync","valueRef","resolverRef","runCurrentResolver","isSync","currentResolver","isFirstRun","dependency","subscribe","useSignalEffect","useSelector","selectIsSynced","spentTime","VIDEO_REVEAL_DELAY","useStreaming","MediaSourceClass","getMediaSource","isTypeSupported","onSourceOpen","sourceBuffer","addSourceBuffer","loader","makeProgressiveLoader","done","readyState","endOfStream","appendBuffer","display","unloadVideo","checkIfStreamingSupported","buffer","ManagedMediaSource","MediaSource","GLOBAL_SUMMARY_CHATID","frozenNotificationHeight","archiveHeight","unconfirmedSessionHeight","setUnreadCount","updateUnreadCount","param","useGlobalSummaryBadge","GlobalSummaryBadge","updateRoomData","ARCHIVE_CUSTOM_PEER","isCustomPeer","avatarIcon","customPeerAvatarColor","Archive","archiveSettings","updateArchiveSettings","orderedChatIds","useFolderManagerForOrderedIds","ARCHIVED_FOLDER_ID","unreadCounters","useFolderManagerForUnreadCounters","archiveUnreadCount","chatsCount","previewItems","arr","unread","actionMinimize","isMinimized","actionExpand","actionHide","isHidden","minimized","buttonClassName","info","Badge","avatarWrapper","chatsPreview","folderType","chatFolder","selectChatFolder","EmptyFolder","foldersDispatch","onSettingsScreenSelect","handleEditFolder","SettingsScreens","FoldersEditFolderFromChatList","FrozenAccountNotification","UnconfirmedSession","sessions","onHeightChange","changeSessionSettings","terminateAuthorization","borderBoxSize","blockSize","contentRect","firstUnconfirmed","dateCreated","session","isUnconfirmed","locationString","deviceModel","region","country","isConfirmed","handleReject","RESERVED_HOTKEYS","canDisplayArchive","onLeftColumnContentChange","openNextChat","shouldIgnoreDragRef","setUnconfirmedSessionHeight","isAllFolder","isSaved","isPresetFolder","isUnreadFolder","isAIFolder","resolvedFolderId","ALL_FOLDER_ID","SAVED_FOLDER_ID","PRESET_FOLDER_ID","UNREAD_FOLDER_ID","AI_FOLDER_ID","shouldDisplayArchive","shouldShowFrozenAccountNotification","chatsHeight","ARCHIVE_MINIMIZED_HEIGHT","serenaHeight","viewportIds","getMore","useInfiniteScroll","CHAT_LIST_SLICE","shouldShowUnconfirmedSessions","sessionsArray","isCurrent","FRESH_AUTH_PERIOD","handleKeyDown","IS_MAC_OS","isArchiveInList","LeftColumnContent","Archived","observe","useIntersectionObserver","rootRef","throttleMs","handleArchivedClick","handleFrozenAccountNotificationClick","handleArchivedDragEnter","renderedOverflowTrigger","onOverscroll","onReset","overscrollTriggerRef","isTriggerJustEnabled","lastScrollTopRef","isTriggerEnabledRef","lastIsOnTopRef","lastScrollAtRef","isReturningOverscrollRef","enableOverscrollTrigger","noScrollInertiaStop","stopScrollInertia","disableOverscrollTrigger","newScrollTop","isMovingDown","isMovingUp","isOnTop","lastEventDelay","forceMutation","handleWheel","deltaY","useTopOverscroll","InfiniteScroll","itemSelector","preloadBackwards","withAbsolutePositioning","beforeChildren","onLoadMore","ChatSerena","viewportOffset","pinnedCount","getPinnedChatsCount","teactOrderKey","getOrderKey","renderChats","Loading","STREAMING_PROGRESS","STREAMING_TIMEOUT","PROGRESS_THROTTLE","isHtmlAllowed","isStreaming","IS_PROGRESSIVE_SUPPORTED","Progressive","useUniqueId","setLoadProgress","startedAtRef","handleProgress","ProfilePhoto","canPlayVideo","isDeletedUser","isChatWithRepliesBot","canHaveMedia","avatarHash","avatarPhotoId","getChatAvatarHash","previewHash","getProfilePhotoMediaHash","getVideoProfilePhotoMediaHash","isVideoReady","markVideoReady","isFullMediaReady","isBlurredThumb","blurredThumbCanvasRef","specialIcon","userFullName","getFirstLetters","profilePhotos","selectPeerPhotos","avatarOwnerId","mediaViewer","currentTopicId","emojiStatusSticker","emojiStatusSlug","ProfileInfo","openPrivacySettingsNoticeModal","photos","prevMediaIndex","prevAvatarOwnerId","hasSlideAnimation","setHasSlideAnimation","slideAnimation","currentPhotoIndex","setCurrentPhotoIndex","currentIndex","usePhotosPreload","handleProfilePhotoClick","SettingsAvatar","handleStatusClick","fromUserId","selectPreviousMedia","selectNextMedia","handleOpenGetReadDateModal","isReadDate","Right","totalPhotosLength","enumerator","activeDashIndex","MAX_PHOTO_DASH_COUNT","renderPhotoTabs","personalPhoto","fallbackPhoto","renderPhoto","canCopyTitle","isReadDateRestrictedByMe","renderStatus","strokeLinejoin","clipPath","StopIcon","clipRule","ArrowRightIcon","SendIcon","SettingIcon","to","begin","repeatCount","groupCallId","selectGroupCall","selectGroupCallParticipant","participantId","selectIsAdminInActiveGroupCall","selectActiveGroupCall","selectPhoneCallUser","adminId","selectCanInviteToActiveGroupCall","CHANNEL_OVERVIEW","isPercentage","GROUP_OVERVIEW","MESSAGE_OVERVIEW","isPlain","isApproximate","STORY_OVERVIEW","BOOST_OVERVIEW","withAbsoluteValue","StatisticsOverview","statistics","isToncoin","renderBalanceCell","usdRate","integerTonPart","decimalTonPart","integerUsdPart","decimalUsdPart","balances","schema","getSchemaByType","formatFullDate","minDate","maxDate","availableBalance","currentBalance","overallRevenue","cell","field","formatInteger","percentage","renderOverviewItemValue","change","isChangeNegative","fragments","lastIndex","original","startPlaying","stopPlaying","isPositionUpdateRequired","requirePositionUpdate","resetPositionUpdate","effectAnimationId","effectStickerId","getEffectHash","effectBlob","handleEnded","effectClassName","toggleStoriesHidden","isDense","StoryRibbon","preventMessageInputBlurWithBubbling","handleSavedStories","profileTab","handleArchivedStories","handleOpenProfile","handleArchivePeer","hasUnreadStories","name_hasUnreadStory","contextMenu","isClosing","closing","useHorizontalScroll","StoryRibbonButton","FOCUS_DELAY_MS","MODAL_HIDE_DELAY_MS","useInputFocusOnOpen","useMarkScrolled","isScrolled","orderDiffs","numberOfUp","numberOfDown","Infinity","typingUser","typingUserName","AVATAR_SIZES","micro","mini","tiny","small","medium","large","giant","jumbo","createClassNameBuilder","webPhoto","noPersonalPhoto","clickOpenRoom","realPeer","isApiPeerUser","isReplies","pxSize","hasBlobUrl","author","decoding","titleKey","isPremiumGradient","withPremiumGradient","hoverTitle","MouseButton","Main","customStyle","Tooltip","hasSpoiler","shouldUseDraft","CustomSend","NOTIFICATION_DURATION","shouldDisableNotification","setIsUnsupported","handleUnsupported","IS_MOBILE","onError","onCanPlay","PROGRESS_CENTER","ROUND_VIDEO_DIMENSIONS_PX","PROGRESS_CIRCUMFERENCE","stopPrevious","playerRef","circleRef","shouldRenderSpoiler","getProgress","setProgress","getThrottledProgress","playerEl","capturePlaying","togglePlaying","isPriority","originalDuration","onInit","noPlaylist","noProgressUpdates","noHandleEvents","controllerRef","setIsPlaying","isPlayingSync","mediaHandlers","closeAudioPlayer","skipTime","seekOffset","seekTime","makeMediaHandlers","PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION","prevShouldPlay","playIfPresent","setTime","audioProxy","SponsoredContextMenu","sponsorInfo","canReport","shouldSkipAbout","onAboutAdsClick","onSponsoredHide","onSponsorInfo","onSponsoredReport","menuRef","isSeparatorNeeded","SponsoredMessageContextMenuContainer","randomId","additionalInfo","onItemClick","openAboutAdsModal","reportSponsored","hideSponsored","handleItemClick","handleAboutAdsOpen","handleSponsoredHide","handleSponsorInfo","handleReportSponsoredMessage","ICON_SIZE","canManageTopics","EmptyForum","openCreateTopicPanel","handleCreateTopic","centered","selectTopics","isChatMuted","canDelete","selectCanDeleteTopic","Topic","deleteTopic","handleOpenDeleteModal","handleOpenTopic","wasOpened","editTopic","toggleTopicPinned","markTopicRead","canToggleClosed","getCanManageTopic","canTogglePinned","actionUnreadMark","actionCloseTopic","useTopicContextActions","ForumPanel","onOpenAnimationStart","scrollTopHandlerRef","setIsScrolled","handleClose","handleToggleChatInfo","orderedPinnedTopicIds","totalCount","TOPICS_SLICE","shouldRenderRef","prevIsVisible","useHistoryBack","onBack","endHeavyAnimation","waitForTransitionEnd","onTransitionEnd","TOPIC_HEIGHT_PX","sensitiveArea","TOPIC_LIST_SENSITIVE_AREA","renderTopics","GENERAL_TOPIC_ID","prop","getBrowserFullscreenElementProp","useFullscreen","elRef","exitCallback","enterCallback","isFullscreen","setIsFullscreen","listener","HTMLVideoElement","controls","listenerEnter","listenerExit","setFullscreen","requestFullscreen","webkitRequestFullscreen","webkitEnterFullscreen","mozRequestFullScreen","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","webkitExitFullscreen","useFullscreenStatus","checkIfFullscreen","removeElectronListener","electron","FULLSCREEN_CHANGE","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","fullscreenProp","NBSP","containedMedia","replyMedia","isVideoThumbnail","previewPhotoSizes","useThumbnail","replyForwardInfo","senderChatTitle","forwardSenderTitle","areSendersSame","isFullVideo","shouldRenderVideo","getMediaContentTypeDescription","CONTENT_NOT_SUPPORTED","renderMediaContentType","isReplyToQuote","renderSender","freezeWhenClosed","preloadedStories","canPreload","aroundStoryId","isArray","mediaHashes","isStream","getProgressiveUrl","cachedSize","chunk","byteLength","preloadStream","head","autoplay","disableRemotePlayback","preloadProgressive","preloadHashes","preloadIds","findIdsAroundCurrentId","currentStoryId","altVideos","getPreloadMediaHashes","LIMIT_PER_BATCH","BATCH_INTERVAL","pendingDownloads","planned","download","pendingDownload","downloadOne","processQueue","DEFAULT_PART_SIZE","MAX_END_TO_CACHE","bufferCache","sizeCache","pendingRequests","chunkSize","fileSize","cacheKey","arrayBuffer","fullSize","super","hasError","getDerivedStateFromError","componentDidCatch","errorInfo"],"sourceRoot":""}