(self.webpackChunktelegram_t=self.webpackChunktelegram_t||[]).push([[2163],{1671:()=>{},7971:(t,e,a)=>{"use strict";a.d(e,{Ah:()=>D,Al:()=>A,ER:()=>b,LW:()=>h,WE:()=>l,_b:()=>p,aT:()=>O,mu:()=>y,tg:()=>f,ur:()=>w});var n=a(25279),s=a(72531),i=a(20919),o=a(81120),c=(a(96140),a(90709)),r=a(58554),m=a(69036),u=a(30020),d=a(13439);a(29807),u.GlobalWorkerOptions.workerSrc="pdf.worker.min.js";const g=a(47595);async function l(t,e=!1){if(!t.isMentioned||!t.content?.text?.text)return;let a={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-reply-mention"}],content:JSON.stringify({messageId:t.id,content:t.content.text?.text,isAuto:e,status:"loading"})};await x(a),(0,o.Rx)({message:t.content.text?.text,language:S()}).then((n=>{n.text?(a={...a,content:JSON.stringify({messageId:t.id,content:t.content.text?.text,replys:n.text,isAuto:e,status:"success"})},x(a)):N(a,t,e)})).catch((n=>{console.log("error",n),N(a,t,e)}))}async function f(t,e=!1){const a=t.content?.photo;if(!a)return;const s=(0,c.VO)(a,"download");if(!s)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await x(i),await I({mimeType:"image/jpeg",mediaHash:s,message:t,newMessage:i,isAuto:e})}async function w(t,e=!1){const a=t.content?.webPage,s=a?a?.url:t.content?.text?.text;if(!s||""===s)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await x(i),(0,o.U$)({url:s,text:t.content?.text?.text||"",language:S()}).then((a=>{a?.text?(i={...i,content:JSON.stringify({message:t,summaryInfo:a?.text,isAuto:e,status:"success"})},x(i)):N(i,t,e)})).catch((a=>{console.log("error",a),N(i,t,e)}))}async function y(t,e=!1){const a=t.content?.document;if(!a)return;const s=(0,c.VO)(a,"download");if(!s)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};if(await x(i),b(a.mimeType))return void I({mimeType:a.mimeType,mediaHash:s,message:t,newMessage:i,isAuto:e});await r.hd(s,0);const m=r.Ih(s);if(!m)return;const d=await fetch(m),l=await d.blob(),f=await l.arrayBuffer();let w="";switch(a.mimeType){case"text/plain":w=(new TextDecoder).decode(f);break;case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":w=(await g.extractRawText({arrayBuffer:f})).value;break;case"application/pdf":const a=await u.getDocument({data:f}).promise;let n="";for(let t=1;t<=a.numPages;t++){const e=await a.getPage(t);n+=(await e.getTextContent()).items.map((t=>t.str)).join(" ")+"\n"}w=n;break;default:return void await N(i,t,e)}""!==w?(0,o.OJ)({content:w,language:S()}).then((a=>{a?.text?(i={...i,content:JSON.stringify({message:t,summaryInfo:a?.text,isAuto:e,status:"success"})},x(i)):N(i,t,e)})).catch((a=>{console.log("error",a),N(i,t,e)})):await N(i,t,e)}async function p(t,e=!1){const a=t.content?.voice;if(!a)return;const s=(0,c.VO)(a,"download");if(!s)return;const i=Math.floor(4194304);if(t.content.audio?.size&&t.content.audio?.size*(4/3)>i)return void m.Ay.info("File size exceeds limit (4 MB)");let o={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await x(o),await T({mediaHash:s,mimeType:"audio/ogg",filename:a?.id+".ogg",size:a?.size,newMessage:o,message:t,isAuto:e})}async function h(t,e=!1){const a=t.content?.audio;if(!a)return;const s=(0,c.VO)(a,"download");if(!s)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await x(i),await T({mediaHash:s,mimeType:a?.mimeType,filename:a?.fileName,size:a?.size,newMessage:i,message:t,isAuto:e})}async function A(t,e=!1){const a=t.content?.video;if(!a)return;const s=(0,c.VO)(a,"download");if(!s)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await x(i),"video/mp4"===a?.mimeType?await T({mediaHash:s,mimeType:a?.mimeType,filename:a?.fileName,size:a?.size,newMessage:i,message:t,isAuto:e}):await N(i,t,e)}async function x(t){await(i.zs.message?.storeMessage(t)),await s.A.emit(s.E.AddRoomAIMessage,t)}async function T({mediaHash:t,mimeType:e,filename:a,size:n,newMessage:s,message:i,isAuto:c}){try{if(n&&n>4718592)return m.Ay.info("File size exceeds limit (4.5 MB)"),s={...s,content:JSON.stringify({message:i,errorMsg:"File size exceeds limit (4.5 MB)",isAuto:c,status:"error"})},void await x(s);await r.hd(t,0);const u=r.Ih(t);if(!u)return void N(s,i,c);const d=await fetch(u),g=await d.blob(),l=new FormData;l.append("file",g,a||"audio.ogg"),l.append("language",S()),e&&l.append("mimeType",e);const f=await(0,o.DF)(l);f?.text?x(s={...s,content:JSON.stringify({message:i,summaryInfo:f?.text,isAuto:c,status:"success"})}):N(s,i,c)}catch(t){console.log("error",t),N(s,i,c)}}async function I({mimeType:t,mediaHash:e,message:a,newMessage:n,isAuto:s}){await r.hd(e,0);const i=r.Ih(e);if(!i)return void N(n,a,s);const c=await fetch(i),m=await c.blob(),u=new FileReader;u.onloadend=function(){const e=u.result?.toString().split(",")[1]||"";(0,o.IT)({image:`data:${t};base64,`+e,language:S()}).then((t=>{t?.text?x(n={...n,content:JSON.stringify({message:a,summaryInfo:JSON.stringify({text:t?.text}),isAuto:s,status:"success"})}):N(n,a,s)})).catch((t=>{console.log("error",t),N(n,a,s)}))},u.readAsDataURL(m)}function O(t){const{photo:e,document:a,webPage:n,voice:s,audio:i,text:o,video:c}=t?.content,r=D(o?.text),m=o?.text&&""!==o.text.trim();return e||a||n&&!m||s||i||r||c}function D(t){return"string"==typeof t&&/^https?:\/\/[\w\-._~:/?#[\]@!$&'()*+,;=%]+$/i.test(t)}function b(t){return t.startsWith("image/")}async function N(t,e,a){t={...t,content:JSON.stringify({message:e,isAuto:a,status:"error"})},await x(t)}function S(){const t=(0,d.mS)(),{autoTranslateLanguage:e="en"}=t.settings.byKey;return new Intl.DisplayNames([e],{type:"language"}).of(e)||"en"}},15365:()=>{},25352:()=>{},26959:()=>{},58725:(t,e,a)=>{"use strict";a.d(e,{default:()=>s});var n=a(7971);const s=class{static messageListener(t){const{webPage:e,photo:a,video:s,audio:i,voice:o,document:c,text:r}=t.content,m=(0,n.Ah)(r?.text);t.isMentioned?(0,n.WE)(t,!0):e&&!r?.text||m?(0,n.ur)(t,!0):a||(o?(0,n._b)(t,!0):i?(0,n.LW)(t,!0):c?(0,n.mu)(t,!0):s&&(0,n.Al)(t,!0))}}},60195:()=>{},98196:()=>{}}]);
//# sourceMappingURL=2163.087e3400ac4b298c35a3.js.map