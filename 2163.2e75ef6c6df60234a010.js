(self.webpackChunkTelyAI=self.webpackChunkTelyAI||[]).push([[2163],{1671:()=>{},7971:(t,e,a)=>{"use strict";a.d(e,{Ah:()=>D,Al:()=>x,ER:()=>N,LW:()=>A,WE:()=>f,_b:()=>h,aT:()=>v,mu:()=>p,tg:()=>w,ur:()=>y});var n=a(25279),s=a(72531),i=a(77787),o=a(81120),r=(a(96140),a(90709)),c=a(58554),m=a(69036),u=a(30020),d=a(13439),g=a(60919);u.GlobalWorkerOptions.workerSrc="pdf.worker.min.js";const l=a(70306);async function f(t,e=!1){if(!t.isMentioned||!t.content?.text?.text)return;let a={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-reply-mention"}],content:JSON.stringify({messageId:t.id,content:t.content.text?.text,isAuto:e,status:"loading"})};await T(a),(0,o.Rx)({message:t.content.text?.text,language:b()}).then(n=>{n.text?(a={...a,content:JSON.stringify({messageId:t.id,content:t.content.text?.text,replys:n.text,isAuto:e,status:"success"})},T(a)):S(a,t,e)}).catch(n=>{console.log("error",n),S(a,t,e)})}async function w(t,e=!1){const a=t.content?.photo;if(!a)return;const s=(0,r.VO)(a,"download");if(!s)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await T(i),await O({mimeType:"image/jpeg",mediaHash:s,message:t,newMessage:i,isAuto:e})}async function y(t,e=!1){const a=(0,d.mS)(),s=(0,g.Pn$)(a,t),i=s?s?.url:t.content?.text?.text;if(!i||""===i)return;let r={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await T(r),(0,o.U$)({url:i,text:t.content?.text?.text||"",language:b()}).then(a=>{a?.text?(r={...r,content:JSON.stringify({message:t,summaryInfo:a?.text,isAuto:e,status:"success"})},T(r)):S(r,t,e)}).catch(a=>{console.log("error",a),S(r,t,e)})}async function p(t,e=!1){const a=t.content?.document;if(!a)return;const s=(0,r.VO)(a,"download");if(!s)return;if(N(a.mimeType)&&e)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};if(await T(i),N(a.mimeType))return void O({mimeType:a.mimeType,mediaHash:s,message:t,newMessage:i,isAuto:e});if(m=a.mimeType,["video/mp4"].indexOf(m)>=0)return void await I({mediaHash:s,mimeType:a?.mimeType,filename:a?.fileName,size:a?.size,newMessage:i,message:t,isAuto:e});var m;await c.hd(s,0);const d=c.Ih(s);if(!d)return;const g=await fetch(d),f=await g.blob(),w=await f.arrayBuffer();let y="";switch(a.mimeType){case"text/plain":y=(new TextDecoder).decode(w);break;case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":y=(await l.extractRawText({arrayBuffer:w})).value;break;case"application/pdf":const a=await u.getDocument({data:w}).promise;let n="";for(let t=1;t<=a.numPages;t++){const e=await a.getPage(t);n+=(await e.getTextContent()).items.map(t=>t.str).join(" ")+"\n"}y=n;break;default:return void await S(i,t,e)}""!==y?(0,o.OJ)({content:y,language:b()}).then(a=>{a?.text?(i={...i,content:JSON.stringify({message:t,summaryInfo:a?.text,isAuto:e,status:"success"})},T(i)):S(i,t,e)}).catch(a=>{console.log("error",a),S(i,t,e)}):await S(i,t,e)}async function h(t,e=!1){const a=t.content?.voice;if(!a)return;const s=(0,r.VO)(a,"download");if(!s)return;const i=Math.floor(4194304);if(t.content.audio?.size&&t.content.audio?.size*(4/3)>i)return void m.Ay.info("File size exceeds limit (4 MB)");let o={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await T(o),await I({mediaHash:s,mimeType:"audio/ogg",filename:a?.id+".ogg",size:a?.size,newMessage:o,message:t,isAuto:e})}async function A(t,e=!1){const a=t.content?.audio;if(!a)return;const s=(0,r.VO)(a,"download");if(!s)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await T(i),await I({mediaHash:s,mimeType:a?.mimeType,filename:a?.fileName,size:a?.size,newMessage:i,message:t,isAuto:e})}async function x(t,e=!1){const a=t.content?.video;if(!a)return;const s=(0,r.VO)(a,"download");if(!s)return;let i={chatId:t.chatId,timestamp:(new Date).getTime(),id:(0,n.A)(),createdAt:new Date,role:"assistant",annotations:[{type:"room-ai-media-summary"}],content:JSON.stringify({message:t,isAuto:e,status:"loading"})};await T(i),"video/mp4"===a?.mimeType?await I({mediaHash:s,mimeType:a?.mimeType,filename:a?.fileName,size:a?.size,newMessage:i,message:t,isAuto:e}):await S(i,t,e)}async function T(t){await(i.zs.message?.storeMessage(t)),await s.A.emit(s.E.AddRoomAIMessage,t)}async function I({mediaHash:t,mimeType:e,filename:a,size:n,newMessage:s,message:i,isAuto:r}){try{if(n&&n>4718592)return m.Ay.info("File size exceeds limit (4.5 MB)"),s={...s,content:JSON.stringify({message:i,errorMsg:"File size exceeds limit (4.5 MB)",isAuto:r,status:"error"})},void await T(s);await c.hd(t,0);const u=c.Ih(t);if(!u)return void S(s,i,r);const d=await fetch(u),g=await d.blob(),l=new FormData;l.append("file",g,a||"audio.ogg"),l.append("language",b()),e&&l.append("mimeType",e);const f=await(0,o.DF)(l);f?.text?T(s={...s,content:JSON.stringify({message:i,summaryInfo:f?.text,isAuto:r,status:"success"})}):S(s,i,r)}catch(t){console.log("error",t),S(s,i,r)}}async function O({mimeType:t,mediaHash:e,message:a,newMessage:n,isAuto:s}){await c.hd(e,0);const i=c.Ih(e);if(!i)return void S(n,a,s);const r=await fetch(i),m=await r.blob(),u=new FileReader;u.onloadend=function(){const e=u.result?.toString().split(",")[1]||"";(0,o.IT)({image:`data:${t};base64,`+e,language:b()}).then(t=>{t?.text?T(n={...n,content:JSON.stringify({message:a,summaryInfo:JSON.stringify({text:t?.text}),isAuto:s,status:"success"})}):S(n,a,s)}).catch(t=>{console.log("error",t),S(n,a,s)})},u.readAsDataURL(m)}function v(t){const{photo:e,document:a,webPage:n,voice:s,audio:i,text:o,video:r}=t?.content,c=D(o?.text),m=o?.text&&""!==o.text.trim();return e||a||n&&!m||s||i||c||r}function D(t){return"string"==typeof t&&/^https?:\/\/[\w\-._~:/?#[\]@!$&'()*+,;=%]+$/i.test(t)}function N(t){return t.startsWith("image/")}async function S(t,e,a){t={...t,content:JSON.stringify({message:e,isAuto:a,status:"error"})},await T(t)}function b(){const t=(0,d.mS)(),{autoTranslateLanguage:e="en"}=t.settings.byKey;return new Intl.DisplayNames([e],{type:"language"}).of(e)||"en"}},15365:()=>{},25352:()=>{},26959:()=>{},58725:(t,e,a)=>{"use strict";a.d(e,{default:()=>s});var n=a(7971);const s=class{static messageListener(t){const{webPage:e,photo:a,video:s,audio:i,voice:o,document:r,text:c}=t.content,m=(0,n.Ah)(c?.text);t.isMentioned?(0,n.WE)(t,!0):e&&!c?.text||m?(0,n.ur)(t,!0):a?(0,n.tg)(t,!0):o?(0,n._b)(t,!0):i?(0,n.LW)(t,!0):r?(0,n.mu)(t,!0):s&&(0,n.Al)(t,!0)}}},60195:()=>{},98196:()=>{}}]);
//# sourceMappingURL=2163.2e75ef6c6df60234a010.js.map